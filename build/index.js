(()=>{var __webpack_modules__={924:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var o=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,i;return i={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function verb(e){return function(t){return step([e,t])}}function step(i){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(s=i[0]&2?o["return"]:i[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;if(o=0,s)i=[i[0]&2,s.value];switch(i[0]){case 0:case 1:s=i;break;case 4:r.label++;return{value:i[1],done:false};case 5:r.label++;o=i[1];i=[0];continue;case 7:i=r.ops.pop();r.trys.pop();continue;default:if(!(s=r.trys,s=s.length>0&&s[s.length-1])&&(i[0]===6||i[0]===2)){r=0;continue}if(i[0]===3&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(i[0]===6&&r.label<s[1]){r.label=s[1];s=i;break}if(s&&r.label<s[2]){r.label=s[2];r.ops.push(i);break}if(s[2])r.ops.pop();r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e];o=0}finally{n=s=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}};Object.defineProperty(t,"__esModule",{value:true});t.MemoryServerFactory=void 0;var s=r(5517);var i=r(1257);var a=function(){function MemoryServerFactory(){}MemoryServerFactory.generateMemoryServer=function(e,t,r,s){return n(this,void 0,void 0,(function(){var n,a,c,l;return o(this,(function(o){switch(o.label){case 0:n={};a={checkMD5:true};if(e){n.dbName=e}if(t){n.port=t}if(r){n.storageEngine=r}if(s){a.version=s}c={instance:n,binary:a};return[4,i.MongoMemoryServer.create(c)];case 1:l=o.sent();return[2,l]}}))}))};MemoryServerFactory.verifyMemoryServer=function(e){return n(this,void 0,void 0,(function(){var t,r,n;return o(this,(function(o){switch(o.label){case 0:o.trys.push([0,2,3,6]);r=e.getUri();t=new s.MongoClient(r,{useUnifiedTopology:true,useNewUrlParser:true});return[4,t.connect()];case 1:o.sent();return[2,r];case 2:n=o.sent();console.error(n);throw n;case 3:if(!(t===null||t===void 0?void 0:t.isConnected()))return[3,5];return[4,t.close()];case 4:o.sent();o.label=5;case 5:return[7];case 6:return[2]}}))}))};return MemoryServerFactory}();t.MemoryServerFactory=a},1667:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};var i=this&&this.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var a=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,i;return i={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function verb(e){return function(t){return step([e,t])}}function step(i){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(s=i[0]&2?o["return"]:i[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;if(o=0,s)i=[i[0]&2,s.value];switch(i[0]){case 0:case 1:s=i;break;case 4:r.label++;return{value:i[1],done:false};case 5:r.label++;o=i[1];i=[0];continue;case 7:i=r.ops.pop();r.trys.pop();continue;default:if(!(s=r.trys,s=s.length>0&&s[s.length-1])&&(i[0]===6||i[0]===2)){r=0;continue}if(i[0]===3&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(i[0]===6&&r.label<s[1]){r.label=s[1];s=i;break}if(s&&r.label<s[2]){r.label=s[2];r.ops.push(i);break}if(s[2])r.ops.pop();r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e];o=0}finally{n=s=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}};Object.defineProperty(t,"__esModule",{value:true});var c=s(r(2186));var l=r(1257);var u=r(3129);var d=r(924);function runCommand(e,t){return i(this,void 0,void 0,(function(){var r,n;return a(this,(function(o){console.info('Executing the target script: "'+e+'"');r=c.getInput("db-connection-env-var");n=c.getInput("mongoms-debug");process.env[r]=t;if(n){process.env["MONGOMS_DEBUG"]="1"}try{return[2,u.execSync(e,{env:process.env,cwd:process.env.githubRepository}).toString()]}catch(e){console.error(e);throw e}return[2]}))}))}function run(){return i(this,void 0,void 0,(function(){var e,t,r,n,o,s,i,u,p;return a(this,(function(a){switch(a.label){case 0:a.trys.push([0,4,5,8]);t=c.getInput("instance-dbName");r=Number.parseInt(c.getInput("instance-port"));n=c.getInput("instance-storageEngine");o=c.getInput("binary-version");return[4,d.MemoryServerFactory.generateMemoryServer(t,r,n,o)];case 1:e=a.sent();return[4,d.MemoryServerFactory.verifyMemoryServer(e)];case 2:s=a.sent();i=c.getInput("run-command");return[4,runCommand(i,s)];case 3:u=a.sent();console.info(u);return[3,8];case 4:p=a.sent();c.setFailed(p.message);return[3,8];case 5:if(!((e===null||e===void 0?void 0:e.state)===l.MongoMemoryServerStates.running))return[3,7];return[4,e.stop()];case 6:a.sent();a.label=7;case 7:return[7];case 8:return[2]}}))}))}run()},7351:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.issue=t.issueCommand=void 0;const i=s(r(2087));const a=r(5278);function issueCommand(e,t,r){const n=new Command(e,t,r);process.stdout.write(n.toString()+i.EOL)}t.issueCommand=issueCommand;function issue(e,t=""){issueCommand(e,{},t)}t.issue=issue;const c="::";class Command{constructor(e,t,r){if(!e){e="missing.command"}this.command=e;this.properties=t;this.message=r}toString(){let e=c+this.command;if(this.properties&&Object.keys(this.properties).length>0){e+=" ";let t=true;for(const r in this.properties){if(this.properties.hasOwnProperty(r)){const n=this.properties[r];if(n){if(t){t=false}else{e+=","}e+=`${r}=${escapeProperty(n)}`}}}}e+=`${c}${escapeData(this.message)}`;return e}}function escapeData(e){return a.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function escapeProperty(e){return a.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}},2186:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};var i=this&&this.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:true});t.getState=t.saveState=t.group=t.endGroup=t.startGroup=t.info=t.warning=t.error=t.debug=t.isDebug=t.setFailed=t.setCommandEcho=t.setOutput=t.getBooleanInput=t.getMultilineInput=t.getInput=t.addPath=t.setSecret=t.exportVariable=t.ExitCode=void 0;const a=r(7351);const c=r(717);const l=r(5278);const u=s(r(2087));const d=s(r(5622));var p;(function(e){e[e["Success"]=0]="Success";e[e["Failure"]=1]="Failure"})(p=t.ExitCode||(t.ExitCode={}));function exportVariable(e,t){const r=l.toCommandValue(t);process.env[e]=r;const n=process.env["GITHUB_ENV"]||"";if(n){const t="_GitHubActionsFileCommandDelimeter_";const n=`${e}<<${t}${u.EOL}${r}${u.EOL}${t}`;c.issueCommand("ENV",n)}else{a.issueCommand("set-env",{name:e},r)}}t.exportVariable=exportVariable;function setSecret(e){a.issueCommand("add-mask",{},e)}t.setSecret=setSecret;function addPath(e){const t=process.env["GITHUB_PATH"]||"";if(t){c.issueCommand("PATH",e)}else{a.issueCommand("add-path",{},e)}process.env["PATH"]=`${e}${d.delimiter}${process.env["PATH"]}`}t.addPath=addPath;function getInput(e,t){const r=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!r){throw new Error(`Input required and not supplied: ${e}`)}if(t&&t.trimWhitespace===false){return r}return r.trim()}t.getInput=getInput;function getMultilineInput(e,t){const r=getInput(e,t).split("\n").filter((e=>e!==""));return r}t.getMultilineInput=getMultilineInput;function getBooleanInput(e,t){const r=["true","True","TRUE"];const n=["false","False","FALSE"];const o=getInput(e,t);if(r.includes(o))return true;if(n.includes(o))return false;throw new TypeError(`Input does not meet YAML 1.2 "Core Schema" specification: ${e}\n`+`Support boolean input list: \`true | True | TRUE | false | False | FALSE\``)}t.getBooleanInput=getBooleanInput;function setOutput(e,t){process.stdout.write(u.EOL);a.issueCommand("set-output",{name:e},t)}t.setOutput=setOutput;function setCommandEcho(e){a.issue("echo",e?"on":"off")}t.setCommandEcho=setCommandEcho;function setFailed(e){process.exitCode=p.Failure;error(e)}t.setFailed=setFailed;function isDebug(){return process.env["RUNNER_DEBUG"]==="1"}t.isDebug=isDebug;function debug(e){a.issueCommand("debug",{},e)}t.debug=debug;function error(e){a.issue("error",e instanceof Error?e.toString():e)}t.error=error;function warning(e){a.issue("warning",e instanceof Error?e.toString():e)}t.warning=warning;function info(e){process.stdout.write(e+u.EOL)}t.info=info;function startGroup(e){a.issue("group",e)}t.startGroup=startGroup;function endGroup(){a.issue("endgroup")}t.endGroup=endGroup;function group(e,t){return i(this,void 0,void 0,(function*(){startGroup(e);let r;try{r=yield t()}finally{endGroup()}return r}))}t.group=group;function saveState(e,t){a.issueCommand("save-state",{name:e},t)}t.saveState=saveState;function getState(e){return process.env[`STATE_${e}`]||""}t.getState=getState},717:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.hasOwnProperty.call(e,r))n(t,e,r);o(t,e);return t};Object.defineProperty(t,"__esModule",{value:true});t.issueCommand=void 0;const i=s(r(5747));const a=s(r(2087));const c=r(5278);function issueCommand(e,t){const r=process.env[`GITHUB_${e}`];if(!r){throw new Error(`Unable to find environment variable for file command ${e}`)}if(!i.existsSync(r)){throw new Error(`Missing file at path: ${r}`)}i.appendFileSync(r,`${c.toCommandValue(t)}${a.EOL}`,{encoding:"utf8"})}t.issueCommand=issueCommand},5278:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.toCommandValue=void 0;function toCommandValue(e){if(e===null||e===undefined){return""}else if(typeof e==="string"||e instanceof String){return e}return JSON.stringify(e)}t.toCommandValue=toCommandValue},9690:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const o=r(8614);const s=n(r(8237));const i=n(r(6570));const a=s.default("agent-base");function isAgent(e){return Boolean(e)&&typeof e.addRequest==="function"}function isSecureEndpoint(){const{stack:e}=new Error;if(typeof e!=="string")return false;return e.split("\n").some((e=>e.indexOf("(https.js:")!==-1||e.indexOf("node:https:")!==-1))}function createAgent(e,t){return new createAgent.Agent(e,t)}(function(e){class Agent extends o.EventEmitter{constructor(e,t){super();let r=t;if(typeof e==="function"){this.callback=e}else if(e){r=e}this.timeout=null;if(r&&typeof r.timeout==="number"){this.timeout=r.timeout}this.maxFreeSockets=1;this.maxSockets=1;this.maxTotalSockets=Infinity;this.sockets={};this.freeSockets={};this.requests={};this.options={}}get defaultPort(){if(typeof this.explicitDefaultPort==="number"){return this.explicitDefaultPort}return isSecureEndpoint()?443:80}set defaultPort(e){this.explicitDefaultPort=e}get protocol(){if(typeof this.explicitProtocol==="string"){return this.explicitProtocol}return isSecureEndpoint()?"https:":"http:"}set protocol(e){this.explicitProtocol=e}callback(e,t,r){throw new Error('"agent-base" has no default implementation, you must subclass and override `callback()`')}addRequest(e,t){const r=Object.assign({},t);if(typeof r.secureEndpoint!=="boolean"){r.secureEndpoint=isSecureEndpoint()}if(r.host==null){r.host="localhost"}if(r.port==null){r.port=r.secureEndpoint?443:80}if(r.protocol==null){r.protocol=r.secureEndpoint?"https:":"http:"}if(r.host&&r.path){delete r.path}delete r.agent;delete r.hostname;delete r._defaultAgent;delete r.defaultPort;delete r.createConnection;e._last=true;e.shouldKeepAlive=false;let n=false;let o=null;const s=r.timeout||this.timeout;const onerror=t=>{if(e._hadError)return;e.emit("error",t);e._hadError=true};const ontimeout=()=>{o=null;n=true;const e=new Error(`A "socket" was not created for HTTP request before ${s}ms`);e.code="ETIMEOUT";onerror(e)};const callbackError=e=>{if(n)return;if(o!==null){clearTimeout(o);o=null}onerror(e)};const onsocket=t=>{if(n)return;if(o!=null){clearTimeout(o);o=null}if(isAgent(t)){a("Callback returned another Agent instance %o",t.constructor.name);t.addRequest(e,r);return}if(t){t.once("free",(()=>{this.freeSocket(t,r)}));e.onSocket(t);return}const s=new Error(`no Duplex stream was returned to agent-base for \`${e.method} ${e.path}\``);onerror(s)};if(typeof this.callback!=="function"){onerror(new Error("`callback` is not defined"));return}if(!this.promisifiedCallback){if(this.callback.length>=3){a("Converting legacy callback function to promise");this.promisifiedCallback=i.default(this.callback)}else{this.promisifiedCallback=this.callback}}if(typeof s==="number"&&s>0){o=setTimeout(ontimeout,s)}if("port"in r&&typeof r.port!=="number"){r.port=Number(r.port)}try{a("Resolving socket for %o request: %o",r.protocol,`${e.method} ${e.path}`);Promise.resolve(this.promisifiedCallback(e,r)).then(onsocket,callbackError)}catch(e){Promise.reject(e).catch(callbackError)}}freeSocket(e,t){a("Freeing socket %o %o",e.constructor.name,t);e.destroy()}destroy(){a("Destroying agent %o",this.constructor.name)}}e.Agent=Agent;e.prototype=e.Agent.prototype})(createAgent||(createAgent={}));e.exports=createAgent},6570:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});function promisify(e){return function(t,r){return new Promise(((n,o)=>{e.call(this,t,r,((e,t)=>{if(e){o(e)}else{n(t)}}))}))}}t.default=promisify},4855:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r(4351);var o=r(6006);var s=function(){function Mutex(e){this._semaphore=new o.default(1,e)}Mutex.prototype.acquire=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t;return n.__generator(this,(function(r){switch(r.label){case 0:return[4,this._semaphore.acquire()];case 1:e=r.sent(),t=e[1];return[2,t]}}))}))};Mutex.prototype.runExclusive=function(e){return this._semaphore.runExclusive((function(){return e()}))};Mutex.prototype.isLocked=function(){return this._semaphore.isLocked()};Mutex.prototype.release=function(){this._semaphore.release()};Mutex.prototype.cancel=function(){return this._semaphore.cancel()};return Mutex}();t.default=s},6006:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r(4351);var o=r(6984);var s=function(){function Semaphore(e,t){if(t===void 0){t=o.E_CANCELED}this._maxConcurrency=e;this._cancelError=t;this._queue=[];if(e<=0){throw new Error("semaphore must be initialized to a positive value")}this._value=e}Semaphore.prototype.acquire=function(){var e=this;var t=this.isLocked();var r=new Promise((function(t,r){return e._queue.push({resolve:t,reject:r})}));if(!t)this._dispatch();return r};Semaphore.prototype.runExclusive=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,o;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.acquire()];case 1:t=n.sent(),r=t[0],o=t[1];n.label=2;case 2:n.trys.push([2,,4,5]);return[4,e(r)];case 3:return[2,n.sent()];case 4:o();return[7];case 5:return[2]}}))}))};Semaphore.prototype.isLocked=function(){return this._value<=0};Semaphore.prototype.release=function(){if(this._maxConcurrency>1){throw new Error("this method is unavailable on semaphores with concurrency > 1; use the scoped release returned by acquire instead")}if(this._currentReleaser){var e=this._currentReleaser;this._currentReleaser=undefined;e()}};Semaphore.prototype.cancel=function(){var e=this;this._queue.forEach((function(t){return t.reject(e._cancelError)}));this._queue=[]};Semaphore.prototype._dispatch=function(){var e=this;var t=this._queue.shift();if(!t)return;var r=false;this._currentReleaser=function(){if(r)return;r=true;e._value++;e._dispatch()};t.resolve([this._value--,this._currentReleaser])};return Semaphore}();t.default=s},6984:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.E_CANCELED=t.E_ALREADY_LOCKED=t.E_TIMEOUT=void 0;t.E_TIMEOUT=new Error("timeout while waiting for mutex to become available");t.E_ALREADY_LOCKED=new Error("mutex already locked");t.E_CANCELED=new Error("request for lock canceled")},4038:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.tryAcquire=t.withTimeout=t.Semaphore=t.Mutex=void 0;var n=r(4351);var o=r(4855);Object.defineProperty(t,"Mutex",{enumerable:true,get:function(){return o.default}});var s=r(6006);Object.defineProperty(t,"Semaphore",{enumerable:true,get:function(){return s.default}});var i=r(5124);Object.defineProperty(t,"withTimeout",{enumerable:true,get:function(){return i.withTimeout}});var a=r(2621);Object.defineProperty(t,"tryAcquire",{enumerable:true,get:function(){return a.tryAcquire}});n.__exportStar(r(6984),t)},2621:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.tryAcquire=void 0;var n=r(6984);var o=r(5124);function tryAcquire(e,t){if(t===void 0){t=n.E_ALREADY_LOCKED}return o.withTimeout(e,0,t)}t.tryAcquire=tryAcquire},5124:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.withTimeout=void 0;var n=r(4351);var o=r(6984);function withTimeout(e,t,r){var s=this;if(r===void 0){r=o.E_TIMEOUT}return{acquire:function(){return new Promise((function(o,i){return n.__awaiter(s,void 0,void 0,(function(){var s,a,c,l,u;return n.__generator(this,(function(n){switch(n.label){case 0:s=false;a=setTimeout((function(){s=true;i(r)}),t);n.label=1;case 1:n.trys.push([1,3,,4]);return[4,e.acquire()];case 2:c=n.sent();if(s){l=Array.isArray(c)?c[1]:c;l()}else{clearTimeout(a);o(c)}return[3,4];case 3:u=n.sent();if(!s){clearTimeout(a);i(u)}return[3,4];case 4:return[2]}}))}))}))},runExclusive:function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r;return n.__generator(this,(function(n){switch(n.label){case 0:t=function(){return undefined};n.label=1;case 1:n.trys.push([1,,7,8]);return[4,this.acquire()];case 2:r=n.sent();if(!Array.isArray(r))return[3,4];t=r[1];return[4,e(r[0])];case 3:return[2,n.sent()];case 4:t=r;return[4,e()];case 5:return[2,n.sent()];case 6:return[3,8];case 7:t();return[7];case 8:return[2]}}))}))},release:function(){e.release()},cancel:function(){return e.cancel()},isLocked:function(){return e.isLocked()}}}t.withTimeout=withTimeout},9417:e=>{"use strict";e.exports=balanced;function balanced(e,t,r){if(e instanceof RegExp)e=maybeMatch(e,r);if(t instanceof RegExp)t=maybeMatch(t,r);var n=range(e,t,r);return n&&{start:n[0],end:n[1],pre:r.slice(0,n[0]),body:r.slice(n[0]+e.length,n[1]),post:r.slice(n[1]+t.length)}}function maybeMatch(e,t){var r=t.match(e);return r?r[0]:null}balanced.range=range;function range(e,t,r){var n,o,s,i,a;var c=r.indexOf(e);var l=r.indexOf(t,c+1);var u=c;if(c>=0&&l>0){if(e===t){return[c,l]}n=[];s=r.length;while(u>=0&&!a){if(u==c){n.push(u);c=r.indexOf(e,u+1)}else if(n.length==1){a=[n.pop(),l]}else{o=n.pop();if(o<s){s=o;i=l}l=r.indexOf(t,u+1)}u=c<l&&c>=0?c:l}if(n.length){a=[s,i]}}return a}},336:(e,t,r)=>{"use strict";var n=r(1642).Duplex,o=r(1669),s=r(1867).Buffer;function BufferList(e){if(!(this instanceof BufferList))return new BufferList(e);this._bufs=[];this.length=0;if(typeof e=="function"){this._callback=e;var t=function piper(e){if(this._callback){this._callback(e);this._callback=null}}.bind(this);this.on("pipe",(function onPipe(e){e.on("error",t)}));this.on("unpipe",(function onUnpipe(e){e.removeListener("error",t)}))}else{this.append(e)}n.call(this)}o.inherits(BufferList,n);BufferList.prototype._offset=function _offset(e){var t=0,r=0,n;if(e===0)return[0,0];for(;r<this._bufs.length;r++){n=t+this._bufs[r].length;if(e<n||r==this._bufs.length-1){return[r,e-t]}t=n}};BufferList.prototype._reverseOffset=function(e){var t=e[0];var r=e[1];for(var n=0;n<t;n++){r+=this._bufs[n].length}return r};BufferList.prototype.append=function append(e){var t=0;if(s.isBuffer(e)){this._appendBuffer(e)}else if(Array.isArray(e)){for(;t<e.length;t++)this.append(e[t])}else if(e instanceof BufferList){for(;t<e._bufs.length;t++)this.append(e._bufs[t])}else if(e!=null){if(typeof e=="number")e=e.toString();this._appendBuffer(s.from(e))}return this};BufferList.prototype._appendBuffer=function appendBuffer(e){this._bufs.push(e);this.length+=e.length};BufferList.prototype._write=function _write(e,t,r){this._appendBuffer(e);if(typeof r=="function")r()};BufferList.prototype._read=function _read(e){if(!this.length)return this.push(null);e=Math.min(e,this.length);this.push(this.slice(0,e));this.consume(e)};BufferList.prototype.end=function end(e){n.prototype.end.call(this,e);if(this._callback){this._callback(null,this.slice());this._callback=null}};BufferList.prototype.get=function get(e){if(e>this.length||e<0){return undefined}var t=this._offset(e);return this._bufs[t[0]][t[1]]};BufferList.prototype.slice=function slice(e,t){if(typeof e=="number"&&e<0)e+=this.length;if(typeof t=="number"&&t<0)t+=this.length;return this.copy(null,0,e,t)};BufferList.prototype.copy=function copy(e,t,r,n){if(typeof r!="number"||r<0)r=0;if(typeof n!="number"||n>this.length)n=this.length;if(r>=this.length)return e||s.alloc(0);if(n<=0)return e||s.alloc(0);var copy=!!e,o=this._offset(r),i=n-r,a=i,c=copy&&t||0,l=o[1],u,d;if(r===0&&n==this.length){if(!copy){return this._bufs.length===1?this._bufs[0]:s.concat(this._bufs,this.length)}for(d=0;d<this._bufs.length;d++){this._bufs[d].copy(e,c);c+=this._bufs[d].length}return e}if(a<=this._bufs[o[0]].length-l){return copy?this._bufs[o[0]].copy(e,t,l,l+a):this._bufs[o[0]].slice(l,l+a)}if(!copy)e=s.allocUnsafe(i);for(d=o[0];d<this._bufs.length;d++){u=this._bufs[d].length-l;if(a>u){this._bufs[d].copy(e,c,l);c+=u}else{this._bufs[d].copy(e,c,l,l+a);c+=u;break}a-=u;if(l)l=0}if(e.length>c)return e.slice(0,c);return e};BufferList.prototype.shallowSlice=function shallowSlice(e,t){e=e||0;t=typeof t!=="number"?this.length:t;if(e<0)e+=this.length;if(t<0)t+=this.length;if(e===t){return new BufferList}var r=this._offset(e),n=this._offset(t),o=this._bufs.slice(r[0],n[0]+1);if(n[1]==0)o.pop();else o[o.length-1]=o[o.length-1].slice(0,n[1]);if(r[1]!=0)o[0]=o[0].slice(r[1]);return new BufferList(o)};BufferList.prototype.toString=function toString(e,t,r){return this.slice(t,r).toString(e)};BufferList.prototype.consume=function consume(e){e=Math.trunc(e);if(Number.isNaN(e)||e<=0)return this;while(this._bufs.length){if(e>=this._bufs[0].length){e-=this._bufs[0].length;this.length-=this._bufs[0].length;this._bufs.shift()}else{this._bufs[0]=this._bufs[0].slice(e);this.length-=e;break}}return this};BufferList.prototype.duplicate=function duplicate(){var e=0,t=new BufferList;for(;e<this._bufs.length;e++)t.append(this._bufs[e]);return t};BufferList.prototype.destroy=function destroy(){this._bufs.length=0;this.length=0;this.push(null)};BufferList.prototype.indexOf=function(e,t,r){if(r===undefined&&typeof t==="string"){r=t;t=undefined}if(typeof e==="function"||Array.isArray(e)){throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.')}else if(typeof e==="number"){e=s.from([e])}else if(typeof e==="string"){e=s.from(e,r)}else if(e instanceof BufferList){e=e.slice()}else if(!s.isBuffer(e)){e=s.from(e)}t=Number(t||0);if(isNaN(t)){t=0}if(t<0){t=this.length+t}if(t<0){t=0}if(e.length===0){return t>this.length?this.length:t}var n=this._offset(t);var o=n[0];var i=n[1];for(o;o<this._bufs.length;o++){var a=this._bufs[o];while(i<a.length){var c=a.length-i;if(c>=e.length){var l=a.indexOf(e,i);if(l!==-1){return this._reverseOffset([o,l])}i=a.length-e.length+1}else{var u=this._reverseOffset([o,i]);if(this._match(u,e)){return u}i++}}i=0}return-1};BufferList.prototype._match=function(e,t){if(this.length-e<t.length){return false}for(var r=0;r<t.length;r++){if(this.get(e+r)!==t[r]){return false}}return true};(function(){var e={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(var t in e){(function(t){if(e[t]===null){BufferList.prototype[t]=function(e,r){return this.slice(e,e+r)[t](0,r)}}else{BufferList.prototype[t]=function(r){return this.slice(r,r+e[t])[t](0)}}})(t)}})();e.exports=BufferList},3717:(e,t,r)=>{var n=r(6891);var o=r(9417);e.exports=expandTop;var s="\0SLASH"+Math.random()+"\0";var i="\0OPEN"+Math.random()+"\0";var a="\0CLOSE"+Math.random()+"\0";var c="\0COMMA"+Math.random()+"\0";var l="\0PERIOD"+Math.random()+"\0";function numeric(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function escapeBraces(e){return e.split("\\\\").join(s).split("\\{").join(i).split("\\}").join(a).split("\\,").join(c).split("\\.").join(l)}function unescapeBraces(e){return e.split(s).join("\\").split(i).join("{").split(a).join("}").split(c).join(",").split(l).join(".")}function parseCommaParts(e){if(!e)return[""];var t=[];var r=o("{","}",e);if(!r)return e.split(",");var n=r.pre;var s=r.body;var i=r.post;var a=n.split(",");a[a.length-1]+="{"+s+"}";var c=parseCommaParts(i);if(i.length){a[a.length-1]+=c.shift();a.push.apply(a,c)}t.push.apply(t,a);return t}function expandTop(e){if(!e)return[];if(e.substr(0,2)==="{}"){e="\\{\\}"+e.substr(2)}return expand(escapeBraces(e),true).map(unescapeBraces)}function identity(e){return e}function embrace(e){return"{"+e+"}"}function isPadded(e){return/^-?0\d/.test(e)}function lte(e,t){return e<=t}function gte(e,t){return e>=t}function expand(e,t){var r=[];var s=o("{","}",e);if(!s||/\$$/.test(s.pre))return[e];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body);var c=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body);var l=i||c;var u=s.body.indexOf(",")>=0;if(!l&&!u){if(s.post.match(/,.*\}/)){e=s.pre+"{"+s.body+a+s.post;return expand(e)}return[e]}var d;if(l){d=s.body.split(/\.\./)}else{d=parseCommaParts(s.body);if(d.length===1){d=expand(d[0],false).map(embrace);if(d.length===1){var p=s.post.length?expand(s.post,false):[""];return p.map((function(e){return s.pre+d[0]+e}))}}}var h=s.pre;var p=s.post.length?expand(s.post,false):[""];var m;if(l){var y=numeric(d[0]);var g=numeric(d[1]);var v=Math.max(d[0].length,d[1].length);var b=d.length==3?Math.abs(numeric(d[2])):1;var S=lte;var w=g<y;if(w){b*=-1;S=gte}var _=d.some(isPadded);m=[];for(var E=y;S(E,g);E+=b){var O;if(c){O=String.fromCharCode(E);if(O==="\\")O=""}else{O=String(E);if(_){var C=v-O.length;if(C>0){var T=new Array(C+1).join("0");if(E<0)O="-"+T+O.slice(1);else O=T+O}}}m.push(O)}}else{m=n(d,(function(e){return expand(e,false)}))}for(var I=0;I<m.length;I++){for(var k=0;k<p.length;k++){var A=h+m[I]+p[k];if(!t||l||A)r.push(A)}}return r}},4044:(e,t,r)=>{var n=r(6800),o=r(5497),s=r(7113),i=r(3797),a=r(414),c=r(972),l=r(6142),u=r(8522),d=r(3639),p=r(5846),h=r(5325),m=r(9502),y=r(4636),g=r(2259),v=r(1031);n.BSON_INT32_MAX=2147483647;n.BSON_INT32_MIN=-2147483648;n.BSON_INT64_MAX=Math.pow(2,63)-1;n.BSON_INT64_MIN=-Math.pow(2,63);n.JS_INT_MAX=9007199254740992;n.JS_INT_MIN=-9007199254740992;n.Binary=o;n.Code=s;n.DBRef=i;n.Decimal128=a;n.Double=c;n.Int32=l;n.Long=u;n.Map=d;n.MaxKey=p;n.MinKey=h;n.ObjectId=m;n.ObjectID=m;n.BSONRegExp=y;n.Symbol=g;n.Timestamp=v;e.exports=n},5497:(e,t,r)=>{if(typeof global!=="undefined"){var n=r(4293).Buffer}var o=r(2863);function Binary(e,t){if(!(this instanceof Binary))return new Binary(e,t);if(e!=null&&!(typeof e==="string")&&!n.isBuffer(e)&&!(e instanceof Uint8Array)&&!Array.isArray(e)){throw new Error("only String, Buffer, Uint8Array or Array accepted")}this._bsontype="Binary";if(e instanceof Number){this.sub_type=e;this.position=0}else{this.sub_type=t==null?s:t;this.position=0}if(e!=null&&!(e instanceof Number)){if(typeof e==="string"){if(typeof n!=="undefined"){this.buffer=o.toBuffer(e)}else if(typeof Uint8Array!=="undefined"||Object.prototype.toString.call(e)==="[object Array]"){this.buffer=writeStringToArray(e)}else{throw new Error("only String, Buffer, Uint8Array or Array accepted")}}else{this.buffer=e}this.position=e.length}else{if(typeof n!=="undefined"){this.buffer=o.allocBuffer(Binary.BUFFER_SIZE)}else if(typeof Uint8Array!=="undefined"){this.buffer=new Uint8Array(new ArrayBuffer(Binary.BUFFER_SIZE))}else{this.buffer=new Array(Binary.BUFFER_SIZE)}this.position=0}}Binary.prototype.put=function put(e){if(e["length"]!=null&&typeof e!=="number"&&e.length!==1)throw new Error("only accepts single character String, Uint8Array or Array");if(typeof e!=="number"&&e<0||e>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var t=null;if(typeof e==="string"){t=e.charCodeAt(0)}else if(e["length"]!=null){t=e[0]}else{t=e}if(this.buffer.length>this.position){this.buffer[this.position++]=t}else{if(typeof n!=="undefined"&&n.isBuffer(this.buffer)){var r=o.allocBuffer(Binary.BUFFER_SIZE+this.buffer.length);this.buffer.copy(r,0,0,this.buffer.length);this.buffer=r;this.buffer[this.position++]=t}else{r=null;if(Object.prototype.toString.call(this.buffer)==="[object Uint8Array]"){r=new Uint8Array(new ArrayBuffer(Binary.BUFFER_SIZE+this.buffer.length))}else{r=new Array(Binary.BUFFER_SIZE+this.buffer.length)}for(var s=0;s<this.buffer.length;s++){r[s]=this.buffer[s]}this.buffer=r;this.buffer[this.position++]=t}}};Binary.prototype.write=function write(e,t){t=typeof t==="number"?t:this.position;if(this.buffer.length<t+e.length){var r=null;if(typeof n!=="undefined"&&n.isBuffer(this.buffer)){r=o.allocBuffer(this.buffer.length+e.length);this.buffer.copy(r,0,0,this.buffer.length)}else if(Object.prototype.toString.call(this.buffer)==="[object Uint8Array]"){r=new Uint8Array(new ArrayBuffer(this.buffer.length+e.length));for(var s=0;s<this.position;s++){r[s]=this.buffer[s]}}this.buffer=r}if(typeof n!=="undefined"&&n.isBuffer(e)&&n.isBuffer(this.buffer)){e.copy(this.buffer,t,0,e.length);this.position=t+e.length>this.position?t+e.length:this.position}else if(typeof n!=="undefined"&&typeof e==="string"&&n.isBuffer(this.buffer)){this.buffer.write(e,t,"binary");this.position=t+e.length>this.position?t+e.length:this.position}else if(Object.prototype.toString.call(e)==="[object Uint8Array]"||Object.prototype.toString.call(e)==="[object Array]"&&typeof e!=="string"){for(s=0;s<e.length;s++){this.buffer[t++]=e[s]}this.position=t>this.position?t:this.position}else if(typeof e==="string"){for(s=0;s<e.length;s++){this.buffer[t++]=e.charCodeAt(s)}this.position=t>this.position?t:this.position}};Binary.prototype.read=function read(e,t){t=t&&t>0?t:this.position;if(this.buffer["slice"]){return this.buffer.slice(e,e+t)}else{var r=typeof Uint8Array!=="undefined"?new Uint8Array(new ArrayBuffer(t)):new Array(t);for(var n=0;n<t;n++){r[n]=this.buffer[e++]}}return r};Binary.prototype.value=function value(e){e=e==null?false:e;if(e&&typeof n!=="undefined"&&n.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(typeof n!=="undefined"&&n.isBuffer(this.buffer)){return e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)}else{if(e){if(this.buffer["slice"]!=null){return this.buffer.slice(0,this.position)}else{var t=Object.prototype.toString.call(this.buffer)==="[object Uint8Array]"?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position);for(var r=0;r<this.position;r++){t[r]=this.buffer[r]}return t}}else{return convertArraytoUtf8BinaryString(this.buffer,0,this.position)}}};Binary.prototype.length=function length(){return this.position};Binary.prototype.toJSON=function(){return this.buffer!=null?this.buffer.toString("base64"):""};Binary.prototype.toString=function(e){return this.buffer!=null?this.buffer.slice(0,this.position).toString(e):""};var s=0;var writeStringToArray=function(e){var t=typeof Uint8Array!=="undefined"?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length);for(var r=0;r<e.length;r++){t[r]=e.charCodeAt(r)}return t};var convertArraytoUtf8BinaryString=function(e,t,r){var n="";for(var o=t;o<r;o++){n=n+String.fromCharCode(e[o])}return n};Binary.BUFFER_SIZE=256;Binary.SUBTYPE_DEFAULT=0;Binary.SUBTYPE_FUNCTION=1;Binary.SUBTYPE_BYTE_ARRAY=2;Binary.SUBTYPE_UUID_OLD=3;Binary.SUBTYPE_UUID=4;Binary.SUBTYPE_MD5=5;Binary.SUBTYPE_USER_DEFINED=128;e.exports=Binary;e.exports.Binary=Binary},6800:(e,t,r)=>{"use strict";var n=r(3639),o=r(8522),s=r(972),i=r(1031),a=r(9502),c=r(4636),l=r(2259),u=r(6142),d=r(7113),p=r(414),h=r(5325),m=r(5846),y=r(3797),g=r(5497);var v=r(2139),b=r(9290),S=r(1273),w=r(2863);var _=1024*1024*17;var E=w.allocBuffer(_);var BSON=function(){};BSON.prototype.serialize=function serialize(e,t){t=t||{};var r=typeof t.checkKeys==="boolean"?t.checkKeys:false;var n=typeof t.serializeFunctions==="boolean"?t.serializeFunctions:false;var o=typeof t.ignoreUndefined==="boolean"?t.ignoreUndefined:true;var s=typeof t.minInternalBufferSize==="number"?t.minInternalBufferSize:_;if(E.length<s){E=w.allocBuffer(s)}var i=b(E,e,r,0,0,n,o,[]);var a=w.allocBuffer(i);E.copy(a,0,0,a.length);return a};BSON.prototype.serializeWithBufferAndIndex=function(e,t,r){r=r||{};var n=typeof r.checkKeys==="boolean"?r.checkKeys:false;var o=typeof r.serializeFunctions==="boolean"?r.serializeFunctions:false;var s=typeof r.ignoreUndefined==="boolean"?r.ignoreUndefined:true;var i=typeof r.index==="number"?r.index:0;var a=b(t,e,n,i||0,0,o,s);return a-1};BSON.prototype.deserialize=function(e,t){return v(e,t)};BSON.prototype.calculateObjectSize=function(e,t){t=t||{};var r=typeof t.serializeFunctions==="boolean"?t.serializeFunctions:false;var n=typeof t.ignoreUndefined==="boolean"?t.ignoreUndefined:true;return S(e,r,n)};BSON.prototype.deserializeStream=function(e,t,r,n,o,s){s=s!=null?s:{};var i=t;for(var a=0;a<r;a++){var c=e[i]|e[i+1]<<8|e[i+2]<<16|e[i+3]<<24;s["index"]=i;n[o+a]=this.deserialize(e,s);i=i+c}return i};BSON.BSON_INT32_MAX=2147483647;BSON.BSON_INT32_MIN=-2147483648;BSON.BSON_INT64_MAX=Math.pow(2,63)-1;BSON.BSON_INT64_MIN=-Math.pow(2,63);BSON.JS_INT_MAX=9007199254740992;BSON.JS_INT_MIN=-9007199254740992;BSON.BSON_DATA_NUMBER=1;BSON.BSON_DATA_STRING=2;BSON.BSON_DATA_OBJECT=3;BSON.BSON_DATA_ARRAY=4;BSON.BSON_DATA_BINARY=5;BSON.BSON_DATA_OID=7;BSON.BSON_DATA_BOOLEAN=8;BSON.BSON_DATA_DATE=9;BSON.BSON_DATA_NULL=10;BSON.BSON_DATA_REGEXP=11;BSON.BSON_DATA_CODE=13;BSON.BSON_DATA_SYMBOL=14;BSON.BSON_DATA_CODE_W_SCOPE=15;BSON.BSON_DATA_INT=16;BSON.BSON_DATA_TIMESTAMP=17;BSON.BSON_DATA_LONG=18;BSON.BSON_DATA_MIN_KEY=255;BSON.BSON_DATA_MAX_KEY=127;BSON.BSON_BINARY_SUBTYPE_DEFAULT=0;BSON.BSON_BINARY_SUBTYPE_FUNCTION=1;BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;BSON.BSON_BINARY_SUBTYPE_UUID=3;BSON.BSON_BINARY_SUBTYPE_MD5=4;BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128;e.exports=BSON;e.exports.Code=d;e.exports.Map=n;e.exports.Symbol=l;e.exports.BSON=BSON;e.exports.DBRef=y;e.exports.Binary=g;e.exports.ObjectID=a;e.exports.Long=o;e.exports.Timestamp=i;e.exports.Double=s;e.exports.Int32=u;e.exports.MinKey=h;e.exports.MaxKey=m;e.exports.BSONRegExp=c;e.exports.Decimal128=p},7113:e=>{var t=function Code(e,t){if(!(this instanceof Code))return new Code(e,t);this._bsontype="Code";this.code=e;this.scope=t};t.prototype.toJSON=function(){return{scope:this.scope,code:this.code}};e.exports=t;e.exports.Code=t},3797:e=>{function DBRef(e,t,r){if(!(this instanceof DBRef))return new DBRef(e,t,r);this._bsontype="DBRef";this.namespace=e;this.oid=t;this.db=r}DBRef.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:this.db==null?"":this.db}};e.exports=DBRef;e.exports.DBRef=DBRef},414:(e,t,r)=>{"use strict";var n=r(8522);var o=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/;var s=/^(\+|-)?(Infinity|inf)$/i;var i=/^(\+|-)?NaN$/i;var a=6111;var c=-6176;var l=6176;var u=34;var d=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse();var p=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse();var h=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse();var m=/^([-+])?(\d+)?$/;var y=r(2863);var isDigit=function(e){return!isNaN(parseInt(e,10))};var divideu128=function(e){var t=n.fromNumber(1e3*1e3*1e3);var r=n.fromNumber(0);var o=0;if(!e.parts[0]&&!e.parts[1]&&!e.parts[2]&&!e.parts[3]){return{quotient:e,rem:r}}for(o=0;o<=3;o++){r=r.shiftLeft(32);r=r.add(new n(e.parts[o],0));e.parts[o]=r.div(t).low_;r=r.modulo(t)}return{quotient:e,rem:r}};var multiply64x2=function(e,t){if(!e&&!t){return{high:n.fromNumber(0),low:n.fromNumber(0)}}var r=e.shiftRightUnsigned(32);var o=new n(e.getLowBits(),0);var s=t.shiftRightUnsigned(32);var i=new n(t.getLowBits(),0);var a=r.multiply(s);var c=r.multiply(i);var l=o.multiply(s);var u=o.multiply(i);a=a.add(c.shiftRightUnsigned(32));c=new n(c.getLowBits(),0).add(l).add(u.shiftRightUnsigned(32));a=a.add(c.shiftRightUnsigned(32));u=c.shiftLeft(32).add(new n(u.getLowBits(),0));return{high:a,low:u}};var lessThan=function(e,t){var r=e.high_>>>0;var n=t.high_>>>0;if(r<n){return true}else if(r===n){var o=e.low_>>>0;var s=t.low_>>>0;if(o<s)return true}return false};var Decimal128=function(e){this._bsontype="Decimal128";this.bytes=e};Decimal128.fromString=function(e){var t=false;var r=false;var g=false;var v=0;var b=0;var S=0;var w=0;var _=0;var E=[0];var O=0;var C=0;var T=0;var I=0;var k=0;var A=0;var N=[0,0];var R=[0,0];var M=0;var D=0;e=e.trim();if(e.length>=7e3){throw new Error(""+e+" not a valid Decimal128 string")}var P=e.match(o);var L=e.match(s);var B=e.match(i);if(!P&&!L&&!B||e.length===0){throw new Error(""+e+" not a valid Decimal128 string")}if(P&&P[4]&&P[2]===undefined){throw new Error(""+e+" not a valid Decimal128 string")}if(e[D]==="+"||e[D]==="-"){t=e[D++]==="-"}if(!isDigit(e[D])&&e[D]!=="."){if(e[D]==="i"||e[D]==="I"){return new Decimal128(y.toBuffer(t?p:h))}else if(e[D]==="N"){return new Decimal128(y.toBuffer(d))}}while(isDigit(e[D])||e[D]==="."){if(e[D]==="."){if(r){return new Decimal128(y.toBuffer(d))}r=true;D=D+1;continue}if(O<34){if(e[D]!=="0"||g){if(!g){_=b}g=true;E[C++]=parseInt(e[D],10);O=O+1}}if(g){S=S+1}if(r){w=w+1}b=b+1;D=D+1}if(r&&!b){throw new Error(""+e+" not a valid Decimal128 string")}if(e[D]==="e"||e[D]==="E"){var j=e.substr(++D).match(m);if(!j||!j[2]){return new Decimal128(y.toBuffer(d))}k=parseInt(j[0],10);D=D+j[0].length}if(e[D]){return new Decimal128(y.toBuffer(d))}T=0;if(!O){T=0;I=0;E[0]=0;S=1;O=1;v=0}else{I=O-1;v=S;if(k!==0&&v!==1){while(e[_+v-1]==="0"){v=v-1}}}if(k<=w&&w-k>1<<14){k=c}else{k=k-w}while(k>a){I=I+1;if(I-T>u){var U=E.join("");if(U.match(/^0+$/)){k=a;break}else{return new Decimal128(y.toBuffer(t?p:h))}}k=k-1}while(k<c||O<S){if(I===0){k=c;v=0;break}if(O<S){S=S-1}else{I=I-1}if(k<a){k=k+1}else{U=E.join("");if(U.match(/^0+$/)){k=a;break}else{return new Decimal128(y.toBuffer(t?p:h))}}}if(I-T+1<v&&e[v]!=="0"){var F=b;if(r&&k===c){_=_+1;F=F+1}var $=parseInt(e[_+I+1],10);var W=0;if($>=5){W=1;if($===5){W=E[I]%2===1;for(A=_+I+2;A<F;A++){if(parseInt(e[A],10)){W=1;break}}}}if(W){var z=I;for(;z>=0;z--){if(++E[z]>9){E[z]=0;if(z===0){if(k<a){k=k+1;E[z]=1}else{return new Decimal128(y.toBuffer(t?p:h))}}}else{break}}}}N=n.fromNumber(0);R=n.fromNumber(0);if(v===0){N=n.fromNumber(0);R=n.fromNumber(0)}else if(I-T<17){z=T;R=n.fromNumber(E[z++]);N=new n(0,0);for(;z<=I;z++){R=R.multiply(n.fromNumber(10));R=R.add(n.fromNumber(E[z]))}}else{z=T;N=n.fromNumber(E[z++]);for(;z<=I-17;z++){N=N.multiply(n.fromNumber(10));N=N.add(n.fromNumber(E[z]))}R=n.fromNumber(E[z++]);for(;z<=I;z++){R=R.multiply(n.fromNumber(10));R=R.add(n.fromNumber(E[z]))}}var q=multiply64x2(N,n.fromString("100000000000000000"));q.low=q.low.add(R);if(lessThan(q.low,R)){q.high=q.high.add(n.fromNumber(1))}M=k+l;var V={low:n.fromNumber(0),high:n.fromNumber(0)};if(q.high.shiftRightUnsigned(49).and(n.fromNumber(1)).equals(n.fromNumber)){V.high=V.high.or(n.fromNumber(3).shiftLeft(61));V.high=V.high.or(n.fromNumber(M).and(n.fromNumber(16383).shiftLeft(47)));V.high=V.high.or(q.high.and(n.fromNumber(0x7fffffffffff)))}else{V.high=V.high.or(n.fromNumber(M&16383).shiftLeft(49));V.high=V.high.or(q.high.and(n.fromNumber(562949953421311)))}V.low=q.low;if(t){V.high=V.high.or(n.fromString("9223372036854775808"))}var G=y.allocBuffer(16);D=0;G[D++]=V.low.low_&255;G[D++]=V.low.low_>>8&255;G[D++]=V.low.low_>>16&255;G[D++]=V.low.low_>>24&255;G[D++]=V.low.high_&255;G[D++]=V.low.high_>>8&255;G[D++]=V.low.high_>>16&255;G[D++]=V.low.high_>>24&255;G[D++]=V.high.low_&255;G[D++]=V.high.low_>>8&255;G[D++]=V.high.low_>>16&255;G[D++]=V.high.low_>>24&255;G[D++]=V.high.high_&255;G[D++]=V.high.high_>>8&255;G[D++]=V.high.high_>>16&255;G[D++]=V.high.high_>>24&255;return new Decimal128(G)};var g=31;var v=16383;var b=30;var S=31;l=6176;Decimal128.prototype.toString=function(){var e;var t;var r;var o;var s;var i;var a=0;var c=new Array(36);for(var u=0;u<c.length;u++)c[u]=0;var d=0;var p;var h;var m=false;var y;var w={parts:new Array(4)};u;var _,E;var O=[];d=0;var C=this.bytes;o=C[d++]|C[d++]<<8|C[d++]<<16|C[d++]<<24;r=C[d++]|C[d++]<<8|C[d++]<<16|C[d++]<<24;t=C[d++]|C[d++]<<8|C[d++]<<16|C[d++]<<24;e=C[d++]|C[d++]<<8|C[d++]<<16|C[d++]<<24;d=0;var T={low:new n(o,r),high:new n(t,e)};if(T.high.lessThan(n.ZERO)){O.push("-")}s=e>>26&g;if(s>>3===3){if(s===b){return O.join("")+"Infinity"}else if(s===S){return"NaN"}else{i=e>>15&v;y=8+(e>>14&1)}}else{y=e>>14&7;i=e>>17&v}p=i-l;w.parts[0]=(e&16383)+((y&15)<<14);w.parts[1]=t;w.parts[2]=r;w.parts[3]=o;if(w.parts[0]===0&&w.parts[1]===0&&w.parts[2]===0&&w.parts[3]===0){m=true}else{for(E=3;E>=0;E--){var I=0;var k=divideu128(w);w=k.quotient;I=k.rem.low_;if(!I)continue;for(_=8;_>=0;_--){c[E*9+_]=I%10;I=Math.floor(I/10)}}}if(m){a=1;c[d]=0}else{a=36;u=0;while(!c[d]){u++;a=a-1;d=d+1}}h=a-1+p;if(h>=34||h<=-7||p>0){O.push(c[d++]);a=a-1;if(a){O.push(".")}for(u=0;u<a;u++){O.push(c[d++])}O.push("E");if(h>0){O.push("+"+h)}else{O.push(h)}}else{if(p>=0){for(u=0;u<a;u++){O.push(c[d++])}}else{var A=a+p;if(A>0){for(u=0;u<A;u++){O.push(c[d++])}}else{O.push("0")}O.push(".");while(A++<0){O.push("0")}for(u=0;u<a-Math.max(A-1,0);u++){O.push(c[d++])}}}return O.join("")};Decimal128.prototype.toJSON=function(){return{$numberDecimal:this.toString()}};e.exports=Decimal128;e.exports.Decimal128=Decimal128},972:e=>{function Double(e){if(!(this instanceof Double))return new Double(e);this._bsontype="Double";this.value=e}Double.prototype.valueOf=function(){return this.value};Double.prototype.toJSON=function(){return this.value};e.exports=Double;e.exports.Double=Double},7998:(e,t)=>{var r;var readIEEE754=function(e,t,r,n,o){var s,i,a=r==="big",c=o*8-n-1,l=(1<<c)-1,u=l>>1,d=-7,p=a?0:o-1,h=a?1:-1,m=e[t+p];p+=h;s=m&(1<<-d)-1;m>>=-d;d+=c;for(;d>0;s=s*256+e[t+p],p+=h,d-=8);i=s&(1<<-d)-1;s>>=-d;d+=n;for(;d>0;i=i*256+e[t+p],p+=h,d-=8);if(s===0){s=1-u}else if(s===l){return i?NaN:(m?-1:1)*Infinity}else{i=i+Math.pow(2,n);s=s-u}return(m?-1:1)*i*Math.pow(2,s-n)};var writeIEEE754=function(e,t,r,n,o,s){var i,a,c,l=n==="big",u=s*8-o-1,d=(1<<u)-1,p=d>>1,h=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=l?s-1:0,y=l?-1:1,g=t<0||t===0&&1/t<0?1:0;t=Math.abs(t);if(isNaN(t)||t===Infinity){a=isNaN(t)?1:0;i=d}else{i=Math.floor(Math.log(t)/Math.LN2);if(t*(c=Math.pow(2,-i))<1){i--;c*=2}if(i+p>=1){t+=h/c}else{t+=h*Math.pow(2,1-p)}if(t*c>=2){i++;c/=2}if(i+p>=d){a=0;i=d}else if(i+p>=1){a=(t*c-1)*Math.pow(2,o);i=i+p}else{a=t*Math.pow(2,p-1)*Math.pow(2,o);i=0}}for(;o>=8;e[r+m]=a&255,m+=y,a/=256,o-=8);i=i<<o|a;u+=o;for(;u>0;e[r+m]=i&255,m+=y,i/=256,u-=8);e[r+m-y]|=g*128};r=readIEEE754;t.P=writeIEEE754},6142:e=>{var Int32=function(e){if(!(this instanceof Int32))return new Int32(e);this._bsontype="Int32";this.value=e};Int32.prototype.valueOf=function(){return this.value};Int32.prototype.toJSON=function(){return this.value};e.exports=Int32;e.exports.Int32=Int32},8522:e=>{function Long(e,t){if(!(this instanceof Long))return new Long(e,t);this._bsontype="Long";this.low_=e|0;this.high_=t|0}Long.prototype.toInt=function(){return this.low_};Long.prototype.toNumber=function(){return this.high_*Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()};Long.prototype.toBigInt=function(){return BigInt(this.toString())};Long.prototype.toJSON=function(){return this.toString()};Long.prototype.toString=function(e){var t=e||10;if(t<2||36<t){throw Error("radix out of range: "+t)}if(this.isZero()){return"0"}if(this.isNegative()){if(this.equals(Long.MIN_VALUE)){var r=Long.fromNumber(t);var n=this.div(r);var o=n.multiply(r).subtract(this);return n.toString(t)+o.toInt().toString(t)}else{return"-"+this.negate().toString(t)}}var s=Long.fromNumber(Math.pow(t,6));o=this;var i="";while(!o.isZero()){var a=o.div(s);var c=o.subtract(a.multiply(s)).toInt();var l=c.toString(t);o=a;if(o.isZero()){return l+i}else{while(l.length<6){l="0"+l}i=""+l+i}}};Long.prototype.getHighBits=function(){return this.high_};Long.prototype.getLowBits=function(){return this.low_};Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:Long.TWO_PWR_32_DBL_+this.low_};Long.prototype.getNumBitsAbs=function(){if(this.isNegative()){if(this.equals(Long.MIN_VALUE)){return 64}else{return this.negate().getNumBitsAbs()}}else{var e=this.high_!==0?this.high_:this.low_;for(var t=31;t>0;t--){if((e&1<<t)!==0){break}}return this.high_!==0?t+33:t+1}};Long.prototype.isZero=function(){return this.high_===0&&this.low_===0};Long.prototype.isNegative=function(){return this.high_<0};Long.prototype.isOdd=function(){return(this.low_&1)===1};Long.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_};Long.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_};Long.prototype.lessThan=function(e){return this.compare(e)<0};Long.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0};Long.prototype.greaterThan=function(e){return this.compare(e)>0};Long.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0};Long.prototype.compare=function(e){if(this.equals(e)){return 0}var t=this.isNegative();var r=e.isNegative();if(t&&!r){return-1}if(!t&&r){return 1}if(this.subtract(e).isNegative()){return-1}else{return 1}};Long.prototype.negate=function(){if(this.equals(Long.MIN_VALUE)){return Long.MIN_VALUE}else{return this.not().add(Long.ONE)}};Long.prototype.add=function(e){var t=this.high_>>>16;var r=this.high_&65535;var n=this.low_>>>16;var o=this.low_&65535;var s=e.high_>>>16;var i=e.high_&65535;var a=e.low_>>>16;var c=e.low_&65535;var l=0,u=0,d=0,p=0;p+=o+c;d+=p>>>16;p&=65535;d+=n+a;u+=d>>>16;d&=65535;u+=r+i;l+=u>>>16;u&=65535;l+=t+s;l&=65535;return Long.fromBits(d<<16|p,l<<16|u)};Long.prototype.subtract=function(e){return this.add(e.negate())};Long.prototype.multiply=function(e){if(this.isZero()){return Long.ZERO}else if(e.isZero()){return Long.ZERO}if(this.equals(Long.MIN_VALUE)){return e.isOdd()?Long.MIN_VALUE:Long.ZERO}else if(e.equals(Long.MIN_VALUE)){return this.isOdd()?Long.MIN_VALUE:Long.ZERO}if(this.isNegative()){if(e.isNegative()){return this.negate().multiply(e.negate())}else{return this.negate().multiply(e).negate()}}else if(e.isNegative()){return this.multiply(e.negate()).negate()}if(this.lessThan(Long.TWO_PWR_24_)&&e.lessThan(Long.TWO_PWR_24_)){return Long.fromNumber(this.toNumber()*e.toNumber())}var t=this.high_>>>16;var r=this.high_&65535;var n=this.low_>>>16;var o=this.low_&65535;var s=e.high_>>>16;var i=e.high_&65535;var a=e.low_>>>16;var c=e.low_&65535;var l=0,u=0,d=0,p=0;p+=o*c;d+=p>>>16;p&=65535;d+=n*c;u+=d>>>16;d&=65535;d+=o*a;u+=d>>>16;d&=65535;u+=r*c;l+=u>>>16;u&=65535;u+=n*a;l+=u>>>16;u&=65535;u+=o*i;l+=u>>>16;u&=65535;l+=t*c+r*a+n*i+o*s;l&=65535;return Long.fromBits(d<<16|p,l<<16|u)};Long.prototype.div=function(e){if(e.isZero()){throw Error("division by zero")}else if(this.isZero()){return Long.ZERO}if(this.equals(Long.MIN_VALUE)){if(e.equals(Long.ONE)||e.equals(Long.NEG_ONE)){return Long.MIN_VALUE}else if(e.equals(Long.MIN_VALUE)){return Long.ONE}else{var t=this.shiftRight(1);var r=t.div(e).shiftLeft(1);if(r.equals(Long.ZERO)){return e.isNegative()?Long.ONE:Long.NEG_ONE}else{var n=this.subtract(e.multiply(r));var o=r.add(n.div(e));return o}}}else if(e.equals(Long.MIN_VALUE)){return Long.ZERO}if(this.isNegative()){if(e.isNegative()){return this.negate().div(e.negate())}else{return this.negate().div(e).negate()}}else if(e.isNegative()){return this.div(e.negate()).negate()}var s=Long.ZERO;n=this;while(n.greaterThanOrEqual(e)){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));var i=Math.ceil(Math.log(r)/Math.LN2);var a=i<=48?1:Math.pow(2,i-48);var c=Long.fromNumber(r);var l=c.multiply(e);while(l.isNegative()||l.greaterThan(n)){r-=a;c=Long.fromNumber(r);l=c.multiply(e)}if(c.isZero()){c=Long.ONE}s=s.add(c);n=n.subtract(l)}return s};Long.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))};Long.prototype.not=function(){return Long.fromBits(~this.low_,~this.high_)};Long.prototype.and=function(e){return Long.fromBits(this.low_&e.low_,this.high_&e.high_)};Long.prototype.or=function(e){return Long.fromBits(this.low_|e.low_,this.high_|e.high_)};Long.prototype.xor=function(e){return Long.fromBits(this.low_^e.low_,this.high_^e.high_)};Long.prototype.shiftLeft=function(e){e&=63;if(e===0){return this}else{var t=this.low_;if(e<32){var r=this.high_;return Long.fromBits(t<<e,r<<e|t>>>32-e)}else{return Long.fromBits(0,t<<e-32)}}};Long.prototype.shiftRight=function(e){e&=63;if(e===0){return this}else{var t=this.high_;if(e<32){var r=this.low_;return Long.fromBits(r>>>e|t<<32-e,t>>e)}else{return Long.fromBits(t>>e-32,t>=0?0:-1)}}};Long.prototype.shiftRightUnsigned=function(e){e&=63;if(e===0){return this}else{var t=this.high_;if(e<32){var r=this.low_;return Long.fromBits(r>>>e|t<<32-e,t>>>e)}else if(e===32){return Long.fromBits(t,0)}else{return Long.fromBits(t>>>e-32,0)}}};Long.fromInt=function(e){if(-128<=e&&e<128){var t=Long.INT_CACHE_[e];if(t){return t}}var r=new Long(e|0,e<0?-1:0);if(-128<=e&&e<128){Long.INT_CACHE_[e]=r}return r};Long.fromNumber=function(e){if(isNaN(e)||!isFinite(e)){return Long.ZERO}else if(e<=-Long.TWO_PWR_63_DBL_){return Long.MIN_VALUE}else if(e+1>=Long.TWO_PWR_63_DBL_){return Long.MAX_VALUE}else if(e<0){return Long.fromNumber(-e).negate()}else{return new Long(e%Long.TWO_PWR_32_DBL_|0,e/Long.TWO_PWR_32_DBL_|0)}};Long.fromBigInt=function(e){return Long.fromString(e.toString(10),10)};Long.fromBits=function(e,t){return new Long(e,t)};Long.fromString=function(e,t){if(e.length===0){throw Error("number format error: empty string")}var r=t||10;if(r<2||36<r){throw Error("radix out of range: "+r)}if(e.charAt(0)==="-"){return Long.fromString(e.substring(1),r).negate()}else if(e.indexOf("-")>=0){throw Error('number format error: interior "-" character: '+e)}var n=Long.fromNumber(Math.pow(r,8));var o=Long.ZERO;for(var s=0;s<e.length;s+=8){var i=Math.min(8,e.length-s);var a=parseInt(e.substring(s,s+i),r);if(i<8){var c=Long.fromNumber(Math.pow(r,i));o=o.multiply(c).add(Long.fromNumber(a))}else{o=o.multiply(n);o=o.add(Long.fromNumber(a))}}return o};Long.INT_CACHE_={};Long.TWO_PWR_16_DBL_=1<<16;Long.TWO_PWR_24_DBL_=1<<24;Long.TWO_PWR_32_DBL_=Long.TWO_PWR_16_DBL_*Long.TWO_PWR_16_DBL_;Long.TWO_PWR_31_DBL_=Long.TWO_PWR_32_DBL_/2;Long.TWO_PWR_48_DBL_=Long.TWO_PWR_32_DBL_*Long.TWO_PWR_16_DBL_;Long.TWO_PWR_64_DBL_=Long.TWO_PWR_32_DBL_*Long.TWO_PWR_32_DBL_;Long.TWO_PWR_63_DBL_=Long.TWO_PWR_64_DBL_/2;Long.ZERO=Long.fromInt(0);Long.ONE=Long.fromInt(1);Long.NEG_ONE=Long.fromInt(-1);Long.MAX_VALUE=Long.fromBits(4294967295|0,2147483647|0);Long.MIN_VALUE=Long.fromBits(0,2147483648|0);Long.TWO_PWR_24_=Long.fromInt(1<<24);e.exports=Long;e.exports.Long=Long},3639:e=>{"use strict";if(typeof global.Map!=="undefined"){e.exports=global.Map;e.exports.Map=global.Map}else{var Map=function(e){this._keys=[];this._values={};for(var t=0;t<e.length;t++){if(e[t]==null)continue;var r=e[t];var n=r[0];var o=r[1];this._keys.push(n);this._values[n]={v:o,i:this._keys.length-1}}};Map.prototype.clear=function(){this._keys=[];this._values={}};Map.prototype.delete=function(e){var t=this._values[e];if(t==null)return false;delete this._values[e];this._keys.splice(t.i,1);return true};Map.prototype.entries=function(){var e=this;var t=0;return{next:function(){var r=e._keys[t++];return{value:r!==undefined?[r,e._values[r].v]:undefined,done:r!==undefined?false:true}}}};Map.prototype.forEach=function(e,t){t=t||this;for(var r=0;r<this._keys.length;r++){var n=this._keys[r];e.call(t,this._values[n].v,n,t)}};Map.prototype.get=function(e){return this._values[e]?this._values[e].v:undefined};Map.prototype.has=function(e){return this._values[e]!=null};Map.prototype.keys=function(){var e=this;var t=0;return{next:function(){var r=e._keys[t++];return{value:r!==undefined?r:undefined,done:r!==undefined?false:true}}}};Map.prototype.set=function(e,t){if(this._values[e]){this._values[e].v=t;return this}this._keys.push(e);this._values[e]={v:t,i:this._keys.length-1};return this};Map.prototype.values=function(){var e=this;var t=0;return{next:function(){var r=e._keys[t++];return{value:r!==undefined?e._values[r].v:undefined,done:r!==undefined?false:true}}}};Object.defineProperty(Map.prototype,"size",{enumerable:true,get:function(){return this._keys.length}});e.exports=Map;e.exports.Map=Map}},5846:e=>{function MaxKey(){if(!(this instanceof MaxKey))return new MaxKey;this._bsontype="MaxKey"}e.exports=MaxKey;e.exports.MaxKey=MaxKey},5325:e=>{function MinKey(){if(!(this instanceof MinKey))return new MinKey;this._bsontype="MinKey"}e.exports=MinKey;e.exports.MinKey=MinKey},9502:(e,t,r)=>{var n="inspect";var o=r(2863);var s=parseInt(Math.random()*16777215,10);var i=new RegExp("^[0-9a-fA-F]{24}$");try{if(Buffer&&Buffer.from){var a=true;n=r(1669).inspect.custom||"inspect"}}catch(e){a=false}var c=function ObjectID(e){if(e instanceof ObjectID)return e;if(!(this instanceof ObjectID))return new ObjectID(e);this._bsontype="ObjectID";if(e==null||typeof e==="number"){this.id=this.generate(e);if(ObjectID.cacheHexString)this.__id=this.toString("hex");return}var t=ObjectID.isValid(e);if(!t&&e!=null){throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}else if(t&&typeof e==="string"&&e.length===24&&a){return new ObjectID(o.toBuffer(e,"hex"))}else if(t&&typeof e==="string"&&e.length===24){return ObjectID.createFromHexString(e)}else if(e!=null&&e.length===12){this.id=e}else if(e!=null&&typeof e.toHexString==="function"){return e}else{throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}if(ObjectID.cacheHexString)this.__id=this.toString("hex")};var l=[];for(var u=0;u<256;u++){l[u]=(u<=15?"0":"")+u.toString(16)}c.prototype.toHexString=function(){if(c.cacheHexString&&this.__id)return this.__id;var e="";if(!this.id||!this.id.length){throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]")}if(this.id instanceof p){e=convertToHex(this.id);if(c.cacheHexString)this.__id=e;return e}for(var t=0;t<this.id.length;t++){e+=l[this.id.charCodeAt(t)]}if(c.cacheHexString)this.__id=e;return e};c.prototype.get_inc=function(){return c.index=(c.index+1)%16777215};c.prototype.getInc=function(){return this.get_inc()};c.prototype.generate=function(e){if("number"!==typeof e){e=~~(Date.now()/1e3)}var t=(typeof process==="undefined"||process.pid===1?Math.floor(Math.random()*1e5):process.pid)%65535;var r=this.get_inc();var n=o.allocBuffer(12);n[3]=e&255;n[2]=e>>8&255;n[1]=e>>16&255;n[0]=e>>24&255;n[6]=s&255;n[5]=s>>8&255;n[4]=s>>16&255;n[8]=t&255;n[7]=t>>8&255;n[11]=r&255;n[10]=r>>8&255;n[9]=r>>16&255;return n};c.prototype.toString=function(e){if(this.id&&this.id.copy){return this.id.toString(typeof e==="string"?e:"hex")}return this.toHexString()};c.prototype[n]=c.prototype.toString;c.prototype.toJSON=function(){return this.toHexString()};c.prototype.equals=function equals(e){if(e instanceof c){return this.toString()===e.toString()}else if(typeof e==="string"&&c.isValid(e)&&e.length===12&&this.id instanceof p){return e===this.id.toString("binary")}else if(typeof e==="string"&&c.isValid(e)&&e.length===24){return e.toLowerCase()===this.toHexString()}else if(typeof e==="string"&&c.isValid(e)&&e.length===12){return e===this.id}else if(e!=null&&(e instanceof c||e.toHexString)){return e.toHexString()===this.toHexString()}else{return false}};c.prototype.getTimestamp=function(){var e=new Date;var t=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24;e.setTime(Math.floor(t)*1e3);return e};c.index=~~(Math.random()*16777215);c.createPk=function createPk(){return new c};c.createFromTime=function createFromTime(e){var t=o.toBuffer([0,0,0,0,0,0,0,0,0,0,0,0]);t[3]=e&255;t[2]=e>>8&255;t[1]=e>>16&255;t[0]=e>>24&255;return new c(t)};var d=[];u=0;while(u<10)d[48+u]=u++;while(u<16)d[65-10+u]=d[97-10+u]=u++;var p=Buffer;var convertToHex=function(e){return e.toString("hex")};c.createFromHexString=function createFromHexString(e){if(typeof e==="undefined"||e!=null&&e.length!==24){throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}if(a)return new c(o.toBuffer(e,"hex"));var t=new p(12);var r=0;var n=0;while(n<24){t[r++]=d[e.charCodeAt(n++)]<<4|d[e.charCodeAt(n++)]}return new c(t)};c.isValid=function isValid(e){if(e==null)return false;if(typeof e==="number"){return true}if(typeof e==="string"){return e.length===12||e.length===24&&i.test(e)}if(e instanceof c){return true}if(e instanceof p){return true}if(typeof e.toHexString==="function"&&(e.id instanceof p||typeof e.id==="string")){return e.id.length===12||e.id.length===24&&i.test(e.id)}return false};Object.defineProperty(c.prototype,"generationTime",{enumerable:true,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(e){this.id[3]=e&255;this.id[2]=e>>8&255;this.id[1]=e>>16&255;this.id[0]=e>>24&255}});e.exports=c;e.exports.ObjectID=c;e.exports.ObjectId=c},1273:(e,t,r)=>{"use strict";var n=r(8522).Long,o=r(972).Double,s=r(1031).Timestamp,i=r(9502).ObjectID,a=r(2259).Symbol,c=r(4636).BSONRegExp,l=r(7113).Code,u=r(414),d=r(5325).MinKey,p=r(5846).MaxKey,h=r(3797).DBRef,m=r(5497).Binary;var y=r(2863).normalizedFunctionString;var g=function isDate(e){return typeof e==="object"&&Object.prototype.toString.call(e)==="[object Date]"};var v=function calculateObjectSize(e,t,r){var n=4+1;if(Array.isArray(e)){for(var o=0;o<e.length;o++){n+=calculateElement(o.toString(),e[o],t,true,r)}}else{if(e.toBSON){e=e.toBSON()}for(var s in e){n+=calculateElement(s,e[s],t,false,r)}}return n};function calculateElement(e,t,r,S,w){if(t&&t.toBSON){t=t.toBSON()}switch(typeof t){case"string":return 1+Buffer.byteLength(e,"utf8")+1+4+Buffer.byteLength(t,"utf8")+1;case"number":if(Math.floor(t)===t&&t>=b.JS_INT_MIN&&t<=b.JS_INT_MAX){if(t>=b.BSON_INT32_MIN&&t<=b.BSON_INT32_MAX){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(4+1)}else{return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(8+1)}}else{return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(8+1)}case"undefined":if(S||!w)return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1;return 0;case"boolean":return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(1+1);case"object":if(t==null||t instanceof d||t instanceof p||t["_bsontype"]==="MinKey"||t["_bsontype"]==="MaxKey"){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1}else if(t instanceof i||t["_bsontype"]==="ObjectID"||t["_bsontype"]==="ObjectId"){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(12+1)}else if(t instanceof Date||g(t)){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(8+1)}else if(typeof Buffer!=="undefined"&&Buffer.isBuffer(t)){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(1+4+1)+t.length}else if(t instanceof n||t instanceof o||t instanceof s||t["_bsontype"]==="Long"||t["_bsontype"]==="Double"||t["_bsontype"]==="Timestamp"){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(8+1)}else if(t instanceof u||t["_bsontype"]==="Decimal128"){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(16+1)}else if(t instanceof l||t["_bsontype"]==="Code"){if(t.scope!=null&&Object.keys(t.scope).length>0){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(t.code.toString(),"utf8")+1+v(t.scope,r,w)}else{return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(t.code.toString(),"utf8")+1}}else if(t instanceof m||t["_bsontype"]==="Binary"){if(t.sub_type===m.SUBTYPE_BYTE_ARRAY){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1+4)}else{return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1)}}else if(t instanceof a||t["_bsontype"]==="Symbol"){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+Buffer.byteLength(t.value,"utf8")+4+1+1}else if(t instanceof h||t["_bsontype"]==="DBRef"){var _={$ref:t.namespace,$id:t.oid};if(null!=t.db){_["$db"]=t.db}return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+v(_,r,w)}else if(t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1}else if(t instanceof c||t["_bsontype"]==="BSONRegExp"){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.pattern,"utf8")+1+Buffer.byteLength(t.options,"utf8")+1}else{return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+v(t,r,w)+1}case"function":if(t instanceof RegExp||Object.prototype.toString.call(t)==="[object RegExp]"||String.call(t)==="[object RegExp]"){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1}else{if(r&&t.scope!=null&&Object.keys(t.scope).length>0){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(y(t),"utf8")+1+v(t.scope,r,w)}else if(r){return(e!=null?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(y(t),"utf8")+1}}}return 0}var b={};b.BSON_INT32_MAX=2147483647;b.BSON_INT32_MIN=-2147483648;b.JS_INT_MAX=9007199254740992;b.JS_INT_MIN=-9007199254740992;e.exports=v},2139:(module,__unused_webpack_exports,__nccwpck_require__)=>{"use strict";var Long=__nccwpck_require__(8522).Long,Double=__nccwpck_require__(972).Double,Timestamp=__nccwpck_require__(1031).Timestamp,ObjectID=__nccwpck_require__(9502).ObjectID,Symbol=__nccwpck_require__(2259).Symbol,Code=__nccwpck_require__(7113).Code,MinKey=__nccwpck_require__(5325).MinKey,MaxKey=__nccwpck_require__(5846).MaxKey,Decimal128=__nccwpck_require__(414),Int32=__nccwpck_require__(6142),DBRef=__nccwpck_require__(3797).DBRef,BSONRegExp=__nccwpck_require__(4636).BSONRegExp,Binary=__nccwpck_require__(5497).Binary;var utils=__nccwpck_require__(2863);var deserialize=function(e,t,r){t=t==null?{}:t;var n=t&&t.index?t.index:0;var o=e[n]|e[n+1]<<8|e[n+2]<<16|e[n+3]<<24;if(o<5||e.length<o||o+n>e.length){throw new Error("corrupt bson message")}if(e[n+o-1]!==0){throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00")}return deserializeObject(e,n,t,r)};var deserializeObject=function(e,t,r,n){var o=r["evalFunctions"]==null?false:r["evalFunctions"];var s=r["cacheFunctions"]==null?false:r["cacheFunctions"];var i=r["cacheFunctionsCrc32"]==null?false:r["cacheFunctionsCrc32"];if(!i)var a=null;var c=r["fieldsAsRaw"]==null?null:r["fieldsAsRaw"];var l=r["raw"]==null?false:r["raw"];var u=typeof r["bsonRegExp"]==="boolean"?r["bsonRegExp"]:false;var d=r["promoteBuffers"]==null?false:r["promoteBuffers"];var p=r["promoteLongs"]==null?true:r["promoteLongs"];var h=r["promoteValues"]==null?true:r["promoteValues"];var m=t;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var y=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(y<5||y>e.length)throw new Error("corrupt bson message");var g=n?[]:{};var v=0;var b=false;while(!b){var S=e[t++];if(S===0)break;var w=t;while(e[w]!==0&&w<e.length){w++}if(w>=e.length)throw new Error("Bad BSON Document: illegal CString");var _=n?v++:e.toString("utf8",t,w);t=w+1;if(S===BSON.BSON_DATA_STRING){var E=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(E<=0||E>e.length-t||e[t+E-1]!==0)throw new Error("bad string length in bson");g[_]=e.toString("utf8",t,t+E-1);t=t+E}else if(S===BSON.BSON_DATA_OID){var O=utils.allocBuffer(12);e.copy(O,0,t,t+12);g[_]=new ObjectID(O);t=t+12}else if(S===BSON.BSON_DATA_INT&&h===false){g[_]=new Int32(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)}else if(S===BSON.BSON_DATA_INT){g[_]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24}else if(S===BSON.BSON_DATA_NUMBER&&h===false){g[_]=new Double(e.readDoubleLE(t));t=t+8}else if(S===BSON.BSON_DATA_NUMBER){g[_]=e.readDoubleLE(t);t=t+8}else if(S===BSON.BSON_DATA_DATE){var C=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;g[_]=new Date(new Long(C,T).toNumber())}else if(S===BSON.BSON_DATA_BOOLEAN){if(e[t]!==0&&e[t]!==1)throw new Error("illegal boolean type value");g[_]=e[t++]===1}else if(S===BSON.BSON_DATA_OBJECT){var I=t;var k=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;if(k<=0||k>e.length-t)throw new Error("bad embedded document length in bson");if(l){g[_]=e.slice(t,t+k)}else{g[_]=deserializeObject(e,I,r,false)}t=t+k}else if(S===BSON.BSON_DATA_ARRAY){I=t;k=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;var A=r;var N=t+k;if(c&&c[_]){A={};for(var R in r)A[R]=r[R];A["raw"]=true}g[_]=deserializeObject(e,I,A,true);t=t+k;if(e[t-1]!==0)throw new Error("invalid array terminator byte");if(t!==N)throw new Error("corrupted array bson")}else if(S===BSON.BSON_DATA_UNDEFINED){g[_]=undefined}else if(S===BSON.BSON_DATA_NULL){g[_]=null}else if(S===BSON.BSON_DATA_LONG){C=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var M=new Long(C,T);if(p&&h===true){g[_]=M.lessThanOrEqual(JS_INT_MAX_LONG)&&M.greaterThanOrEqual(JS_INT_MIN_LONG)?M.toNumber():M}else{g[_]=M}}else if(S===BSON.BSON_DATA_DECIMAL128){var D=utils.allocBuffer(16);e.copy(D,0,t,t+16);t=t+16;var P=new Decimal128(D);g[_]=P.toObject?P.toObject():P}else if(S===BSON.BSON_DATA_BINARY){var L=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var B=L;var j=e[t++];if(L<0)throw new Error("Negative binary type element size found");if(L>e.length)throw new Error("Binary type size larger than document size");if(e["slice"]!=null){if(j===Binary.SUBTYPE_BYTE_ARRAY){L=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(L<0)throw new Error("Negative binary type element size found for subtype 0x02");if(L>B-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(L<B-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}if(d&&h){g[_]=e.slice(t,t+L)}else{g[_]=new Binary(e.slice(t,t+L),j)}}else{var U=typeof Uint8Array!=="undefined"?new Uint8Array(new ArrayBuffer(L)):new Array(L);if(j===Binary.SUBTYPE_BYTE_ARRAY){L=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(L<0)throw new Error("Negative binary type element size found for subtype 0x02");if(L>B-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(L<B-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}for(w=0;w<L;w++){U[w]=e[t+w]}if(d&&h){g[_]=U}else{g[_]=new Binary(U,j)}}t=t+L}else if(S===BSON.BSON_DATA_REGEXP&&u===false){w=t;while(e[w]!==0&&w<e.length){w++}if(w>=e.length)throw new Error("Bad BSON Document: illegal CString");var F=e.toString("utf8",t,w);t=w+1;w=t;while(e[w]!==0&&w<e.length){w++}if(w>=e.length)throw new Error("Bad BSON Document: illegal CString");var $=e.toString("utf8",t,w);t=w+1;var W=new Array($.length);for(w=0;w<$.length;w++){switch($[w]){case"m":W[w]="m";break;case"s":W[w]="g";break;case"i":W[w]="i";break}}g[_]=new RegExp(F,W.join(""))}else if(S===BSON.BSON_DATA_REGEXP&&u===true){w=t;while(e[w]!==0&&w<e.length){w++}if(w>=e.length)throw new Error("Bad BSON Document: illegal CString");F=e.toString("utf8",t,w);t=w+1;w=t;while(e[w]!==0&&w<e.length){w++}if(w>=e.length)throw new Error("Bad BSON Document: illegal CString");$=e.toString("utf8",t,w);t=w+1;g[_]=new BSONRegExp(F,$)}else if(S===BSON.BSON_DATA_SYMBOL){E=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(E<=0||E>e.length-t||e[t+E-1]!==0)throw new Error("bad string length in bson");g[_]=new Symbol(e.toString("utf8",t,t+E-1));t=t+E}else if(S===BSON.BSON_DATA_TIMESTAMP){C=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;T=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;g[_]=new Timestamp(C,T)}else if(S===BSON.BSON_DATA_MIN_KEY){g[_]=new MinKey}else if(S===BSON.BSON_DATA_MAX_KEY){g[_]=new MaxKey}else if(S===BSON.BSON_DATA_CODE){E=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(E<=0||E>e.length-t||e[t+E-1]!==0)throw new Error("bad string length in bson");var z=e.toString("utf8",t,t+E-1);if(o){if(s){var q=i?a(z):z;g[_]=isolateEvalWithHash(functionCache,q,z,g)}else{g[_]=isolateEval(z)}}else{g[_]=new Code(z)}t=t+E}else if(S===BSON.BSON_DATA_CODE_W_SCOPE){var V=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(V<4+4+4+1){throw new Error("code_w_scope total size shorter minimum expected length")}E=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(E<=0||E>e.length-t||e[t+E-1]!==0)throw new Error("bad string length in bson");z=e.toString("utf8",t,t+E-1);t=t+E;I=t;k=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;var G=deserializeObject(e,I,r,false);t=t+k;if(V<4+4+k+E){throw new Error("code_w_scope total size is to short, truncating scope")}if(V>4+4+k+E){throw new Error("code_w_scope total size is to long, clips outer document")}if(o){if(s){q=i?a(z):z;g[_]=isolateEvalWithHash(functionCache,q,z,g)}else{g[_]=isolateEval(z)}g[_].scope=G}else{g[_]=new Code(z,G)}}else if(S===BSON.BSON_DATA_DBPOINTER){E=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(E<=0||E>e.length-t||e[t+E-1]!==0)throw new Error("bad string length in bson");var Y=e.toString("utf8",t,t+E-1);t=t+E;var K=utils.allocBuffer(12);e.copy(K,0,t,t+12);O=new ObjectID(K);t=t+12;var X=Y.split(".");var J=X.shift();var Z=X.join(".");g[_]=new DBRef(Z,O,J)}else{throw new Error("Detected unknown BSON type "+S.toString(16)+' for fieldname "'+_+'", are you using the latest BSON parser')}}if(y!==t-m){if(n)throw new Error("corrupt array bson");throw new Error("corrupt object bson")}if(g["$id"]!=null)g=new DBRef(g["$ref"],g["$id"],g["$db"]);return g};var isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;if(functionCache[hash]==null){eval("value = "+functionString);functionCache[hash]=value}return functionCache[hash].bind(object)};var isolateEval=function(functionString){var value=null;eval("value = "+functionString);return value};var BSON={};var functionCache=BSON.functionCache={};BSON.BSON_DATA_NUMBER=1;BSON.BSON_DATA_STRING=2;BSON.BSON_DATA_OBJECT=3;BSON.BSON_DATA_ARRAY=4;BSON.BSON_DATA_BINARY=5;BSON.BSON_DATA_UNDEFINED=6;BSON.BSON_DATA_OID=7;BSON.BSON_DATA_BOOLEAN=8;BSON.BSON_DATA_DATE=9;BSON.BSON_DATA_NULL=10;BSON.BSON_DATA_REGEXP=11;BSON.BSON_DATA_DBPOINTER=12;BSON.BSON_DATA_CODE=13;BSON.BSON_DATA_SYMBOL=14;BSON.BSON_DATA_CODE_W_SCOPE=15;BSON.BSON_DATA_INT=16;BSON.BSON_DATA_TIMESTAMP=17;BSON.BSON_DATA_LONG=18;BSON.BSON_DATA_DECIMAL128=19;BSON.BSON_DATA_MIN_KEY=255;BSON.BSON_DATA_MAX_KEY=127;BSON.BSON_BINARY_SUBTYPE_DEFAULT=0;BSON.BSON_BINARY_SUBTYPE_FUNCTION=1;BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;BSON.BSON_BINARY_SUBTYPE_UUID=3;BSON.BSON_BINARY_SUBTYPE_MD5=4;BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128;BSON.BSON_INT32_MAX=2147483647;BSON.BSON_INT32_MIN=-2147483648;BSON.BSON_INT64_MAX=Math.pow(2,63)-1;BSON.BSON_INT64_MIN=-Math.pow(2,63);BSON.JS_INT_MAX=9007199254740992;BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992);var JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);module.exports=deserialize},9290:(e,t,r)=>{"use strict";var n=r(7998).P,o=r(8522).Long,s=r(3639),i=r(5497).Binary;var a=r(2863).normalizedFunctionString;var c=/\x00/;var l=["$db","$ref","$id","$clusterTime"];var u=function isDate(e){return typeof e==="object"&&Object.prototype.toString.call(e)==="[object Date]"};var d=function isRegExp(e){return Object.prototype.toString.call(e)==="[object RegExp]"};var serializeString=function(e,t,r,n,o){e[n++]=h.BSON_DATA_STRING;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s+1;e[n-1]=0;var i=e.write(r,n+4,"utf8");e[n+3]=i+1>>24&255;e[n+2]=i+1>>16&255;e[n+1]=i+1>>8&255;e[n]=i+1&255;n=n+4+i;e[n++]=0;return n};var serializeNumber=function(e,t,r,s,i){if(Math.floor(r)===r&&r>=h.JS_INT_MIN&&r<=h.JS_INT_MAX){if(r>=h.BSON_INT32_MIN&&r<=h.BSON_INT32_MAX){e[s++]=h.BSON_DATA_INT;var a=!i?e.write(t,s,"utf8"):e.write(t,s,"ascii");s=s+a;e[s++]=0;e[s++]=r&255;e[s++]=r>>8&255;e[s++]=r>>16&255;e[s++]=r>>24&255}else if(r>=h.JS_INT_MIN&&r<=h.JS_INT_MAX){e[s++]=h.BSON_DATA_NUMBER;a=!i?e.write(t,s,"utf8"):e.write(t,s,"ascii");s=s+a;e[s++]=0;n(e,r,s,"little",52,8);s=s+8}else{e[s++]=h.BSON_DATA_LONG;a=!i?e.write(t,s,"utf8"):e.write(t,s,"ascii");s=s+a;e[s++]=0;var c=o.fromNumber(r);var l=c.getLowBits();var u=c.getHighBits();e[s++]=l&255;e[s++]=l>>8&255;e[s++]=l>>16&255;e[s++]=l>>24&255;e[s++]=u&255;e[s++]=u>>8&255;e[s++]=u>>16&255;e[s++]=u>>24&255}}else{e[s++]=h.BSON_DATA_NUMBER;a=!i?e.write(t,s,"utf8"):e.write(t,s,"ascii");s=s+a;e[s++]=0;n(e,r,s,"little",52,8);s=s+8}return s};var serializeNull=function(e,t,r,n,o){e[n++]=h.BSON_DATA_NULL;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;return n};var serializeBoolean=function(e,t,r,n,o){e[n++]=h.BSON_DATA_BOOLEAN;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;e[n++]=r?1:0;return n};var serializeDate=function(e,t,r,n,s){e[n++]=h.BSON_DATA_DATE;var i=!s?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+i;e[n++]=0;var a=o.fromNumber(r.getTime());var c=a.getLowBits();var l=a.getHighBits();e[n++]=c&255;e[n++]=c>>8&255;e[n++]=c>>16&255;e[n++]=c>>24&255;e[n++]=l&255;e[n++]=l>>8&255;e[n++]=l>>16&255;e[n++]=l>>24&255;return n};var serializeRegExp=function(e,t,r,n,o){e[n++]=h.BSON_DATA_REGEXP;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;if(r.source&&r.source.match(c)!=null){throw Error("value "+r.source+" must not contain null bytes")}n=n+e.write(r.source,n,"utf8");e[n++]=0;if(r.global)e[n++]=115;if(r.ignoreCase)e[n++]=105;if(r.multiline)e[n++]=109;e[n++]=0;return n};var serializeBSONRegExp=function(e,t,r,n,o){e[n++]=h.BSON_DATA_REGEXP;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;if(r.pattern.match(c)!=null){throw Error("pattern "+r.pattern+" must not contain null bytes")}n=n+e.write(r.pattern,n,"utf8");e[n++]=0;n=n+e.write(r.options.split("").sort().join(""),n,"utf8");e[n++]=0;return n};var serializeMinMax=function(e,t,r,n,o){if(r===null){e[n++]=h.BSON_DATA_NULL}else if(r._bsontype==="MinKey"){e[n++]=h.BSON_DATA_MIN_KEY}else{e[n++]=h.BSON_DATA_MAX_KEY}var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;return n};var serializeObjectId=function(e,t,r,n,o){e[n++]=h.BSON_DATA_OID;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;if(typeof r.id==="string"){e.write(r.id,n,"binary")}else if(r.id&&r.id.copy){r.id.copy(e,n,0,12)}else{throw new Error("object ["+JSON.stringify(r)+"] is not a valid ObjectId")}return n+12};var serializeBuffer=function(e,t,r,n,o){e[n++]=h.BSON_DATA_BINARY;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;var i=r.length;e[n++]=i&255;e[n++]=i>>8&255;e[n++]=i>>16&255;e[n++]=i>>24&255;e[n++]=h.BSON_BINARY_SUBTYPE_DEFAULT;r.copy(e,n,0,i);n=n+i;return n};var serializeObject=function(e,t,r,n,o,s,i,a,c,l){for(var u=0;u<l.length;u++){if(l[u]===r)throw new Error("cyclic dependency detected")}l.push(r);e[n++]=Array.isArray(r)?h.BSON_DATA_ARRAY:h.BSON_DATA_OBJECT;var d=!c?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+d;e[n++]=0;var m=p(e,r,o,n,s+1,i,a,l);l.pop();return m};var serializeDecimal128=function(e,t,r,n,o){e[n++]=h.BSON_DATA_DECIMAL128;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;r.bytes.copy(e,n,0,16);return n+16};var serializeLong=function(e,t,r,n,o){e[n++]=r._bsontype==="Long"?h.BSON_DATA_LONG:h.BSON_DATA_TIMESTAMP;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;var i=r.getLowBits();var a=r.getHighBits();e[n++]=i&255;e[n++]=i>>8&255;e[n++]=i>>16&255;e[n++]=i>>24&255;e[n++]=a&255;e[n++]=a>>8&255;e[n++]=a>>16&255;e[n++]=a>>24&255;return n};var serializeInt32=function(e,t,r,n,o){e[n++]=h.BSON_DATA_INT;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;e[n++]=r&255;e[n++]=r>>8&255;e[n++]=r>>16&255;e[n++]=r>>24&255;return n};var serializeDouble=function(e,t,r,o,s){e[o++]=h.BSON_DATA_NUMBER;var i=!s?e.write(t,o,"utf8"):e.write(t,o,"ascii");o=o+i;e[o++]=0;n(e,r,o,"little",52,8);o=o+8;return o};var serializeFunction=function(e,t,r,n,o,s,i){e[n++]=h.BSON_DATA_CODE;var c=!i?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+c;e[n++]=0;var l=a(r);var u=e.write(l,n+4,"utf8")+1;e[n]=u&255;e[n+1]=u>>8&255;e[n+2]=u>>16&255;e[n+3]=u>>24&255;n=n+4+u-1;e[n++]=0;return n};var serializeCode=function(e,t,r,n,o,s,i,a,c){if(r.scope&&typeof r.scope==="object"){e[n++]=h.BSON_DATA_CODE_W_SCOPE;var l=!c?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+l;e[n++]=0;var u=n;var d=typeof r.code==="string"?r.code:r.code.toString();n=n+4;var m=e.write(d,n+4,"utf8")+1;e[n]=m&255;e[n+1]=m>>8&255;e[n+2]=m>>16&255;e[n+3]=m>>24&255;e[n+4+m-1]=0;n=n+m+4;var y=p(e,r.scope,o,n,s+1,i,a);n=y-1;var g=y-u;e[u++]=g&255;e[u++]=g>>8&255;e[u++]=g>>16&255;e[u++]=g>>24&255;e[n++]=0}else{e[n++]=h.BSON_DATA_CODE;l=!c?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+l;e[n++]=0;d=r.code.toString();var v=e.write(d,n+4,"utf8")+1;e[n]=v&255;e[n+1]=v>>8&255;e[n+2]=v>>16&255;e[n+3]=v>>24&255;n=n+4+v-1;e[n++]=0}return n};var serializeBinary=function(e,t,r,n,o){e[n++]=h.BSON_DATA_BINARY;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;var a=r.value(true);var c=r.position;if(r.sub_type===i.SUBTYPE_BYTE_ARRAY)c=c+4;e[n++]=c&255;e[n++]=c>>8&255;e[n++]=c>>16&255;e[n++]=c>>24&255;e[n++]=r.sub_type;if(r.sub_type===i.SUBTYPE_BYTE_ARRAY){c=c-4;e[n++]=c&255;e[n++]=c>>8&255;e[n++]=c>>16&255;e[n++]=c>>24&255}a.copy(e,n,0,r.position);n=n+r.position;return n};var serializeSymbol=function(e,t,r,n,o){e[n++]=h.BSON_DATA_SYMBOL;var s=!o?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+s;e[n++]=0;var i=e.write(r.value,n+4,"utf8")+1;e[n]=i&255;e[n+1]=i>>8&255;e[n+2]=i>>16&255;e[n+3]=i>>24&255;n=n+4+i-1;e[n++]=0;return n};var serializeDBRef=function(e,t,r,n,o,s,i){e[n++]=h.BSON_DATA_OBJECT;var a=!i?e.write(t,n,"utf8"):e.write(t,n,"ascii");n=n+a;e[n++]=0;var c=n;var l;if(null!=r.db){l=p(e,{$ref:r.namespace,$id:r.oid,$db:r.db},false,n,o+1,s)}else{l=p(e,{$ref:r.namespace,$id:r.oid},false,n,o+1,s)}var u=l-c;e[c++]=u&255;e[c++]=u>>8&255;e[c++]=u>>16&255;e[c++]=u>>24&255;return l};var p=function serializeInto(e,t,r,n,o,i,a,p){n=n||0;p=p||[];p.push(t);var h=n+4;if(Array.isArray(t)){for(var m=0;m<t.length;m++){var y=""+m;var g=t[m];if(g&&g.toBSON){if(typeof g.toBSON!=="function")throw new Error("toBSON is not a function");g=g.toBSON()}var v=typeof g;if(v==="string"){h=serializeString(e,y,g,h,true)}else if(v==="number"){h=serializeNumber(e,y,g,h,true)}else if(v==="bigint"){throw new TypeError("Unsupported type BigInt, please use Decimal128")}else if(v==="boolean"){h=serializeBoolean(e,y,g,h,true)}else if(g instanceof Date||u(g)){h=serializeDate(e,y,g,h,true)}else if(g===undefined){h=serializeNull(e,y,g,h,true)}else if(g===null){h=serializeNull(e,y,g,h,true)}else if(g["_bsontype"]==="ObjectID"||g["_bsontype"]==="ObjectId"){h=serializeObjectId(e,y,g,h,true)}else if(Buffer.isBuffer(g)){h=serializeBuffer(e,y,g,h,true)}else if(g instanceof RegExp||d(g)){h=serializeRegExp(e,y,g,h,true)}else if(v==="object"&&g["_bsontype"]==null){h=serializeObject(e,y,g,h,r,o,i,a,true,p)}else if(v==="object"&&g["_bsontype"]==="Decimal128"){h=serializeDecimal128(e,y,g,h,true)}else if(g["_bsontype"]==="Long"||g["_bsontype"]==="Timestamp"){h=serializeLong(e,y,g,h,true)}else if(g["_bsontype"]==="Double"){h=serializeDouble(e,y,g,h,true)}else if(typeof g==="function"&&i){h=serializeFunction(e,y,g,h,r,o,i,true)}else if(g["_bsontype"]==="Code"){h=serializeCode(e,y,g,h,r,o,i,a,true)}else if(g["_bsontype"]==="Binary"){h=serializeBinary(e,y,g,h,true)}else if(g["_bsontype"]==="Symbol"){h=serializeSymbol(e,y,g,h,true)}else if(g["_bsontype"]==="DBRef"){h=serializeDBRef(e,y,g,h,o,i,true)}else if(g["_bsontype"]==="BSONRegExp"){h=serializeBSONRegExp(e,y,g,h,true)}else if(g["_bsontype"]==="Int32"){h=serializeInt32(e,y,g,h,true)}else if(g["_bsontype"]==="MinKey"||g["_bsontype"]==="MaxKey"){h=serializeMinMax(e,y,g,h,true)}else if(typeof g["_bsontype"]!=="undefined"){throw new TypeError("Unrecognized or invalid _bsontype: "+g["_bsontype"])}}}else if(t instanceof s){var b=t.entries();var S=false;while(!S){var w=b.next();S=w.done;if(S)continue;y=w.value[0];g=w.value[1];v=typeof g;if(typeof y==="string"&&l.indexOf(y)===-1){if(y.match(c)!=null){throw Error("key "+y+" must not contain null bytes")}if(r){if("$"===y[0]){throw Error("key "+y+" must not start with '$'")}else if(~y.indexOf(".")){throw Error("key "+y+" must not contain '.'")}}}if(v==="string"){h=serializeString(e,y,g,h)}else if(v==="number"){h=serializeNumber(e,y,g,h)}else if(v==="bigint"){throw new TypeError("Unsupported type BigInt, please use Decimal128")}else if(v==="boolean"){h=serializeBoolean(e,y,g,h)}else if(g instanceof Date||u(g)){h=serializeDate(e,y,g,h)}else if(g===null||g===undefined&&a===false){h=serializeNull(e,y,g,h)}else if(g["_bsontype"]==="ObjectID"||g["_bsontype"]==="ObjectId"){h=serializeObjectId(e,y,g,h)}else if(Buffer.isBuffer(g)){h=serializeBuffer(e,y,g,h)}else if(g instanceof RegExp||d(g)){h=serializeRegExp(e,y,g,h)}else if(v==="object"&&g["_bsontype"]==null){h=serializeObject(e,y,g,h,r,o,i,a,false,p)}else if(v==="object"&&g["_bsontype"]==="Decimal128"){h=serializeDecimal128(e,y,g,h)}else if(g["_bsontype"]==="Long"||g["_bsontype"]==="Timestamp"){h=serializeLong(e,y,g,h)}else if(g["_bsontype"]==="Double"){h=serializeDouble(e,y,g,h)}else if(g["_bsontype"]==="Code"){h=serializeCode(e,y,g,h,r,o,i,a)}else if(typeof g==="function"&&i){h=serializeFunction(e,y,g,h,r,o,i)}else if(g["_bsontype"]==="Binary"){h=serializeBinary(e,y,g,h)}else if(g["_bsontype"]==="Symbol"){h=serializeSymbol(e,y,g,h)}else if(g["_bsontype"]==="DBRef"){h=serializeDBRef(e,y,g,h,o,i)}else if(g["_bsontype"]==="BSONRegExp"){h=serializeBSONRegExp(e,y,g,h)}else if(g["_bsontype"]==="Int32"){h=serializeInt32(e,y,g,h)}else if(g["_bsontype"]==="MinKey"||g["_bsontype"]==="MaxKey"){h=serializeMinMax(e,y,g,h)}else if(typeof g["_bsontype"]!=="undefined"){throw new TypeError("Unrecognized or invalid _bsontype: "+g["_bsontype"])}}}else{if(t.toBSON){if(typeof t.toBSON!=="function")throw new Error("toBSON is not a function");t=t.toBSON();if(t!=null&&typeof t!=="object")throw new Error("toBSON function did not return an object")}for(y in t){g=t[y];if(g&&g.toBSON){if(typeof g.toBSON!=="function")throw new Error("toBSON is not a function");g=g.toBSON()}v=typeof g;if(typeof y==="string"&&l.indexOf(y)===-1){if(y.match(c)!=null){throw Error("key "+y+" must not contain null bytes")}if(r){if("$"===y[0]){throw Error("key "+y+" must not start with '$'")}else if(~y.indexOf(".")){throw Error("key "+y+" must not contain '.'")}}}if(v==="string"){h=serializeString(e,y,g,h)}else if(v==="number"){h=serializeNumber(e,y,g,h)}else if(v==="bigint"){throw new TypeError("Unsupported type BigInt, please use Decimal128")}else if(v==="boolean"){h=serializeBoolean(e,y,g,h)}else if(g instanceof Date||u(g)){h=serializeDate(e,y,g,h)}else if(g===undefined){if(a===false)h=serializeNull(e,y,g,h)}else if(g===null){h=serializeNull(e,y,g,h)}else if(g["_bsontype"]==="ObjectID"||g["_bsontype"]==="ObjectId"){h=serializeObjectId(e,y,g,h)}else if(Buffer.isBuffer(g)){h=serializeBuffer(e,y,g,h)}else if(g instanceof RegExp||d(g)){h=serializeRegExp(e,y,g,h)}else if(v==="object"&&g["_bsontype"]==null){h=serializeObject(e,y,g,h,r,o,i,a,false,p)}else if(v==="object"&&g["_bsontype"]==="Decimal128"){h=serializeDecimal128(e,y,g,h)}else if(g["_bsontype"]==="Long"||g["_bsontype"]==="Timestamp"){h=serializeLong(e,y,g,h)}else if(g["_bsontype"]==="Double"){h=serializeDouble(e,y,g,h)}else if(g["_bsontype"]==="Code"){h=serializeCode(e,y,g,h,r,o,i,a)}else if(typeof g==="function"&&i){h=serializeFunction(e,y,g,h,r,o,i)}else if(g["_bsontype"]==="Binary"){h=serializeBinary(e,y,g,h)}else if(g["_bsontype"]==="Symbol"){h=serializeSymbol(e,y,g,h)}else if(g["_bsontype"]==="DBRef"){h=serializeDBRef(e,y,g,h,o,i)}else if(g["_bsontype"]==="BSONRegExp"){h=serializeBSONRegExp(e,y,g,h)}else if(g["_bsontype"]==="Int32"){h=serializeInt32(e,y,g,h)}else if(g["_bsontype"]==="MinKey"||g["_bsontype"]==="MaxKey"){h=serializeMinMax(e,y,g,h)}else if(typeof g["_bsontype"]!=="undefined"){throw new TypeError("Unrecognized or invalid _bsontype: "+g["_bsontype"])}}}p.pop();e[h++]=0;var _=h-n;e[n++]=_&255;e[n++]=_>>8&255;e[n++]=_>>16&255;e[n++]=_>>24&255;return h};var h={};h.BSON_DATA_NUMBER=1;h.BSON_DATA_STRING=2;h.BSON_DATA_OBJECT=3;h.BSON_DATA_ARRAY=4;h.BSON_DATA_BINARY=5;h.BSON_DATA_UNDEFINED=6;h.BSON_DATA_OID=7;h.BSON_DATA_BOOLEAN=8;h.BSON_DATA_DATE=9;h.BSON_DATA_NULL=10;h.BSON_DATA_REGEXP=11;h.BSON_DATA_CODE=13;h.BSON_DATA_SYMBOL=14;h.BSON_DATA_CODE_W_SCOPE=15;h.BSON_DATA_INT=16;h.BSON_DATA_TIMESTAMP=17;h.BSON_DATA_LONG=18;h.BSON_DATA_DECIMAL128=19;h.BSON_DATA_MIN_KEY=255;h.BSON_DATA_MAX_KEY=127;h.BSON_BINARY_SUBTYPE_DEFAULT=0;h.BSON_BINARY_SUBTYPE_FUNCTION=1;h.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2;h.BSON_BINARY_SUBTYPE_UUID=3;h.BSON_BINARY_SUBTYPE_MD5=4;h.BSON_BINARY_SUBTYPE_USER_DEFINED=128;h.BSON_INT32_MAX=2147483647;h.BSON_INT32_MIN=-2147483648;h.BSON_INT64_MAX=Math.pow(2,63)-1;h.BSON_INT64_MIN=-Math.pow(2,63);h.JS_INT_MAX=9007199254740992;h.JS_INT_MIN=-9007199254740992;e.exports=p},2863:e=>{"use strict";function normalizedFunctionString(e){return e.toString().replace(/function *\(/,"function (")}function newBuffer(e,t){return new Buffer(e,t)}function allocBuffer(){return Buffer.alloc.apply(Buffer,arguments)}function toBuffer(){return Buffer.from.apply(Buffer,arguments)}e.exports={normalizedFunctionString:normalizedFunctionString,allocBuffer:typeof Buffer.alloc==="function"?allocBuffer:newBuffer,toBuffer:typeof Buffer.from==="function"?toBuffer:newBuffer}},4636:e=>{function BSONRegExp(e,t){if(!(this instanceof BSONRegExp))return new BSONRegExp;this._bsontype="BSONRegExp";this.pattern=e||"";this.options=t||"";for(var r=0;r<this.options.length;r++){if(!(this.options[r]==="i"||this.options[r]==="m"||this.options[r]==="x"||this.options[r]==="l"||this.options[r]==="s"||this.options[r]==="u")){throw new Error("the regular expression options ["+this.options[r]+"] is not supported")}}}e.exports=BSONRegExp;e.exports.BSONRegExp=BSONRegExp},2259:(e,t,r)=>{var n=Buffer?r(1669).inspect.custom||"inspect":"inspect";function Symbol(e){if(!(this instanceof Symbol))return new Symbol(e);this._bsontype="Symbol";this.value=e}Symbol.prototype.valueOf=function(){return this.value};Symbol.prototype.toString=function(){return this.value};Symbol.prototype[n]=function(){return this.value};Symbol.prototype.toJSON=function(){return this.value};e.exports=Symbol;e.exports.Symbol=Symbol},1031:e=>{function Timestamp(e,t){if(!(this instanceof Timestamp))return new Timestamp(e,t);this._bsontype="Timestamp";this.low_=e|0;this.high_=t|0}Timestamp.prototype.toInt=function(){return this.low_};Timestamp.prototype.toNumber=function(){return this.high_*Timestamp.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()};Timestamp.prototype.toJSON=function(){return this.toString()};Timestamp.prototype.toString=function(e){var t=e||10;if(t<2||36<t){throw Error("radix out of range: "+t)}if(this.isZero()){return"0"}if(this.isNegative()){if(this.equals(Timestamp.MIN_VALUE)){var r=Timestamp.fromNumber(t);var n=this.div(r);var o=n.multiply(r).subtract(this);return n.toString(t)+o.toInt().toString(t)}else{return"-"+this.negate().toString(t)}}var s=Timestamp.fromNumber(Math.pow(t,6));o=this;var i="";while(!o.isZero()){var a=o.div(s);var c=o.subtract(a.multiply(s)).toInt();var l=c.toString(t);o=a;if(o.isZero()){return l+i}else{while(l.length<6){l="0"+l}i=""+l+i}}};Timestamp.prototype.getHighBits=function(){return this.high_};Timestamp.prototype.getLowBits=function(){return this.low_};Timestamp.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:Timestamp.TWO_PWR_32_DBL_+this.low_};Timestamp.prototype.getNumBitsAbs=function(){if(this.isNegative()){if(this.equals(Timestamp.MIN_VALUE)){return 64}else{return this.negate().getNumBitsAbs()}}else{var e=this.high_!==0?this.high_:this.low_;for(var t=31;t>0;t--){if((e&1<<t)!==0){break}}return this.high_!==0?t+33:t+1}};Timestamp.prototype.isZero=function(){return this.high_===0&&this.low_===0};Timestamp.prototype.isNegative=function(){return this.high_<0};Timestamp.prototype.isOdd=function(){return(this.low_&1)===1};Timestamp.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_};Timestamp.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_};Timestamp.prototype.lessThan=function(e){return this.compare(e)<0};Timestamp.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0};Timestamp.prototype.greaterThan=function(e){return this.compare(e)>0};Timestamp.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0};Timestamp.prototype.compare=function(e){if(this.equals(e)){return 0}var t=this.isNegative();var r=e.isNegative();if(t&&!r){return-1}if(!t&&r){return 1}if(this.subtract(e).isNegative()){return-1}else{return 1}};Timestamp.prototype.negate=function(){if(this.equals(Timestamp.MIN_VALUE)){return Timestamp.MIN_VALUE}else{return this.not().add(Timestamp.ONE)}};Timestamp.prototype.add=function(e){var t=this.high_>>>16;var r=this.high_&65535;var n=this.low_>>>16;var o=this.low_&65535;var s=e.high_>>>16;var i=e.high_&65535;var a=e.low_>>>16;var c=e.low_&65535;var l=0,u=0,d=0,p=0;p+=o+c;d+=p>>>16;p&=65535;d+=n+a;u+=d>>>16;d&=65535;u+=r+i;l+=u>>>16;u&=65535;l+=t+s;l&=65535;return Timestamp.fromBits(d<<16|p,l<<16|u)};Timestamp.prototype.subtract=function(e){return this.add(e.negate())};Timestamp.prototype.multiply=function(e){if(this.isZero()){return Timestamp.ZERO}else if(e.isZero()){return Timestamp.ZERO}if(this.equals(Timestamp.MIN_VALUE)){return e.isOdd()?Timestamp.MIN_VALUE:Timestamp.ZERO}else if(e.equals(Timestamp.MIN_VALUE)){return this.isOdd()?Timestamp.MIN_VALUE:Timestamp.ZERO}if(this.isNegative()){if(e.isNegative()){return this.negate().multiply(e.negate())}else{return this.negate().multiply(e).negate()}}else if(e.isNegative()){return this.multiply(e.negate()).negate()}if(this.lessThan(Timestamp.TWO_PWR_24_)&&e.lessThan(Timestamp.TWO_PWR_24_)){return Timestamp.fromNumber(this.toNumber()*e.toNumber())}var t=this.high_>>>16;var r=this.high_&65535;var n=this.low_>>>16;var o=this.low_&65535;var s=e.high_>>>16;var i=e.high_&65535;var a=e.low_>>>16;var c=e.low_&65535;var l=0,u=0,d=0,p=0;p+=o*c;d+=p>>>16;p&=65535;d+=n*c;u+=d>>>16;d&=65535;d+=o*a;u+=d>>>16;d&=65535;u+=r*c;l+=u>>>16;u&=65535;u+=n*a;l+=u>>>16;u&=65535;u+=o*i;l+=u>>>16;u&=65535;l+=t*c+r*a+n*i+o*s;l&=65535;return Timestamp.fromBits(d<<16|p,l<<16|u)};Timestamp.prototype.div=function(e){if(e.isZero()){throw Error("division by zero")}else if(this.isZero()){return Timestamp.ZERO}if(this.equals(Timestamp.MIN_VALUE)){if(e.equals(Timestamp.ONE)||e.equals(Timestamp.NEG_ONE)){return Timestamp.MIN_VALUE}else if(e.equals(Timestamp.MIN_VALUE)){return Timestamp.ONE}else{var t=this.shiftRight(1);var r=t.div(e).shiftLeft(1);if(r.equals(Timestamp.ZERO)){return e.isNegative()?Timestamp.ONE:Timestamp.NEG_ONE}else{var n=this.subtract(e.multiply(r));var o=r.add(n.div(e));return o}}}else if(e.equals(Timestamp.MIN_VALUE)){return Timestamp.ZERO}if(this.isNegative()){if(e.isNegative()){return this.negate().div(e.negate())}else{return this.negate().div(e).negate()}}else if(e.isNegative()){return this.div(e.negate()).negate()}var s=Timestamp.ZERO;n=this;while(n.greaterThanOrEqual(e)){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));var i=Math.ceil(Math.log(r)/Math.LN2);var a=i<=48?1:Math.pow(2,i-48);var c=Timestamp.fromNumber(r);var l=c.multiply(e);while(l.isNegative()||l.greaterThan(n)){r-=a;c=Timestamp.fromNumber(r);l=c.multiply(e)}if(c.isZero()){c=Timestamp.ONE}s=s.add(c);n=n.subtract(l)}return s};Timestamp.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))};Timestamp.prototype.not=function(){return Timestamp.fromBits(~this.low_,~this.high_)};Timestamp.prototype.and=function(e){return Timestamp.fromBits(this.low_&e.low_,this.high_&e.high_)};Timestamp.prototype.or=function(e){return Timestamp.fromBits(this.low_|e.low_,this.high_|e.high_)};Timestamp.prototype.xor=function(e){return Timestamp.fromBits(this.low_^e.low_,this.high_^e.high_)};Timestamp.prototype.shiftLeft=function(e){e&=63;if(e===0){return this}else{var t=this.low_;if(e<32){var r=this.high_;return Timestamp.fromBits(t<<e,r<<e|t>>>32-e)}else{return Timestamp.fromBits(0,t<<e-32)}}};Timestamp.prototype.shiftRight=function(e){e&=63;if(e===0){return this}else{var t=this.high_;if(e<32){var r=this.low_;return Timestamp.fromBits(r>>>e|t<<32-e,t>>e)}else{return Timestamp.fromBits(t>>e-32,t>=0?0:-1)}}};Timestamp.prototype.shiftRightUnsigned=function(e){e&=63;if(e===0){return this}else{var t=this.high_;if(e<32){var r=this.low_;return Timestamp.fromBits(r>>>e|t<<32-e,t>>>e)}else if(e===32){return Timestamp.fromBits(t,0)}else{return Timestamp.fromBits(t>>>e-32,0)}}};Timestamp.fromInt=function(e){if(-128<=e&&e<128){var t=Timestamp.INT_CACHE_[e];if(t){return t}}var r=new Timestamp(e|0,e<0?-1:0);if(-128<=e&&e<128){Timestamp.INT_CACHE_[e]=r}return r};Timestamp.fromNumber=function(e){if(isNaN(e)||!isFinite(e)){return Timestamp.ZERO}else if(e<=-Timestamp.TWO_PWR_63_DBL_){return Timestamp.MIN_VALUE}else if(e+1>=Timestamp.TWO_PWR_63_DBL_){return Timestamp.MAX_VALUE}else if(e<0){return Timestamp.fromNumber(-e).negate()}else{return new Timestamp(e%Timestamp.TWO_PWR_32_DBL_|0,e/Timestamp.TWO_PWR_32_DBL_|0)}};Timestamp.fromBits=function(e,t){return new Timestamp(e,t)};Timestamp.fromString=function(e,t){if(e.length===0){throw Error("number format error: empty string")}var r=t||10;if(r<2||36<r){throw Error("radix out of range: "+r)}if(e.charAt(0)==="-"){return Timestamp.fromString(e.substring(1),r).negate()}else if(e.indexOf("-")>=0){throw Error('number format error: interior "-" character: '+e)}var n=Timestamp.fromNumber(Math.pow(r,8));var o=Timestamp.ZERO;for(var s=0;s<e.length;s+=8){var i=Math.min(8,e.length-s);var a=parseInt(e.substring(s,s+i),r);if(i<8){var c=Timestamp.fromNumber(Math.pow(r,i));o=o.multiply(c).add(Timestamp.fromNumber(a))}else{o=o.multiply(n);o=o.add(Timestamp.fromNumber(a))}}return o};Timestamp.INT_CACHE_={};Timestamp.TWO_PWR_16_DBL_=1<<16;Timestamp.TWO_PWR_24_DBL_=1<<24;Timestamp.TWO_PWR_32_DBL_=Timestamp.TWO_PWR_16_DBL_*Timestamp.TWO_PWR_16_DBL_;Timestamp.TWO_PWR_31_DBL_=Timestamp.TWO_PWR_32_DBL_/2;Timestamp.TWO_PWR_48_DBL_=Timestamp.TWO_PWR_32_DBL_*Timestamp.TWO_PWR_16_DBL_;Timestamp.TWO_PWR_64_DBL_=Timestamp.TWO_PWR_32_DBL_*Timestamp.TWO_PWR_32_DBL_;Timestamp.TWO_PWR_63_DBL_=Timestamp.TWO_PWR_64_DBL_/2;Timestamp.ZERO=Timestamp.fromInt(0);Timestamp.ONE=Timestamp.fromInt(1);Timestamp.NEG_ONE=Timestamp.fromInt(-1);Timestamp.MAX_VALUE=Timestamp.fromBits(4294967295|0,2147483647|0);Timestamp.MIN_VALUE=Timestamp.fromBits(0,2147483648|0);Timestamp.TWO_PWR_24_=Timestamp.fromInt(1<<24);e.exports=Timestamp;e.exports.Timestamp=Timestamp},4794:(e,t,r)=>{var n=r(4293).Buffer;var o=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];if(typeof Int32Array!=="undefined"){o=new Int32Array(o)}function ensureBuffer(e){if(n.isBuffer(e)){return e}var t=typeof n.alloc==="function"&&typeof n.from==="function";if(typeof e==="number"){return t?n.alloc(e):new n(e)}else if(typeof e==="string"){return t?n.from(e):new n(e)}else{throw new Error("input must be buffer, number, or string, received "+typeof e)}}function bufferizeInt(e){var t=ensureBuffer(4);t.writeInt32BE(e,0);return t}function _crc32(e,t){e=ensureBuffer(e);if(n.isBuffer(t)){t=t.readUInt32BE(0)}var r=~~t^-1;for(var s=0;s<e.length;s++){r=o[(r^e[s])&255]^r>>>8}return r^-1}function crc32(){return bufferizeInt(_crc32.apply(null,arguments))}crc32.signed=function(){return _crc32.apply(null,arguments)};crc32.unsigned=function(){return _crc32.apply(null,arguments)>>>0};e.exports=crc32},1362:e=>{"use strict";const preserveCamelCase=(e,t)=>{let r=false;let n=false;let o=false;for(let s=0;s<e.length;s++){const i=e[s];if(r&&/[\p{Lu}]/u.test(i)){e=e.slice(0,s)+"-"+e.slice(s);r=false;o=n;n=true;s++}else if(n&&o&&/[\p{Ll}]/u.test(i)){e=e.slice(0,s-1)+"-"+e.slice(s-1);o=n;n=false;r=true}else{r=i.toLocaleLowerCase(t)===i&&i.toLocaleUpperCase(t)!==i;o=n;n=i.toLocaleUpperCase(t)===i&&i.toLocaleLowerCase(t)!==i}}return e};const preserveConsecutiveUppercase=e=>e.replace(/^[\p{Lu}](?![\p{Lu}])/gu,(e=>e.toLowerCase()));const postProcess=(e,t)=>e.replace(/[_.\- ]+([\p{Alpha}\p{N}_]|$)/gu,((e,r)=>r.toLocaleUpperCase(t.locale))).replace(/\d+([\p{Alpha}\p{N}_]|$)/gu,(e=>e.toLocaleUpperCase(t.locale)));const camelCase=(e,t)=>{if(!(typeof e==="string"||Array.isArray(e))){throw new TypeError("Expected the input to be `string | string[]`")}t={pascalCase:false,preserveConsecutiveUppercase:false,...t};if(Array.isArray(e)){e=e.map((e=>e.trim())).filter((e=>e.length)).join("-")}else{e=e.trim()}if(e.length===0){return""}if(e.length===1){return t.pascalCase?e.toLocaleUpperCase(t.locale):e.toLocaleLowerCase(t.locale)}const r=e!==e.toLocaleLowerCase(t.locale);if(r){e=preserveCamelCase(e,t.locale)}e=e.replace(/^[_.\- ]+/,"");if(t.preserveConsecutiveUppercase){e=preserveConsecutiveUppercase(e)}else{e=e.toLocaleLowerCase()}if(t.pascalCase){e=e.charAt(0).toLocaleUpperCase(t.locale)+e.slice(1)}return postProcess(e,t)};e.exports=camelCase;e.exports.default=camelCase},9930:(e,t,r)=>{var n=r(5622);e.exports=function(e,t){if(t){var r=t.map((function(t){return n.resolve(e,t)}))}else{var r=e}var o=r.slice(1).reduce((function(e,t){if(!t.match(/^([A-Za-z]:)?\/|\\/)){throw new Error("relative path without a basedir")}var r=t.split(/\/+|\\+/);for(var n=0;e[n]===r[n]&&n<Math.min(e.length,r.length);n++);return e.slice(0,n)}),r[0].split(/\/+|\\+/));return o.length>1?o.join("/"):"/"}},6891:e=>{e.exports=function(e,r){var n=[];for(var o=0;o<e.length;o++){var s=r(e[o],o);if(t(s))n.push.apply(n,s);else n.push(s)}return n};var t=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}},8222:(e,t,r)=>{t.formatArgs=formatArgs;t.save=save;t.load=load;t.useColors=useColors;t.storage=localstorage();t.destroy=(()=>{let e=false;return()=>{if(!e){e=true;console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}}})();t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function useColors(){if(typeof window!=="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)){return true}if(typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return false}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function formatArgs(t){t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff);if(!this.useColors){return}const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0;let o=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{if(e==="%%"){return}n++;if(e==="%c"){o=n}}));t.splice(o,0,r)}t.log=console.debug||console.log||(()=>{});function save(e){try{if(e){t.storage.setItem("debug",e)}else{t.storage.removeItem("debug")}}catch(e){}}function load(){let e;try{e=t.storage.getItem("debug")}catch(e){}if(!e&&typeof process!=="undefined"&&"env"in process){e=process.env.DEBUG}return e}function localstorage(){try{return localStorage}catch(e){}}e.exports=r(6243)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},6243:(e,t,r)=>{function setup(e){createDebug.debug=createDebug;createDebug.default=createDebug;createDebug.coerce=coerce;createDebug.disable=disable;createDebug.enable=enable;createDebug.enabled=enabled;createDebug.humanize=r(900);createDebug.destroy=destroy;Object.keys(e).forEach((t=>{createDebug[t]=e[t]}));createDebug.names=[];createDebug.skips=[];createDebug.formatters={};function selectColor(e){let t=0;for(let r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r);t|=0}return createDebug.colors[Math.abs(t)%createDebug.colors.length]}createDebug.selectColor=selectColor;function createDebug(e){let t;let r=null;function debug(...e){if(!debug.enabled){return}const r=debug;const n=Number(new Date);const o=n-(t||n);r.diff=o;r.prev=t;r.curr=n;t=n;e[0]=createDebug.coerce(e[0]);if(typeof e[0]!=="string"){e.unshift("%O")}let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((t,n)=>{if(t==="%%"){return"%"}s++;const o=createDebug.formatters[n];if(typeof o==="function"){const n=e[s];t=o.call(r,n);e.splice(s,1);s--}return t}));createDebug.formatArgs.call(r,e);const i=r.log||createDebug.log;i.apply(r,e)}debug.namespace=e;debug.useColors=createDebug.useColors();debug.color=createDebug.selectColor(e);debug.extend=extend;debug.destroy=createDebug.destroy;Object.defineProperty(debug,"enabled",{enumerable:true,configurable:false,get:()=>r===null?createDebug.enabled(e):r,set:e=>{r=e}});if(typeof createDebug.init==="function"){createDebug.init(debug)}return debug}function extend(e,t){const r=createDebug(this.namespace+(typeof t==="undefined"?":":t)+e);r.log=this.log;return r}function enable(e){createDebug.save(e);createDebug.names=[];createDebug.skips=[];let t;const r=(typeof e==="string"?e:"").split(/[\s,]+/);const n=r.length;for(t=0;t<n;t++){if(!r[t]){continue}e=r[t].replace(/\*/g,".*?");if(e[0]==="-"){createDebug.skips.push(new RegExp("^"+e.substr(1)+"$"))}else{createDebug.names.push(new RegExp("^"+e+"$"))}}}function disable(){const e=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map((e=>"-"+e))].join(",");createDebug.enable("");return e}function enabled(e){if(e[e.length-1]==="*"){return true}let t;let r;for(t=0,r=createDebug.skips.length;t<r;t++){if(createDebug.skips[t].test(e)){return false}}for(t=0,r=createDebug.names.length;t<r;t++){if(createDebug.names[t].test(e)){return true}}return false}function toNamespace(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}function coerce(e){if(e instanceof Error){return e.stack||e.message}return e}function destroy(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}createDebug.enable(createDebug.load());return createDebug}e.exports=setup},8237:(e,t,r)=>{if(typeof process==="undefined"||process.type==="renderer"||process.browser===true||process.__nwjs){e.exports=r(8222)}else{e.exports=r(5332)}},5332:(e,t,r)=>{const n=r(3867);const o=r(1669);t.init=init;t.log=log;t.formatArgs=formatArgs;t.save=save;t.load=load;t.useColors=useColors;t.destroy=o.deprecate((()=>{}),"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");t.colors=[6,2,3,4,5,1];try{const e=r(9318);if(e&&(e.stderr||e).level>=2){t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221]}}catch(e){}t.inspectOpts=Object.keys(process.env).filter((e=>/^debug_/i.test(e))).reduce(((e,t)=>{const r=t.substring(6).toLowerCase().replace(/_([a-z])/g,((e,t)=>t.toUpperCase()));let n=process.env[t];if(/^(yes|on|true|enabled)$/i.test(n)){n=true}else if(/^(no|off|false|disabled)$/i.test(n)){n=false}else if(n==="null"){n=null}else{n=Number(n)}e[r]=n;return e}),{});function useColors(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):n.isatty(process.stderr.fd)}function formatArgs(t){const{namespace:r,useColors:n}=this;if(n){const n=this.color;const o="[3"+(n<8?n:"8;5;"+n);const s=`  ${o};1m${r} [0m`;t[0]=s+t[0].split("\n").join("\n"+s);t.push(o+"m+"+e.exports.humanize(this.diff)+"[0m")}else{t[0]=getDate()+r+" "+t[0]}}function getDate(){if(t.inspectOpts.hideDate){return""}return(new Date).toISOString()+" "}function log(...e){return process.stderr.write(o.format(...e)+"\n")}function save(e){if(e){process.env.DEBUG=e}else{delete process.env.DEBUG}}function load(){return process.env.DEBUG}function init(e){e.inspectOpts={};const r=Object.keys(t.inspectOpts);for(let n=0;n<r.length;n++){e.inspectOpts[r[n]]=t.inspectOpts[r[n]]}}e.exports=r(6243)(t);const{formatters:s}=e.exports;s.o=function(e){this.inspectOpts.colors=this.useColors;return o.inspect(e,this.inspectOpts).split("\n").map((e=>e.trim())).join(" ")};s.O=function(e){this.inspectOpts.colors=this.useColors;return o.inspect(e,this.inspectOpts)}},2342:e=>{"use strict";function Denque(e,t){var t=t||{};this._head=0;this._tail=0;this._capacity=t.capacity;this._capacityMask=3;this._list=new Array(4);if(Array.isArray(e)){this._fromArray(e)}}Denque.prototype.peekAt=function peekAt(e){var t=e;if(t!==(t|0)){return void 0}var r=this.size();if(t>=r||t<-r)return undefined;if(t<0)t+=r;t=this._head+t&this._capacityMask;return this._list[t]};Denque.prototype.get=function get(e){return this.peekAt(e)};Denque.prototype.peek=function peek(){if(this._head===this._tail)return undefined;return this._list[this._head]};Denque.prototype.peekFront=function peekFront(){return this.peek()};Denque.prototype.peekBack=function peekBack(){return this.peekAt(-1)};Object.defineProperty(Denque.prototype,"length",{get:function length(){return this.size()}});Denque.prototype.size=function size(){if(this._head===this._tail)return 0;if(this._head<this._tail)return this._tail-this._head;else return this._capacityMask+1-(this._head-this._tail)};Denque.prototype.unshift=function unshift(e){if(e===undefined)return this.size();var t=this._list.length;this._head=this._head-1+t&this._capacityMask;this._list[this._head]=e;if(this._tail===this._head)this._growArray();if(this._capacity&&this.size()>this._capacity)this.pop();if(this._head<this._tail)return this._tail-this._head;else return this._capacityMask+1-(this._head-this._tail)};Denque.prototype.shift=function shift(){var e=this._head;if(e===this._tail)return undefined;var t=this._list[e];this._list[e]=undefined;this._head=e+1&this._capacityMask;if(e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2)this._shrinkArray();return t};Denque.prototype.push=function push(e){if(e===undefined)return this.size();var t=this._tail;this._list[t]=e;this._tail=t+1&this._capacityMask;if(this._tail===this._head){this._growArray()}if(this._capacity&&this.size()>this._capacity){this.shift()}if(this._head<this._tail)return this._tail-this._head;else return this._capacityMask+1-(this._head-this._tail)};Denque.prototype.pop=function pop(){var e=this._tail;if(e===this._head)return undefined;var t=this._list.length;this._tail=e-1+t&this._capacityMask;var r=this._list[this._tail];this._list[this._tail]=undefined;if(this._head<2&&e>1e4&&e<=t>>>2)this._shrinkArray();return r};Denque.prototype.removeOne=function removeOne(e){var t=e;if(t!==(t|0)){return void 0}if(this._head===this._tail)return void 0;var r=this.size();var n=this._list.length;if(t>=r||t<-r)return void 0;if(t<0)t+=r;t=this._head+t&this._capacityMask;var o=this._list[t];var s;if(e<r/2){for(s=e;s>0;s--){this._list[t]=this._list[t=t-1+n&this._capacityMask]}this._list[t]=void 0;this._head=this._head+1+n&this._capacityMask}else{for(s=r-1-e;s>0;s--){this._list[t]=this._list[t=t+1+n&this._capacityMask]}this._list[t]=void 0;this._tail=this._tail-1+n&this._capacityMask}return o};Denque.prototype.remove=function remove(e,t){var r=e;var n;var o=t;if(r!==(r|0)){return void 0}if(this._head===this._tail)return void 0;var s=this.size();var i=this._list.length;if(r>=s||r<-s||t<1)return void 0;if(r<0)r+=s;if(t===1||!t){n=new Array(1);n[0]=this.removeOne(r);return n}if(r===0&&r+t>=s){n=this.toArray();this.clear();return n}if(r+t>s)t=s-r;var a;n=new Array(t);for(a=0;a<t;a++){n[a]=this._list[this._head+r+a&this._capacityMask]}r=this._head+r&this._capacityMask;if(e+t===s){this._tail=this._tail-t+i&this._capacityMask;for(a=t;a>0;a--){this._list[r=r+1+i&this._capacityMask]=void 0}return n}if(e===0){this._head=this._head+t+i&this._capacityMask;for(a=t-1;a>0;a--){this._list[r=r+1+i&this._capacityMask]=void 0}return n}if(r<s/2){this._head=this._head+e+t+i&this._capacityMask;for(a=e;a>0;a--){this.unshift(this._list[r=r-1+i&this._capacityMask])}r=this._head-1+i&this._capacityMask;while(o>0){this._list[r=r-1+i&this._capacityMask]=void 0;o--}if(e<0)this._tail=r}else{this._tail=r;r=r+t+i&this._capacityMask;for(a=s-(t+e);a>0;a--){this.push(this._list[r++])}r=this._tail;while(o>0){this._list[r=r+1+i&this._capacityMask]=void 0;o--}}if(this._head<2&&this._tail>1e4&&this._tail<=i>>>2)this._shrinkArray();return n};Denque.prototype.splice=function splice(e,t){var r=e;if(r!==(r|0)){return void 0}var n=this.size();if(r<0)r+=n;if(r>n)return void 0;if(arguments.length>2){var o;var s;var i;var a=arguments.length;var c=this._list.length;var l=2;if(!n||r<n/2){s=new Array(r);for(o=0;o<r;o++){s[o]=this._list[this._head+o&this._capacityMask]}if(t===0){i=[];if(r>0){this._head=this._head+r+c&this._capacityMask}}else{i=this.remove(r,t);this._head=this._head+r+c&this._capacityMask}while(a>l){this.unshift(arguments[--a])}for(o=r;o>0;o--){this.unshift(s[o-1])}}else{s=new Array(n-(r+t));var u=s.length;for(o=0;o<u;o++){s[o]=this._list[this._head+r+t+o&this._capacityMask]}if(t===0){i=[];if(r!=n){this._tail=this._head+r+c&this._capacityMask}}else{i=this.remove(r,t);this._tail=this._tail-u+c&this._capacityMask}while(l<a){this.push(arguments[l++])}for(o=0;o<u;o++){this.push(s[o])}}return i}else{return this.remove(r,t)}};Denque.prototype.clear=function clear(){this._head=0;this._tail=0};Denque.prototype.isEmpty=function isEmpty(){return this._head===this._tail};Denque.prototype.toArray=function toArray(){return this._copyArray(false)};Denque.prototype._fromArray=function _fromArray(e){for(var t=0;t<e.length;t++)this.push(e[t])};Denque.prototype._copyArray=function _copyArray(e){var t=[];var r=this._list;var n=r.length;var o;if(e||this._head>this._tail){for(o=this._head;o<n;o++)t.push(r[o]);for(o=0;o<this._tail;o++)t.push(r[o])}else{for(o=this._head;o<this._tail;o++)t.push(r[o])}return t};Denque.prototype._growArray=function _growArray(){if(this._head){this._list=this._copyArray(true);this._head=0}this._tail=this._list.length;this._list.length*=2;this._capacityMask=this._capacityMask<<1|1};Denque.prototype._shrinkArray=function _shrinkArray(){this._list.length>>>=1;this._capacityMask>>>=1};e.exports=Denque},1205:(e,t,r)=>{var n=r(1223);var noop=function(){};var isRequest=function(e){return e.setHeader&&typeof e.abort==="function"};var isChildProcess=function(e){return e.stdio&&Array.isArray(e.stdio)&&e.stdio.length===3};var eos=function(e,t,r){if(typeof t==="function")return eos(e,null,t);if(!t)t={};r=n(r||noop);var o=e._writableState;var s=e._readableState;var i=t.readable||t.readable!==false&&e.readable;var a=t.writable||t.writable!==false&&e.writable;var c=false;var onlegacyfinish=function(){if(!e.writable)onfinish()};var onfinish=function(){a=false;if(!i)r.call(e)};var onend=function(){i=false;if(!a)r.call(e)};var onexit=function(t){r.call(e,t?new Error("exited with error code: "+t):null)};var onerror=function(t){r.call(e,t)};var onclose=function(){process.nextTick(onclosenexttick)};var onclosenexttick=function(){if(c)return;if(i&&!(s&&(s.ended&&!s.destroyed)))return r.call(e,new Error("premature close"));if(a&&!(o&&(o.ended&&!o.destroyed)))return r.call(e,new Error("premature close"))};var onrequest=function(){e.req.on("finish",onfinish)};if(isRequest(e)){e.on("complete",onfinish);e.on("abort",onclose);if(e.req)onrequest();else e.on("request",onrequest)}else if(a&&!o){e.on("end",onlegacyfinish);e.on("close",onlegacyfinish)}if(isChildProcess(e))e.on("exit",onexit);e.on("end",onend);e.on("finish",onfinish);if(t.error!==false)e.on("error",onerror);e.on("close",onclose);return function(){c=true;e.removeListener("complete",onfinish);e.removeListener("abort",onclose);e.removeListener("request",onrequest);if(e.req)e.req.removeListener("finish",onfinish);e.removeListener("end",onlegacyfinish);e.removeListener("close",onlegacyfinish);e.removeListener("finish",onfinish);e.removeListener("exit",onexit);e.removeListener("end",onend);e.removeListener("error",onerror);e.removeListener("close",onclose)}};e.exports=eos},5010:(e,t,r)=>{var n=r(5747);var o=r(1669);var s=r(2413);var i=s.Readable;var a=s.Writable;var c=s.PassThrough;var l=r(4833);var u=r(8614).EventEmitter;t.createFromBuffer=createFromBuffer;t.createFromFd=createFromFd;t.BufferSlicer=BufferSlicer;t.FdSlicer=FdSlicer;o.inherits(FdSlicer,u);function FdSlicer(e,t){t=t||{};u.call(this);this.fd=e;this.pend=new l;this.pend.max=1;this.refCount=0;this.autoClose=!!t.autoClose}FdSlicer.prototype.read=function(e,t,r,o,s){var i=this;i.pend.go((function(a){n.read(i.fd,e,t,r,o,(function(e,t,r){a();s(e,t,r)}))}))};FdSlicer.prototype.write=function(e,t,r,o,s){var i=this;i.pend.go((function(a){n.write(i.fd,e,t,r,o,(function(e,t,r){a();s(e,t,r)}))}))};FdSlicer.prototype.createReadStream=function(e){return new ReadStream(this,e)};FdSlicer.prototype.createWriteStream=function(e){return new WriteStream(this,e)};FdSlicer.prototype.ref=function(){this.refCount+=1};FdSlicer.prototype.unref=function(){var e=this;e.refCount-=1;if(e.refCount>0)return;if(e.refCount<0)throw new Error("invalid unref");if(e.autoClose){n.close(e.fd,onCloseDone)}function onCloseDone(t){if(t){e.emit("error",t)}else{e.emit("close")}}};o.inherits(ReadStream,i);function ReadStream(e,t){t=t||{};i.call(this,t);this.context=e;this.context.ref();this.start=t.start||0;this.endOffset=t.end;this.pos=this.start;this.destroyed=false}ReadStream.prototype._read=function(e){var t=this;if(t.destroyed)return;var r=Math.min(t._readableState.highWaterMark,e);if(t.endOffset!=null){r=Math.min(r,t.endOffset-t.pos)}if(r<=0){t.destroyed=true;t.push(null);t.context.unref();return}t.context.pend.go((function(e){if(t.destroyed)return e();var o=new Buffer(r);n.read(t.context.fd,o,0,r,t.pos,(function(r,n){if(r){t.destroy(r)}else if(n===0){t.destroyed=true;t.push(null);t.context.unref()}else{t.pos+=n;t.push(o.slice(0,n))}e()}))}))};ReadStream.prototype.destroy=function(e){if(this.destroyed)return;e=e||new Error("stream destroyed");this.destroyed=true;this.emit("error",e);this.context.unref()};o.inherits(WriteStream,a);function WriteStream(e,t){t=t||{};a.call(this,t);this.context=e;this.context.ref();this.start=t.start||0;this.endOffset=t.end==null?Infinity:+t.end;this.bytesWritten=0;this.pos=this.start;this.destroyed=false;this.on("finish",this.destroy.bind(this))}WriteStream.prototype._write=function(e,t,r){var o=this;if(o.destroyed)return;if(o.pos+e.length>o.endOffset){var s=new Error("maximum file length exceeded");s.code="ETOOBIG";o.destroy();r(s);return}o.context.pend.go((function(t){if(o.destroyed)return t();n.write(o.context.fd,e,0,e.length,o.pos,(function(e,n){if(e){o.destroy();t();r(e)}else{o.bytesWritten+=n;o.pos+=n;o.emit("progress");t();r()}}))}))};WriteStream.prototype.destroy=function(){if(this.destroyed)return;this.destroyed=true;this.context.unref()};o.inherits(BufferSlicer,u);function BufferSlicer(e,t){u.call(this);t=t||{};this.refCount=0;this.buffer=e;this.maxChunkSize=t.maxChunkSize||Number.MAX_SAFE_INTEGER}BufferSlicer.prototype.read=function(e,t,r,n,o){var s=n+r;var i=s-this.buffer.length;var a=i>0?i:r;this.buffer.copy(e,t,n,s);setImmediate((function(){o(null,a)}))};BufferSlicer.prototype.write=function(e,t,r,n,o){e.copy(this.buffer,n,t,t+r);setImmediate((function(){o(null,r,e)}))};BufferSlicer.prototype.createReadStream=function(e){e=e||{};var t=new c(e);t.destroyed=false;t.start=e.start||0;t.endOffset=e.end;t.pos=t.endOffset||this.buffer.length;var r=this.buffer.slice(t.start,t.pos);var n=0;while(true){var o=n+this.maxChunkSize;if(o>=r.length){if(n<r.length){t.write(r.slice(n,r.length))}break}t.write(r.slice(n,o));n=o}t.end();t.destroy=function(){t.destroyed=true};return t};BufferSlicer.prototype.createWriteStream=function(e){var t=this;e=e||{};var r=new a(e);r.start=e.start||0;r.endOffset=e.end==null?this.buffer.length:+e.end;r.bytesWritten=0;r.pos=r.start;r.destroyed=false;r._write=function(e,n,o){if(r.destroyed)return;var s=r.pos+e.length;if(s>r.endOffset){var i=new Error("maximum file length exceeded");i.code="ETOOBIG";r.destroyed=true;o(i);return}e.copy(t.buffer,r.pos,0,e.length);r.bytesWritten+=e.length;r.pos=s;r.emit("progress");o()};r.destroy=function(){r.destroyed=true};return r};BufferSlicer.prototype.ref=function(){this.refCount+=1};BufferSlicer.prototype.unref=function(){this.refCount-=1;if(this.refCount<0){throw new Error("invalid unref")}};function createFromBuffer(e,t){return new BufferSlicer(e,t)}function createFromFd(e,t){return new FdSlicer(e,t)}},7281:(e,t,r)=>{"use strict";const n=r(5622);const o=r(5747);const s=r(9930);const i=r(8098);const a=r(9126);const{env:c,cwd:l}=process;const isWritable=e=>{try{o.accessSync(e,o.constants.W_OK);return true}catch(e){return false}};function useDirectory(e,t){if(t.create){a.sync(e)}if(t.thunk){return(...t)=>n.join(e,...t)}return e}function getNodeModuleDirectory(e){const t=n.join(e,"node_modules");if(!isWritable(t)&&(o.existsSync(t)||!isWritable(n.join(e)))){return}return t}e.exports=(e={})=>{if(c.CACHE_DIR&&!["true","false","1","0"].includes(c.CACHE_DIR)){return useDirectory(n.join(c.CACHE_DIR,"find-cache-dir"),e)}let{cwd:t=l()}=e;if(e.files){t=s(t,e.files)}t=i.sync(t);if(!t){return}const r=getNodeModuleDirectory(t);if(!r){return undefined}return useDirectory(n.join(t,"node_modules",".cache",e.name),e)}},3186:(e,t,r)=>{e.exports=r(5747).constants||r(7619)},6863:(e,t,r)=>{e.exports=realpath;realpath.realpath=realpath;realpath.sync=realpathSync;realpath.realpathSync=realpathSync;realpath.monkeypatch=monkeypatch;realpath.unmonkeypatch=unmonkeypatch;var n=r(5747);var o=n.realpath;var s=n.realpathSync;var i=process.version;var a=/^v[0-5]\./.test(i);var c=r(1734);function newError(e){return e&&e.syscall==="realpath"&&(e.code==="ELOOP"||e.code==="ENOMEM"||e.code==="ENAMETOOLONG")}function realpath(e,t,r){if(a){return o(e,t,r)}if(typeof t==="function"){r=t;t=null}o(e,t,(function(n,o){if(newError(n)){c.realpath(e,t,r)}else{r(n,o)}}))}function realpathSync(e,t){if(a){return s(e,t)}try{return s(e,t)}catch(r){if(newError(r)){return c.realpathSync(e,t)}else{throw r}}}function monkeypatch(){n.realpath=realpath;n.realpathSync=realpathSync}function unmonkeypatch(){n.realpath=o;n.realpathSync=s}},1734:(e,t,r)=>{var n=r(5622);var o=process.platform==="win32";var s=r(5747);var i=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function rethrow(){var e;if(i){var t=new Error;e=debugCallback}else e=missingCallback;return e;function debugCallback(e){if(e){t.message=e.message;e=t;missingCallback(e)}}function missingCallback(e){if(e){if(process.throwDeprecation)throw e;else if(!process.noDeprecation){var t="fs: missing callback "+(e.stack||e.message);if(process.traceDeprecation)console.trace(t);else console.error(t)}}}}function maybeCallback(e){return typeof e==="function"?e:rethrow()}var a=n.normalize;if(o){var c=/(.*?)(?:[\/\\]+|$)/g}else{var c=/(.*?)(?:[\/]+|$)/g}if(o){var l=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/}else{var l=/^[\/]*/}t.realpathSync=function realpathSync(e,t){e=n.resolve(e);if(t&&Object.prototype.hasOwnProperty.call(t,e)){return t[e]}var r=e,i={},a={};var u;var d;var p;var h;start();function start(){var t=l.exec(e);u=t[0].length;d=t[0];p=t[0];h="";if(o&&!a[p]){s.lstatSync(p);a[p]=true}}while(u<e.length){c.lastIndex=u;var m=c.exec(e);h=d;d+=m[0];p=h+m[1];u=c.lastIndex;if(a[p]||t&&t[p]===p){continue}var y;if(t&&Object.prototype.hasOwnProperty.call(t,p)){y=t[p]}else{var g=s.lstatSync(p);if(!g.isSymbolicLink()){a[p]=true;if(t)t[p]=p;continue}var v=null;if(!o){var b=g.dev.toString(32)+":"+g.ino.toString(32);if(i.hasOwnProperty(b)){v=i[b]}}if(v===null){s.statSync(p);v=s.readlinkSync(p)}y=n.resolve(h,v);if(t)t[p]=y;if(!o)i[b]=v}e=n.resolve(y,e.slice(u));start()}if(t)t[r]=e;return e};t.realpath=function realpath(e,t,r){if(typeof r!=="function"){r=maybeCallback(t);t=null}e=n.resolve(e);if(t&&Object.prototype.hasOwnProperty.call(t,e)){return process.nextTick(r.bind(null,null,t[e]))}var i=e,a={},u={};var d;var p;var h;var m;start();function start(){var t=l.exec(e);d=t[0].length;p=t[0];h=t[0];m="";if(o&&!u[h]){s.lstat(h,(function(e){if(e)return r(e);u[h]=true;LOOP()}))}else{process.nextTick(LOOP)}}function LOOP(){if(d>=e.length){if(t)t[i]=e;return r(null,e)}c.lastIndex=d;var n=c.exec(e);m=p;p+=n[0];h=m+n[1];d=c.lastIndex;if(u[h]||t&&t[h]===h){return process.nextTick(LOOP)}if(t&&Object.prototype.hasOwnProperty.call(t,h)){return gotResolvedLink(t[h])}return s.lstat(h,gotStat)}function gotStat(e,n){if(e)return r(e);if(!n.isSymbolicLink()){u[h]=true;if(t)t[h]=h;return process.nextTick(LOOP)}if(!o){var i=n.dev.toString(32)+":"+n.ino.toString(32);if(a.hasOwnProperty(i)){return gotTarget(null,a[i],h)}}s.stat(h,(function(e){if(e)return r(e);s.readlink(h,(function(e,t){if(!o)a[i]=t;gotTarget(e,t)}))}))}function gotTarget(e,o,s){if(e)return r(e);var i=n.resolve(m,o);if(t)t[s]=i;gotResolvedLink(i)}function gotResolvedLink(t){e=n.resolve(t,e.slice(d));start()}}},3002:(e,t,r)=>{"use strict";const n=r(1631);class Locked extends Error{constructor(e){super(`${e} is locked`)}}const o={old:new Set,young:new Set};const s=1e3*15;let i;const getAvailablePort=e=>new Promise(((t,r)=>{const o=n.createServer();o.unref();o.on("error",r);o.listen(e,(()=>{const{port:e}=o.address();o.close((()=>{t(e)}))}))}));const portCheckSequence=function*(e){if(e){yield*e}yield 0};e.exports=async e=>{let t;if(e){t=typeof e.port==="number"?[e.port]:e.port}if(i===undefined){i=setInterval((()=>{o.old=o.young;o.young=new Set}),s);if(i.unref){i.unref()}}for(const r of portCheckSequence(t)){try{let t=await getAvailablePort({...e,port:r});while(o.old.has(t)||o.young.has(t)){if(r!==0){throw new Locked(r)}t=await getAvailablePort({...e,port:r})}o.young.add(t);return t}catch(e){if(!["EADDRINUSE","EACCES"].includes(e.code)&&!(e instanceof Locked)){throw e}}}throw new Error("No available ports found")};e.exports.makeRange=(e,t)=>{if(!Number.isInteger(e)||!Number.isInteger(t)){throw new TypeError("`from` and `to` must be integer numbers")}if(e<1024||e>65535){throw new RangeError("`from` must be between 1024 and 65535")}if(t<1024||t>65536){throw new RangeError("`to` must be between 1024 and 65536")}if(t<e){throw new RangeError("`to` must be greater than or equal to `from`")}const generator=function*(e,t){for(let r=e;r<=t;r++){yield r}};return generator(e,t)}},7625:(e,t,r)=>{t.setopts=setopts;t.ownProp=ownProp;t.makeAbs=makeAbs;t.finish=finish;t.mark=mark;t.isIgnored=isIgnored;t.childrenIgnored=childrenIgnored;function ownProp(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var n=r(5622);var o=r(3973);var s=r(8714);var i=o.Minimatch;function alphasort(e,t){return e.localeCompare(t,"en")}function setupIgnores(e,t){e.ignore=t.ignore||[];if(!Array.isArray(e.ignore))e.ignore=[e.ignore];if(e.ignore.length){e.ignore=e.ignore.map(ignoreMap)}}function ignoreMap(e){var t=null;if(e.slice(-3)==="/**"){var r=e.replace(/(\/\*\*)+$/,"");t=new i(r,{dot:true})}return{matcher:new i(e,{dot:true}),gmatcher:t}}function setopts(e,t,r){if(!r)r={};if(r.matchBase&&-1===t.indexOf("/")){if(r.noglobstar){throw new Error("base matching requires globstar")}t="**/"+t}e.silent=!!r.silent;e.pattern=t;e.strict=r.strict!==false;e.realpath=!!r.realpath;e.realpathCache=r.realpathCache||Object.create(null);e.follow=!!r.follow;e.dot=!!r.dot;e.mark=!!r.mark;e.nodir=!!r.nodir;if(e.nodir)e.mark=true;e.sync=!!r.sync;e.nounique=!!r.nounique;e.nonull=!!r.nonull;e.nosort=!!r.nosort;e.nocase=!!r.nocase;e.stat=!!r.stat;e.noprocess=!!r.noprocess;e.absolute=!!r.absolute;e.maxLength=r.maxLength||Infinity;e.cache=r.cache||Object.create(null);e.statCache=r.statCache||Object.create(null);e.symlinks=r.symlinks||Object.create(null);setupIgnores(e,r);e.changedCwd=false;var o=process.cwd();if(!ownProp(r,"cwd"))e.cwd=o;else{e.cwd=n.resolve(r.cwd);e.changedCwd=e.cwd!==o}e.root=r.root||n.resolve(e.cwd,"/");e.root=n.resolve(e.root);if(process.platform==="win32")e.root=e.root.replace(/\\/g,"/");e.cwdAbs=s(e.cwd)?e.cwd:makeAbs(e,e.cwd);if(process.platform==="win32")e.cwdAbs=e.cwdAbs.replace(/\\/g,"/");e.nomount=!!r.nomount;r.nonegate=true;r.nocomment=true;e.minimatch=new i(t,r);e.options=e.minimatch.options}function finish(e){var t=e.nounique;var r=t?[]:Object.create(null);for(var n=0,o=e.matches.length;n<o;n++){var s=e.matches[n];if(!s||Object.keys(s).length===0){if(e.nonull){var i=e.minimatch.globSet[n];if(t)r.push(i);else r[i]=true}}else{var a=Object.keys(s);if(t)r.push.apply(r,a);else a.forEach((function(e){r[e]=true}))}}if(!t)r=Object.keys(r);if(!e.nosort)r=r.sort(alphasort);if(e.mark){for(var n=0;n<r.length;n++){r[n]=e._mark(r[n])}if(e.nodir){r=r.filter((function(t){var r=!/\/$/.test(t);var n=e.cache[t]||e.cache[makeAbs(e,t)];if(r&&n)r=n!=="DIR"&&!Array.isArray(n);return r}))}}if(e.ignore.length)r=r.filter((function(t){return!isIgnored(e,t)}));e.found=r}function mark(e,t){var r=makeAbs(e,t);var n=e.cache[r];var o=t;if(n){var s=n==="DIR"||Array.isArray(n);var i=t.slice(-1)==="/";if(s&&!i)o+="/";else if(!s&&i)o=o.slice(0,-1);if(o!==t){var a=makeAbs(e,o);e.statCache[a]=e.statCache[r];e.cache[a]=e.cache[r]}}return o}function makeAbs(e,t){var r=t;if(t.charAt(0)==="/"){r=n.join(e.root,t)}else if(s(t)||t===""){r=t}else if(e.changedCwd){r=n.resolve(e.cwd,t)}else{r=n.resolve(t)}if(process.platform==="win32")r=r.replace(/\\/g,"/");return r}function isIgnored(e,t){if(!e.ignore.length)return false;return e.ignore.some((function(e){return e.matcher.match(t)||!!(e.gmatcher&&e.gmatcher.match(t))}))}function childrenIgnored(e,t){if(!e.ignore.length)return false;return e.ignore.some((function(e){return!!(e.gmatcher&&e.gmatcher.match(t))}))}},1957:(e,t,r)=>{e.exports=glob;var n=r(5747);var o=r(6863);var s=r(3973);var i=s.Minimatch;var a=r(4124);var c=r(8614).EventEmitter;var l=r(5622);var u=r(2357);var d=r(8714);var p=r(9010);var h=r(7625);var m=h.setopts;var y=h.ownProp;var g=r(2492);var v=r(1669);var b=h.childrenIgnored;var S=h.isIgnored;var w=r(1223);function glob(e,t,r){if(typeof t==="function")r=t,t={};if(!t)t={};if(t.sync){if(r)throw new TypeError("callback provided to sync glob");return p(e,t)}return new Glob(e,t,r)}glob.sync=p;var _=glob.GlobSync=p.GlobSync;glob.glob=glob;function extend(e,t){if(t===null||typeof t!=="object"){return e}var r=Object.keys(t);var n=r.length;while(n--){e[r[n]]=t[r[n]]}return e}glob.hasMagic=function(e,t){var r=extend({},t);r.noprocess=true;var n=new Glob(e,r);var o=n.minimatch.set;if(!e)return false;if(o.length>1)return true;for(var s=0;s<o[0].length;s++){if(typeof o[0][s]!=="string")return true}return false};glob.Glob=Glob;a(Glob,c);function Glob(e,t,r){if(typeof t==="function"){r=t;t=null}if(t&&t.sync){if(r)throw new TypeError("callback provided to sync glob");return new _(e,t)}if(!(this instanceof Glob))return new Glob(e,t,r);m(this,e,t);this._didRealPath=false;var n=this.minimatch.set.length;this.matches=new Array(n);if(typeof r==="function"){r=w(r);this.on("error",r);this.on("end",(function(e){r(null,e)}))}var o=this;this._processing=0;this._emitQueue=[];this._processQueue=[];this.paused=false;if(this.noprocess)return this;if(n===0)return done();var s=true;for(var i=0;i<n;i++){this._process(this.minimatch.set[i],i,false,done)}s=false;function done(){--o._processing;if(o._processing<=0){if(s){process.nextTick((function(){o._finish()}))}else{o._finish()}}}}Glob.prototype._finish=function(){u(this instanceof Glob);if(this.aborted)return;if(this.realpath&&!this._didRealpath)return this._realpath();h.finish(this);this.emit("end",this.found)};Glob.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=true;var e=this.matches.length;if(e===0)return this._finish();var t=this;for(var r=0;r<this.matches.length;r++)this._realpathSet(r,next);function next(){if(--e===0)t._finish()}};Glob.prototype._realpathSet=function(e,t){var r=this.matches[e];if(!r)return t();var n=Object.keys(r);var s=this;var i=n.length;if(i===0)return t();var a=this.matches[e]=Object.create(null);n.forEach((function(r,n){r=s._makeAbs(r);o.realpath(r,s.realpathCache,(function(n,o){if(!n)a[o]=true;else if(n.syscall==="stat")a[r]=true;else s.emit("error",n);if(--i===0){s.matches[e]=a;t()}}))}))};Glob.prototype._mark=function(e){return h.mark(this,e)};Glob.prototype._makeAbs=function(e){return h.makeAbs(this,e)};Glob.prototype.abort=function(){this.aborted=true;this.emit("abort")};Glob.prototype.pause=function(){if(!this.paused){this.paused=true;this.emit("pause")}};Glob.prototype.resume=function(){if(this.paused){this.emit("resume");this.paused=false;if(this._emitQueue.length){var e=this._emitQueue.slice(0);this._emitQueue.length=0;for(var t=0;t<e.length;t++){var r=e[t];this._emitMatch(r[0],r[1])}}if(this._processQueue.length){var n=this._processQueue.slice(0);this._processQueue.length=0;for(var t=0;t<n.length;t++){var o=n[t];this._processing--;this._process(o[0],o[1],o[2],o[3])}}}};Glob.prototype._process=function(e,t,r,n){u(this instanceof Glob);u(typeof n==="function");if(this.aborted)return;this._processing++;if(this.paused){this._processQueue.push([e,t,r,n]);return}var o=0;while(typeof e[o]==="string"){o++}var i;switch(o){case e.length:this._processSimple(e.join("/"),t,n);return;case 0:i=null;break;default:i=e.slice(0,o).join("/");break}var a=e.slice(o);var c;if(i===null)c=".";else if(d(i)||d(e.join("/"))){if(!i||!d(i))i="/"+i;c=i}else c=i;var l=this._makeAbs(c);if(b(this,c))return n();var p=a[0]===s.GLOBSTAR;if(p)this._processGlobStar(i,c,l,a,t,r,n);else this._processReaddir(i,c,l,a,t,r,n)};Glob.prototype._processReaddir=function(e,t,r,n,o,s,i){var a=this;this._readdir(r,s,(function(c,l){return a._processReaddir2(e,t,r,n,o,s,l,i)}))};Glob.prototype._processReaddir2=function(e,t,r,n,o,s,i,a){if(!i)return a();var c=n[0];var u=!!this.minimatch.negate;var d=c._glob;var p=this.dot||d.charAt(0)===".";var h=[];for(var m=0;m<i.length;m++){var y=i[m];if(y.charAt(0)!=="."||p){var g;if(u&&!e){g=!y.match(c)}else{g=y.match(c)}if(g)h.push(y)}}var v=h.length;if(v===0)return a();if(n.length===1&&!this.mark&&!this.stat){if(!this.matches[o])this.matches[o]=Object.create(null);for(var m=0;m<v;m++){var y=h[m];if(e){if(e!=="/")y=e+"/"+y;else y=e+y}if(y.charAt(0)==="/"&&!this.nomount){y=l.join(this.root,y)}this._emitMatch(o,y)}return a()}n.shift();for(var m=0;m<v;m++){var y=h[m];var b;if(e){if(e!=="/")y=e+"/"+y;else y=e+y}this._process([y].concat(n),o,s,a)}a()};Glob.prototype._emitMatch=function(e,t){if(this.aborted)return;if(S(this,t))return;if(this.paused){this._emitQueue.push([e,t]);return}var r=d(t)?t:this._makeAbs(t);if(this.mark)t=this._mark(t);if(this.absolute)t=r;if(this.matches[e][t])return;if(this.nodir){var n=this.cache[r];if(n==="DIR"||Array.isArray(n))return}this.matches[e][t]=true;var o=this.statCache[r];if(o)this.emit("stat",t,o);this.emit("match",t)};Glob.prototype._readdirInGlobStar=function(e,t){if(this.aborted)return;if(this.follow)return this._readdir(e,false,t);var r="lstat\0"+e;var o=this;var s=g(r,lstatcb_);if(s)n.lstat(e,s);function lstatcb_(r,n){if(r&&r.code==="ENOENT")return t();var s=n&&n.isSymbolicLink();o.symlinks[e]=s;if(!s&&n&&!n.isDirectory()){o.cache[e]="FILE";t()}else o._readdir(e,false,t)}};Glob.prototype._readdir=function(e,t,r){if(this.aborted)return;r=g("readdir\0"+e+"\0"+t,r);if(!r)return;if(t&&!y(this.symlinks,e))return this._readdirInGlobStar(e,r);if(y(this.cache,e)){var o=this.cache[e];if(!o||o==="FILE")return r();if(Array.isArray(o))return r(null,o)}var s=this;n.readdir(e,readdirCb(this,e,r))};function readdirCb(e,t,r){return function(n,o){if(n)e._readdirError(t,n,r);else e._readdirEntries(t,o,r)}}Glob.prototype._readdirEntries=function(e,t,r){if(this.aborted)return;if(!this.mark&&!this.stat){for(var n=0;n<t.length;n++){var o=t[n];if(e==="/")o=e+o;else o=e+"/"+o;this.cache[o]=true}}this.cache[e]=t;return r(null,t)};Glob.prototype._readdirError=function(e,t,r){if(this.aborted)return;switch(t.code){case"ENOTSUP":case"ENOTDIR":var n=this._makeAbs(e);this.cache[n]="FILE";if(n===this.cwdAbs){var o=new Error(t.code+" invalid cwd "+this.cwd);o.path=this.cwd;o.code=t.code;this.emit("error",o);this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=false;break;default:this.cache[this._makeAbs(e)]=false;if(this.strict){this.emit("error",t);this.abort()}if(!this.silent)console.error("glob error",t);break}return r()};Glob.prototype._processGlobStar=function(e,t,r,n,o,s,i){var a=this;this._readdir(r,s,(function(c,l){a._processGlobStar2(e,t,r,n,o,s,l,i)}))};Glob.prototype._processGlobStar2=function(e,t,r,n,o,s,i,a){if(!i)return a();var c=n.slice(1);var l=e?[e]:[];var u=l.concat(c);this._process(u,o,false,a);var d=this.symlinks[r];var p=i.length;if(d&&s)return a();for(var h=0;h<p;h++){var m=i[h];if(m.charAt(0)==="."&&!this.dot)continue;var y=l.concat(i[h],c);this._process(y,o,true,a);var g=l.concat(i[h],n);this._process(g,o,true,a)}a()};Glob.prototype._processSimple=function(e,t,r){var n=this;this._stat(e,(function(o,s){n._processSimple2(e,t,o,s,r)}))};Glob.prototype._processSimple2=function(e,t,r,n,o){if(!this.matches[t])this.matches[t]=Object.create(null);if(!n)return o();if(e&&d(e)&&!this.nomount){var s=/[\/\\]$/.test(e);if(e.charAt(0)==="/"){e=l.join(this.root,e)}else{e=l.resolve(this.root,e);if(s)e+="/"}}if(process.platform==="win32")e=e.replace(/\\/g,"/");this._emitMatch(t,e);o()};Glob.prototype._stat=function(e,t){var r=this._makeAbs(e);var o=e.slice(-1)==="/";if(e.length>this.maxLength)return t();if(!this.stat&&y(this.cache,r)){var s=this.cache[r];if(Array.isArray(s))s="DIR";if(!o||s==="DIR")return t(null,s);if(o&&s==="FILE")return t()}var i;var a=this.statCache[r];if(a!==undefined){if(a===false)return t(null,a);else{var c=a.isDirectory()?"DIR":"FILE";if(o&&c==="FILE")return t();else return t(null,c,a)}}var l=this;var u=g("stat\0"+r,lstatcb_);if(u)n.lstat(r,u);function lstatcb_(o,s){if(s&&s.isSymbolicLink()){return n.stat(r,(function(n,o){if(n)l._stat2(e,r,null,s,t);else l._stat2(e,r,n,o,t)}))}else{l._stat2(e,r,o,s,t)}}};Glob.prototype._stat2=function(e,t,r,n,o){if(r&&(r.code==="ENOENT"||r.code==="ENOTDIR")){this.statCache[t]=false;return o()}var s=e.slice(-1)==="/";this.statCache[t]=n;if(t.slice(-1)==="/"&&n&&!n.isDirectory())return o(null,false,n);var i=true;if(n)i=n.isDirectory()?"DIR":"FILE";this.cache[t]=this.cache[t]||i;if(s&&i==="FILE")return o();return o(null,i,n)}},9010:(e,t,r)=>{e.exports=globSync;globSync.GlobSync=GlobSync;var n=r(5747);var o=r(6863);var s=r(3973);var i=s.Minimatch;var a=r(1957).Glob;var c=r(1669);var l=r(5622);var u=r(2357);var d=r(8714);var p=r(7625);var h=p.setopts;var m=p.ownProp;var y=p.childrenIgnored;var g=p.isIgnored;function globSync(e,t){if(typeof t==="function"||arguments.length===3)throw new TypeError("callback provided to sync glob\n"+"See: https://github.com/isaacs/node-glob/issues/167");return new GlobSync(e,t).found}function GlobSync(e,t){if(!e)throw new Error("must provide pattern");if(typeof t==="function"||arguments.length===3)throw new TypeError("callback provided to sync glob\n"+"See: https://github.com/isaacs/node-glob/issues/167");if(!(this instanceof GlobSync))return new GlobSync(e,t);h(this,e,t);if(this.noprocess)return this;var r=this.minimatch.set.length;this.matches=new Array(r);for(var n=0;n<r;n++){this._process(this.minimatch.set[n],n,false)}this._finish()}GlobSync.prototype._finish=function(){u(this instanceof GlobSync);if(this.realpath){var e=this;this.matches.forEach((function(t,r){var n=e.matches[r]=Object.create(null);for(var s in t){try{s=e._makeAbs(s);var i=o.realpathSync(s,e.realpathCache);n[i]=true}catch(t){if(t.syscall==="stat")n[e._makeAbs(s)]=true;else throw t}}}))}p.finish(this)};GlobSync.prototype._process=function(e,t,r){u(this instanceof GlobSync);var n=0;while(typeof e[n]==="string"){n++}var o;switch(n){case e.length:this._processSimple(e.join("/"),t);return;case 0:o=null;break;default:o=e.slice(0,n).join("/");break}var i=e.slice(n);var a;if(o===null)a=".";else if(d(o)||d(e.join("/"))){if(!o||!d(o))o="/"+o;a=o}else a=o;var c=this._makeAbs(a);if(y(this,a))return;var l=i[0]===s.GLOBSTAR;if(l)this._processGlobStar(o,a,c,i,t,r);else this._processReaddir(o,a,c,i,t,r)};GlobSync.prototype._processReaddir=function(e,t,r,n,o,s){var i=this._readdir(r,s);if(!i)return;var a=n[0];var c=!!this.minimatch.negate;var u=a._glob;var d=this.dot||u.charAt(0)===".";var p=[];for(var h=0;h<i.length;h++){var m=i[h];if(m.charAt(0)!=="."||d){var y;if(c&&!e){y=!m.match(a)}else{y=m.match(a)}if(y)p.push(m)}}var g=p.length;if(g===0)return;if(n.length===1&&!this.mark&&!this.stat){if(!this.matches[o])this.matches[o]=Object.create(null);for(var h=0;h<g;h++){var m=p[h];if(e){if(e.slice(-1)!=="/")m=e+"/"+m;else m=e+m}if(m.charAt(0)==="/"&&!this.nomount){m=l.join(this.root,m)}this._emitMatch(o,m)}return}n.shift();for(var h=0;h<g;h++){var m=p[h];var v;if(e)v=[e,m];else v=[m];this._process(v.concat(n),o,s)}};GlobSync.prototype._emitMatch=function(e,t){if(g(this,t))return;var r=this._makeAbs(t);if(this.mark)t=this._mark(t);if(this.absolute){t=r}if(this.matches[e][t])return;if(this.nodir){var n=this.cache[r];if(n==="DIR"||Array.isArray(n))return}this.matches[e][t]=true;if(this.stat)this._stat(t)};GlobSync.prototype._readdirInGlobStar=function(e){if(this.follow)return this._readdir(e,false);var t;var r;var o;try{r=n.lstatSync(e)}catch(e){if(e.code==="ENOENT"){return null}}var s=r&&r.isSymbolicLink();this.symlinks[e]=s;if(!s&&r&&!r.isDirectory())this.cache[e]="FILE";else t=this._readdir(e,false);return t};GlobSync.prototype._readdir=function(e,t){var r;if(t&&!m(this.symlinks,e))return this._readdirInGlobStar(e);if(m(this.cache,e)){var o=this.cache[e];if(!o||o==="FILE")return null;if(Array.isArray(o))return o}try{return this._readdirEntries(e,n.readdirSync(e))}catch(t){this._readdirError(e,t);return null}};GlobSync.prototype._readdirEntries=function(e,t){if(!this.mark&&!this.stat){for(var r=0;r<t.length;r++){var n=t[r];if(e==="/")n=e+n;else n=e+"/"+n;this.cache[n]=true}}this.cache[e]=t;return t};GlobSync.prototype._readdirError=function(e,t){switch(t.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(e);this.cache[r]="FILE";if(r===this.cwdAbs){var n=new Error(t.code+" invalid cwd "+this.cwd);n.path=this.cwd;n.code=t.code;throw n}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(e)]=false;break;default:this.cache[this._makeAbs(e)]=false;if(this.strict)throw t;if(!this.silent)console.error("glob error",t);break}};GlobSync.prototype._processGlobStar=function(e,t,r,n,o,s){var i=this._readdir(r,s);if(!i)return;var a=n.slice(1);var c=e?[e]:[];var l=c.concat(a);this._process(l,o,false);var u=i.length;var d=this.symlinks[r];if(d&&s)return;for(var p=0;p<u;p++){var h=i[p];if(h.charAt(0)==="."&&!this.dot)continue;var m=c.concat(i[p],a);this._process(m,o,true);var y=c.concat(i[p],n);this._process(y,o,true)}};GlobSync.prototype._processSimple=function(e,t){var r=this._stat(e);if(!this.matches[t])this.matches[t]=Object.create(null);if(!r)return;if(e&&d(e)&&!this.nomount){var n=/[\/\\]$/.test(e);if(e.charAt(0)==="/"){e=l.join(this.root,e)}else{e=l.resolve(this.root,e);if(n)e+="/"}}if(process.platform==="win32")e=e.replace(/\\/g,"/");this._emitMatch(t,e)};GlobSync.prototype._stat=function(e){var t=this._makeAbs(e);var r=e.slice(-1)==="/";if(e.length>this.maxLength)return false;if(!this.stat&&m(this.cache,t)){var o=this.cache[t];if(Array.isArray(o))o="DIR";if(!r||o==="DIR")return o;if(r&&o==="FILE")return false}var s;var i=this.statCache[t];if(!i){var a;try{a=n.lstatSync(t)}catch(e){if(e&&(e.code==="ENOENT"||e.code==="ENOTDIR")){this.statCache[t]=false;return false}}if(a&&a.isSymbolicLink()){try{i=n.statSync(t)}catch(e){i=a}}else{i=a}}this.statCache[t]=i;var o=true;if(i)o=i.isDirectory()?"DIR":"FILE";this.cache[t]=this.cache[t]||o;if(r&&o==="FILE")return false;return o};GlobSync.prototype._mark=function(e){return p.mark(this,e)};GlobSync.prototype._makeAbs=function(e){return p.makeAbs(this,e)}},1621:e=>{"use strict";e.exports=(e,t=process.argv)=>{const r=e.startsWith("-")?"":e.length===1?"-":"--";const n=t.indexOf(r+e);const o=t.indexOf("--");return n!==-1&&(o===-1||n<o)}},3734:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});const s=o(r(1631));const i=o(r(8818));const a=o(r(8835));const c=o(r(2357));const l=o(r(8237));const u=r(9690);const d=o(r(595));const p=l.default("https-proxy-agent:agent");class HttpsProxyAgent extends u.Agent{constructor(e){let t;if(typeof e==="string"){t=a.default.parse(e)}else{t=e}if(!t){throw new Error("an HTTP(S) proxy server `host` and `port` must be specified!")}p("creating new HttpsProxyAgent instance: %o",t);super(t);const r=Object.assign({},t);this.secureProxy=t.secureProxy||isHTTPS(r.protocol);r.host=r.hostname||r.host;if(typeof r.port==="string"){r.port=parseInt(r.port,10)}if(!r.port&&r.host){r.port=this.secureProxy?443:80}if(this.secureProxy&&!("ALPNProtocols"in r)){r.ALPNProtocols=["http 1.1"]}if(r.host&&r.path){delete r.path;delete r.pathname}this.proxy=r}callback(e,t){return n(this,void 0,void 0,(function*(){const{proxy:r,secureProxy:n}=this;let o;if(n){p("Creating `tls.Socket`: %o",r);o=i.default.connect(r)}else{p("Creating `net.Socket`: %o",r);o=s.default.connect(r)}const a=Object.assign({},r.headers);const l=`${t.host}:${t.port}`;let u=`CONNECT ${l} HTTP/1.1\r\n`;if(r.auth){a["Proxy-Authorization"]=`Basic ${Buffer.from(r.auth).toString("base64")}`}let{host:h,port:m,secureEndpoint:y}=t;if(!isDefaultPort(m,y)){h+=`:${m}`}a.Host=h;a.Connection="close";for(const e of Object.keys(a)){u+=`${e}: ${a[e]}\r\n`}const g=d.default(o);o.write(`${u}\r\n`);const{statusCode:v,buffered:b}=yield g;if(v===200){e.once("socket",resume);if(t.secureEndpoint){const e=t.servername||t.host;if(!e){throw new Error('Could not determine "servername"')}p("Upgrading socket connection to TLS");return i.default.connect(Object.assign(Object.assign({},omit(t,"host","hostname","path","port")),{socket:o,servername:e}))}return o}o.destroy();const S=new s.default.Socket;S.readable=true;e.once("socket",(e=>{p("replaying proxy buffer for failed request");c.default(e.listenerCount("data")>0);e.push(b);e.push(null)}));return S}))}}t.default=HttpsProxyAgent;function resume(e){e.resume()}function isDefaultPort(e,t){return Boolean(!t&&e===80||t&&e===443)}function isHTTPS(e){return typeof e==="string"?/^https:?$/i.test(e):false}function omit(e,...t){const r={};let n;for(n in e){if(!t.includes(n)){r[n]=e[n]}}return r}},7219:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};const o=n(r(3734));function createHttpsProxyAgent(e){return new o.default(e)}(function(e){e.HttpsProxyAgent=o.default;e.prototype=o.default.prototype})(createHttpsProxyAgent||(createHttpsProxyAgent={}));e.exports=createHttpsProxyAgent},595:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});const o=n(r(8237));const s=o.default("https-proxy-agent:parse-proxy-response");function parseProxyResponse(e){return new Promise(((t,r)=>{let n=0;const o=[];function read(){const t=e.read();if(t)ondata(t);else e.once("readable",read)}function cleanup(){e.removeListener("end",onend);e.removeListener("error",onerror);e.removeListener("close",onclose);e.removeListener("readable",read)}function onclose(e){s("onclose had error %o",e)}function onend(){s("onend")}function onerror(e){cleanup();s("onerror %o",e);r(e)}function ondata(e){o.push(e);n+=e.length;const r=Buffer.concat(o,n);const i=r.indexOf("\r\n\r\n");if(i===-1){s("have not received end of HTTP headers yet...");read();return}const a=r.toString("ascii",0,r.indexOf("\r\n"));const c=+a.split(" ")[1];s("got proxy server response: %o",a);t({statusCode:c,buffered:r})}e.on("error",onerror);e.on("close",onclose);e.on("end",onend);read()}))}t.default=parseProxyResponse},2492:(e,t,r)=>{var n=r(2940);var o=Object.create(null);var s=r(1223);e.exports=n(inflight);function inflight(e,t){if(o[e]){o[e].push(t);return null}else{o[e]=[t];return makeres(e)}}function makeres(e){return s((function RES(){var t=o[e];var r=t.length;var n=slice(arguments);try{for(var s=0;s<r;s++){t[s].apply(null,n)}}finally{if(t.length>r){t.splice(0,r);process.nextTick((function(){RES.apply(null,n)}))}else{delete o[e]}}}))}function slice(e){var t=e.length;var r=[];for(var n=0;n<t;n++)r[n]=e[n];return r}},4124:(e,t,r)=>{try{var n=r(1669);if(typeof n.inherits!=="function")throw"";e.exports=n.inherits}catch(t){e.exports=r(8544)}},8544:e=>{if(typeof Object.create==="function"){e.exports=function inherits(e,t){if(t){e.super_=t;e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}})}}}else{e.exports=function inherits(e,t){if(t){e.super_=t;var TempCtor=function(){};TempCtor.prototype=t.prototype;e.prototype=new TempCtor;e.prototype.constructor=e}}}},7129:(e,t,r)=>{"use strict";const n=r(665);const o=Symbol("max");const s=Symbol("length");const i=Symbol("lengthCalculator");const a=Symbol("allowStale");const c=Symbol("maxAge");const l=Symbol("dispose");const u=Symbol("noDisposeOnSet");const d=Symbol("lruList");const p=Symbol("cache");const h=Symbol("updateAgeOnGet");const naiveLength=()=>1;class LRUCache{constructor(e){if(typeof e==="number")e={max:e};if(!e)e={};if(e.max&&(typeof e.max!=="number"||e.max<0))throw new TypeError("max must be a non-negative number");const t=this[o]=e.max||Infinity;const r=e.length||naiveLength;this[i]=typeof r!=="function"?naiveLength:r;this[a]=e.stale||false;if(e.maxAge&&typeof e.maxAge!=="number")throw new TypeError("maxAge must be a number");this[c]=e.maxAge||0;this[l]=e.dispose;this[u]=e.noDisposeOnSet||false;this[h]=e.updateAgeOnGet||false;this.reset()}set max(e){if(typeof e!=="number"||e<0)throw new TypeError("max must be a non-negative number");this[o]=e||Infinity;trim(this)}get max(){return this[o]}set allowStale(e){this[a]=!!e}get allowStale(){return this[a]}set maxAge(e){if(typeof e!=="number")throw new TypeError("maxAge must be a non-negative number");this[c]=e;trim(this)}get maxAge(){return this[c]}set lengthCalculator(e){if(typeof e!=="function")e=naiveLength;if(e!==this[i]){this[i]=e;this[s]=0;this[d].forEach((e=>{e.length=this[i](e.value,e.key);this[s]+=e.length}))}trim(this)}get lengthCalculator(){return this[i]}get length(){return this[s]}get itemCount(){return this[d].length}rforEach(e,t){t=t||this;for(let r=this[d].tail;r!==null;){const n=r.prev;forEachStep(this,e,r,t);r=n}}forEach(e,t){t=t||this;for(let r=this[d].head;r!==null;){const n=r.next;forEachStep(this,e,r,t);r=n}}keys(){return this[d].toArray().map((e=>e.key))}values(){return this[d].toArray().map((e=>e.value))}reset(){if(this[l]&&this[d]&&this[d].length){this[d].forEach((e=>this[l](e.key,e.value)))}this[p]=new Map;this[d]=new n;this[s]=0}dump(){return this[d].map((e=>isStale(this,e)?false:{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[d]}set(e,t,r){r=r||this[c];if(r&&typeof r!=="number")throw new TypeError("maxAge must be a number");const n=r?Date.now():0;const a=this[i](t,e);if(this[p].has(e)){if(a>this[o]){del(this,this[p].get(e));return false}const i=this[p].get(e);const c=i.value;if(this[l]){if(!this[u])this[l](e,c.value)}c.now=n;c.maxAge=r;c.value=t;this[s]+=a-c.length;c.length=a;this.get(e);trim(this);return true}const h=new Entry(e,t,a,n,r);if(h.length>this[o]){if(this[l])this[l](e,t);return false}this[s]+=h.length;this[d].unshift(h);this[p].set(e,this[d].head);trim(this);return true}has(e){if(!this[p].has(e))return false;const t=this[p].get(e).value;return!isStale(this,t)}get(e){return get(this,e,true)}peek(e){return get(this,e,false)}pop(){const e=this[d].tail;if(!e)return null;del(this,e);return e.value}del(e){del(this,this[p].get(e))}load(e){this.reset();const t=Date.now();for(let r=e.length-1;r>=0;r--){const n=e[r];const o=n.e||0;if(o===0)this.set(n.k,n.v);else{const e=o-t;if(e>0){this.set(n.k,n.v,e)}}}}prune(){this[p].forEach(((e,t)=>get(this,t,false)))}}const get=(e,t,r)=>{const n=e[p].get(t);if(n){const t=n.value;if(isStale(e,t)){del(e,n);if(!e[a])return undefined}else{if(r){if(e[h])n.value.now=Date.now();e[d].unshiftNode(n)}}return t.value}};const isStale=(e,t)=>{if(!t||!t.maxAge&&!e[c])return false;const r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[c]&&r>e[c]};const trim=e=>{if(e[s]>e[o]){for(let t=e[d].tail;e[s]>e[o]&&t!==null;){const r=t.prev;del(e,t);t=r}}};const del=(e,t)=>{if(t){const r=t.value;if(e[l])e[l](r.key,r.value);e[s]-=r.length;e[p].delete(r.key);e[d].removeNode(t)}};class Entry{constructor(e,t,r,n,o){this.key=e;this.value=t;this.length=r;this.now=n;this.maxAge=o||0}}const forEachStep=(e,t,r,n)=>{let o=r.value;if(isStale(e,o)){del(e,r);if(!e[a])o=undefined}if(o)t.call(n,o.value,o.key,e)};e.exports=LRUCache},9126:(e,t,r)=>{"use strict";const n=r(5747);const o=r(5622);const{promisify:s}=r(1669);const i=r(1383);const a=i.satisfies(process.version,">=10.12.0");const checkPath=e=>{if(process.platform==="win32"){const t=/[<>:"|?*]/.test(e.replace(o.parse(e).root,""));if(t){const t=new Error(`Path contains invalid characters: ${e}`);t.code="EINVAL";throw t}}};const processOptions=e=>{const t={mode:511,fs:n};return{...t,...e}};const permissionError=e=>{const t=new Error(`operation not permitted, mkdir '${e}'`);t.code="EPERM";t.errno=-4048;t.path=e;t.syscall="mkdir";return t};const makeDir=async(e,t)=>{checkPath(e);t=processOptions(t);const r=s(t.fs.mkdir);const i=s(t.fs.stat);if(a&&t.fs.mkdir===n.mkdir){const n=o.resolve(e);await r(n,{mode:t.mode,recursive:true});return n}const make=async e=>{try{await r(e,t.mode);return e}catch(t){if(t.code==="EPERM"){throw t}if(t.code==="ENOENT"){if(o.dirname(e)===e){throw permissionError(e)}if(t.message.includes("null bytes")){throw t}await make(o.dirname(e));return make(e)}try{const t=await i(e);if(!t.isDirectory()){throw new Error("The path is not a directory")}}catch(e){throw t}return e}};return make(o.resolve(e))};e.exports=makeDir;e.exports.sync=(e,t)=>{checkPath(e);t=processOptions(t);if(a&&t.fs.mkdirSync===n.mkdirSync){const r=o.resolve(e);n.mkdirSync(r,{mode:t.mode,recursive:true});return r}const make=e=>{try{t.fs.mkdirSync(e,t.mode)}catch(r){if(r.code==="EPERM"){throw r}if(r.code==="ENOENT"){if(o.dirname(e)===e){throw permissionError(e)}if(r.message.includes("null bytes")){throw r}make(o.dirname(e));return make(e)}try{if(!t.fs.statSync(e).isDirectory()){throw new Error("The path is not a directory")}}catch(e){throw r}}return e};return make(o.resolve(e))}},1446:(e,t,r)=>{const n=r(6417);const o=r(5747);const s=8192;function md5FileSync(e){const t=o.openSync(e,"r");const r=n.createHash("md5");const i=Buffer.alloc(s);try{let e;do{e=o.readSync(t,i,0,s);r.update(i.slice(0,e))}while(e===s)}finally{o.closeSync(t)}return r.digest("hex")}function md5File(e){return new Promise(((t,r)=>{const s=n.createHash("md5");const i=o.createReadStream(e);i.on("error",(e=>{r(e)}));s.once("readable",(()=>{t(s.read().toString("hex"))}));i.pipe(s)}))}e.exports=md5File;e.exports.sync=md5FileSync},7147:e=>{e.exports=Pager;function Pager(e,t){if(!(this instanceof Pager))return new Pager(e,t);this.length=0;this.updates=[];this.path=new Uint16Array(4);this.pages=new Array(32768);this.maxPages=this.pages.length;this.level=0;this.pageSize=e||1024;this.deduplicate=t?t.deduplicate:null;this.zeros=this.deduplicate?alloc(this.deduplicate.length):null}Pager.prototype.updated=function(e){while(this.deduplicate&&e.buffer[e.deduplicate]===this.deduplicate[e.deduplicate]){e.deduplicate++;if(e.deduplicate===this.deduplicate.length){e.deduplicate=0;if(e.buffer.equals&&e.buffer.equals(this.deduplicate))e.buffer=this.deduplicate;break}}if(e.updated||!this.updates)return;e.updated=true;this.updates.push(e)};Pager.prototype.lastUpdate=function(){if(!this.updates||!this.updates.length)return null;var e=this.updates.pop();e.updated=false;return e};Pager.prototype._array=function(e,t){if(e>=this.maxPages){if(t)return;grow(this,e)}factor(e,this.path);var r=this.pages;for(var n=this.level;n>0;n--){var o=this.path[n];var s=r[o];if(!s){if(t)return;s=r[o]=new Array(32768)}r=s}return r};Pager.prototype.get=function(e,t){var r=this._array(e,t);var n=this.path[0];var o=r&&r[n];if(!o&&!t){o=r[n]=new Page(e,alloc(this.pageSize));if(e>=this.length)this.length=e+1}if(o&&o.buffer===this.deduplicate&&this.deduplicate&&!t){o.buffer=copy(o.buffer);o.deduplicate=0}return o};Pager.prototype.set=function(e,t){var r=this._array(e,false);var n=this.path[0];if(e>=this.length)this.length=e+1;if(!t||this.zeros&&t.equals&&t.equals(this.zeros)){r[n]=undefined;return}if(this.deduplicate&&t.equals&&t.equals(this.deduplicate)){t=this.deduplicate}var o=r[n];var s=truncate(t,this.pageSize);if(o)o.buffer=s;else r[n]=new Page(e,s)};Pager.prototype.toBuffer=function(){var e=new Array(this.length);var t=alloc(this.pageSize);var r=0;while(r<e.length){var n=this._array(r,true);for(var o=0;o<32768&&r<e.length;o++){e[r++]=n&&n[o]?n[o].buffer:t}}return Buffer.concat(e)};function grow(e,t){while(e.maxPages<t){var r=e.pages;e.pages=new Array(32768);e.pages[0]=r;e.level++;e.maxPages*=32768}}function truncate(e,t){if(e.length===t)return e;if(e.length>t)return e.slice(0,t);var r=alloc(t);e.copy(r);return r}function alloc(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);t.fill(0);return t}function copy(e){var t=Buffer.allocUnsafe?Buffer.allocUnsafe(e.length):new Buffer(e.length);e.copy(t);return t}function Page(e,t){this.offset=e*t.length;this.buffer=t;this.updated=false;this.deduplicate=0}function factor(e,t){e=(e-(t[0]=e&32767))/32768;e=(e-(t[1]=e&32767))/32768;t[3]=(e-(t[2]=e&32767))/32768&32767}},3973:(e,t,r)=>{e.exports=minimatch;minimatch.Minimatch=Minimatch;var n={sep:"/"};try{n=r(5622)}catch(e){}var o=minimatch.GLOBSTAR=Minimatch.GLOBSTAR={};var s=r(3717);var i={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}};var a="[^/]";var c=a+"*?";var l="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?";var u="(?:(?!(?:\\/|^)\\.).)*?";var d=charSet("().*{}+?[]^$\\!");function charSet(e){return e.split("").reduce((function(e,t){e[t]=true;return e}),{})}var p=/\/+/;minimatch.filter=filter;function filter(e,t){t=t||{};return function(r,n,o){return minimatch(r,e,t)}}function ext(e,t){e=e||{};t=t||{};var r={};Object.keys(t).forEach((function(e){r[e]=t[e]}));Object.keys(e).forEach((function(t){r[t]=e[t]}));return r}minimatch.defaults=function(e){if(!e||!Object.keys(e).length)return minimatch;var t=minimatch;var r=function minimatch(r,n,o){return t.minimatch(r,n,ext(e,o))};r.Minimatch=function Minimatch(r,n){return new t.Minimatch(r,ext(e,n))};return r};Minimatch.defaults=function(e){if(!e||!Object.keys(e).length)return Minimatch;return minimatch.defaults(e).Minimatch};function minimatch(e,t,r){if(typeof t!=="string"){throw new TypeError("glob pattern string required")}if(!r)r={};if(!r.nocomment&&t.charAt(0)==="#"){return false}if(t.trim()==="")return e==="";return new Minimatch(t,r).match(e)}function Minimatch(e,t){if(!(this instanceof Minimatch)){return new Minimatch(e,t)}if(typeof e!=="string"){throw new TypeError("glob pattern string required")}if(!t)t={};e=e.trim();if(n.sep!=="/"){e=e.split(n.sep).join("/")}this.options=t;this.set=[];this.pattern=e;this.regexp=null;this.negate=false;this.comment=false;this.empty=false;this.make()}Minimatch.prototype.debug=function(){};Minimatch.prototype.make=make;function make(){if(this._made)return;var e=this.pattern;var t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=true;return}if(!e){this.empty=true;return}this.parseNegate();var r=this.globSet=this.braceExpand();if(t.debug)this.debug=console.error;this.debug(this.pattern,r);r=this.globParts=r.map((function(e){return e.split(p)}));this.debug(this.pattern,r);r=r.map((function(e,t,r){return e.map(this.parse,this)}),this);this.debug(this.pattern,r);r=r.filter((function(e){return e.indexOf(false)===-1}));this.debug(this.pattern,r);this.set=r}Minimatch.prototype.parseNegate=parseNegate;function parseNegate(){var e=this.pattern;var t=false;var r=this.options;var n=0;if(r.nonegate)return;for(var o=0,s=e.length;o<s&&e.charAt(o)==="!";o++){t=!t;n++}if(n)this.pattern=e.substr(n);this.negate=t}minimatch.braceExpand=function(e,t){return braceExpand(e,t)};Minimatch.prototype.braceExpand=braceExpand;function braceExpand(e,t){if(!t){if(this instanceof Minimatch){t=this.options}else{t={}}}e=typeof e==="undefined"?this.pattern:e;if(typeof e==="undefined"){throw new TypeError("undefined pattern")}if(t.nobrace||!e.match(/\{.*\}/)){return[e]}return s(e)}Minimatch.prototype.parse=parse;var h={};function parse(e,t){if(e.length>1024*64){throw new TypeError("pattern is too long")}var r=this.options;if(!r.noglobstar&&e==="**")return o;if(e==="")return"";var n="";var s=!!r.nocase;var l=false;var u=[];var p=[];var m;var y=false;var g=-1;var v=-1;var b=e.charAt(0)==="."?"":r.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)";var S=this;function clearStateChar(){if(m){switch(m){case"*":n+=c;s=true;break;case"?":n+=a;s=true;break;default:n+="\\"+m;break}S.debug("clearStateChar %j %j",m,n);m=false}}for(var w=0,_=e.length,E;w<_&&(E=e.charAt(w));w++){this.debug("%s\t%s %s %j",e,w,n,E);if(l&&d[E]){n+="\\"+E;l=false;continue}switch(E){case"/":return false;case"\\":clearStateChar();l=true;continue;case"?":case"*":case"+":case"@":case"!":this.debug("%s\t%s %s %j <-- stateChar",e,w,n,E);if(y){this.debug("  in class");if(E==="!"&&w===v+1)E="^";n+=E;continue}S.debug("call clearStateChar %j",m);clearStateChar();m=E;if(r.noext)clearStateChar();continue;case"(":if(y){n+="(";continue}if(!m){n+="\\(";continue}u.push({type:m,start:w-1,reStart:n.length,open:i[m].open,close:i[m].close});n+=m==="!"?"(?:(?!(?:":"(?:";this.debug("plType %j %j",m,n);m=false;continue;case")":if(y||!u.length){n+="\\)";continue}clearStateChar();s=true;var O=u.pop();n+=O.close;if(O.type==="!"){p.push(O)}O.reEnd=n.length;continue;case"|":if(y||!u.length||l){n+="\\|";l=false;continue}clearStateChar();n+="|";continue;case"[":clearStateChar();if(y){n+="\\"+E;continue}y=true;v=w;g=n.length;n+=E;continue;case"]":if(w===v+1||!y){n+="\\"+E;l=false;continue}if(y){var C=e.substring(v+1,w);try{RegExp("["+C+"]")}catch(e){var T=this.parse(C,h);n=n.substr(0,g)+"\\["+T[0]+"\\]";s=s||T[1];y=false;continue}}s=true;y=false;n+=E;continue;default:clearStateChar();if(l){l=false}else if(d[E]&&!(E==="^"&&y)){n+="\\"}n+=E}}if(y){C=e.substr(v+1);T=this.parse(C,h);n=n.substr(0,g)+"\\["+T[0];s=s||T[1]}for(O=u.pop();O;O=u.pop()){var I=n.slice(O.reStart+O.open.length);this.debug("setting tail",n,O);I=I.replace(/((?:\\{2}){0,64})(\\?)\|/g,(function(e,t,r){if(!r){r="\\"}return t+t+r+"|"}));this.debug("tail=%j\n   %s",I,I,O,n);var k=O.type==="*"?c:O.type==="?"?a:"\\"+O.type;s=true;n=n.slice(0,O.reStart)+k+"\\("+I}clearStateChar();if(l){n+="\\\\"}var A=false;switch(n.charAt(0)){case".":case"[":case"(":A=true}for(var N=p.length-1;N>-1;N--){var R=p[N];var M=n.slice(0,R.reStart);var D=n.slice(R.reStart,R.reEnd-8);var P=n.slice(R.reEnd-8,R.reEnd);var L=n.slice(R.reEnd);P+=L;var B=M.split("(").length-1;var j=L;for(w=0;w<B;w++){j=j.replace(/\)[+*?]?/,"")}L=j;var U="";if(L===""&&t!==h){U="$"}var F=M+D+L+U+P;n=F}if(n!==""&&s){n="(?=.)"+n}if(A){n=b+n}if(t===h){return[n,s]}if(!s){return globUnescape(e)}var $=r.nocase?"i":"";try{var W=new RegExp("^"+n+"$",$)}catch(e){return new RegExp("$.")}W._glob=e;W._src=n;return W}minimatch.makeRe=function(e,t){return new Minimatch(e,t||{}).makeRe()};Minimatch.prototype.makeRe=makeRe;function makeRe(){if(this.regexp||this.regexp===false)return this.regexp;var e=this.set;if(!e.length){this.regexp=false;return this.regexp}var t=this.options;var r=t.noglobstar?c:t.dot?l:u;var n=t.nocase?"i":"";var s=e.map((function(e){return e.map((function(e){return e===o?r:typeof e==="string"?regExpEscape(e):e._src})).join("\\/")})).join("|");s="^(?:"+s+")$";if(this.negate)s="^(?!"+s+").*$";try{this.regexp=new RegExp(s,n)}catch(e){this.regexp=false}return this.regexp}minimatch.match=function(e,t,r){r=r||{};var n=new Minimatch(t,r);e=e.filter((function(e){return n.match(e)}));if(n.options.nonull&&!e.length){e.push(t)}return e};Minimatch.prototype.match=match;function match(e,t){this.debug("match",e,this.pattern);if(this.comment)return false;if(this.empty)return e==="";if(e==="/"&&t)return true;var r=this.options;if(n.sep!=="/"){e=e.split(n.sep).join("/")}e=e.split(p);this.debug(this.pattern,"split",e);var o=this.set;this.debug(this.pattern,"set",o);var s;var i;for(i=e.length-1;i>=0;i--){s=e[i];if(s)break}for(i=0;i<o.length;i++){var a=o[i];var c=e;if(r.matchBase&&a.length===1){c=[s]}var l=this.matchOne(c,a,t);if(l){if(r.flipNegate)return true;return!this.negate}}if(r.flipNegate)return false;return this.negate}Minimatch.prototype.matchOne=function(e,t,r){var n=this.options;this.debug("matchOne",{this:this,file:e,pattern:t});this.debug("matchOne",e.length,t.length);for(var s=0,i=0,a=e.length,c=t.length;s<a&&i<c;s++,i++){this.debug("matchOne loop");var l=t[i];var u=e[s];this.debug(t,l,u);if(l===false)return false;if(l===o){this.debug("GLOBSTAR",[t,l,u]);var d=s;var p=i+1;if(p===c){this.debug("** at the end");for(;s<a;s++){if(e[s]==="."||e[s]===".."||!n.dot&&e[s].charAt(0)===".")return false}return true}while(d<a){var h=e[d];this.debug("\nglobstar while",e,d,t,p,h);if(this.matchOne(e.slice(d),t.slice(p),r)){this.debug("globstar found match!",d,a,h);return true}else{if(h==="."||h===".."||!n.dot&&h.charAt(0)==="."){this.debug("dot detected!",e,d,t,p);break}this.debug("globstar swallow a segment, and continue");d++}}if(r){this.debug("\n>>> no match, partial?",e,d,t,p);if(d===a)return true}return false}var m;if(typeof l==="string"){if(n.nocase){m=u.toLowerCase()===l.toLowerCase()}else{m=u===l}this.debug("string match",l,u,m)}else{m=u.match(l);this.debug("pattern match",l,u,m)}if(!m)return false}if(s===a&&i===c){return true}else if(s===a){return r}else if(i===c){var y=s===a-1&&e[s]==="";return y}throw new Error("wtf?")};function globUnescape(e){return e.replace(/\\(.)/g,"$1")}function regExpEscape(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}},6186:(e,t,r)=>{const n=r(2853);const o=r(2930);const{mkdirpNative:s,mkdirpNativeSync:i}=r(4983);const{mkdirpManual:a,mkdirpManualSync:c}=r(356);const{useNative:l,useNativeSync:u}=r(4518);const mkdirp=(e,t)=>{e=o(e);t=n(t);return l(t)?s(e,t):a(e,t)};const mkdirpSync=(e,t)=>{e=o(e);t=n(t);return u(t)?i(e,t):c(e,t)};mkdirp.sync=mkdirpSync;mkdirp.native=(e,t)=>s(o(e),n(t));mkdirp.manual=(e,t)=>a(o(e),n(t));mkdirp.nativeSync=(e,t)=>i(o(e),n(t));mkdirp.manualSync=(e,t)=>c(o(e),n(t));e.exports=mkdirp},4992:(e,t,r)=>{const{dirname:n}=r(5622);const findMade=(e,t,r=undefined)=>{if(r===t)return Promise.resolve();return e.statAsync(t).then((e=>e.isDirectory()?r:undefined),(r=>r.code==="ENOENT"?findMade(e,n(t),t):undefined))};const findMadeSync=(e,t,r=undefined)=>{if(r===t)return undefined;try{return e.statSync(t).isDirectory()?r:undefined}catch(r){return r.code==="ENOENT"?findMadeSync(e,n(t),t):undefined}};e.exports={findMade:findMade,findMadeSync:findMadeSync}},356:(e,t,r)=>{const{dirname:n}=r(5622);const mkdirpManual=(e,t,r)=>{t.recursive=false;const o=n(e);if(o===e){return t.mkdirAsync(e,t).catch((e=>{if(e.code!=="EISDIR")throw e}))}return t.mkdirAsync(e,t).then((()=>r||e),(n=>{if(n.code==="ENOENT")return mkdirpManual(o,t).then((r=>mkdirpManual(e,t,r)));if(n.code!=="EEXIST"&&n.code!=="EROFS")throw n;return t.statAsync(e).then((e=>{if(e.isDirectory())return r;else throw n}),(()=>{throw n}))}))};const mkdirpManualSync=(e,t,r)=>{const o=n(e);t.recursive=false;if(o===e){try{return t.mkdirSync(e,t)}catch(e){if(e.code!=="EISDIR")throw e;else return}}try{t.mkdirSync(e,t);return r||e}catch(n){if(n.code==="ENOENT")return mkdirpManualSync(e,t,mkdirpManualSync(o,t,r));if(n.code!=="EEXIST"&&n.code!=="EROFS")throw n;try{if(!t.statSync(e).isDirectory())throw n}catch(e){throw n}}};e.exports={mkdirpManual:mkdirpManual,mkdirpManualSync:mkdirpManualSync}},4983:(e,t,r)=>{const{dirname:n}=r(5622);const{findMade:o,findMadeSync:s}=r(4992);const{mkdirpManual:i,mkdirpManualSync:a}=r(356);const mkdirpNative=(e,t)=>{t.recursive=true;const r=n(e);if(r===e)return t.mkdirAsync(e,t);return o(t,e).then((r=>t.mkdirAsync(e,t).then((()=>r)).catch((r=>{if(r.code==="ENOENT")return i(e,t);else throw r}))))};const mkdirpNativeSync=(e,t)=>{t.recursive=true;const r=n(e);if(r===e)return t.mkdirSync(e,t);const o=s(t,e);try{t.mkdirSync(e,t);return o}catch(r){if(r.code==="ENOENT")return a(e,t);else throw r}};e.exports={mkdirpNative:mkdirpNative,mkdirpNativeSync:mkdirpNativeSync}},2853:(e,t,r)=>{const{promisify:n}=r(1669);const o=r(5747);const optsArg=e=>{if(!e)e={mode:511,fs:o};else if(typeof e==="object")e={mode:511,fs:o,...e};else if(typeof e==="number")e={mode:e,fs:o};else if(typeof e==="string")e={mode:parseInt(e,8),fs:o};else throw new TypeError("invalid options argument");e.mkdir=e.mkdir||e.fs.mkdir||o.mkdir;e.mkdirAsync=n(e.mkdir);e.stat=e.stat||e.fs.stat||o.stat;e.statAsync=n(e.stat);e.statSync=e.statSync||e.fs.statSync||o.statSync;e.mkdirSync=e.mkdirSync||e.fs.mkdirSync||o.mkdirSync;return e};e.exports=optsArg},2930:(e,t,r)=>{const n=process.env.__TESTING_MKDIRP_PLATFORM__||process.platform;const{resolve:o,parse:s}=r(5622);const pathArg=e=>{if(/\0/.test(e)){throw Object.assign(new TypeError("path must be a string without null bytes"),{path:e,code:"ERR_INVALID_ARG_VALUE"})}e=o(e);if(n==="win32"){const t=/[*|"<>?:]/;const{root:r}=s(e);if(t.test(e.substr(r.length))){throw Object.assign(new Error("Illegal characters in path."),{path:e,code:"EINVAL"})}}return e};e.exports=pathArg},4518:(e,t,r)=>{const n=r(5747);const o=process.env.__TESTING_MKDIRP_NODE_VERSION__||process.version;const s=o.replace(/^v/,"").split(".");const i=+s[0]>10||+s[0]===10&&+s[1]>=12;const a=!i?()=>false:e=>e.mkdir===n.mkdir;const c=!i?()=>false:e=>e.mkdirSync===n.mkdirSync;e.exports={useNative:a,useNativeSync:c}},1257:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MongoMemoryServer=t.MongoMemoryServerStates=t.MongoMemoryServerEvents=void 0;const n=r(4351);const o=n.__importStar(r(8517));const s=n.__importDefault(r(3002));const i=r(1978);const a=r(843);const c=n.__importDefault(r(8237));const l=r(8614);const u=r(5747);const d=r(5517);const p=r(1383);const h=r(3386);const m=c.default("MongoMS:MongoMemoryServer");o.setGracefulCleanup();var y;(function(e){e["stateChange"]="stateChange"})(y=t.MongoMemoryServerEvents||(t.MongoMemoryServerEvents={}));var g;(function(e){e["new"]="new";e["starting"]="starting";e["running"]="running";e["stopped"]="stopped"})(g=t.MongoMemoryServerStates||(t.MongoMemoryServerStates={}));class MongoMemoryServer extends l.EventEmitter{constructor(e){super();this._state=g.new;this.opts=Object.assign({},e);if(!i.isNullOrUndefined(this.opts.auth)){this.auth=i.authDefault(this.opts.auth)}}static create(e){return n.__awaiter(this,void 0,void 0,(function*(){m("create: Called .create() method");const t=new MongoMemoryServer(Object.assign({},e));yield t.start();return t}))}stateChange(e){this._state=e;this.emit(y.stateChange,e)}start(e=false){var t,r;return n.__awaiter(this,void 0,void 0,(function*(){m("start: Called .start() method");switch(this._state){case g.new:case g.stopped:break;case g.running:case g.starting:default:throw new h.StateError([g.new,g.stopped],this.state)}i.assertion(i.isNullOrUndefined((t=this._instanceInfo)===null||t===void 0?void 0:t.instance.mongodProcess),new Error('Cannot start because "instance.mongodProcess" is already defined!'));this.stateChange(g.starting);if(i.isNullOrUndefined((r=this.opts.instance)===null||r===void 0?void 0:r.replSet)&&process.listeners("beforeExit").findIndex((e=>e===this.cleanup))<=-1){process.on("beforeExit",this.cleanup)}yield this._startUpInstance(e).catch((e=>{if(!c.default.enabled("MongoMS:MongoMemoryServer")){console.warn("Starting the instance failed, enable debug for more information")}this.stateChange(g.stopped);throw e}));this.stateChange(g.running);m("start: Instance fully Started")}))}getNewPort(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=yield s.default({port:e});if(e!=t&&typeof e==="number"){m(`getNewPort: starting with port "${t}", since "${e}" was locked`)}return t}))}getStartOptions(){var e,t,r;return n.__awaiter(this,void 0,void 0,(function*(){m("getStartOptions");const n=(e=this.opts.instance)!==null&&e!==void 0?e:{};let s=true;const a={port:yield this.getNewPort(n.port),dbName:i.generateDbName(n.dbName),ip:(t=n.ip)!==null&&t!==void 0?t:"127.0.0.1",storageEngine:(r=n.storageEngine)!==null&&r!==void 0?r:"ephemeralForTest",replSet:n.replSet,dbPath:n.dbPath,tmpDir:undefined};if(i.isNullOrUndefined(this._instanceInfo)){if(!a.dbPath){a.tmpDir=o.dirSync({mode:493,prefix:"mongo-mem-",unsafeCleanup:true});a.dbPath=a.tmpDir.name;s=true}else{m(`getStartOptions: Checking if "${a.dbPath}}" (no new tmpDir) already has data`);const e=yield u.promises.readdir(a.dbPath);s=e.length>0}}else{s=false}const c=!!n.auth&&!i.isNullOrUndefined(this.auth)&&!this.auth.disable&&(this.auth.force||s)&&!n.replSet;return{data:a,createAuth:c,mongodOptions:{instance:Object.assign(Object.assign({},a),{args:n.args,auth:c?false:n.auth}),binary:this.opts.binary,spawn:this.opts.spawn}}}))}_startUpInstance(e=false){var t;return n.__awaiter(this,void 0,void 0,(function*(){m("_startUpInstance: Called MongoMemoryServer._startUpInstance() method");if(!i.isNullOrUndefined(this._instanceInfo)){m('_startUpInstance: "instanceInfo" already defined, reusing instance');if(!e){const e=yield this.getNewPort(this._instanceInfo.port);this._instanceInfo.instance.instanceOpts.port=e;this._instanceInfo.port=e}yield this._instanceInfo.instance.start();return}const{mongodOptions:r,createAuth:n,data:o}=yield this.getStartOptions();m(`_startUpInstance: Creating new MongoDB instance with options: ${JSON.stringify(r)}`);const s=yield a.MongoInstance.create(r);m("_startUpInstance: Instance Started");if(!i.isNullOrUndefined(this.auth)&&n){m(`_startUpInstance: Running "createAuth" (force: "${this.auth.force}")`);yield this.createAuth(o);if(o.storageEngine!=="ephemeralForTest"){m("_startUpInstance: Killing No-Auth instance");yield s.stop();m("_startUpInstance: Starting Auth Instance");s.instanceOpts.auth=true;yield s.start()}else{console.warn("Not Restarting MongoInstance for Auth\n"+'Storage engine is "ephemeralForTest", which does not write data on shutdown, and mongodb does not allow changing "auth" runtime')}}else{if((t=this.opts.auth)===null||t===void 0?void 0:t.disable){m('_startUpInstance: AutomaticAuth.disable is set to "true" skipping "createAuth"')}}this._instanceInfo=Object.assign(Object.assign({},o),{dbPath:o.dbPath,instance:s})}))}stop(e=true){var t;return n.__awaiter(this,void 0,void 0,(function*(){m("stop: Called .stop() method");if(i.isNullOrUndefined(this._instanceInfo)){m('stop: "instanceInfo" is not defined (never ran?)');return false}if(this._state===g.stopped){m(`stop: state is "stopped", so already stopped`);return false}i.assertion(!i.isNullOrUndefined(this._instanceInfo.instance),new Error('"instanceInfo.instance" is undefined!'));m(`stop: Stopping MongoDB server on port ${this._instanceInfo.port} with pid ${(t=this._instanceInfo.instance.mongodProcess)===null||t===void 0?void 0:t.pid}`);yield this._instanceInfo.instance.stop();this.stateChange(g.stopped);if(e){yield this.cleanup(false)}return true}))}cleanup(e=false){return n.__awaiter(this,void 0,void 0,(function*(){if(typeof e!=="boolean"){e=false}assertionIsMMSState(g.stopped,this.state);process.removeListener("beforeExit",this.cleanup);if(i.isNullOrUndefined(this._instanceInfo)){m('cleanup: "instanceInfo" is undefined');return}i.assertion(i.isNullOrUndefined(this._instanceInfo.instance.mongodProcess),new Error('Cannot cleanup because "instance.mongodProcess" is still defined'));m(`cleanup: force ${e}`);const t=this._instanceInfo.tmpDir;if(!i.isNullOrUndefined(t)){m(`cleanup: removing tmpDir at ${t.name}`);t.removeCallback()}if(e){const e=this._instanceInfo.dbPath;const t=yield i.statPath(e);if(i.isNullOrUndefined(t)){m(`cleanup: force is true, but path "${e}" dosnt exist anymore`)}else{i.assertion(t.isDirectory(),new Error("Defined dbPath is not an directory"));if(p.lt(process.version,"14.14.0")){yield u.promises.rmdir(e,{recursive:true,maxRetries:1})}else{yield u.promises.rm(e,{recursive:true,maxRetries:1})}}}this.stateChange(g.new);this._instanceInfo=undefined}))}get instanceInfo(){return this._instanceInfo}get state(){return this._state}ensureInstance(){return n.__awaiter(this,void 0,void 0,(function*(){m("ensureInstance: Called .ensureInstance() method");switch(this._state){case g.running:if(this._instanceInfo){return this._instanceInfo}throw new Error('MongoMemoryServer "_state" is "running" but "instanceInfo" is undefined!');case g.new:case g.stopped:break;case g.starting:return new Promise(((e,t)=>this.once(y.stateChange,(r=>{if(r!=g.running){t(new Error(`"ensureInstance" waited for "running" but got an different state: "${r}"`));return}i.assertion(!i.isNullOrUndefined(this._instanceInfo),new Error("InstanceInfo is undefined!"));e(this._instanceInfo)}))));default:throw new h.StateError([g.running,g.new,g.stopped,g.starting],this.state)}m('ensureInstance: no running instance, calling "start()" command');yield this.start();m('ensureInstance: "start()" command was succesfully resolved');if(!this._instanceInfo){throw new Error("Ensure-Instance failed to start an instance!")}return this._instanceInfo}))}getUri(e){m("getUri:",this.state);assertionInstanceInfo(this._instanceInfo);return i.uriTemplate(this._instanceInfo.ip,this._instanceInfo.port,i.generateDbName(e))}createAuth(e){var t,r,o;return n.__awaiter(this,void 0,void 0,(function*(){i.assertion(!i.isNullOrUndefined(this.auth),new Error('"createAuth" got called, but "this.auth" is undefined!'));m("createAuth: options:",this.auth);const n=yield d.MongoClient.connect(i.uriTemplate(e.ip,e.port,"admin"),{useNewUrlParser:true,useUnifiedTopology:true});let s=n.db("admin");m(`createAuth: Creating Root user, name: "${this.auth.customRootName}"`);yield s.command({createUser:this.auth.customRootName,pwd:"rootuser",mechanisms:["SCRAM-SHA-256"],customData:{createdBy:"mongodb-memory-server",as:"ROOTUSER"},roles:["root"]});if(this.auth.extraUsers.length>0){m(`createAuth: Creating "${this.auth.extraUsers.length}" Custom Users`);this.auth.extraUsers.sort(((e,t)=>{if(e.database==="admin"){return-1}return e.database===t.database?0:1}));for(const e of this.auth.extraUsers){e.database=i.isNullOrUndefined(e.database)?"admin":e.database;if(e.database!==s.databaseName){s=n.db(e.database)}m("createAuth: Creating User: ",e);yield s.command({createUser:e.createUser,pwd:e.pwd,customData:Object.assign(Object.assign({},e.customData),{createdBy:"mongodb-memory-server",as:"EXTRAUSER"}),roles:e.roles,authenticationRestrictions:(t=e.authenticationRestrictions)!==null&&t!==void 0?t:[],mechanisms:(r=e.mechanisms)!==null&&r!==void 0?r:["SCRAM-SHA-256"],digestPassword:(o=e.digestPassword)!==null&&o!==void 0?o:true})}}yield n.close()}))}}t.MongoMemoryServer=MongoMemoryServer;t.default=MongoMemoryServer;function assertionInstanceInfo(e){i.assertion(!i.isNullOrUndefined(e),new Error('"instanceInfo" is undefined'))}function assertionIsMMSState(e,t){i.assertion(t===e,new h.StateError([e],t))}},8919:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.DryMongoBinary=void 0;const n=r(4351);const o=r(5747);const s=n.__importDefault(r(8237));const i=r(8730);const a=r(1978);const c=n.__importStar(r(5622));const l=r(2087);const u=n.__importDefault(r(7281));const d=n.__importStar(r(8278));const p=s.default("MongoMS:DryMongoBinary");class DryMongoBinary{static locateBinary(e){return n.__awaiter(this,void 0,void 0,(function*(){p(`locateBinary: Trying to locate Binary for version "${e.version}"`);const t=yield this.generateOptions(e);if(!!t.systemBinary){p(`locateBinary: env "SYSTEM_BINARY" was provided with value: "${t.systemBinary}"`);const e=yield this.getSystemPath(t.systemBinary);if(a.isNullOrUndefined(e)){throw new Error(`Config option "SYSTEM_BINARY" was provided with value "${t.systemBinary}", but no binary could be found!`)}return e}if(this.binaryCache.has(e.version)){const t=this.binaryCache.get(e.version);p(`locateBinary: Requested Version found in cache: "[${e.version}, ${t}]"`);return t}p("locateBinary: running generateDownloadPath");const r=yield this.generateDownloadPath(t);if(!r[0]){p("locateBinary: could not find an existing binary");return undefined}p(`locateBinary: found binary at "${r[1]}"`);this.binaryCache.set(e.version,r[1]);return r[1]}))}static generateOptions(e){var t,r;return n.__awaiter(this,void 0,void 0,(function*(){const n=(t=i.resolveConfig(i.ResolveConfigVariables.VERSION))!==null&&t!==void 0?t:"4.0.25";const o=a.isNullOrUndefined(e)?{version:n}:e;if(a.isNullOrUndefined(this.cachedGetOs)){this.cachedGetOs=yield d.default()}const s={version:o.version||n,downloadDir:(e===null||e===void 0?void 0:e.downloadDir)||"",os:(r=e===null||e===void 0?void 0:e.os)!==null&&r!==void 0?r:this.cachedGetOs,arch:(e===null||e===void 0?void 0:e.arch)||l.arch(),systemBinary:i.resolveConfig(i.ResolveConfigVariables.SYSTEM_BINARY)||""};s.downloadDir=c.dirname((yield this.generateDownloadPath(s))[1]);return s}))}static getBinaryName(e){const t=l.platform()==="win32"?".exe":"";const r=d.isLinuxOS(e.os)?e.os.dist:e.os.os;return`mongod-${e.arch}-${r}-${e.version}${t}`}static combineBinaryName(e,t){return c.resolve(e,t)}static getSystemPath(e){return n.__awaiter(this,void 0,void 0,(function*(){try{yield o.promises.access(e,o.constants.X_OK);p(`getSystemPath: found system binary path at "${e}"`);return e}catch(t){p(`getSystemPath: can't find system binary at "${e}".\n${t.message}`)}return undefined}))}static generatePaths(e){return n.__awaiter(this,void 0,void 0,(function*(){const t={legacyHomeCache:"",modulesCache:"",relative:"",resolveConfig:""};const r=this.getBinaryName(e);let n=process.env["INIT_CWD"]||process.cwd();while(n.includes(`node_modules${c.sep}mongodb-memory-server`)){n=c.resolve(n,"..","..")}const o=u.default({name:"mongodb-memory-server",cwd:n});if(!a.isNullOrUndefined(o)){t.modulesCache=this.combineBinaryName(c.resolve(o),r)}const s=c.resolve(this.homedir(),".cache/mongodb-binaries");t.legacyHomeCache=this.combineBinaryName(s,r);const l=e.downloadDir||i.resolveConfig(i.ResolveConfigVariables.DOWNLOAD_DIR);if(!a.isNullOrUndefined(l)&&l.length>0){p(`generatePaths: resolveConfigValue is not empty`);t.resolveConfig=this.combineBinaryName(l,r)}t.relative=this.combineBinaryName(c.resolve(process.cwd(),"mongodb-binaries"),r);return t}))}static generateDownloadPath(e){return n.__awaiter(this,void 0,void 0,(function*(){const t=i.envToBool(i.resolveConfig(i.ResolveConfigVariables.PREFER_GLOBAL_PATH));p(`generateDownloadPath: Generating Download Path, preferGlobal: "${t}"`);const r=yield this.generatePaths(e);p("generateDownloadPath: Paths:",r);if(yield a.pathExists(r.resolveConfig)){p(`generateDownloadPath: Found binary in resolveConfig (DOWNLOAD_DIR): "${r.resolveConfig}"`);return[true,r.resolveConfig]}if(yield a.pathExists(r.legacyHomeCache)){p(`generateDownloadPath: Found binary in legacyHomeCache: "${r.legacyHomeCache}"`);return[true,r.legacyHomeCache]}if(yield a.pathExists(r.modulesCache)){p(`generateDownloadPath: Found binary in modulesCache: "${r.modulesCache}"`);return[true,r.modulesCache]}if(yield a.pathExists(r.relative)){p(`generateDownloadPath: Found binary in relative: "${r.relative}"`);return[true,r.relative]}p(`generateDownloadPath: no existing binary for version "${e.version}" was found`);if(r.resolveConfig.length>0){p(`generateDownloadPath: using resolveConfig (DOWNLOAD_DIR) "${r.resolveConfig}"`);return[false,r.resolveConfig]}if(t&&!!r.legacyHomeCache){p(`generateDownloadPath: using global (preferGlobal) "${r.legacyHomeCache}"`);return[false,r.legacyHomeCache]}if(r.modulesCache.length>0){p(`generateDownloadPath: using modulesCache "${r.modulesCache}"`);return[false,r.modulesCache]}p(`generateDownloadPath: using relative "${r.relative}"`);return[false,r.relative]}))}static homedir(){return l.homedir()}}t.DryMongoBinary=DryMongoBinary;DryMongoBinary.binaryCache=new Map},9125:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MongoBinary=void 0;const n=r(4351);const o=n.__importDefault(r(2087));const s=n.__importDefault(r(5622));const i=n.__importDefault(r(6186));const a=n.__importDefault(r(229));const c=n.__importStar(r(8730));const l=n.__importDefault(r(8237));const u=n.__importStar(r(1383));const d=r(1978);const p=r(3129);const h=r(4908);const m=r(8919);const y=l.default("MongoMS:MongoBinary");class MongoBinary{static download(e){return n.__awaiter(this,void 0,void 0,(function*(){y("download");const{downloadDir:t,version:r}=e;yield i.default(t);const n=s.default.resolve(t,`${r}.lock`);y(`download: Waiting to acquire Download lock for file "${n}"`);const o=yield h.LockFile.lock(n);y("download: Download lock acquired");try{if(!m.DryMongoBinary.binaryCache.has(r)){y(`download: Adding version ${r} to cache`);const t=new a.default(e);m.DryMongoBinary.binaryCache.set(r,yield t.getMongodPath())}}finally{y("download: Removing Download lock");yield o.unlock();y("download: Download lock removed")}const c=m.DryMongoBinary.binaryCache.get(r);d.assertion(typeof c==="string",new Error(`No Cache Path for version "${r}" found (and download failed silently?)`));return c}))}static getPath(e={}){return n.__awaiter(this,void 0,void 0,(function*(){y("getPath");const t=Object.assign(Object.assign({},yield m.DryMongoBinary.generateOptions(e)),{platform:e.platform||c.default(c.ResolveConfigVariables.PLATFORM)||o.default.platform(),checkMD5:e.checkMD5||c.envToBool(c.default(c.ResolveConfigVariables.MD5_CHECK))});y(`getPath: MongoBinary options:`,JSON.stringify(t,null,2));let r=yield m.DryMongoBinary.locateBinary(t);if(!!t.systemBinary){if(!d.isNullOrUndefined(r)){y(`getPath: Spawning binaryPath "${r}" to get version`);const e=p.spawnSync(r,["--version"]).stdout.toString().match(/^\s*db\s+version\s+v?(\d+\.\d+\.\d+)\s*$/im);d.assertion(!d.isNullOrUndefined(e),new Error("Couldnt find an version from system binary output!"));const n=e[1];if(u.neq(t.version,n)){console.warn("getPath: MongoMemoryServer: Possible version conflict\n"+`  SystemBinary version: "${n}"\n`+`  Requested version:    "${t.version}"\n\n`+"  Using SystemBinary!")}}else{throw new Error('Option "SYSTEM_BINARY" was set, but binaryPath was empty! (system binary could not be found?) [This Error should normally not be thrown, please report this]')}}d.assertion(typeof t.version==="string",new Error('"MongoBinary.options.version" is not an string!'));if(!r){if(c.envToBool(c.default(c.ResolveConfigVariables.RUNTIME_DOWNLOAD))){y('getPath: "RUNTIME_DOWNLOAD" is "true", trying to download');r=yield this.download(t)}else{y('getPath: "RUNTIME_DOWNLOAD" is "false", not downloading')}}if(!r){const e=c.envToBool(c.default(c.ResolveConfigVariables.RUNTIME_DOWNLOAD));throw new Error(`MongoBinary.getPath: could not find an valid binary path! (Got: "${r}", RUNTIME_DOWNLOAD: "${e}")`)}y(`getPath: Mongod binary path: "${r}"`);return r}))}}t.MongoBinary=MongoBinary;t.default=MongoBinary},229:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MongoBinaryDownload=void 0;const n=r(4351);const o=n.__importDefault(r(2087));const s=r(8835);const i=n.__importDefault(r(5622));const a=r(5747);const c=n.__importDefault(r(1446));const l=n.__importDefault(r(7211));const u=r(8761);const d=n.__importDefault(r(2283));const p=n.__importDefault(r(8781));const h=n.__importDefault(r(1));const m=r(7219);const y=n.__importStar(r(8730));const g=n.__importDefault(r(8237));const v=r(1978);const b=r(8919);const S=n.__importDefault(r(6186));const w=r(1058);const _=g.default("MongoMS:MongoBinaryDownload");class MongoBinaryDownload{constructor({platform:e,arch:t,downloadDir:r,version:n,checkMD5:s}){this.platform=e!==null&&e!==void 0?e:o.default.platform();this.arch=t!==null&&t!==void 0?t:o.default.arch();n=n!==null&&n!==void 0?n:y.default(y.ResolveConfigVariables.VERSION);v.assertion(typeof n==="string",new Error("An MongoDB Binary version must be specified!"));v.assertion(typeof r==="string",new Error("An DownloadDir must be specified!"));this.version=n;this.downloadDir=r;this.checkMD5=s!==null&&s!==void 0?s:y.envToBool(y.default(y.ResolveConfigVariables.MD5_CHECK));this.dlProgress={current:0,length:0,totalMb:0,lastPrintedAt:0}}getPath(){return n.__awaiter(this,void 0,void 0,(function*(){const e=yield b.DryMongoBinary.generateOptions({version:this.version,arch:this.arch,downloadDir:this.downloadDir});return b.DryMongoBinary.combineBinaryName(this.downloadDir,b.DryMongoBinary.getBinaryName(e))}))}getMongodPath(){return n.__awaiter(this,void 0,void 0,(function*(){_("getMongodPath");const e=yield this.getPath();if(yield v.pathExists(e)){_(`getMongodPath: mongod path "${e}" already exists, using this`);return e}const t=yield this.startDownload();yield this.extract(t);yield a.promises.unlink(t);if(yield v.pathExists(e)){return e}throw new Error(`Cannot find downloaded mongod binary by path "${e}"`)}))}startDownload(){return n.__awaiter(this,void 0,void 0,(function*(){_("startDownload");const e=new h.default({platform:this.platform,arch:this.arch,version:this.version});yield S.default(this.downloadDir);try{yield a.promises.access(this.downloadDir,a.constants.X_OK|a.constants.W_OK)}catch(e){console.error(`Download Directory at "${this.downloadDir}" does not have sufficient permissions to be used by this process\n`+"Needed Permissions: Write & Execute (-wx)\n");throw e}const t=yield e.getDownloadUrl();const r=yield this.download(t);yield this.makeMD5check(`${t}.md5`,r);return r}))}makeMD5check(e,t){return n.__awaiter(this,void 0,void 0,(function*(){_("makeMD5check: Checking MD5 of downloaded binary...");if(!this.checkMD5){_("makeMD5check: checkMD5 is disabled");return undefined}const r=yield this.download(e);const n=(yield a.promises.readFile(r)).toString("utf-8");const o=n.match(/^\s*([\w\d]+)\s*/i);const s=o?o[1]:null;const i=c.default.sync(t);_(`makeMD5check: Local MD5: ${i}, Remote MD5: ${s}`);if(s!==i){throw new Error("MongoBinaryDownload: md5 check failed")}yield a.promises.unlink(r);return true}))}download(e){return n.__awaiter(this,void 0,void 0,(function*(){_("download");const t=process.env["yarn_https-proxy"]||process.env.yarn_proxy||process.env["npm_config_https-proxy"]||process.env.npm_config_proxy||process.env.https_proxy||process.env.http_proxy||process.env.HTTPS_PROXY||process.env.HTTP_PROXY;const r=process.env.npm_config_strict_ssl==="true";const n=new s.URL(e);n.port=n.port||"443";const o={method:"GET",rejectUnauthorized:r,protocol:y.envToBool(y.default(y.ResolveConfigVariables.USE_HTTP))?"http:":"https:",agent:t?new m.HttpsProxyAgent(t):undefined};const a=n.pathname.split("/").pop();if(!a){throw new Error(`MongoBinaryDownload: missing filename for url "${e}"`)}const c=i.default.resolve(this.downloadDir,a);const l=i.default.resolve(this.downloadDir,`${a}.downloading`);_(`download: Downloading${t?` via proxy "${t}"`:""}: "${e}"`);if(yield v.pathExists(c)){_("download: Already downloaded archive found, skipping download");return c}this.assignDownloadingURL(n);const u=yield this.httpDownload(n,o,c,l);return u}))}extract(e){var t,r;return n.__awaiter(this,void 0,void 0,(function*(){_("extract");const n=yield this.getPath();_(`extract: archive: "${e}" final: "${n}"`);yield S.default(i.default.dirname(n));const filter=e=>/(?:bin\/(?:mongod(?:\.exe)?)|(?:.*\.dll))$/i.test(e);if(/(.tar.gz|.tgz)$/.test(e)){yield this.extractTarGz(e,n,filter)}else if(/.zip$/.test(e)){yield this.extractZip(e,n,filter)}else{throw new Error(`MongoBinaryDownload: unsupported archive "${e}" (downloaded from "${(t=this._downloadingUrl)!==null&&t!==void 0?t:"unknown"}"). Broken archive from MongoDB Provider?`)}if(!(yield v.pathExists(n))){throw new Error(`MongoBinaryDownload: missing mongod binary in "${e}" (downloaded from "${(r=this._downloadingUrl)!==null&&r!==void 0?r:"unknown"}"). Broken archive from MongoDB Provider?`)}return n}))}extractTarGz(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){_("extractTarGz");const n=d.default.extract();n.on("entry",((e,n,o)=>{if(r(e.name)){n.pipe(a.createWriteStream(t,{mode:509}))}n.on("end",(()=>o()));n.resume()}));return new Promise(((t,r)=>{a.createReadStream(e).on("error",(t=>{r("Unable to open tarball "+e+": "+t)})).pipe(u.createUnzip()).on("error",(t=>{r("Error during unzip for "+e+": "+t)})).pipe(n).on("error",(t=>{r("Error during untar for "+e+": "+t)})).on("finish",(e=>{t(e)}))}))}))}extractZip(e,t,r){return n.__awaiter(this,void 0,void 0,(function*(){_("extractZip");return new Promise(((n,o)=>{p.default.open(e,{lazyEntries:true},((e,s)=>{if(e||!s){return o(e)}s.readEntry();s.on("end",(()=>n()));s.on("entry",(e=>{if(!r(e.fileName)){return s.readEntry()}s.openReadStream(e,((e,r)=>{if(e||!r){return o(e)}r.on("end",(()=>s.readEntry()));r.pipe(a.createWriteStream(t,{mode:509}))}))}))}))}))}))}httpDownload(e,t,r,o){return n.__awaiter(this,void 0,void 0,(function*(){_("httpDownload");const s=this.assignDownloadingURL(e);return new Promise(((i,c)=>{_(`httpDownload: trying to download "${s}"`);l.default.get(e,t,(e=>{if(e.statusCode!=200){if(e.statusCode===403){c(new Error("Status Code is 403 (MongoDB's 404)\n"+"This means that the requested version-platform combination doesn't exist\n"+`  Used Url: "${s}"\n`+"Try to use different version 'new MongoMemoryServer({ binary: { version: 'X.Y.Z' } })'\n"+"List of available versions can be found here:\n"+"  https://www.mongodb.org/dl/linux for Linux\n"+"  https://www.mongodb.org/dl/osx for OSX\n"+"  https://www.mongodb.org/dl/win32 for Windows"));return}c(new Error("Status Code isnt 200!"));return}if(typeof e.headers["content-length"]!="string"){c(new Error('Response header "content-length" is empty!'));return}this.dlProgress.current=0;this.dlProgress.length=parseInt(e.headers["content-length"],10);this.dlProgress.totalMb=Math.round(this.dlProgress.length/1048576*10)/10;const l=a.createWriteStream(o);e.pipe(l);l.on("finish",(()=>n.__awaiter(this,void 0,void 0,(function*(){var e;if(this.dlProgress.current<this.dlProgress.length&&!((e=t.path)===null||e===void 0?void 0:e.endsWith(".md5"))){c(new Error(`Too small (${this.dlProgress.current} bytes) mongod binary downloaded from ${s}`));return}this.printDownloadProgress({length:0},true);l.close();yield a.promises.rename(o,r);_(`httpDownload: moved "${o}" to "${r}"`);i(r)}))));e.on("data",(e=>{this.printDownloadProgress(e)}))})).on("error",(e=>{console.error(`Couldnt download "${s}"!`,e.message);c(e)}))}))}))}printDownloadProgress(e,t=false){this.dlProgress.current+=e.length;const r=Date.now();if(r-this.dlProgress.lastPrintedAt<2e3&&!t){return}this.dlProgress.lastPrintedAt=r;const n=Math.round(100*this.dlProgress.current/this.dlProgress.length*10)/10;const o=Math.round(this.dlProgress.current/1048576*10)/10;const s=this.platform==="win32"?"[0G":"\r";const i=`Downloading MongoDB "${this.version}": ${n}% (${o}mb / ${this.dlProgress.totalMb}mb)${s}`;if(process.stdout.isTTY){w.clearLine(process.stdout,0);process.stdout.write(i)}else{console.log(i)}}assignDownloadingURL(e){this._downloadingUrl=e.href;return this._downloadingUrl}}t.MongoBinaryDownload=MongoBinaryDownload;t.default=MongoBinaryDownload},1:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MongoBinaryDownloadUrl=void 0;const n=r(4351);const o=r(8730);const s=n.__importDefault(r(8237));const i=n.__importStar(r(1383));const a=r(1978);const c=r(8919);const l=r(8835);const u=r(3386);const d=s.default("MongoMS:MongoBinaryDownloadUrl");class MongoBinaryDownloadUrl{constructor(e){this.version=e.version;this.platform=this.translatePlatform(e.platform);this.arch=MongoBinaryDownloadUrl.translateArch(e.arch,this.platform);this.os=e.os}getDownloadUrl(){var e;return n.__awaiter(this,void 0,void 0,(function*(){const t=o.resolveConfig(o.ResolveConfigVariables.DOWNLOAD_URL);if(t){d(`Using "${t}" as the Download-URL`);const e=new l.URL(t);return e.toString()}const r=yield this.getArchiveName();d(`Using "${r}" as the Archive String`);const n=(e=o.resolveConfig(o.ResolveConfigVariables.DOWNLOAD_MIRROR))!==null&&e!==void 0?e:"https://fastdl.mongodb.org";d(`Using "${n}" as the mirror`);const s=new l.URL(n);s.pathname=`/${this.platform}/${r}`;return s.toString()}))}getArchiveName(){return n.__awaiter(this,void 0,void 0,(function*(){const e=o.resolveConfig(o.ResolveConfigVariables.ARCHIVE_NAME);if(!!e){return e}switch(this.platform){case"osx":return this.getArchiveNameOsx();case"win32":case"windows":return this.getArchiveNameWin();case"linux":return this.getArchiveNameLinux();default:throw new u.UnknownPlatform(this.platform)}}))}getArchiveNameWin(){let e=`mongodb-${this.platform}-${this.arch}`;if(!a.isNullOrUndefined(i.coerce(this.version))){if(i.satisfies(this.version,"4.2.x")){e+="-2012plus"}else if(i.lt(this.version,"4.1.0")){e+="-2008plus-ssl"}}e+=`-${this.version}.zip`;return e}getArchiveNameOsx(){let e=`mongodb-osx`;const t=i.coerce(this.version);if(!a.isNullOrUndefined(t)&&i.gte(t,"3.2.0")){e+="-ssl"}if(a.isNullOrUndefined(t)||i.gte(t,"4.2.0")){e=`mongodb-macos`}if(this.arch==="arm64"){d('getArchiveNameOsx: Arch is "arm64", using x64 binary');this.arch="x86_64"}e+=`-${this.arch}-${this.version}.tgz`;return e}getArchiveNameLinux(){return n.__awaiter(this,void 0,void 0,(function*(){let e;if(this.arch!=="i686"){if(!this.os){this.os=(yield c.DryMongoBinary.generateOptions()).os}e=this.getLinuxOSVersionString(this.os)}let t=`mongodb-linux-${this.arch}`;if(!!e){t+=`-${e}`}t+=`-${this.version}.tgz`;return t}))}getLinuxOSVersionString(e){if(regexHelper(/ubuntu/i,e)){return this.getUbuntuVersionString(e)}else if(regexHelper(/suse/i,e)){return this.getSuseVersionString(e)}else if(regexHelper(/(rhel|centos|scientific)/i,e)){return this.getRhelVersionString(e)}else if(regexHelper(/fedora/i,e)){return this.getFedoraVersionString(e)}else if(regexHelper(/debian/i,e)){return this.getDebianVersionString(e)}else if(regexHelper(/alpine/i,e)){console.warn("There is no offical build of MongoDB for Alpine!")}else if(regexHelper(/(arch|manjaro|arco)(?:linux)?$/i,e)){console.warn(`There is no official build of MongoDB for ArchLinux (${e.dist}). Falling back to Ubuntu 20.04 release.`);return this.getUbuntuVersionString({os:"linux",dist:"Ubuntu Linux",release:"20.04"})}else if(regexHelper(/unknown/i,e)){console.warn("Couldnt parse dist information, please report this to https://github.com/nodkz/mongodb-memory-server/issues")}console.warn(`Unknown/unsupported linux "${e.dist}(${e.id_like})". Falling back to legacy MongoDB build!`);return this.getLegacyVersionString()}getDebianVersionString(e){let t="debian";const r=parseFloat(e.release);if(r>=10||["unstable","testing"].includes(e.release)){if(i.lte(this.version,"4.2.0")){d(`getDebianVersionString: requested version "${this.version}" not available for osrelease "${r}", using "92"`);t+="92"}else{t+="10"}}else if(r>=9){t+="92"}else if(r>=8.1){t+="81"}else if(r>=7.1){t+="71"}return t}getFedoraVersionString(e){let t="rhel";const r=parseInt(e.release,10);if(r>=34){t+="80"}if(r<34&&r>=19){t+="70"}if(r<19&&r>=12){t+="62"}if(r<12&&r>=6){t+="55"}return t}getRhelVersionString(e){let t="rhel";const{release:r}=e;if(r){if(/^8/.test(r)){t+="80"}else if(/^7/.test(r)){t+="70"}else if(/^6/.test(r)){t+="62"}else if(/^5/.test(r)){t+="55"}}return t}getLegacyVersionString(){return""}getSuseVersionString(e){const t=e.release.match(/(^11|^12)/);return t?`suse${t[0]}`:""}getUbuntuVersionString(e){const t=Object.assign(Object.assign({},e),{dist:"ubuntu"});{if(/^linux\s?mint\s*$/i.test(e.dist)){const r={17:"14.04",18:"16.04",19:"18.04",20:"20.04"};t.release=r[parseInt(e.release.split(".")[0])]||r[20]}if(/^elementary\s?os\s*$/i.test(e.dist)){const r={3:"14.04",4:"16.04",5:"18.04",6:"20.04"};const[n,o]=e.release.split(".").map((e=>parseInt(e)));const s=n||o;t.release=r[s]||r[6]}}const r=parseInt(t.release.split(".")[0],10);if(this.arch==="arm64"){if(i.satisfies(this.version,"<4.1.10")){this.arch="arm64";return"ubuntu1604"}if(i.satisfies(this.version,">=4.1.10")){this.arch="aarch64";if(i.satisfies(this.version,"<4.4.0")){return"ubuntu1804"}return`ubuntu${r||18}04`}}if(t.release==="14.10"){return"ubuntu1410-clang"}if(r>=18&&i.satisfies(this.version,"3.x.x")){d(`getUbuntuVersionString: ubuntuYear is "${r}", which dosnt have an 3.x.x version, defaulting to "1604"`);return"ubuntu1604"}if(r>18&&i.satisfies(this.version,"<=4.3.x")){d(`getUbuntuVersionString: ubuntuYear is "${r}", which dosnt have an "<=4.3.x" version, defaulting to "1804"`);return"ubuntu1804"}return`ubuntu${r||14}04`}translatePlatform(e){switch(e){case"darwin":return"osx";case"win32":const t=i.coerce(this.version);if(a.isNullOrUndefined(t)){return"windows"}return i.gte(t,"4.3.0")?"windows":"win32";case"linux":case"elementary OS":return"linux";case"sunos":return"sunos5";default:throw new u.UnknownPlatform(e)}}static translateArch(e,t){switch(e){case"ia32":if(t==="linux"){return"i686"}else if(t==="win32"){return"i386"}throw new u.UnknownArchitecture(e,t);case"x64":return"x86_64";case"arm64":return"arm64";default:throw new u.UnknownArchitecture(e)}}}t.MongoBinaryDownloadUrl=MongoBinaryDownloadUrl;t.default=MongoBinaryDownloadUrl;function regexHelper(e,t){return e.test(t.dist)||(!a.isNullOrUndefined(t.id_like)?e.test(t.id_like):false)}},843:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MongoInstance=t.MongoInstanceEvents=void 0;const n=r(4351);const o=r(3129);const s=n.__importStar(r(5622));const i=r(9125);const a=n.__importDefault(r(8237));const c=r(1978);const l=r(1383);const u=r(8614);const d=r(5517);const p=r(5747);if(l.lt(process.version,"10.15.0")){console.warn("Using NodeJS below 10.15.0")}const h=a.default("MongoMS:MongoInstance");var m;(function(e){e["instanceReplState"]="instanceReplState";e["instancePrimary"]="instancePrimary";e["instanceReady"]="instanceReady";e["instanceSTDOUT"]="instanceSTDOUT";e["instanceSTDERR"]="instanceSTDERR";e["instanceClosed"]="instanceClosed";e["instanceRawError"]="instanceRawError";e["instanceError"]="instanceError";e["killerLaunched"]="killerLaunched";e["instanceLaunched"]="instanceLaunched";e["instanceStarted"]="instanceStarted"})(m=t.MongoInstanceEvents||(t.MongoInstanceEvents={}));class MongoInstance extends u.EventEmitter{constructor(e){super();this.isInstancePrimary=false;this.isInstanceReady=false;this.isReplSet=false;this.instanceOpts=Object.assign({},e.instance);this.binaryOpts=Object.assign({},e.binary);this.spawnOpts=Object.assign({},e.spawn);this.on(m.instanceReady,(()=>{this.isInstanceReady=true;this.debug("constructor: Instance is ready!")}));this.on(m.instanceError,(e=>n.__awaiter(this,void 0,void 0,(function*(){this.debug(`constructor: Instance has thrown an Error: ${e.toString()}`);this.isInstanceReady=false;this.isInstancePrimary=false;yield this.stop()}))))}debug(e){var t;const r=(t=this.instanceOpts.port)!==null&&t!==void 0?t:"unknown";h(`Mongo[${r}]: ${e}`)}static create(e){return n.__awaiter(this,void 0,void 0,(function*(){h("create: Called .create() method");const t=new this(e);yield t.start();return t}))}prepareCommandArgs(){var e;this.debug("prepareCommandArgs");c.assertion(!c.isNullOrUndefined(this.instanceOpts.port),new Error('"instanceOpts.port" is required to be set!'));c.assertion(!c.isNullOrUndefined(this.instanceOpts.dbPath),new Error('"instanceOpts.dbPath" is required to be set!'));const t=[];t.push("--port",this.instanceOpts.port.toString());t.push("--dbpath",this.instanceOpts.dbPath);if(!!this.instanceOpts.storageEngine){t.push("--storageEngine",this.instanceOpts.storageEngine)}if(!!this.instanceOpts.ip){t.push("--bind_ip",this.instanceOpts.ip)}if(this.instanceOpts.auth){t.push("--auth")}else{t.push("--noauth")}if(!!this.instanceOpts.replSet){this.isReplSet=true;t.push("--replSet",this.instanceOpts.replSet)}const r=t.concat((e=this.instanceOpts.args)!==null&&e!==void 0?e:[]);this.debug("prepareCommandArgs: final arugment array:"+JSON.stringify(r));return r}start(){return n.__awaiter(this,void 0,void 0,(function*(){this.debug("start");this.isInstancePrimary=false;this.isInstanceReady=false;this.isReplSet=false;const e=new Promise(((e,t)=>{this.once(m.instanceReady,e);this.once(m.instanceError,t);this.once(m.instanceClosed,(()=>{t(new Error("Instance Exited before being ready and without throwing an error!"))}))}));const t=yield i.MongoBinary.getPath(this.binaryOpts);try{yield p.promises.access(t,p.constants.X_OK)}catch(e){console.error(`Mongod File at "${t}" does not have sufficient permissions to be used by this process\n`+"Needed Permissions: Execute (--x)\n");throw e}this.debug("start: Starting Processes");this.mongodProcess=this._launchMongod(t);this.killerProcess=this._launchKiller(process.pid,this.mongodProcess.pid);yield e;this.emit(m.instanceStarted);this.debug("start: Processes Started")}))}stop(){return n.__awaiter(this,void 0,void 0,(function*(){this.debug("stop");if(!this.mongodProcess&&!this.killerProcess){h("stop: nothing to shutdown, returning");return false}if(!c.isNullOrUndefined(this.mongodProcess)){if(this.isReplSet&&this.isInstancePrimary){let e;try{h("stop: trying replSetStepDown");const t=this.instanceOpts.port;const r=this.instanceOpts.ip;c.assertion(!c.isNullOrUndefined(t),new Error('Cannot shutdown replset gracefully, no "port" is provided'));c.assertion(!c.isNullOrUndefined(r),new Error('Cannot shutdown replset gracefully, no "ip" is provided'));e=yield d.MongoClient.connect(c.uriTemplate(r,t,"admin"),{useNewUrlParser:true,useUnifiedTopology:true});const n=e.db("admin");yield n.command({replSetStepDown:1,force:true})}catch(e){if(!(e instanceof d.MongoNetworkError&&/^connection \d+ to [\d.]+:\d+ closed$/i.test(e.message))){console.warn(e)}}finally{if(!c.isNullOrUndefined(e)){yield e.close()}}}yield c.killProcess(this.mongodProcess,"mongodProcess");this.mongodProcess=undefined}else{this.debug("stop: mongodProcess: nothing to shutdown, skipping")}if(!c.isNullOrUndefined(this.killerProcess)){yield c.killProcess(this.killerProcess,"killerProcess");this.killerProcess=undefined}else{this.debug("stop: killerProcess: nothing to shutdown, skipping")}this.debug("stop: Instance Finished Shutdown");return true}))}_launchMongod(e){var t,r;this.debug("_launchMongod: Launching Mongod Process");const n=o.spawn(s.resolve(e),this.prepareCommandArgs(),Object.assign(Object.assign({},this.spawnOpts),{stdio:"pipe"}));(t=n.stderr)===null||t===void 0?void 0:t.on("data",this.stderrHandler.bind(this));(r=n.stdout)===null||r===void 0?void 0:r.on("data",this.stdoutHandler.bind(this));n.on("close",this.closeHandler.bind(this));n.on("error",this.errorHandler.bind(this));if(c.isNullOrUndefined(n.pid)){throw new Error("Spawned Mongo Instance PID is undefined")}this.emit(m.instanceLaunched);return n}_launchKiller(e,t){this.debug(`_launchKiller: Launching Killer Process (parent: ${e}, child: ${t})`);const r=o.fork(s.resolve(__dirname,"../../scripts/mongo_killer.js"),[e.toString(),t.toString()],{detached:true,stdio:"ignore"});r.unref();this.emit(m.killerLaunched);return r}errorHandler(e){this.emit(m.instanceRawError,e);this.emit(m.instanceError,e)}closeHandler(e){if(process.platform==="win32"&&e!=12&&e!=0||e!=0){this.debug("closeHandler: Mongod instance closed with an non-0 (or non 12 on windows) code!")}this.debug(`closeHandler: ${e}`);this.emit(m.instanceClosed,e)}stderrHandler(e){this.debug(`stderrHandler: ""${e.toString()}""`);this.emit(m.instanceSTDERR,e)}stdoutHandler(e){var t,r,n,o;const s=e.toString().trim();this.debug(`stdoutHandler: ""${s}""`);this.emit(m.instanceSTDOUT,s);if(/waiting for connections/i.test(s)){this.emit(m.instanceReady)}if(/address already in use/i.test(s)){this.emit(m.instanceError,`Port "${this.instanceOpts.port}" already in use`)}if(/mongod instance already running/i.test(s)){this.emit(m.instanceError,"Mongod already running")}if(/permission denied/i.test(s)){this.emit(m.instanceError,"Mongod permission denied")}if(/Data directory .*? not found/i.test(s)){this.emit(m.instanceError,"Data directory not found")}if(/CURL_OPENSSL_3.*not found/i.test(s)){this.emit(m.instanceError,"libcurl3 is not available on your system. Mongod requires it and cannot be started without it.\n"+"You should manually install libcurl3 or try to use an newer version of MongoDB\n")}if(/CURL_OPENSSL_4.*not found/i.test(s)){this.emit(m.instanceError,"libcurl4 is not available on your system. Mongod requires it and cannot be started without it.\n"+"You need to manually install libcurl4\n")}if(/lib.*: cannot open shared object/i.test(s)){const e=(r=(t=s.match(/(lib.*): cannot open shared object/i))===null||t===void 0?void 0:t[1].toLocaleLowerCase())!==null&&r!==void 0?r:"unknown";this.emit(m.instanceError,`Instance Failed to start because an library file is missing: "${e}"`)}if(/\*\*\*aborting after/i.test(s)){this.emit(m.instanceError,"Mongod internal error")}if(/transition to primary complete; database writes are now permitted/i.test(s)){this.isInstancePrimary=true;this.debug('stdoutHandler: emitting "instancePrimary"');this.emit(m.instancePrimary)}if(/member [\d\.:]+ is now in state \w+/i.test(s)){const e=(o=(n=/member [\d\.:]+ is now in state (\w+)/i.exec(s))===null||n===void 0?void 0:n[1])!==null&&o!==void 0?o:"UNKNOWN";this.emit(m.instanceReplState,e);if(e!=="PRIMARY"){this.isInstancePrimary=false}}}}t.MongoInstance=MongoInstance;t.default=MongoInstance},3386:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.UnknownArchitecture=t.UnknownPlatform=t.UnknownLockfileStatus=t.StateError=void 0;const n=r(1978);class StateError extends Error{constructor(e,t){super(`Incorrect State for operation: "${t}", allowed States: "[${e.join(",")}]"`);this.wantedStates=e;this.gotState=t}}t.StateError=StateError;class UnknownLockfileStatus extends Error{constructor(e){super(`Unknown LockFile Status: "${e}"`);this.status=e}}t.UnknownLockfileStatus=UnknownLockfileStatus;class UnknownPlatform extends Error{constructor(e){super(`Unknown Platform: "${e}"`);this.platform=e}}t.UnknownPlatform=UnknownPlatform;class UnknownArchitecture extends Error{constructor(e,t){super();this.arch=e;this.platform=t;if(!n.isNullOrUndefined(t)){this.message=`Unsupported Architecture-Platform combination: arch: "${e}", platform: "${t}"`}else{this.message=`Unsupported Architecture: "${e}"`}}}t.UnknownArchitecture=UnknownArchitecture},8278:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.parseOS=t.parseLSB=t.getOS=t.isLinuxOS=void 0;const n=r(4351);const o=r(2087);const s=n.__importDefault(r(8237));const i=r(1978);const a=s.default("MongoMS:getos");const c={name:/^(?:distributor id:|DISTRIB_ID=)\s*(.*)$/im,codename:/^(?:codename:|DISTRIB_CODENAME=)\s*(.*)$/im,release:/^(?:release:|DISTRIB_RELEASE=)\s*(.*)$/im};const l={name:/^id\s*=\s*"?(.*)"?$/im,codename:/^version_codename\s*=\s*(.*)$/im,release:/^version_id\s*=\s*"?(\d*(?:\.\d*)?)"?$/im,id_like:/^id_like\s*=\s*"?(.*)"?$/im};function isLinuxOS(e){return e.os==="linux"}t.isLinuxOS=isLinuxOS;function getOS(){return n.__awaiter(this,void 0,void 0,(function*(){const e=o.platform();if(e==="linux"){return yield getLinuxInformation()}return{os:e}}))}t.getOS=getOS;t.default=getOS;function getLinuxInformation(){return n.__awaiter(this,void 0,void 0,(function*(){const e=yield i.tryReleaseFile("/etc/upstream-release/lsb-release",parseLSB);if(!i.isNullOrUndefined(e)){a("getLinuxInformation: Using UpstreamLSB");return e}const t=yield i.tryReleaseFile("/etc/os-release",parseOS);if(!i.isNullOrUndefined(t)){a("getLinuxInformation: Using etcOsRelease");return t}const r=yield i.tryReleaseFile("/usr/lib/os-release",parseOS);if(!i.isNullOrUndefined(r)){a("getLinuxInformation: Using usrOsRelease");return r}const n=yield i.tryReleaseFile("/etc/lsb-release",parseLSB);if(!i.isNullOrUndefined(n)){a("getLinuxInformation: Using etcLSBRelease");return n}console.warn("Could not find any Release File, using fallback binary");return{os:"linux",dist:"unknown",release:""}}))}function parseLSB(e){var t,r,n,o,s;return{os:"linux",dist:(r=(t=e.match(c.name))===null||t===void 0?void 0:t[1].toLocaleLowerCase())!==null&&r!==void 0?r:"unknown",codename:(n=e.match(c.codename))===null||n===void 0?void 0:n[1].toLocaleLowerCase(),release:(s=(o=e.match(c.release))===null||o===void 0?void 0:o[1].toLocaleLowerCase())!==null&&s!==void 0?s:""}}t.parseLSB=parseLSB;function parseOS(e){var t,r,n,o,s,i;return{os:"linux",dist:(r=(t=e.match(l.name))===null||t===void 0?void 0:t[1].toLocaleLowerCase())!==null&&r!==void 0?r:"unknown",codename:(n=e.match(l.codename))===null||n===void 0?void 0:n[1].toLocaleLowerCase(),release:(s=(o=e.match(l.release))===null||o===void 0?void 0:o[1].toLocaleLowerCase())!==null&&s!==void 0?s:"",id_like:(i=e.match(l.id_like))===null||i===void 0?void 0:i[1].toLocaleLowerCase()}}t.parseOS=parseOS},4908:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.LockFile=t.LockFileEvents=t.LockFileStatus=void 0;const n=r(4351);const o=r(8614);const s=n.__importStar(r(1978));const i=n.__importDefault(r(8237));const a=n.__importStar(r(5622));const c=n.__importDefault(r(6186));const l=r(5747);const u=r(4038);const d=r(5840);const p=r(3386);const h=i.default("MongoMS:LockFile");class RepeatError extends Error{constructor(e){super();this.repeat=e}}var m;(function(e){e[e["available"]=0]="available";e[e["availableInstance"]=1]="availableInstance";e[e["lockedSelf"]=2]="lockedSelf";e[e["lockedDifferent"]=3]="lockedDifferent"})(m=t.LockFileStatus||(t.LockFileStatus={}));var y;(function(e){e["lock"]="lock";e["unlock"]="unlock"})(y=t.LockFileEvents||(t.LockFileEvents={}));class LockFileEventsClass extends o.EventEmitter{}class LockFile{constructor(e,t){this.file=e;this.uuid=t}static lock(e){return n.__awaiter(this,void 0,void 0,(function*(){yield s.ensureAsync();h(`lock: Locking file "${e}"`);const t=a.resolve(e.trim());s.assertion(t.length>0,new Error("Provided Path for lock file is length of 0"));const r=yield this.checkLock(t);switch(r){case m.lockedDifferent:case m.lockedSelf:return this.waitForLock(t);case m.available:return this.createLock(t);default:throw new p.UnknownLockfileStatus(r)}}))}static checkLock(e,t){return n.__awaiter(this,void 0,void 0,(function*(){h(`checkLock: for file "${e}" with uuid: "${t}"`);if(!(yield s.pathExists(e))){return m.available}try{const r=(yield l.promises.readFile(e)).toString().trim().split(" ");const n=parseInt(r[0]);if(n===process.pid){h(`checkLock: Lock File Already exists, and is for *this* process, with uuid: "${r[1]}"`);if(!this.files.has(e)){return m.available}if(!s.isNullOrUndefined(t)){return t===r[1]?m.availableInstance:m.lockedSelf}return m.lockedSelf}h(`checkLock: Lock File Aready exists, for an different process: "${n}"`);return s.isAlive(n)?m.lockedDifferent:m.available}catch(e){if(e.code==="ENOENT"){h("checkLock: reading file failed with ENOENT");return m.available}throw e}}))}static waitForLock(e){return n.__awaiter(this,void 0,void 0,(function*(){h(`waitForLock: Starting to wait for file "${e}"`);let t=undefined;let r=undefined;yield new Promise((o=>{r=t=>{if(t===e){o()}};t=setInterval((()=>n.__awaiter(this,void 0,void 0,(function*(){const t=yield this.checkLock(e);h(`waitForLock: Interval for file "${e}" with status "${t}"`);if(t===m.available){o()}}))),1e3*3);this.events.on(y.unlock,r)}));if(t){clearInterval(t)}if(r){this.events.removeListener(y.unlock,r)}h(`waitForLock: File became available "${e}"`);yield s.ensureAsync();const o=yield this.checkLock(e);h(`waitForLock: Lock File Status reassessment for file "${e}": ${o}`);switch(o){case m.lockedDifferent:case m.lockedSelf:return this.waitForLock(e);case m.available:return this.createLock(e);default:throw new p.UnknownLockfileStatus(o)}}))}static createLock(e){return n.__awaiter(this,void 0,void 0,(function*(){h(`createLock: trying to create a lock file for "${e}"`);const t=d.v4();try{yield this.mutex.runExclusive((()=>n.__awaiter(this,void 0,void 0,(function*(){if(this.files.has(e)){h(`createLock: Map already has file "${e}"`);throw new RepeatError(true)}yield c.default(a.dirname(e));yield l.promises.writeFile(e,`${process.pid.toString()} ${t}`);this.files.add(e);this.events.emit(y.lock,e)}))))}catch(t){if(t instanceof RepeatError&&t.repeat){return this.waitForLock(e)}}h(`createLock: Lock File Created for file "${e}"`);return new this(e,t)}))}unlock(){var e;return n.__awaiter(this,void 0,void 0,(function*(){yield s.ensureAsync();h(`unlock: Unlocking file "${this.file}"`);if(s.isNullOrUndefined(this.file)||((e=this.file)===null||e===void 0?void 0:e.length)<=0){h("unlock: invalid file, returning");return}switch(yield LockFile.checkLock(this.file,this.uuid)){case m.available:h(`unlock: Lock Status was already "available" for file "${this.file}"`);yield this.unlockCleanup(false);return;case m.availableInstance:h(`unlock: Lock Status was "availableInstance" for file "${this.file}"`);yield this.unlockCleanup(true);return;case m.lockedSelf:throw new Error(`Cannot unlock file "${this.file}", because it is not locked by this instance!`);default:throw new Error(`Cannot unlock Lock File "${this.file}" because it is not locked by this process!`)}}))}unlockCleanup(e=true){return n.__awaiter(this,void 0,void 0,(function*(){return yield LockFile.mutex.runExclusive((()=>n.__awaiter(this,void 0,void 0,(function*(){h(`unlockCleanup: for file "${this.file}"`);if(s.isNullOrUndefined(this.file)){return}if(e){yield l.promises.unlink(this.file).catch((e=>{h(`unlockCleanup: lock file unlink failed: "${e}"`)}))}LockFile.files.delete(this.file);LockFile.events.emit(y.unlock,this.file);this.file=undefined;this.uuid=undefined}))))}))}}t.LockFile=LockFile;LockFile.files=new Set;LockFile.events=new LockFileEventsClass;LockFile.mutex=new u.Mutex},8730:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.envToBool=t.envName=t.resolveConfig=t.findPackageJson=t.setDefaultValue=t.defaultValues=t.ENV_CONFIG_PREFIX=t.ResolveConfigVariables=void 0;const n=r(4351);const o=n.__importDefault(r(1362));const s=r(1156);const i=n.__importDefault(r(8237));const a=n.__importStar(r(5622));const c=r(5747);const l=i.default("MongoMS:ResolveConfig");var u;(function(e){e["DOWNLOAD_DIR"]="DOWNLOAD_DIR";e["PLATFORM"]="PLATFORM";e["ARCH"]="ARCH";e["VERSION"]="VERSION";e["DEBUG"]="DEBUG";e["DOWNLOAD_MIRROR"]="DOWNLOAD_MIRROR";e["DOWNLOAD_URL"]="DOWNLOAD_URL";e["PREFER_GLOBAL_PATH"]="PREFER_GLOBAL_PATH";e["DISABLE_POSTINSTALL"]="DISABLE_POSTINSTALL";e["SYSTEM_BINARY"]="SYSTEM_BINARY";e["MD5_CHECK"]="MD5_CHECK";e["ARCHIVE_NAME"]="ARCHIVE_NAME";e["RUNTIME_DOWNLOAD"]="RUNTIME_DOWNLOAD";e["USE_HTTP"]="USE_HTTP"})(u=t.ResolveConfigVariables||(t.ResolveConfigVariables={}));t.ENV_CONFIG_PREFIX="MONGOMS_";t.defaultValues=new Map([[u.VERSION,"4.0.25"],[u.PREFER_GLOBAL_PATH,"true"],[u.RUNTIME_DOWNLOAD,"true"],[u.USE_HTTP,"false"]]);function setDefaultValue(e,r){t.defaultValues.set(e,r)}t.setDefaultValue=setDefaultValue;let d={};function findPackageJson(e){var t,r,n;let i;for(const o of s.findSync(e||process.cwd())){l(`findPackageJson: Found package.json at "${o}"`);const e=JSON.parse(c.readFileSync(o).toString());if(Object.keys((r=(t=e===null||e===void 0?void 0:e.config)===null||t===void 0?void 0:t.mongodbMemoryServer)!==null&&r!==void 0?r:{}).length>0){l(`findPackageJson: Found package with non-empty config field at "${o}"`);d=(n=e===null||e===void 0?void 0:e.config)===null||n===void 0?void 0:n.mongodbMemoryServer;break}}if(i){const e=o.default(u.DOWNLOAD_DIR);const t=o.default(u.SYSTEM_BINARY);if(e in d){d[e]=a.resolve(a.dirname(i),d[e])}if(t in d){d[t]=a.resolve(a.dirname(i),d[t])}}return d}t.findPackageJson=findPackageJson;function resolveConfig(e){var r,n,s;return(s=(n=(r=process.env[envName(e)])!==null&&r!==void 0?r:d[o.default(e)])!==null&&n!==void 0?n:t.defaultValues.get(e))===null||s===void 0?void 0:s.toString()}t.resolveConfig=resolveConfig;t.default=resolveConfig;function envName(e){return`${t.ENV_CONFIG_PREFIX}${e}`}t.envName=envName;function envToBool(e=""){if(typeof e!=="string"){l("envToBool: input was not an string!");return false}return["1","on","yes","true"].indexOf(e.toLowerCase())!==-1}t.envToBool=envToBool;if(envToBool(resolveConfig(u.DEBUG))){i.default.enable("MongoMS:*")}findPackageJson()},1978:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ManagerAdvanced=t.ManagerBase=t.tryReleaseFile=t.pathExists=t.statPath=t.authDefault=t.ensureAsync=t.isAlive=t.killProcess=t.assertion=t.isNullOrUndefined=t.uriTemplate=t.getHost=t.generateDbName=void 0;const n=r(4351);const o=n.__importDefault(r(8237));const s=r(5747);const i=o.default("MongoMS:utils");function generateDbName(e){return e||""}t.generateDbName=generateDbName;function getHost(e){return e.replace(/(?:^mongodb:\/{2})|(?:\/.*$)|(?:.*@)/gim,"")}t.getHost=getHost;function uriTemplate(e,t,r,n){const o=!isNullOrUndefined(t)?`${e}:${t}`:e;return`mongodb://${o}/${r}`+(!isNullOrUndefined(n)?`?${n.join("&")}`:"")}t.uriTemplate=uriTemplate;function isNullOrUndefined(e){return e===null||e===undefined}t.isNullOrUndefined=isNullOrUndefined;function assertion(e,t){if(!e){throw t!==null&&t!==void 0?t:new Error("Assert failed - no custom error")}}t.assertion=assertion;function killProcess(e,t){return n.__awaiter(this,void 0,void 0,(function*(){if(!isAlive(e.pid)){i("killProcess: given childProcess's PID was not alive anymore");return}const r=1e3*10;yield new Promise(((n,s)=>{let a=setTimeout((()=>{i("killProcess: timeout triggered, trying SIGKILL");if(!o.default.enabled("MongoMS:utils")){console.warn('An Process didnt exit with signal "SIGINT" within 10 seconds, using "SIGKILL"!\n'+"Enable debug logs for more information")}e.kill("SIGKILL");a=setTimeout((()=>{i("killProcess: timeout triggered again, rejecting");s(new Error(`Process "${t}" didnt exit, enable debug for more information.`))}),r)}),r);e.once(`exit`,((e,r)=>{i(`killProcess: ${t}: got exit signal, Code: ${e}, Signal: ${r}`);clearTimeout(a);n()}));i(`killProcess: ${t}: sending "SIGINT"`);e.kill("SIGINT")}))}))}t.killProcess=killProcess;function isAlive(e){try{process.kill(e,0);return true}catch(e){return false}}t.isAlive=isAlive;function ensureAsync(){return n.__awaiter(this,void 0,void 0,(function*(){return new Promise((e=>process.nextTick(e)))}))}t.ensureAsync=ensureAsync;function authDefault(e){return Object.assign({force:false,disable:false,customRootName:"mongodb-memory-server-root",customRootPwd:"rootuser",extraUsers:[]},e)}t.authDefault=authDefault;function statPath(e){return n.__awaiter(this,void 0,void 0,(function*(){return s.promises.stat(e).catch((e=>{if(e.code==="ENOENT"){return undefined}throw e}))}))}t.statPath=statPath;function pathExists(e){return n.__awaiter(this,void 0,void 0,(function*(){return!isNullOrUndefined(yield statPath(e))}))}t.pathExists=pathExists;function tryReleaseFile(e,t){return n.__awaiter(this,void 0,void 0,(function*(){try{const r=yield s.promises.readFile(e);return t(r.toString())}catch(t){if(t.code!=="ENOENT"){throw t}i(`tryReleaseFile: "${e}" does not exist`);return undefined}}))}t.tryReleaseFile=tryReleaseFile;class ManagerBase{}t.ManagerBase=ManagerBase;class ManagerAdvanced extends ManagerBase{}t.ManagerAdvanced=ManagerAdvanced},5517:(e,t,r)=>{"use strict";const n=r(3994);const o=r(2138);const s=r(1545).connect;s.MongoError=n.MongoError;s.MongoNetworkError=n.MongoNetworkError;s.MongoTimeoutError=n.MongoTimeoutError;s.MongoServerSelectionError=n.MongoServerSelectionError;s.MongoParseError=n.MongoParseError;s.MongoWriteConcernError=n.MongoWriteConcernError;s.MongoBulkWriteError=r(4239).BulkWriteError;s.BulkWriteError=s.MongoBulkWriteError;s.Admin=r(3238);s.MongoClient=r(1545);s.Db=r(6662);s.Collection=r(5193);s.Server=r(8421);s.ReplSet=r(382);s.Mongos=r(2048);s.ReadPreference=n.ReadPreference;s.GridStore=r(9406);s.Chunk=r(3890);s.Logger=n.Logger;s.AggregationCursor=r(7429);s.CommandCursor=r(538);s.Cursor=r(7159);s.GridFSBucket=r(2573);s.CoreServer=n.Server;s.CoreConnection=n.Connection;s.Binary=n.BSON.Binary;s.Code=n.BSON.Code;s.Map=n.BSON.Map;s.DBRef=n.BSON.DBRef;s.Double=n.BSON.Double;s.Int32=n.BSON.Int32;s.Long=n.BSON.Long;s.MinKey=n.BSON.MinKey;s.MaxKey=n.BSON.MaxKey;s.ObjectID=n.BSON.ObjectID;s.ObjectId=n.BSON.ObjectID;s.Symbol=n.BSON.Symbol;s.Timestamp=n.BSON.Timestamp;s.BSONRegExp=n.BSON.BSONRegExp;s.Decimal128=n.BSON.Decimal128;s.connect=s;s.instrument=function(e,t){if(typeof e==="function"){t=e;e={}}const r=new o;r.instrument(s.MongoClient,t);return r};e.exports=s},3238:(e,t,r)=>{"use strict";const n=r(1371).applyWriteConcern;const o=r(7057);const s=r(1681);const i=r(1969);const a=r(9263);const c=r(9929);const l=r(2548);function Admin(e,t,r){if(!(this instanceof Admin))return new Admin(e,t);this.s={db:e,topology:t,promiseLibrary:r}}Admin.prototype.command=function(e,t,r){const n=Array.prototype.slice.call(arguments,1);r=typeof n[n.length-1]==="function"?n.pop():undefined;t=n.length?n.shift():{};const o=new s(this.s.db,e,t);return l(this.s.db.s.topology,o,r)};Admin.prototype.buildInfo=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r={buildinfo:1};const n=new s(this.s.db,r,e);return l(this.s.db.s.topology,n,t)};Admin.prototype.serverInfo=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r={buildinfo:1};const n=new s(this.s.db,r,e);return l(this.s.db.s.topology,n,t)};Admin.prototype.serverStatus=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=new s(this.s.db,{serverStatus:1},e);return l(this.s.db.s.topology,r,t)};Admin.prototype.ping=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r={ping:1};const n=new s(this.s.db,r,e);return l(this.s.db.s.topology,n,t)};Admin.prototype.addUser=function(e,t,r,s){const i=Array.prototype.slice.call(arguments,2);s=typeof i[i.length-1]==="function"?i.pop():undefined;if(typeof e==="string"&&t!=null&&typeof t==="object"){r=t;t=null}r=i.length?i.shift():{};r=Object.assign({},r);r=n(r,{db:this.s.db});r.dbName="admin";const a=new o(this.s.db,e,t,r);return l(this.s.db.s.topology,a,s)};Admin.prototype.removeUser=function(e,t,r){const o=Array.prototype.slice.call(arguments,1);r=typeof o[o.length-1]==="function"?o.pop():undefined;t=o.length?o.shift():{};t=Object.assign({},t);t=n(t,{db:this.s.db});t.dbName="admin";const s=new i(this.s.db,e,t);return l(this.s.db.s.topology,s,r)};Admin.prototype.validateCollection=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};const n=new a(this,e,t);return l(this.s.db.s.topology,n,r)};Admin.prototype.listDatabases=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};return l(this.s.db.s.topology,new c(this.s.db,e),t)};Admin.prototype.replSetGetStatus=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=new s(this.s.db,{replSetGetStatus:1},e);return l(this.s.db.s.topology,r,t)};e.exports=Admin},7429:(e,t,r)=>{"use strict";const n=r(3994).MongoError;const o=r(7159);const s=r(4847).CursorState;class AggregationCursor extends o{constructor(e,t,r){super(e,t,r)}batchSize(e){if(this.s.state===s.CLOSED||this.isDead()){throw n.create({message:"Cursor is closed",driver:true})}if(typeof e!=="number"){throw n.create({message:"batchSize requires an integer",driver:true})}this.operation.options.batchSize=e;this.setCursorBatchSize(e);return this}geoNear(e){this.operation.addToPipeline({$geoNear:e});return this}group(e){this.operation.addToPipeline({$group:e});return this}limit(e){this.operation.addToPipeline({$limit:e});return this}match(e){this.operation.addToPipeline({$match:e});return this}maxTimeMS(e){this.operation.options.maxTimeMS=e;return this}out(e){this.operation.addToPipeline({$out:e});return this}project(e){this.operation.addToPipeline({$project:e});return this}lookup(e){this.operation.addToPipeline({$lookup:e});return this}redact(e){this.operation.addToPipeline({$redact:e});return this}skip(e){this.operation.addToPipeline({$skip:e});return this}sort(e){this.operation.addToPipeline({$sort:e});return this}unwind(e){this.operation.addToPipeline({$unwind:e});return this}getLogger(){return this.logger}}AggregationCursor.prototype.get=AggregationCursor.prototype.toArray;e.exports=AggregationCursor},2138:(e,t,r)=>{"use strict";const n=r(8614).EventEmitter;class Instrumentation extends n{constructor(){super()}instrument(e,t){this.$MongoClient=e;const r=this.$prototypeConnect=e.prototype.connect;const n=this;e.prototype.connect=function(e){this.s.options.monitorCommands=true;this.on("commandStarted",(e=>n.emit("started",e)));this.on("commandSucceeded",(e=>n.emit("succeeded",e)));this.on("commandFailed",(e=>n.emit("failed",e)));return r.call(this,e)};if(typeof t==="function")t(null,this)}uninstrument(){this.$MongoClient.prototype.connect=this.$prototypeConnect}}e.exports=Instrumentation},1749:(e,t)=>{"use strict";function asyncIterator(){const e=this;return{next:function(){return Promise.resolve().then((()=>e.next())).then((t=>{if(!t){return e.close().then((()=>({value:t,done:true})))}return{value:t,done:false}}))}}}t.asyncIterator=asyncIterator},4239:(e,t,r)=>{"use strict";const n=r(3994).BSON.Long;const o=r(3994).MongoError;const s=r(3994).BSON.ObjectID;const i=r(3994).BSON;const a=r(3994).MongoWriteConcernError;const c=r(1371).emitWarningOnce;const l=r(1371).toError;const u=r(1371).handleCallback;const d=r(1371).applyRetryableWrites;const p=r(1371).applyWriteConcern;const h=r(1371).executeLegacyOperation;const m=r(1371).isPromiseLike;const y=r(1371).hasAtomicOperators;const g=r(1178).maxWireVersion;const v=64;const b=1;const S=2;const w=3;const _=new i([i.Binary,i.Code,i.DBRef,i.Decimal128,i.Double,i.Int32,i.Long,i.Map,i.MaxKey,i.MinKey,i.ObjectId,i.BSONRegExp,i.Symbol,i.Timestamp]);class Batch{constructor(e,t){this.originalZeroIndex=t;this.currentIndex=0;this.originalIndexes=[];this.batchType=e;this.operations=[];this.size=0;this.sizeBytes=0}}const E=Symbol("upsertedIds");const O=Symbol("insertedIds");class BulkWriteResult{constructor(e){this.result=e;this[E]=undefined;this[O]=undefined}get insertedCount(){return typeof this.result.nInserted!=="number"?0:this.result.nInserted}get matchedCount(){return typeof this.result.nMatched!=="number"?0:this.result.nMatched}get modifiedCount(){return typeof this.result.nModified!=="number"?0:this.result.nModified}get deletedCount(){return typeof this.result.nRemoved!=="number"?0:this.result.nRemoved}get upsertedCount(){return!this.result.upserted?0:this.result.upserted.length}get upsertedIds(){if(this[E]){return this[E]}this[E]={};for(const e of this.result.upserted||[]){this[E][e.index]=e._id}return this[E]}get insertedIds(){if(this[O]){return this[O]}this[O]={};for(const e of this.result.insertedIds||[]){this[O][e.index]=e._id}return this[O]}get n(){return this.result.insertedCount}get ok(){return this.result.ok}get nInserted(){return this.result.nInserted}get nUpserted(){return this.result.nUpserted}get nMatched(){return this.result.nMatched}get nModified(){return this.result.nModified}get nRemoved(){return this.result.nRemoved}getInsertedIds(){return this.result.insertedIds}getUpsertedIds(){return this.result.upserted}getUpsertedIdAt(e){return this.result.upserted[e]}getRawResponse(){return this.result}hasWriteErrors(){return this.result.writeErrors.length>0}getWriteErrorCount(){return this.result.writeErrors.length}getWriteErrorAt(e){if(e<this.result.writeErrors.length){return this.result.writeErrors[e]}return null}getWriteErrors(){return this.result.writeErrors}getLastOp(){return this.result.lastOp}getWriteConcernError(){if(this.result.writeConcernErrors.length===0){return null}else if(this.result.writeConcernErrors.length===1){return this.result.writeConcernErrors[0]}else{let e="";for(let t=0;t<this.result.writeConcernErrors.length;t++){const r=this.result.writeConcernErrors[t];e=e+r.errmsg;if(t===0)e=e+" and "}return new WriteConcernError({errmsg:e,code:v})}}toJSON(){return this.result}toString(){return`BulkWriteResult(${this.toJSON(this.result)})`}isOk(){return this.result.ok===1}}class WriteConcernError{constructor(e){this.err=e}get code(){return this.err.code}get errmsg(){return this.err.errmsg}toJSON(){return{code:this.err.code,errmsg:this.err.errmsg}}toString(){return`WriteConcernError(${this.err.errmsg})`}}class WriteError{constructor(e){this.err=e}get code(){return this.err.code}get index(){return this.err.index}get errmsg(){return this.err.errmsg}getOperation(){return this.err.op}toJSON(){return{code:this.err.code,index:this.err.index,errmsg:this.err.errmsg,op:this.err.op}}toString(){return`WriteError(${JSON.stringify(this.toJSON())})`}}function mergeBatchResults(e,t,r,o){if(r){o=r}else if(o&&o.result){o=o.result}else if(o==null){return}if(o.ok===0&&t.ok===1){t.ok=0;const r={index:0,code:o.code||0,errmsg:o.message,op:e.operations[0]};t.writeErrors.push(new WriteError(r));return}else if(o.ok===0&&t.ok===0){return}if(o.opTime||o.lastOp){const e=o.lastOp||o.opTime;let r=null;let s=null;if(e&&e._bsontype==="Timestamp"){if(t.lastOp==null){t.lastOp=e}else if(e.greaterThan(t.lastOp)){t.lastOp=e}}else{if(t.lastOp){r=typeof t.lastOp.ts==="number"?n.fromNumber(t.lastOp.ts):t.lastOp.ts;s=typeof t.lastOp.t==="number"?n.fromNumber(t.lastOp.t):t.lastOp.t}const o=typeof e.ts==="number"?n.fromNumber(e.ts):e.ts;const i=typeof e.t==="number"?n.fromNumber(e.t):e.t;if(t.lastOp==null){t.lastOp=e}else if(o.greaterThan(r)){t.lastOp=e}else if(o.equals(r)){if(i.greaterThan(s)){t.lastOp=e}}}}if(e.batchType===b&&o.n){t.nInserted=t.nInserted+o.n}if(e.batchType===w&&o.n){t.nRemoved=t.nRemoved+o.n}let s=0;if(Array.isArray(o.upserted)){s=o.upserted.length;for(let r=0;r<o.upserted.length;r++){t.upserted.push({index:o.upserted[r].index+e.originalZeroIndex,_id:o.upserted[r]._id})}}else if(o.upserted){s=1;t.upserted.push({index:e.originalZeroIndex,_id:o.upserted})}if(e.batchType===S&&o.n){const e=o.nModified;t.nUpserted=t.nUpserted+s;t.nMatched=t.nMatched+(o.n-s);if(typeof e==="number"){t.nModified=t.nModified+e}else{t.nModified=null}}if(Array.isArray(o.writeErrors)){for(let r=0;r<o.writeErrors.length;r++){const n={index:e.originalIndexes[o.writeErrors[r].index],code:o.writeErrors[r].code,errmsg:o.writeErrors[r].errmsg,op:e.operations[o.writeErrors[r].index]};t.writeErrors.push(new WriteError(n))}}if(o.writeConcernError){t.writeConcernErrors.push(new WriteConcernError(o.writeConcernError))}}function executeCommands(e,t,r){if(e.s.batches.length===0){return u(r,null,new BulkWriteResult(e.s.bulkResult))}const n=e.s.batches.shift();function resultHandler(o,s){if((o&&o.driver||o&&o.message)&&!(o instanceof a)){return u(r,o)}if(o)o.ok=0;if(o instanceof a){return handleMongoWriteConcernError(n,e.s.bulkResult,o,r)}const i=new BulkWriteResult(e.s.bulkResult);const c=mergeBatchResults(n,e.s.bulkResult,o,s);if(c!=null){return u(r,null,i)}if(e.handleWriteError(r,i))return;executeCommands(e,t,r)}e.finalOptionsHandler({options:t,batch:n,resultHandler:resultHandler},r)}function handleMongoWriteConcernError(e,t,r,n){mergeBatchResults(e,t,null,r.result);const o=new WriteConcernError({errmsg:r.result.writeConcernError.errmsg,code:r.result.writeConcernError.result});return u(n,new BulkWriteError(l(o),new BulkWriteResult(t)),null)}class BulkWriteError extends o{constructor(e,t){const r=e.err||e.errmsg||e.errMessage||e;super(r);Object.assign(this,e);this.name="BulkWriteError";this.result=t}get insertedCount(){return this.result.insertedCount}get matchedCount(){return this.result.matchedCount}get modifiedCount(){return this.result.modifiedCount}get deletedCount(){return this.result.deletedCount}get upsertedCount(){return this.result.upsertedCount}get insertedIds(){return this.result.insertedIds}get upsertedIds(){return this.result.upsertedIds}}class FindOperators{constructor(e){this.s=e.s}update(e){const t=typeof this.s.currentOp.upsert==="boolean"?this.s.currentOp.upsert:false;const r={q:this.s.currentOp.selector,u:e,multi:true,upsert:t};if(e.hint){r.hint=e.hint}this.s.currentOp=null;return this.s.options.addToOperationsList(this,S,r)}updateOne(e){const t=typeof this.s.currentOp.upsert==="boolean"?this.s.currentOp.upsert:false;const r={q:this.s.currentOp.selector,u:e,multi:false,upsert:t};if(e.hint){r.hint=e.hint}if(!y(e)){throw new TypeError("Update document requires atomic operators")}this.s.currentOp=null;return this.s.options.addToOperationsList(this,S,r)}replaceOne(e){const t=typeof this.s.currentOp.upsert==="boolean"?this.s.currentOp.upsert:false;const r={q:this.s.currentOp.selector,u:e,multi:false,upsert:t};if(e.hint){r.hint=e.hint}if(y(e)){throw new TypeError("Replacement document must not use atomic operators")}this.s.currentOp=null;return this.s.options.addToOperationsList(this,S,r)}upsert(){this.s.currentOp.upsert=true;return this}deleteOne(){const e={q:this.s.currentOp.selector,limit:1};this.s.currentOp=null;return this.s.options.addToOperationsList(this,w,e)}delete(){const e={q:this.s.currentOp.selector,limit:0};this.s.currentOp=null;return this.s.options.addToOperationsList(this,w,e)}removeOne(){c("bulk operation `removeOne` has been deprecated, please use `deleteOne`");return this.deleteOne()}remove(){c("bulk operation `remove` has been deprecated, please use `delete`");return this.delete()}}class BulkOperationBase{constructor(e,t,r,n){this.isOrdered=n;r=r==null?{}:r;const o=t.s.namespace;const s=false;const i=null;const a=e.bson;const c=e.lastIsMaster();const l=!!(e.s.options&&e.s.options.autoEncrypter);const u=c&&c.maxBsonObjectSize?c.maxBsonObjectSize:1024*1024*16;const h=l?1024*1024*2:u;const m=c&&c.maxWriteBatchSize?c.maxWriteBatchSize:1e3;const y=(m-1).toString(10).length+2;let g=Object.assign({},r);g=d(g,t.s.db);g=p(g,{collection:t},r);const v=g.writeConcern;const b=r.promiseLibrary||Promise;const S={ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]};this.s={bulkResult:S,currentBatch:null,currentIndex:0,currentBatchSize:0,currentBatchSizeBytes:0,currentInsertBatch:null,currentUpdateBatch:null,currentRemoveBatch:null,batches:[],writeConcern:v,maxBsonObjectSize:u,maxBatchSizeBytes:h,maxWriteBatchSize:m,maxKeySize:y,namespace:o,bson:a,topology:e,options:g,currentOp:i,executed:s,collection:t,promiseLibrary:b,err:null,checkKeys:typeof r.checkKeys==="boolean"?r.checkKeys:true};if(r.bypassDocumentValidation===true){this.s.bypassDocumentValidation=true}}insert(e){if(this.s.collection.s.db.options.forceServerObjectId!==true&&e._id==null)e._id=new s;return this.s.options.addToOperationsList(this,b,e)}find(e){if(!e){throw l("Bulk find operation must specify a selector")}this.s.currentOp={selector:e};return new FindOperators(this)}raw(e){const t=Object.keys(e)[0];const r=typeof this.s.options.forceServerObjectId==="boolean"?this.s.options.forceServerObjectId:this.s.collection.s.db.options.forceServerObjectId;if(e.updateOne&&e.updateOne.q||e.updateMany&&e.updateMany.q||e.replaceOne&&e.replaceOne.q){e[t].multi=e.updateOne||e.replaceOne?false:true;return this.s.options.addToOperationsList(this,S,e[t])}if(e.updateOne||e.updateMany||e.replaceOne){if(e.replaceOne&&y(e[t].replacement)){throw new TypeError("Replacement document must not use atomic operators")}else if((e.updateOne||e.updateMany)&&!y(e[t].update)){throw new TypeError("Update document requires atomic operators")}const r=e.updateOne||e.replaceOne?false:true;const n={q:e[t].filter,u:e[t].update||e[t].replacement,multi:r};if(e[t].hint){n.hint=e[t].hint}if(this.isOrdered){n.upsert=e[t].upsert?true:false;if(e.collation)n.collation=e.collation}else{if(e[t].upsert)n.upsert=true}if(e[t].arrayFilters){if(g(this.s.topology)<6){throw new TypeError("arrayFilters are only supported on MongoDB 3.6+")}n.arrayFilters=e[t].arrayFilters}return this.s.options.addToOperationsList(this,S,n)}if(e.removeOne||e.removeMany||e.deleteOne&&e.deleteOne.q||e.deleteMany&&e.deleteMany.q){e[t].limit=e.removeOne?1:0;return this.s.options.addToOperationsList(this,w,e[t])}if(e.deleteOne||e.deleteMany){const r=e.deleteOne?1:0;const n={q:e[t].filter,limit:r};if(e[t].hint){n.hint=e[t].hint}if(this.isOrdered){if(e.collation)n.collation=e.collation}return this.s.options.addToOperationsList(this,w,n)}if(e.insertOne&&e.insertOne.document==null){if(r!==true&&e.insertOne._id==null)e.insertOne._id=new s;return this.s.options.addToOperationsList(this,b,e.insertOne)}else if(e.insertOne&&e.insertOne.document){if(r!==true&&e.insertOne.document._id==null)e.insertOne.document._id=new s;return this.s.options.addToOperationsList(this,b,e.insertOne.document)}if(e.insertMany){c("bulk operation `insertMany` has been deprecated; use multiple `insertOne` ops instead");for(let t=0;t<e.insertMany.length;t++){if(r!==true&&e.insertMany[t]._id==null)e.insertMany[t]._id=new s;this.s.options.addToOperationsList(this,b,e.insertMany[t])}return}throw l("bulkWrite only supports insertOne, insertMany, updateOne, updateMany, removeOne, removeMany, deleteOne, deleteMany")}_handleEarlyError(e,t){if(typeof t==="function"){t(e,null);return}return this.s.promiseLibrary.reject(e)}bulkExecute(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};if(typeof e==="function"){r=e}else if(e&&typeof e==="object"){this.s.writeConcern=e}if(this.s.executed){const e=l("batch cannot be re-executed");return this._handleEarlyError(e,r)}if(this.isOrdered){if(this.s.currentBatch)this.s.batches.push(this.s.currentBatch)}else{if(this.s.currentInsertBatch)this.s.batches.push(this.s.currentInsertBatch);if(this.s.currentUpdateBatch)this.s.batches.push(this.s.currentUpdateBatch);if(this.s.currentRemoveBatch)this.s.batches.push(this.s.currentRemoveBatch)}if(this.s.batches.length===0){const e=l("Invalid Operation, no operations specified");return this._handleEarlyError(e,r)}return{options:t,callback:r}}execute(e,t,r){const n=this.bulkExecute(e,t,r);if(!n||m(n)){return n}t=n.options;r=n.callback;return h(this.s.topology,executeCommands,[this,t,r])}finalOptionsHandler(e,t){const r=Object.assign({ordered:this.isOrdered},e.options);if(this.s.writeConcern!=null){r.writeConcern=this.s.writeConcern}if(r.bypassDocumentValidation!==true){delete r.bypassDocumentValidation}if(this.operationId){e.resultHandler.operationId=this.operationId}if(this.s.options.serializeFunctions){r.serializeFunctions=true}if(this.s.options.ignoreUndefined){r.ignoreUndefined=true}if(this.s.bypassDocumentValidation===true){r.bypassDocumentValidation=true}if(this.s.checkKeys===false){r.checkKeys=false}if(r.retryWrites){if(e.batch.batchType===S){r.retryWrites=r.retryWrites&&!e.batch.operations.some((e=>e.multi))}if(e.batch.batchType===w){r.retryWrites=r.retryWrites&&!e.batch.operations.some((e=>e.limit===0))}}try{if(e.batch.batchType===b){this.s.topology.insert(this.s.namespace,e.batch.operations,r,e.resultHandler)}else if(e.batch.batchType===S){this.s.topology.update(this.s.namespace,e.batch.operations,r,e.resultHandler)}else if(e.batch.batchType===w){this.s.topology.remove(this.s.namespace,e.batch.operations,r,e.resultHandler)}}catch(r){r.ok=0;u(t,null,mergeBatchResults(e.batch,this.s.bulkResult,r,null))}}handleWriteError(e,t){if(this.s.bulkResult.writeErrors.length>0){const r=this.s.bulkResult.writeErrors[0].errmsg?this.s.bulkResult.writeErrors[0].errmsg:"write operation failed";u(e,new BulkWriteError(l({message:r,code:this.s.bulkResult.writeErrors[0].code,writeErrors:this.s.bulkResult.writeErrors}),t),null);return true}if(t.getWriteConcernError()){u(e,new BulkWriteError(l(t.getWriteConcernError()),t),null);return true}}}Object.defineProperty(BulkOperationBase.prototype,"length",{enumerable:true,get:function(){return this.s.currentIndex}});e.exports={Batch:Batch,BulkOperationBase:BulkOperationBase,bson:_,INSERT:b,UPDATE:S,REMOVE:w,BulkWriteError:BulkWriteError,BulkWriteResult:BulkWriteResult}},5035:(e,t,r)=>{"use strict";const n=r(4239);const o=n.BulkOperationBase;const s=n.Batch;const i=n.bson;const a=r(1371);const c=a.toError;function addToOperationsList(e,t,r){const o=i.calculateObjectSize(r,{checkKeys:false,ignoreUndefined:false});if(o>=e.s.maxBsonObjectSize)throw c("document is larger than the maximum size "+e.s.maxBsonObjectSize);if(e.s.currentBatch==null)e.s.currentBatch=new s(t,e.s.currentIndex);const a=e.s.maxKeySize;if(e.s.currentBatchSize+1>=e.s.maxWriteBatchSize||e.s.currentBatchSize>0&&e.s.currentBatchSizeBytes+a+o>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t){e.s.batches.push(e.s.currentBatch);e.s.currentBatch=new s(t,e.s.currentIndex);e.s.currentBatchSize=0;e.s.currentBatchSizeBytes=0}if(t===n.INSERT){e.s.bulkResult.insertedIds.push({index:e.s.currentIndex,_id:r._id})}if(Array.isArray(r)){throw c("operation passed in cannot be an Array")}e.s.currentBatch.originalIndexes.push(e.s.currentIndex);e.s.currentBatch.operations.push(r);e.s.currentBatchSize+=1;e.s.currentBatchSizeBytes+=a+o;e.s.currentIndex+=1;return e}class OrderedBulkOperation extends o{constructor(e,t,r){r=r||{};r=Object.assign(r,{addToOperationsList:addToOperationsList});super(e,t,r,true)}}function initializeOrderedBulkOp(e,t,r){return new OrderedBulkOperation(e,t,r)}initializeOrderedBulkOp.OrderedBulkOperation=OrderedBulkOperation;e.exports=initializeOrderedBulkOp;e.exports.Bulk=OrderedBulkOperation},325:(e,t,r)=>{"use strict";const n=r(4239);const o=n.BulkOperationBase;const s=n.Batch;const i=n.bson;const a=r(1371);const c=a.toError;function addToOperationsList(e,t,r){const o=i.calculateObjectSize(r,{checkKeys:false,ignoreUndefined:false});if(o>=e.s.maxBsonObjectSize)throw c("document is larger than the maximum size "+e.s.maxBsonObjectSize);e.s.currentBatch=null;if(t===n.INSERT){e.s.currentBatch=e.s.currentInsertBatch}else if(t===n.UPDATE){e.s.currentBatch=e.s.currentUpdateBatch}else if(t===n.REMOVE){e.s.currentBatch=e.s.currentRemoveBatch}const a=e.s.maxKeySize;if(e.s.currentBatch==null)e.s.currentBatch=new s(t,e.s.currentIndex);if(e.s.currentBatch.size+1>=e.s.maxWriteBatchSize||e.s.currentBatch.size>0&&e.s.currentBatch.sizeBytes+a+o>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t){e.s.batches.push(e.s.currentBatch);e.s.currentBatch=new s(t,e.s.currentIndex)}if(Array.isArray(r)){throw c("operation passed in cannot be an Array")}e.s.currentBatch.operations.push(r);e.s.currentBatch.originalIndexes.push(e.s.currentIndex);e.s.currentIndex=e.s.currentIndex+1;if(t===n.INSERT){e.s.currentInsertBatch=e.s.currentBatch;e.s.bulkResult.insertedIds.push({index:e.s.bulkResult.insertedIds.length,_id:r._id})}else if(t===n.UPDATE){e.s.currentUpdateBatch=e.s.currentBatch}else if(t===n.REMOVE){e.s.currentRemoveBatch=e.s.currentBatch}e.s.currentBatch.size+=1;e.s.currentBatch.sizeBytes+=a+o;return e}class UnorderedBulkOperation extends o{constructor(e,t,r){r=r||{};r=Object.assign(r,{addToOperationsList:addToOperationsList});super(e,t,r,false)}handleWriteError(e,t){if(this.s.batches.length){return false}return super.handleWriteError(e,t)}}function initializeUnorderedBulkOp(e,t,r){return new UnorderedBulkOperation(e,t,r)}initializeUnorderedBulkOp.UnorderedBulkOperation=UnorderedBulkOperation;e.exports=initializeUnorderedBulkOp;e.exports.Bulk=UnorderedBulkOperation},1117:(e,t,r)=>{"use strict";const n=r(2342);const o=r(8614);const s=r(9386).isResumableError;const i=r(3994).MongoError;const a=r(7159);const c=r(1178).relayEvents;const l=r(1178).maxWireVersion;const u=r(1371).maybePromise;const d=r(1371).now;const p=r(1371).calculateDurationInMs;const h=r(1554);const m=Symbol("resumeQueue");const y=["resumeAfter","startAfter","startAtOperationTime","fullDocument"];const g=["batchSize","maxAwaitTimeMS","collation","readPreference"].concat(y);const v={COLLECTION:Symbol("Collection"),DATABASE:Symbol("Database"),CLUSTER:Symbol("Cluster")};class ChangeStream extends o{constructor(e,t,o){super();const s=r(5193);const i=r(6662);const a=r(1545);this.pipeline=t||[];this.options=o||{};this.parent=e;this.namespace=e.s.namespace;if(e instanceof s){this.type=v.COLLECTION;this.topology=e.s.db.serverConfig}else if(e instanceof i){this.type=v.DATABASE;this.topology=e.serverConfig}else if(e instanceof a){this.type=v.CLUSTER;this.topology=e.topology}else{throw new TypeError("parent provided to ChangeStream constructor is not an instance of Collection, Db, or MongoClient")}this.promiseLibrary=e.s.promiseLibrary;if(!this.options.readPreference&&e.s.readPreference){this.options.readPreference=e.s.readPreference}this[m]=new n;this.cursor=createChangeStreamCursor(this,o);this.closed=false;this.on("newListener",(e=>{if(e==="change"&&this.cursor&&this.listenerCount("change")===0){this.cursor.on("data",(e=>processNewChange(this,e)))}}));this.on("removeListener",(e=>{if(e==="change"&&this.listenerCount("change")===0&&this.cursor){this.cursor.removeAllListeners("data")}}))}get resumeToken(){return this.cursor.resumeToken}hasNext(e){return u(this.parent,e,(e=>{getCursor(this,((t,r)=>{if(t)return e(t);r.hasNext(e)}))}))}next(e){return u(this.parent,e,(e=>{getCursor(this,((t,r)=>{if(t)return e(t);r.next(((t,r)=>{if(t){this[m].push((()=>this.next(e)));processError(this,t,e);return}processNewChange(this,r,e)}))}))}))}isClosed(){return this.closed||this.cursor&&this.cursor.isClosed()}close(e){return u(this.parent,e,(e=>{if(this.closed)return e();this.closed=true;if(!this.cursor)return e();const t=this.cursor;return t.close((r=>{["data","close","end","error"].forEach((e=>t.removeAllListeners(e)));this.cursor=undefined;return e(r)}))}))}pipe(e,t){if(!this.pipeDestinations){this.pipeDestinations=[]}this.pipeDestinations.push(e);return this.cursor.pipe(e,t)}unpipe(e){if(this.pipeDestinations&&this.pipeDestinations.indexOf(e)>-1){this.pipeDestinations.splice(this.pipeDestinations.indexOf(e),1)}return this.cursor.unpipe(e)}stream(e){this.streamOptions=e;return this.cursor.stream(e)}pause(){return this.cursor.pause()}resume(){return this.cursor.resume()}}class ChangeStreamCursor extends a{constructor(e,t,r){super(e,t,r);r=r||{};this._resumeToken=null;this.startAtOperationTime=r.startAtOperationTime;if(r.startAfter){this.resumeToken=r.startAfter}else if(r.resumeAfter){this.resumeToken=r.resumeAfter}}set resumeToken(e){this._resumeToken=e;this.emit("resumeTokenChanged",e)}get resumeToken(){return this._resumeToken}get resumeOptions(){const e={};for(const t of g){if(this.options[t])e[t]=this.options[t]}if(this.resumeToken||this.startAtOperationTime){["resumeAfter","startAfter","startAtOperationTime"].forEach((t=>delete e[t]));if(this.resumeToken){const t=this.options.startAfter&&!this.hasReceived?"startAfter":"resumeAfter";e[t]=this.resumeToken}else if(this.startAtOperationTime&&l(this.server)>=7){e.startAtOperationTime=this.startAtOperationTime}}return e}cacheResumeToken(e){if(this.bufferedCount()===0&&this.cursorState.postBatchResumeToken){this.resumeToken=this.cursorState.postBatchResumeToken}else{this.resumeToken=e}this.hasReceived=true}_processBatch(e,t){const r=t.cursor;if(r.postBatchResumeToken){this.cursorState.postBatchResumeToken=r.postBatchResumeToken;if(r[e].length===0){this.resumeToken=r.postBatchResumeToken}}}_initializeCursor(e){super._initializeCursor(((t,r)=>{if(t||r==null){e(t,r);return}const n=r.documents[0];if(this.startAtOperationTime==null&&this.resumeAfter==null&&this.startAfter==null&&l(this.server)>=7){this.startAtOperationTime=n.operationTime}this._processBatch("firstBatch",n);this.emit("init",r);this.emit("response");e(t,r)}))}_getMore(e){super._getMore(((t,r)=>{if(t){e(t);return}this._processBatch("nextBatch",r);this.emit("more",r);this.emit("response");e(t,r)}))}}function createChangeStreamCursor(e,t){const r={fullDocument:t.fullDocument||"default"};applyKnownOptions(r,t,y);if(e.type===v.CLUSTER){r.allChangesForCluster=true}const n=[{$changeStream:r}].concat(e.pipeline);const o=applyKnownOptions({},t,g);const s=new ChangeStreamCursor(e.topology,new h(e.parent,n,t),o);c(s,e,["resumeTokenChanged","end","close"]);if(e.listenerCount("change")>0){s.on("data",(function(t){processNewChange(e,t)}))}s.on("error",(function(t){processError(e,t)}));if(e.pipeDestinations){const t=s.stream(e.streamOptions);for(let r of e.pipeDestinations){t.pipe(r)}}return s}function applyKnownOptions(e,t,r){r.forEach((r=>{if(t[r]){e[r]=t[r]}}));return e}const b=3e4;function waitForTopologyConnected(e,t,r){setTimeout((()=>{if(t&&t.start==null){t.start=d()}const n=t.start||d();const o=t.timeout||b;const s=t.readPreference;if(e.isConnected({readPreference:s})){return r()}if(p(n)>o){return r(new i("Timed out waiting for connection"))}waitForTopologyConnected(e,t,r)}),500)}function processNewChange(e,t,r){const n=e.cursor;if(t==null){e.closed=true}if(e.closed){if(r)r(new i("ChangeStream is closed"));return}if(t&&!t._id){const t=new Error("A change stream document has been received that lacks a resume token (_id).");if(!r)return e.emit("error",t);return r(t)}n.cacheResumeToken(t._id);e.options.startAtOperationTime=undefined;if(!r)return e.emit("change",t);return r(undefined,t)}function processError(e,t,r){const n=e.topology;const o=e.cursor;if(e.closed){if(r)r(new i("ChangeStream is closed"));return}function resumeWithCursor(t){e.cursor=t;processResumeQueue(e)}function unresumableError(t){if(!r){e.emit("error",t);e.emit("close")}processResumeQueue(e,t);e.closed=true}if(o&&s(t,l(o.server))){e.cursor=undefined;["data","close","end","error"].forEach((e=>o.removeAllListeners(e)));o.close();waitForTopologyConnected(n,{readPreference:o.options.readPreference},(t=>{if(t)return unresumableError(t);const n=createChangeStreamCursor(e,o.resumeOptions);if(!r)return resumeWithCursor(n);n.hasNext((e=>{if(e)return unresumableError(e);resumeWithCursor(n)}))}));return}if(!r)return e.emit("error",t);return r(t)}function getCursor(e,t){if(e.isClosed()){t(new i("ChangeStream is closed."));return}if(e.cursor){t(undefined,e.cursor);return}e[m].push(t)}function processResumeQueue(e,t){while(e[m].length){const r=e[m].pop();if(e.isClosed()&&!t){r(new i("Change Stream is not open."));return}r(t,e.cursor)}}e.exports=ChangeStream},9820:(e,t,r)=>{"use strict";const n=r(8614);const o=r(2425);const s=r(3111).MongoError;const i=r(3111).MongoNetworkError;const a=r(3111).MongoNetworkTimeoutError;const c=r(3111).MongoWriteConcernError;const l=r(2337);const u=r(6292).StreamDescription;const d=r(9206);const p=r(9815);const h=r(5474).updateSessionFromResponse;const m=r(1178).uuidV4;const y=r(1371).now;const g=r(1371).calculateDurationInMs;const v=Symbol("stream");const b=Symbol("queue");const S=Symbol("messageStream");const w=Symbol("generation");const _=Symbol("lastUseTime");const E=Symbol("clusterTime");const O=Symbol("description");const C=Symbol("ismaster");const T=Symbol("autoEncrypter");class Connection extends n{constructor(e,t){super(t);this.id=t.id;this.address=streamIdentifier(e);this.bson=t.bson;this.socketTimeout=typeof t.socketTimeout==="number"?t.socketTimeout:0;this.host=t.host||"localhost";this.port=t.port||27017;this.monitorCommands=typeof t.monitorCommands==="boolean"?t.monitorCommands:false;this.closed=false;this.destroyed=false;this[O]=new u(this.address,t);this[w]=t.generation;this[_]=y();if(t.autoEncrypter){this[T]=t.autoEncrypter}this[b]=new Map;this[S]=new o(t);this[S].on("message",messageHandler(this));this[v]=e;e.on("error",(()=>{}));this[S].on("error",(e=>this.handleIssue({destroy:e})));e.on("close",(()=>this.handleIssue({isClose:true})));e.on("timeout",(()=>this.handleIssue({isTimeout:true,destroy:true})));e.pipe(this[S]);this[S].pipe(e)}get description(){return this[O]}get ismaster(){return this[C]}set ismaster(e){this[O].receiveResponse(e);this[C]=e}get generation(){return this[w]||0}get idleTime(){return g(this[_])}get clusterTime(){return this[E]}get stream(){return this[v]}markAvailable(){this[_]=y()}handleIssue(e){if(this.closed){return}if(e.destroy){this[v].destroy(typeof e.destroy==="boolean"?undefined:e.destroy)}this.closed=true;for(const t of this[b]){const r=t[1];if(e.isTimeout){r.cb(new a(`connection ${this.id} to ${this.address} timed out`,{beforeHandshake:this.ismaster==null}))}else if(e.isClose){r.cb(new i(`connection ${this.id} to ${this.address} closed`))}else{r.cb(typeof e.destroy==="boolean"?undefined:e.destroy)}}this[b].clear();this.emit("close")}destroy(e,t){if(typeof e==="function"){t=e;e={}}e=Object.assign({force:false},e);if(this[v]==null||this.destroyed){this.destroyed=true;if(typeof t==="function"){t()}return}if(e.force){this[v].destroy();this.destroyed=true;if(typeof t==="function"){t()}return}this[v].end((e=>{this.destroyed=true;if(typeof t==="function"){t(e)}}))}command(e,t,r,n){d.command(makeServerTrampoline(this),e,t,r,n)}query(e,t,r,n,o){d.query(makeServerTrampoline(this),e,t,r,n,o)}getMore(e,t,r,n,o){d.getMore(makeServerTrampoline(this),e,t,r,n,o)}killCursors(e,t,r){d.killCursors(makeServerTrampoline(this),e,t,r)}insert(e,t,r,n){d.insert(makeServerTrampoline(this),e,t,r,n)}update(e,t,r,n){d.update(makeServerTrampoline(this),e,t,r,n)}remove(e,t,r,n){d.remove(makeServerTrampoline(this),e,t,r,n)}}function makeServerTrampoline(e){const t={description:e.description,clusterTime:e[E],s:{bson:e.bson,pool:{write:write.bind(e),isConnected:()=>true}}};if(e[T]){t.autoEncrypter=e[T]}return t}function messageHandler(e){return function messageHandler(t){e.emit("message",t);if(!e[b].has(t.responseTo)){return}const r=e[b].get(t.responseTo);const n=r.cb;e[b].delete(t.responseTo);if(t.moreToCome){e[b].set(t.requestId,r)}else if(r.socketTimeoutOverride){e[v].setTimeout(e.socketTimeout)}try{t.parse(r)}catch(e){n(new s(e));return}if(t.documents[0]){const o=t.documents[0];const i=r.session;if(i){h(i,o)}if(o.$clusterTime){e[E]=o.$clusterTime;e.emit("clusterTimeReceived",o.$clusterTime)}if(r.command){if(o.writeConcernError){n(new c(o.writeConcernError,o));return}if(o.ok===0||o.$err||o.errmsg||o.code){n(new s(o));return}}}n(undefined,new l(r.fullResult?t:t.documents[0],e,t))}}function streamIdentifier(e){if(typeof e.address==="function"){return`${e.remoteAddress}:${e.remotePort}`}return m().toString("hex")}function write(e,t,r){if(typeof t==="function"){r=t}t=t||{};const n={requestId:e.requestId,cb:r,session:t.session,fullResult:typeof t.fullResult==="boolean"?t.fullResult:false,noResponse:typeof t.noResponse==="boolean"?t.noResponse:false,documentsReturnedIn:t.documentsReturnedIn,command:!!t.command,promoteLongs:typeof t.promoteLongs==="boolean"?t.promoteLongs:true,promoteValues:typeof t.promoteValues==="boolean"?t.promoteValues:true,promoteBuffers:typeof t.promoteBuffers==="boolean"?t.promoteBuffers:false,raw:typeof t.raw==="boolean"?t.raw:false};if(this[O]&&this[O].compressor){n.agreedCompressor=this[O].compressor;if(this[O].zlibCompressionLevel){n.zlibCompressionLevel=this[O].zlibCompressionLevel}}if(typeof t.socketTimeout==="number"){n.socketTimeoutOverride=true;this[v].setTimeout(t.socketTimeout)}if(this.monitorCommands){this.emit("commandStarted",new p.CommandStartedEvent(this,e));n.started=y();n.cb=(t,o)=>{if(t){this.emit("commandFailed",new p.CommandFailedEvent(this,e,t,n.started))}else{if(o&&o.result&&(o.result.ok===0||o.result.$err)){this.emit("commandFailed",new p.CommandFailedEvent(this,e,o.result,n.started))}else{this.emit("commandSucceeded",new p.CommandSucceededEvent(this,e,o,n.started))}}if(typeof r==="function"){r(t,o)}}}if(!n.noResponse){this[b].set(n.requestId,n)}try{this[S].writeCommand(e,n)}catch(e){if(!n.noResponse){this[b].delete(n.requestId);n.cb(e);return}}if(n.noResponse){n.cb()}}e.exports={Connection:Connection}},2529:(e,t,r)=>{"use strict";const n=r(2342);const o=r(8614).EventEmitter;const s=r(104);const i=r(1371).makeCounter;const a=r(3111).MongoError;const c=r(9820).Connection;const l=r(1178).eachAsync;const u=r(6573);const d=r(1178).relayEvents;const p=r(2926);const h=p.PoolClosedError;const m=p.WaitQueueTimeoutError;const y=r(897);const g=y.ConnectionPoolCreatedEvent;const v=y.ConnectionPoolClosedEvent;const b=y.ConnectionCreatedEvent;const S=y.ConnectionReadyEvent;const w=y.ConnectionClosedEvent;const _=y.ConnectionCheckOutStartedEvent;const E=y.ConnectionCheckOutFailedEvent;const O=y.ConnectionCheckedOutEvent;const C=y.ConnectionCheckedInEvent;const T=y.ConnectionPoolClearedEvent;const I=Symbol("logger");const k=Symbol("connections");const A=Symbol("permits");const N=Symbol("minPoolSizeTimer");const R=Symbol("generation");const M=Symbol("connectionCounter");const D=Symbol("cancellationToken");const P=Symbol("waitQueue");const L=Symbol("cancelled");const B=new Set(["ssl","bson","connectionType","monitorCommands","socketTimeout","credentials","compression","host","port","localAddress","localPort","family","hints","lookup","path","ca","cert","sigalgs","ciphers","clientCertEngine","crl","dhparam","ecdhCurve","honorCipherOrder","key","privateKeyEngine","privateKeyIdentifier","maxVersion","minVersion","passphrase","pfx","secureOptions","secureProtocol","sessionIdContext","allowHalfOpen","rejectUnauthorized","pskCallback","ALPNProtocols","servername","checkServerIdentity","session","minDHSize","secureContext","maxPoolSize","minPoolSize","maxIdleTimeMS","waitQueueTimeoutMS"]);function resolveOptions(e,t){const r=Array.from(B).reduce(((t,r)=>{if(Object.prototype.hasOwnProperty.call(e,r)){t[r]=e[r]}return t}),{});return Object.freeze(Object.assign({},t,r))}class ConnectionPool extends o{constructor(e){super();e=e||{};this.closed=false;this.options=resolveOptions(e,{connectionType:c,maxPoolSize:typeof e.maxPoolSize==="number"?e.maxPoolSize:100,minPoolSize:typeof e.minPoolSize==="number"?e.minPoolSize:0,maxIdleTimeMS:typeof e.maxIdleTimeMS==="number"?e.maxIdleTimeMS:0,waitQueueTimeoutMS:typeof e.waitQueueTimeoutMS==="number"?e.waitQueueTimeoutMS:0,autoEncrypter:e.autoEncrypter,metadata:e.metadata});if(e.minSize>e.maxSize){throw new TypeError("Connection pool minimum size must not be greater than maxiumum pool size")}this[I]=s("ConnectionPool",e);this[k]=new n;this[A]=this.options.maxPoolSize;this[N]=undefined;this[R]=0;this[M]=i(1);this[D]=new o;this[D].setMaxListeners(Infinity);this[P]=new n;process.nextTick((()=>{this.emit("connectionPoolCreated",new g(this));ensureMinPoolSize(this)}))}get address(){return`${this.options.host}:${this.options.port}`}get generation(){return this[R]}get totalConnectionCount(){return this[k].length+(this.options.maxPoolSize-this[A])}get availableConnectionCount(){return this[k].length}get waitQueueSize(){return this[P].length}checkOut(e){this.emit("connectionCheckOutStarted",new _(this));if(this.closed){this.emit("connectionCheckOutFailed",new E(this,"poolClosed"));e(new h(this));return}const t={callback:e};const r=this;const n=this.options.waitQueueTimeoutMS;if(n){t.timer=setTimeout((()=>{t[L]=true;t.timer=undefined;r.emit("connectionCheckOutFailed",new E(r,"timeout"));t.callback(new m(r))}),n)}this[P].push(t);process.nextTick((()=>processWaitQueue(this)))}checkIn(e){const t=this.closed;const r=connectionIsStale(this,e);const n=!!(t||r||e.closed);if(!n){e.markAvailable();this[k].push(e)}this.emit("connectionCheckedIn",new C(this,e));if(n){const r=e.closed?"error":t?"poolClosed":"stale";destroyConnection(this,e,r)}process.nextTick((()=>processWaitQueue(this)))}clear(){this[R]+=1;this.emit("connectionPoolCleared",new T(this))}close(e,t){if(typeof e==="function"){t=e}e=Object.assign({force:false},e);if(this.closed){return t()}this[D].emit("cancel");while(this.waitQueueSize){const e=this[P].pop();clearTimeout(e.timer);if(!e[L]){e.callback(new a("connection pool closed"))}}if(this[N]){clearTimeout(this[N])}if(typeof this[M].return==="function"){this[M].return()}this.closed=true;l(this[k].toArray(),((t,r)=>{this.emit("connectionClosed",new w(this,t,"poolClosed"));t.destroy(e,r)}),(e=>{this[k].clear();this.emit("connectionPoolClosed",new v(this));t(e)}))}withConnection(e,t){this.checkOut(((r,n)=>{e(r,n,((e,r)=>{if(typeof t==="function"){if(e){t(e)}else{t(undefined,r)}}if(n){this.checkIn(n)}}))}))}}function ensureMinPoolSize(e){if(e.closed||e.options.minPoolSize===0){return}const t=e.options.minPoolSize;for(let r=e.totalConnectionCount;r<t;++r){createConnection(e)}e[N]=setTimeout((()=>ensureMinPoolSize(e)),10)}function connectionIsStale(e,t){return t.generation!==e[R]}function connectionIsIdle(e,t){return!!(e.options.maxIdleTimeMS&&t.idleTime>e.options.maxIdleTimeMS)}function createConnection(e,t){const r=Object.assign({id:e[M].next().value,generation:e[R]},e.options);e[A]--;u(r,e[D],((r,n)=>{if(r){e[A]++;e[I].debug(`connection attempt failed with error [${JSON.stringify(r)}]`);if(typeof t==="function"){t(r)}return}if(e.closed){n.destroy({force:true});return}d(n,e,["commandStarted","commandFailed","commandSucceeded","clusterTimeReceived"]);e.emit("connectionCreated",new b(e,n));n.markAvailable();e.emit("connectionReady",new S(e,n));if(typeof t==="function"){t(undefined,n);return}e[k].push(n);process.nextTick((()=>processWaitQueue(e)))}))}function destroyConnection(e,t,r){e.emit("connectionClosed",new w(e,t,r));e[A]++;process.nextTick((()=>t.destroy()))}function processWaitQueue(e){if(e.closed){return}while(e.waitQueueSize){const t=e[P].peekFront();if(t[L]){e[P].shift();continue}if(!e.availableConnectionCount){break}const r=e[k].shift();const n=connectionIsStale(e,r);const o=connectionIsIdle(e,r);if(!n&&!o&&!r.closed){e.emit("connectionCheckedOut",new O(e,r));clearTimeout(t.timer);e[P].shift();t.callback(undefined,r);return}const s=r.closed?"error":n?"stale":"idle";destroyConnection(e,r,s)}const t=e.options.maxPoolSize;if(e.waitQueueSize&&(t<=0||e.totalConnectionCount<t)){createConnection(e,((t,r)=>{const n=e[P].shift();if(n==null||n[L]){if(t==null){e[k].push(r)}return}if(t){e.emit("connectionCheckOutFailed",new E(e,t))}else{e.emit("connectionCheckedOut",new O(e,r))}clearTimeout(n.timer);n.callback(t,r)}));return}}e.exports={ConnectionPool:ConnectionPool}},2926:(e,t,r)=>{"use strict";const n=r(3111).MongoError;class PoolClosedError extends n{constructor(e){super("Attempted to check out a connection from closed connection pool");this.name="MongoPoolClosedError";this.address=e.address}}class WaitQueueTimeoutError extends n{constructor(e){super("Timed out while checking out a connection from connection pool");this.name="MongoWaitQueueTimeoutError";this.address=e.address}}e.exports={PoolClosedError:PoolClosedError,WaitQueueTimeoutError:WaitQueueTimeoutError}},897:e=>{"use strict";class ConnectionPoolMonitoringEvent{constructor(e){this.time=new Date;this.address=e.address}}class ConnectionPoolCreatedEvent extends ConnectionPoolMonitoringEvent{constructor(e){super(e);this.options=e.options}}class ConnectionPoolClosedEvent extends ConnectionPoolMonitoringEvent{constructor(e){super(e)}}class ConnectionCreatedEvent extends ConnectionPoolMonitoringEvent{constructor(e,t){super(e);this.connectionId=t.id}}class ConnectionReadyEvent extends ConnectionPoolMonitoringEvent{constructor(e,t){super(e);this.connectionId=t.id}}class ConnectionClosedEvent extends ConnectionPoolMonitoringEvent{constructor(e,t,r){super(e);this.connectionId=t.id;this.reason=r||"unknown"}}class ConnectionCheckOutStartedEvent extends ConnectionPoolMonitoringEvent{constructor(e){super(e)}}class ConnectionCheckOutFailedEvent extends ConnectionPoolMonitoringEvent{constructor(e,t){super(e);this.reason=t}}class ConnectionCheckedOutEvent extends ConnectionPoolMonitoringEvent{constructor(e,t){super(e);this.connectionId=t.id}}class ConnectionCheckedInEvent extends ConnectionPoolMonitoringEvent{constructor(e,t){super(e);this.connectionId=t.id}}class ConnectionPoolClearedEvent extends ConnectionPoolMonitoringEvent{constructor(e){super(e)}}const t=["connectionPoolCreated","connectionPoolClosed","connectionCreated","connectionReady","connectionClosed","connectionCheckOutStarted","connectionCheckOutFailed","connectionCheckedOut","connectionCheckedIn","connectionPoolCleared"];e.exports={CMAP_EVENT_NAMES:t,ConnectionPoolCreatedEvent:ConnectionPoolCreatedEvent,ConnectionPoolClosedEvent:ConnectionPoolClosedEvent,ConnectionCreatedEvent:ConnectionCreatedEvent,ConnectionReadyEvent:ConnectionReadyEvent,ConnectionClosedEvent:ConnectionClosedEvent,ConnectionCheckOutStartedEvent:ConnectionCheckOutStartedEvent,ConnectionCheckOutFailedEvent:ConnectionCheckOutFailedEvent,ConnectionCheckedOutEvent:ConnectionCheckedOutEvent,ConnectionCheckedInEvent:ConnectionCheckedInEvent,ConnectionPoolClearedEvent:ConnectionPoolClearedEvent}},2425:(e,t,r)=>{"use strict";const n=r(2413).Duplex;const o=r(336);const s=r(3111).MongoParseError;const i=r(7793).decompress;const a=r(9814).Response;const c=r(8988).BinMsg;const l=r(3111).MongoError;const u=r(7272).opcodes.OP_COMPRESSED;const d=r(7272).opcodes.OP_MSG;const p=r(7272).MESSAGE_HEADER_SIZE;const h=r(7272).COMPRESSION_DETAILS_SIZE;const m=r(7272).opcodes;const y=r(7793).compress;const g=r(7793).compressorIDs;const v=r(7793).uncompressibleCommands;const b=r(8988).Msg;const S=1024*1024*16*4;const w=Symbol("buffer");class MessageStream extends n{constructor(e){e=e||{};super(e);this.bson=e.bson;this.maxBsonMessageSize=e.maxBsonMessageSize||S;this[w]=new o}_write(e,t,r){const n=this[w];n.append(e);processIncomingData(this,r)}_read(){return}writeCommand(e,t){const r=t&&!!t.agreedCompressor;if(!r||!canCompress(e)){const t=e.toBin();this.push(Array.isArray(t)?Buffer.concat(t):t);return}const n=Buffer.concat(e.toBin());const o=n.slice(p);const s=n.readInt32LE(12);y({options:t},o,((r,n)=>{if(r){t.cb(r,null);return}const i=Buffer.alloc(p);i.writeInt32LE(p+h+n.length,0);i.writeInt32LE(e.requestId,4);i.writeInt32LE(0,8);i.writeInt32LE(m.OP_COMPRESSED,12);const a=Buffer.alloc(h);a.writeInt32LE(s,0);a.writeInt32LE(o.length,4);a.writeUInt8(g[t.agreedCompressor],8);this.push(Buffer.concat([i,a,n]))}))}}function canCompress(e){const t=e instanceof b?e.command:e.query;const r=Object.keys(t)[0];return!v.has(r)}function processIncomingData(e,t){const r=e[w];if(r.length<4){t();return}const n=r.readInt32LE(0);if(n<0){t(new s(`Invalid message size: ${n}`));return}if(n>e.maxBsonMessageSize){t(new s(`Invalid message size: ${n}, max allowed: ${e.maxBsonMessageSize}`));return}if(n>r.length){t();return}const o=r.slice(0,n);r.consume(n);const h={length:o.readInt32LE(0),requestId:o.readInt32LE(4),responseTo:o.readInt32LE(8),opCode:o.readInt32LE(12)};let m=h.opCode===d?c:a;const y=e.responseOptions;if(h.opCode!==u){const n=o.slice(p);e.emit("message",new m(e.bson,o,h,n,y));if(r.length>=4){processIncomingData(e,t)}else{t()}return}h.fromCompressed=true;h.opCode=o.readInt32LE(p);h.length=o.readInt32LE(p+4);const g=o[p+8];const v=o.slice(p+9);m=h.opCode===d?c:a;i(g,v,((n,s)=>{if(n){t(n);return}if(s.length!==h.length){t(new l("Decompressing a compressed message from the server failed. The message is corrupt."));return}e.emit("message",new m(e.bson,o,h,s,y));if(r.length>=4){processIncomingData(e,t)}else{t()}}))}e.exports=MessageStream},6292:(e,t,r)=>{"use strict";const n=r(750).parseServerType;const o=["minWireVersion","maxWireVersion","maxBsonObjectSize","maxMessageSizeBytes","maxWriteBatchSize","__nodejs_mock_server__"];class StreamDescription{constructor(e,t){this.address=e;this.type=n(null);this.minWireVersion=undefined;this.maxWireVersion=undefined;this.maxBsonObjectSize=16777216;this.maxMessageSizeBytes=48e6;this.maxWriteBatchSize=1e5;this.compressors=t&&t.compression&&Array.isArray(t.compression.compressors)?t.compression.compressors:[]}receiveResponse(e){this.type=n(e);o.forEach((t=>{if(typeof e[t]!=="undefined"){this[t]=e[t]}}));if(e.compression){this.compressor=this.compressors.filter((t=>e.compression.indexOf(t)!==-1))[0]}}}e.exports={StreamDescription:StreamDescription}},5193:(e,t,r)=>{"use strict";const n=r(1669).deprecate;const o=r(1371).deprecateOptions;const s=r(1371).emitWarningOnce;const i=r(1371).checkCollectionName;const a=r(3994).BSON.ObjectID;const c=r(3994).MongoError;const l=r(1371).normalizeHintField;const u=r(1371).decorateCommand;const d=r(1371).decorateWithCollation;const p=r(1371).decorateWithReadConcern;const h=r(1371).formattedOrderClause;const m=r(3994).ReadPreference;const y=r(325);const g=r(5035);const v=r(1117);const b=r(1371).executeLegacyOperation;const S=r(2481);const w=r(7289);const _=r(1371).MongoDBNamespace;const E=r(7429);const O=r(538);const C=r(6716).ensureIndex;const T=r(6716).group;const I=r(6716).parallelCollectionScan;const k=r(2296).removeDocuments;const A=r(6716).save;const N=r(2296).updateDocuments;const R=r(1554);const M=r(6976);const D=r(5131);const P=r(6394);const L=r(323);const B=r(6352);const j=r(6469);const U=r(2360).DropCollectionOperation;const F=r(3560);const $=r(5328);const W=r(4451);const z=r(9961);const q=r(4497);const V=r(711);const G=r(5841);const Y=r(4316);const K=r(1925);const X=r(8169);const J=r(4218);const Z=r(7809);const Q=r(4245);const ee=r(3592);const te=r(9915);const re=r(4956);const ne=r(28);const oe=r(2779);const se=r(43);const ie=r(2808);const ae=r(6331);const ce=r(2508);const le=r(968);const ue=r(9350);const fe=r(9068);const de=r(2548);const pe=["ignoreUndefined"];function Collection(e,t,r,n,o,s){i(n);const c=null;const l=s==null||s.slaveOk==null?e.slaveOk:s.slaveOk;const u=s==null||s.serializeFunctions==null?e.s.options.serializeFunctions:s.serializeFunctions;const d=s==null||s.raw==null?e.s.options.raw:s.raw;const p=s==null||s.promoteLongs==null?e.s.options.promoteLongs:s.promoteLongs;const h=s==null||s.promoteValues==null?e.s.options.promoteValues:s.promoteValues;const y=s==null||s.promoteBuffers==null?e.s.options.promoteBuffers:s.promoteBuffers;const g=null;const v=new _(r,n);const b=s.promiseLibrary||Promise;o=o==null?a:o;this.s={pkFactory:o,db:e,topology:t,options:s,namespace:v,readPreference:m.fromOptions(s),slaveOk:l,serializeFunctions:u,raw:d,promoteLongs:p,promoteValues:h,promoteBuffers:y,internalHint:c,collectionHint:g,promiseLibrary:b,readConcern:w.fromOptions(s),writeConcern:S.fromOptions(s)}}Object.defineProperty(Collection.prototype,"dbName",{enumerable:true,get:function(){return this.s.namespace.db}});Object.defineProperty(Collection.prototype,"collectionName",{enumerable:true,get:function(){return this.s.namespace.collection}});Object.defineProperty(Collection.prototype,"namespace",{enumerable:true,get:function(){return this.s.namespace.toString()}});Object.defineProperty(Collection.prototype,"readConcern",{enumerable:true,get:function(){if(this.s.readConcern==null){return this.s.db.readConcern}return this.s.readConcern}});Object.defineProperty(Collection.prototype,"readPreference",{enumerable:true,get:function(){if(this.s.readPreference==null){return this.s.db.readPreference}return this.s.readPreference}});Object.defineProperty(Collection.prototype,"writeConcern",{enumerable:true,get:function(){if(this.s.writeConcern==null){return this.s.db.writeConcern}return this.s.writeConcern}});Object.defineProperty(Collection.prototype,"hint",{enumerable:true,get:function(){return this.s.collectionHint},set:function(e){this.s.collectionHint=l(e)}});const he=["maxScan","fields","snapshot","oplogReplay"];Collection.prototype.find=o({name:"collection.find",deprecatedOptions:he,optionsIndex:1},(function(e,t,r){if(typeof r==="object"){s("Third parameter to `find()` must be a callback or undefined")}let n=e;if(typeof r!=="function"){if(typeof t==="function"){r=t;t=undefined}else if(t==null){r=typeof n==="function"?n:undefined;n=typeof n==="object"?n:undefined}}n=n==null?{}:n;const o=n;if(Buffer.isBuffer(o)){const e=o[0]|o[1]<<8|o[2]<<16|o[3]<<24;if(e!==o.length){const t=new Error("query selector raw message size does not match message header size ["+o.length+"] != ["+e+"]");t.name="MongoError";throw t}}if(n!=null&&n._bsontype==="ObjectID"){n={_id:n}}if(!t)t={};let i=t.projection||t.fields;if(i&&!Buffer.isBuffer(i)&&Array.isArray(i)){i=i.length?i.reduce(((e,t)=>{e[t]=1;return e}),{}):{_id:1}}let a=Object.assign({},t);for(let e in this.s.options){if(pe.indexOf(e)!==-1){a[e]=this.s.options[e]}}a.skip=t.skip?t.skip:0;a.limit=t.limit?t.limit:0;a.raw=typeof t.raw==="boolean"?t.raw:this.s.raw;a.hint=t.hint!=null?l(t.hint):this.s.collectionHint;a.timeout=typeof t.timeout==="undefined"?undefined:t.timeout;a.slaveOk=t.slaveOk!=null?t.slaveOk:this.s.db.slaveOk;a.readPreference=m.resolve(this,a);if(a.readPreference!=null&&(a.readPreference!=="primary"||a.readPreference.mode!=="primary")){a.slaveOk=true}if(n!=null&&typeof n!=="object"){throw c.create({message:"query selector must be an object",driver:true})}const y={find:this.s.namespace.toString(),limit:a.limit,skip:a.skip,query:n};if(typeof t.allowDiskUse==="boolean"){y.allowDiskUse=t.allowDiskUse}if(typeof a.awaitdata==="boolean"){a.awaitData=a.awaitdata}if(typeof a.timeout==="boolean")a.noCursorTimeout=!a.timeout;u(y,a,["session","collation"]);if(i)y.fields=i;a.db=this.s.db;a.promiseLibrary=this.s.promiseLibrary;if(a.raw==null&&typeof this.s.raw==="boolean")a.raw=this.s.raw;if(a.promoteLongs==null&&typeof this.s.promoteLongs==="boolean")a.promoteLongs=this.s.promoteLongs;if(a.promoteValues==null&&typeof this.s.promoteValues==="boolean")a.promoteValues=this.s.promoteValues;if(a.promoteBuffers==null&&typeof this.s.promoteBuffers==="boolean")a.promoteBuffers=this.s.promoteBuffers;if(y.sort){y.sort=h(y.sort)}p(y,this,t);try{d(y,this,t)}catch(e){if(typeof r==="function")return r(e,null);throw e}const g=this.s.topology.cursor(new z(this,this.s.namespace,y,a),a);if(typeof r==="function"){r(null,g);return}return g}));Collection.prototype.insertOne=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};if(this.s.options.ignoreUndefined){t=Object.assign({},t);t.ignoreUndefined=this.s.options.ignoreUndefined}const n=new te(this,e,t);return de(this.s.topology,n,r)};Collection.prototype.insertMany=function(e,t,r){if(typeof t==="function")r=t,t={};t=t?Object.assign({},t):{ordered:true};const n=new ee(this,e,t);return de(this.s.topology,n,r)};Collection.prototype.bulkWrite=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{ordered:true};if(!Array.isArray(e)){throw c.create({message:"operations must be an array of documents",driver:true})}const n=new M(this,e,t);return de(this.s.topology,n,r)};Collection.prototype.insert=n((function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{ordered:false};e=!Array.isArray(e)?[e]:e;if(t.keepGoing===true){t.ordered=false}return this.insertMany(e,t,r)}),"collection.insert is deprecated. Use insertOne, insertMany or bulkWrite instead.");Collection.prototype.updateOne=function(e,t,r,n){if(typeof r==="function")n=r,r={};r=Object.assign({},r);if(this.s.options.ignoreUndefined){r=Object.assign({},r);r.ignoreUndefined=this.s.options.ignoreUndefined}return de(this.s.topology,new fe(this,e,t,r),n)};Collection.prototype.replaceOne=function(e,t,r,n){if(typeof r==="function")n=r,r={};r=Object.assign({},r);if(this.s.options.ignoreUndefined){r=Object.assign({},r);r.ignoreUndefined=this.s.options.ignoreUndefined}return de(this.s.topology,new ce(this,e,t,r),n)};Collection.prototype.updateMany=function(e,t,r,n){if(typeof r==="function")n=r,r={};r=Object.assign({},r);if(this.s.options.ignoreUndefined){r=Object.assign({},r);r.ignoreUndefined=this.s.options.ignoreUndefined}return de(this.s.topology,new ue(this,e,t,r),n)};Collection.prototype.update=n((function(e,t,r,n){if(typeof r==="function")n=r,r={};r=r||{};if(this.s.options.ignoreUndefined){r=Object.assign({},r);r.ignoreUndefined=this.s.options.ignoreUndefined}return b(this.s.topology,N,[this,e,t,r,n])}),"collection.update is deprecated. Use updateOne, updateMany, or bulkWrite instead.");Collection.prototype.deleteOne=function(e,t,r){if(typeof t==="function")r=t,t={};t=Object.assign({},t);if(this.s.options.ignoreUndefined){t=Object.assign({},t);t.ignoreUndefined=this.s.options.ignoreUndefined}const n=new B(this,e,t);return de(this.s.topology,n,r)};Collection.prototype.removeOne=Collection.prototype.deleteOne;Collection.prototype.deleteMany=function(e,t,r){if(typeof t==="function")r=t,t={};t=Object.assign({},t);if(this.s.options.ignoreUndefined){t=Object.assign({},t);t.ignoreUndefined=this.s.options.ignoreUndefined}const n=new L(this,e,t);return de(this.s.topology,n,r)};Collection.prototype.removeMany=Collection.prototype.deleteMany;Collection.prototype.remove=n((function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};if(this.s.options.ignoreUndefined){t=Object.assign({},t);t.ignoreUndefined=this.s.options.ignoreUndefined}return b(this.s.topology,k,[this,e,t,r])}),"collection.remove is deprecated. Use deleteOne, deleteMany, or bulkWrite instead.");Collection.prototype.save=n((function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};if(this.s.options.ignoreUndefined){t=Object.assign({},t);t.ignoreUndefined=this.s.options.ignoreUndefined}return b(this.s.topology,A,[this,e,t,r])}),"collection.save is deprecated. Use insertOne, insertMany, updateOne, or updateMany instead.");Collection.prototype.findOne=o({name:"collection.find",deprecatedOptions:he,optionsIndex:1},(function(e,t,r){if(typeof r==="object"){s("Third parameter to `findOne()` must be a callback or undefined")}if(typeof e==="function")r=e,e={},t={};if(typeof t==="function")r=t,t={};e=e||{};t=t||{};const n=new q(this,e,t);return de(this.s.topology,n,r)}));Collection.prototype.rename=function(e,t,r){if(typeof t==="function")r=t,t={};t=Object.assign({},t,{readPreference:m.PRIMARY});const n=new ie(this,e,t);return de(this.s.topology,n,r)};Collection.prototype.drop=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=new U(this.s.db,this.collectionName,e);return de(this.s.topology,r,t)};Collection.prototype.options=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=new se(this,e);return de(this.s.topology,r,t)};Collection.prototype.isCapped=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=new re(this,e);return de(this.s.topology,r,t)};Collection.prototype.createIndex=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};const n=new P(this,this.collectionName,e,t);return de(this.s.topology,n,r)};Collection.prototype.createIndexes=function(e,t,r){if(typeof t==="function")r=t,t={};t=t?Object.assign({},t):{};if(typeof t.maxTimeMS!=="number")delete t.maxTimeMS;const n=new P(this,this.collectionName,e,t);return de(this.s.topology,n,r)};Collection.prototype.dropIndex=function(e,t,r){const n=Array.prototype.slice.call(arguments,1);r=typeof n[n.length-1]==="function"?n.pop():undefined;t=n.length?n.shift()||{}:{};t.readPreference=m.PRIMARY;const o=new F(this,e,t);return de(this.s.topology,o,r)};Collection.prototype.dropIndexes=function(e,t){if(typeof e==="function")t=e,e={};e=e?Object.assign({},e):{};if(typeof e.maxTimeMS!=="number")delete e.maxTimeMS;const r=new $(this,e);return de(this.s.topology,r,t)};Collection.prototype.dropAllIndexes=n(Collection.prototype.dropIndexes,"collection.dropAllIndexes is deprecated. Use dropIndexes instead.");Collection.prototype.reIndex=n((function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=new ae(this,e);return de(this.s.topology,r,t)}),"collection.reIndex is deprecated. Use db.command instead.");Collection.prototype.listIndexes=function(e){const t=new O(this.s.topology,new ne(this,e),e);return t};Collection.prototype.ensureIndex=n((function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};return b(this.s.topology,C,[this,e,t,r])}),"collection.ensureIndex is deprecated. Use createIndexes instead.");Collection.prototype.indexExists=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};const n=new Z(this,e,t);return de(this.s.topology,n,r)};Collection.prototype.indexInformation=function(e,t){const r=Array.prototype.slice.call(arguments,0);t=typeof r[r.length-1]==="function"?r.pop():undefined;e=r.length?r.shift()||{}:{};const n=new Q(this.s.db,this.collectionName,e);return de(this.s.topology,n,t)};Collection.prototype.count=n((function(e,t,r){const n=Array.prototype.slice.call(arguments,0);r=typeof n[n.length-1]==="function"?n.pop():undefined;e=n.length?n.shift()||{}:{};t=n.length?n.shift()||{}:{};if(typeof t==="function")r=t,t={};t=t||{};return de(this.s.topology,new W(this,e,t),r)}),"collection.count is deprecated, and will be removed in a future version."+" Use Collection.countDocuments or Collection.estimatedDocumentCount instead");Collection.prototype.estimatedDocumentCount=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=new W(this,e);return de(this.s.topology,r,t)};Collection.prototype.countDocuments=function(e,t,r){const n=Array.prototype.slice.call(arguments,0);r=typeof n[n.length-1]==="function"?n.pop():undefined;e=n.length?n.shift()||{}:{};t=n.length?n.shift()||{}:{};const o=new D(this,e,t);return de(this.s.topology,o,r)};Collection.prototype.distinct=function(e,t,r,n){const o=Array.prototype.slice.call(arguments,1);n=typeof o[o.length-1]==="function"?o.pop():undefined;const s=o.length?o.shift()||{}:{};const i=o.length?o.shift()||{}:{};const a=new j(this,e,s,i);return de(this.s.topology,a,n)};Collection.prototype.indexes=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=new J(this,e);return de(this.s.topology,r,t)};Collection.prototype.stats=function(e,t){const r=Array.prototype.slice.call(arguments,0);t=typeof r[r.length-1]==="function"?r.pop():undefined;e=r.length?r.shift()||{}:{};const n=new le(this,e);return de(this.s.topology,n,t)};Collection.prototype.findOneAndDelete=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};if(this.s.options.ignoreUndefined){t=Object.assign({},t);t.ignoreUndefined=this.s.options.ignoreUndefined}return de(this.s.topology,new G(this,e,t),r)};Collection.prototype.findOneAndReplace=o({name:"collection.findOneAndReplace",deprecatedOptions:["returnOriginal"],optionsIndex:2},(function(e,t,r,n){if(typeof r==="function")n=r,r={};r=r||{};if(this.s.options.ignoreUndefined){r=Object.assign({},r);r.ignoreUndefined=this.s.options.ignoreUndefined}return de(this.s.topology,new Y(this,e,t,r),n)}));Collection.prototype.findOneAndUpdate=o({name:"collection.findOneAndUpdate",deprecatedOptions:["returnOriginal"],optionsIndex:2},(function(e,t,r,n){if(typeof r==="function")n=r,r={};r=r||{};if(this.s.options.ignoreUndefined){r=Object.assign({},r);r.ignoreUndefined=this.s.options.ignoreUndefined}return de(this.s.topology,new K(this,e,t,r),n)}));Collection.prototype.findAndModify=n(_findAndModify,"collection.findAndModify is deprecated. Use findOneAndUpdate, findOneAndReplace or findOneAndDelete instead.");Collection.prototype._findAndModify=_findAndModify;function _findAndModify(e,t,r,n,o){const s=Array.prototype.slice.call(arguments,1);o=typeof s[s.length-1]==="function"?s.pop():undefined;t=s.length?s.shift()||[]:[];r=s.length?s.shift():null;n=s.length?s.shift()||{}:{};n=Object.assign({},n);n.readPreference=m.PRIMARY;return de(this.s.topology,new V(this,e,t,r,n),o)}Collection.prototype.findAndRemove=n((function(e,t,r,n){const o=Array.prototype.slice.call(arguments,1);n=typeof o[o.length-1]==="function"?o.pop():undefined;t=o.length?o.shift()||[]:[];r=o.length?o.shift()||{}:{};r.remove=true;return de(this.s.topology,new V(this,e,t,null,r),n)}),"collection.findAndRemove is deprecated. Use findOneAndDelete instead.");Collection.prototype.aggregate=function(e,t,r){if(Array.isArray(e)){if(typeof t==="function"){r=t;t={}}if(t==null&&r==null){t={}}}else{const n=Array.prototype.slice.call(arguments,0);r=n.pop();const o=n[n.length-1];t=o&&(o.readPreference||o.explain||o.cursor||o.out||o.maxTimeMS||o.hint||o.allowDiskUse)?n.pop():{};e=n}const n=new E(this.s.topology,new R(this,e,t),t);if(typeof r==="function"){r(null,n);return}return n};Collection.prototype.watch=function(e,t){e=e||[];t=t||{};if(!Array.isArray(e)){t=e;e=[]}return new v(this,e,t)};Collection.prototype.parallelCollectionScan=n((function(e,t){if(typeof e==="function")t=e,e={numCursors:1};e.numCursors=e.numCursors||1;e.batchSize=e.batchSize||1e3;e=Object.assign({},e);e.readPreference=m.resolve(this,e);e.promiseLibrary=this.s.promiseLibrary;if(e.session){e.session=undefined}return b(this.s.topology,I,[this,e,t],{skipSessions:true})}),"parallelCollectionScan is deprecated in MongoDB v4.1");Collection.prototype.geoHaystackSearch=n((function(e,t,r,n){const o=Array.prototype.slice.call(arguments,2);n=typeof o[o.length-1]==="function"?o.pop():undefined;r=o.length?o.shift()||{}:{};const s=new X(this,e,t,r);return de(this.s.topology,s,n)}),"geoHaystackSearch is deprecated, and will be removed in a future version.");Collection.prototype.group=n((function(e,t,r,n,o,s,i,a){const c=Array.prototype.slice.call(arguments,3);a=typeof c[c.length-1]==="function"?c.pop():undefined;n=c.length?c.shift():null;o=c.length?c.shift():null;s=c.length?c.shift():null;i=c.length?c.shift()||{}:{};if(!(typeof o==="function")){s=o;o=null}if(!Array.isArray(e)&&e instanceof Object&&typeof e!=="function"&&!(e._bsontype==="Code")){e=Object.keys(e)}if(typeof n==="function"){n=n.toString()}if(typeof o==="function"){o=o.toString()}s=s==null?true:s;return b(this.s.topology,T,[this,e,t,r,n,o,s,i,a])}),"MongoDB 3.6 or higher no longer supports the group command. We recommend rewriting using the aggregation framework.");Collection.prototype.mapReduce=function(e,t,r,n){if("function"===typeof r)n=r,r={};if(null==r.out){throw new Error("the out option parameter must be defined, see mongodb docs for possible values")}if("function"===typeof e){e=e.toString()}if("function"===typeof t){t=t.toString()}if("function"===typeof r.finalize){r.finalize=r.finalize.toString()}const o=new oe(this,e,t,r);return de(this.s.topology,o,n)};Collection.prototype.initializeUnorderedBulkOp=function(e){e=e||{};if(e.ignoreUndefined==null){e.ignoreUndefined=this.s.options.ignoreUndefined}e.promiseLibrary=this.s.promiseLibrary;return y(this.s.topology,this,e)};Collection.prototype.initializeOrderedBulkOp=function(e){e=e||{};if(e.ignoreUndefined==null){e.ignoreUndefined=this.s.options.ignoreUndefined}e.promiseLibrary=this.s.promiseLibrary;return g(this.s.topology,this,e)};Collection.prototype.getLogger=function(){return this.s.db.s.logger};e.exports=Collection},538:(e,t,r)=>{"use strict";const n=r(3994).ReadPreference;const o=r(3994).MongoError;const s=r(7159);const i=r(4847).CursorState;class CommandCursor extends s{constructor(e,t,r,n){super(e,t,r,n)}setReadPreference(e){if(this.s.state===i.CLOSED||this.isDead()){throw o.create({message:"Cursor is closed",driver:true})}if(this.s.state!==i.INIT){throw o.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:true})}if(e instanceof n){this.options.readPreference=e}else if(typeof e==="string"){this.options.readPreference=new n(e)}else{throw new TypeError("Invalid read preference: "+e)}return this}batchSize(e){if(this.s.state===i.CLOSED||this.isDead()){throw o.create({message:"Cursor is closed",driver:true})}if(typeof e!=="number"){throw o.create({message:"batchSize requires an integer",driver:true})}if(this.cmd.cursor){this.cmd.cursor.batchSize=e}this.setCursorBatchSize(e);return this}maxTimeMS(e){if(this.topology.lastIsMaster().minWireVersion>2){this.cmd.maxTimeMS=e}return this}getLogger(){return this.logger}}CommandCursor.prototype.get=CommandCursor.prototype.toArray;e.exports=CommandCursor},147:e=>{"use strict";e.exports={SYSTEM_NAMESPACE_COLLECTION:"system.namespaces",SYSTEM_INDEX_COLLECTION:"system.indexes",SYSTEM_PROFILE_COLLECTION:"system.profile",SYSTEM_USER_COLLECTION:"system.users",SYSTEM_COMMAND_COLLECTION:"$cmd",SYSTEM_JS_COLLECTION:"system.js"}},557:e=>{"use strict";class AuthContext{constructor(e,t,r){this.connection=e;this.credentials=t;this.options=r}}class AuthProvider{constructor(e){this.bson=e}prepare(e,t,r){r(undefined,e)}auth(e,t){t(new TypeError("`auth` method must be overridden by subclass"))}}e.exports={AuthContext:AuthContext,AuthProvider:AuthProvider}},2192:(e,t,r)=>{"use strict";const n=r(4228);const o=r(7324);const s=r(8728);const i=r(2640);const a=r(864).ScramSHA1;const c=r(864).ScramSHA256;const l=r(8857);function defaultAuthProviders(e){return{"mongodb-aws":new l(e),mongocr:new n(e),x509:new o(e),plain:new s(e),gssapi:new i(e),"scram-sha-1":new a(e),"scram-sha-256":new c(e)}}e.exports={defaultAuthProviders:defaultAuthProviders}},2640:(e,t,r)=>{"use strict";const n=r(881);const o=r(557).AuthProvider;const s=r(1178).retrieveKerberos;const i=r(3111).MongoError;let a;class GSSAPI extends o{auth(e,t){const r=e.connection;const n=e.credentials;if(n==null)return t(new i("credentials required"));const o=n.username;function externalCommand(e,t){return r.command("$external.$cmd",e,t)}makeKerberosClient(e,((e,r)=>{if(e)return t(e);if(r==null)return t(new i("gssapi client missing"));r.step("",((e,n)=>{if(e)return t(e);externalCommand(saslStart(n),((e,n)=>{if(e)return t(e);const s=n.result;negotiate(r,10,s.payload,((e,n)=>{if(e)return t(e);externalCommand(saslContinue(n,s.conversationId),((e,n)=>{if(e)return t(e);const s=n.result;finalize(r,o,s.payload,((e,r)=>{if(e)return t(e);externalCommand({saslContinue:1,conversationId:s.conversationId,payload:r},((e,r)=>{if(e)return t(e);t(undefined,r)}))}))}))}))}))}))}))}}e.exports=GSSAPI;function makeKerberosClient(e,t){const r=e.options.host;const n=e.options.port;const o=e.credentials;if(!r||!n||!o){return t(new i(`Connection must specify: ${r?"host":""}, ${n?"port":""}, ${o?"host":"credentials"}.`))}if(a==null){try{a=s()}catch(e){return t(e)}}const c=o.username;const l=o.password;const u=o.mechanismProperties;const d=u["gssapiservicename"]||u["gssapiServiceName"]||"mongodb";performGssapiCanonicalizeHostName(r,u,((e,r)=>{if(e)return t(e);const n={};if(l!=null){Object.assign(n,{user:c,password:l})}a.initializeClient(`${d}${process.platform==="win32"?"/":"@"}${r}`,n,((e,r)=>{if(e)return t(new i(e));t(null,r)}))}))}function saslStart(e){return{saslStart:1,mechanism:"GSSAPI",payload:e,autoAuthorize:1}}function saslContinue(e,t){return{saslContinue:1,conversationId:t,payload:e}}function negotiate(e,t,r,n){e.step(r,((o,s)=>{if(o&&t===0)return n(o);if(o)return negotiate(e,t-1,r,n);n(undefined,s||"")}))}function finalize(e,t,r,n){e.unwrap(r,((r,o)=>{if(r)return n(r);e.wrap(o||"",{user:t},((e,t)=>{if(e)return n(e);n(undefined,t)}))}))}function performGssapiCanonicalizeHostName(e,t,r){const o=typeof t.gssapiCanonicalizeHostName==="boolean"?t.gssapiCanonicalizeHostName:false;if(!o)return r(undefined,e);n.resolveCname(e,((t,n)=>{if(t)return r(t);if(Array.isArray(n)&&n.length>0){return r(undefined,n[0])}r(undefined,e)}))}},2222:e=>{"use strict";function getDefaultAuthMechanism(e){if(e){if(Array.isArray(e.saslSupportedMechs)){return e.saslSupportedMechs.indexOf("SCRAM-SHA-256")>=0?"scram-sha-256":"scram-sha-1"}if(e.maxWireVersion>=3){return"scram-sha-1"}}return"mongocr"}class MongoCredentials{constructor(e){e=e||{};this.username=e.username;this.password=e.password;this.source=e.source||e.db;this.mechanism=e.mechanism||"default";this.mechanismProperties=e.mechanismProperties||{};if(/MONGODB-AWS/i.test(this.mechanism)){if(!this.username&&process.env.AWS_ACCESS_KEY_ID){this.username=process.env.AWS_ACCESS_KEY_ID}if(!this.password&&process.env.AWS_SECRET_ACCESS_KEY){this.password=process.env.AWS_SECRET_ACCESS_KEY}if(!this.mechanismProperties.AWS_SESSION_TOKEN&&process.env.AWS_SESSION_TOKEN){this.mechanismProperties.AWS_SESSION_TOKEN=process.env.AWS_SESSION_TOKEN}}Object.freeze(this.mechanismProperties);Object.freeze(this)}equals(e){return this.mechanism===e.mechanism&&this.username===e.username&&this.password===e.password&&this.source===e.source}resolveAuthMechanism(e){if(/DEFAULT/i.test(this.mechanism)){return new MongoCredentials({username:this.username,password:this.password,source:this.source,mechanism:getDefaultAuthMechanism(e),mechanismProperties:this.mechanismProperties})}return this}}e.exports={MongoCredentials:MongoCredentials}},4228:(e,t,r)=>{"use strict";const n=r(6417);const o=r(557).AuthProvider;class MongoCR extends o{auth(e,t){const r=e.connection;const o=e.credentials;const s=o.username;const i=o.password;const a=o.source;r.command(`${a}.$cmd`,{getnonce:1},((e,o)=>{let c=null;let l=null;if(e==null){const e=o.result;c=e.nonce;let t=n.createHash("md5");t.update(s+":mongo:"+i,"utf8");const r=t.digest("hex");t=n.createHash("md5");t.update(c+s+r,"utf8");l=t.digest("hex")}const u={authenticate:1,user:s,nonce:c,key:l};r.command(`${a}.$cmd`,u,t)}))}}e.exports=MongoCR},8857:(e,t,r)=>{"use strict";const n=r(557).AuthProvider;const o=r(2222).MongoCredentials;const s=r(3111).MongoError;const i=r(6417);const a=r(8605);const c=r(1178).maxWireVersion;const l=r(8835);let u;try{u=r(3847)}catch(e){}const d=110;const p="http://169.254.170.2";const h="http://169.254.169.254";const m="/latest/meta-data/iam/security-credentials";class MongoDBAWS extends n{auth(e,t){const r=e.connection;const n=e.credentials;if(c(r)<9){t(new s("MONGODB-AWS authentication requires MongoDB version 4.4 or later"));return}if(u==null){t(new s("MONGODB-AWS authentication requires the `aws4` module, please install it as a dependency of your project"));return}if(n.username==null){makeTempCredentials(n,((r,n)=>{if(r)return t(r);e.credentials=n;this.auth(e,t)}));return}const o=n.username;const a=n.password;const l=n.source;const p=n.mechanismProperties.AWS_SESSION_TOKEN;const h=this.bson;i.randomBytes(32,((e,n)=>{if(e){t(e);return}const i={saslStart:1,mechanism:"MONGODB-AWS",payload:h.serialize({r:n,p:d})};r.command(`${l}.$cmd`,i,((e,i)=>{if(e)return t(e);const c=i.result;const d=h.deserialize(c.payload.buffer);const m=d.h;const y=d.s.buffer;if(y.length!==64){t(new s(`Invalid server nonce length ${y.length}, expected 64`));return}if(y.compare(n,0,n.length,0,n.length)!==0){t(new s("Server nonce does not begin with client nonce"));return}if(m.length<1||m.length>255||m.indexOf("..")!==-1){t(new s(`Server returned an invalid host: "${m}"`));return}const g="Action=GetCallerIdentity&Version=2011-06-15";const v=u.sign({method:"POST",host:m,region:deriveRegion(d.h),service:"sts",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":g.length,"X-MongoDB-Server-Nonce":y.toString("base64"),"X-MongoDB-GS2-CB-Flag":"n"},path:"/",body:g},{accessKeyId:o,secretAccessKey:a,token:p});const b=v.headers.Authorization;const S=v.headers["X-Amz-Date"];const w={a:b,d:S};if(p){w.t=p}const _={saslContinue:1,conversationId:1,payload:h.serialize(w)};r.command(`${l}.$cmd`,_,(e=>{if(e)return t(e);t()}))}))}))}}function makeTempCredentials(e,t){function done(r){if(r.AccessKeyId==null||r.SecretAccessKey==null||r.Token==null){t(new s("Could not obtain temporary MONGODB-AWS credentials"));return}t(undefined,new o({username:r.AccessKeyId,password:r.SecretAccessKey,source:e.source,mechanism:"MONGODB-AWS",mechanismProperties:{AWS_SESSION_TOKEN:r.Token}}))}if(process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI){request(`${p}${process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI}`,((e,r)=>{if(e)return t(e);done(r)}));return}request(`${h}/latest/api/token`,{method:"PUT",json:false,headers:{"X-aws-ec2-metadata-token-ttl-seconds":30}},((e,r)=>{if(e)return t(e);request(`${h}/${m}`,{json:false,headers:{"X-aws-ec2-metadata-token":r}},((e,n)=>{if(e)return t(e);request(`${h}/${m}/${n}`,{headers:{"X-aws-ec2-metadata-token":r}},((e,r)=>{if(e)return t(e);done(r)}))}))}))}function deriveRegion(e){const t=e.split(".");if(t.length===1||t[1]==="amazonaws"){return"us-east-1"}return t[1]}function request(e,t,r){if(typeof t==="function"){r=t;t={}}t=Object.assign({method:"GET",timeout:1e4,json:true},l.parse(e),t);const n=a.request(t,(e=>{e.setEncoding("utf8");let n="";e.on("data",(e=>n+=e));e.on("end",(()=>{if(t.json===false){r(undefined,n);return}try{const e=JSON.parse(n);r(undefined,e)}catch(e){r(new s(`Invalid JSON response: "${n}"`))}}))}));n.on("error",(e=>r(e)));n.end()}e.exports=MongoDBAWS},8728:(e,t,r)=>{"use strict";const n=r(7746).retrieveBSON;const o=r(557).AuthProvider;const s=n();const i=s.Binary;class Plain extends o{auth(e,t){const r=e.connection;const n=e.credentials;const o=n.username;const s=n.password;const a=new i(`\0${o}\0${s}`);const c={saslStart:1,mechanism:"PLAIN",payload:a,autoAuthorize:1};r.command("$external.$cmd",c,t)}}e.exports=Plain},864:(e,t,r)=>{"use strict";const n=r(6417);const o=r(1867).Buffer;const s=r(7746).retrieveBSON;const i=r(3111).MongoError;const a=r(557).AuthProvider;const c=r(1371).emitWarning;const l=s();const u=l.Binary;let d;try{d=r(9178)}catch(e){}class ScramSHA extends a{constructor(e,t){super(e);this.cryptoMethod=t||"sha1"}prepare(e,t,r){const o=this.cryptoMethod;if(o==="sha256"&&d==null){c("Warning: no saslprep library specified. Passwords will not be sanitized")}n.randomBytes(24,((n,s)=>{if(n){return r(n)}Object.assign(t,{nonce:s});const i=t.credentials;const a=Object.assign({},e,{speculativeAuthenticate:Object.assign(makeFirstMessage(o,i,s),{db:i.source})});r(undefined,a)}))}auth(e,t){const r=e.response;if(r&&r.speculativeAuthenticate){continueScramConversation(this.cryptoMethod,r.speculativeAuthenticate,e,t);return}executeScram(this.cryptoMethod,e,t)}}function cleanUsername(e){return e.replace("=","=3D").replace(",","=2C")}function clientFirstMessageBare(e,t){return o.concat([o.from("n=","utf8"),o.from(e,"utf8"),o.from(",r=","utf8"),o.from(t.toString("base64"),"utf8")])}function makeFirstMessage(e,t,r){const n=cleanUsername(t.username);const s=e==="sha1"?"SCRAM-SHA-1":"SCRAM-SHA-256";return{saslStart:1,mechanism:s,payload:new u(o.concat([o.from("n,,","utf8"),clientFirstMessageBare(n,r)])),autoAuthorize:1,options:{skipEmptyExchange:true}}}function executeScram(e,t,r){const n=t.connection;const o=t.credentials;const s=t.nonce;const i=o.source;const a=makeFirstMessage(e,o,s);n.command(`${i}.$cmd`,a,((n,o)=>{const s=resolveError(n,o);if(s){return r(s)}continueScramConversation(e,o.result,t,r)}))}function continueScramConversation(e,t,r,n){const s=r.connection;const a=r.credentials;const c=r.nonce;const l=a.source;const p=cleanUsername(a.username);const h=a.password;let m;if(e==="sha256"){m=d?d(h):h}else{try{m=passwordDigest(p,h)}catch(e){return n(e)}}const y=o.isBuffer(t.payload)?new u(t.payload):t.payload;const g=parsePayload(y.value());const v=parseInt(g.i,10);if(v&&v<4096){n(new i(`Server returned an invalid iteration count ${v}`),false);return}const b=g.s;const S=g.r;if(S.startsWith("nonce")){n(new i(`Server returned an invalid nonce: ${S}`),false);return}const w=`c=biws,r=${S}`;const _=HI(m,o.from(b,"base64"),v,e);const E=HMAC(e,_,"Client Key");const O=HMAC(e,_,"Server Key");const C=H(e,E);const T=[clientFirstMessageBare(p,c),y.value().toString("base64"),w].join(",");const I=HMAC(e,C,T);const k=`p=${xor(E,I)}`;const A=[w,k].join(",");const N=HMAC(e,O,T);const R={saslContinue:1,conversationId:t.conversationId,payload:new u(o.from(A))};s.command(`${l}.$cmd`,R,((e,t)=>{const r=resolveError(e,t);if(r){return n(r)}const a=t.result;const c=parsePayload(a.payload.value());if(!compareDigest(o.from(c.v,"base64"),N)){n(new i("Server returned an invalid signature"));return}if(!a||a.done!==false){return n(r,a)}const u={saslContinue:1,conversationId:a.conversationId,payload:o.alloc(0)};s.command(`${l}.$cmd`,u,n)}))}function parsePayload(e){const t={};const r=e.split(",");for(let e=0;e<r.length;e++){const n=r[e].split("=");t[n[0]]=n[1]}return t}function passwordDigest(e,t){if(typeof e!=="string"){throw new i("username must be a string")}if(typeof t!=="string"){throw new i("password must be a string")}if(t.length===0){throw new i("password cannot be empty")}const r=n.createHash("md5");r.update(`${e}:mongo:${t}`,"utf8");return r.digest("hex")}function xor(e,t){if(!o.isBuffer(e)){e=o.from(e)}if(!o.isBuffer(t)){t=o.from(t)}const r=Math.max(e.length,t.length);const n=[];for(let o=0;o<r;o+=1){n.push(e[o]^t[o])}return o.from(n).toString("base64")}function H(e,t){return n.createHash(e).update(t).digest()}function HMAC(e,t,r){return n.createHmac(e,t).update(r).digest()}let p={};let h=0;function _hiCachePurge(){p={};h=0}const m={sha256:32,sha1:20};function HI(e,t,r,o){const s=[e,t.toString("base64"),r].join("_");if(p[s]!==undefined){return p[s]}const i=n.pbkdf2Sync(e,t,r,m[o],o);if(h>=200){_hiCachePurge()}p[s]=i;h+=1;return i}function compareDigest(e,t){if(e.length!==t.length){return false}if(typeof n.timingSafeEqual==="function"){return n.timingSafeEqual(e,t)}let r=0;for(let n=0;n<e.length;n++){r|=e[n]^t[n]}return r===0}function resolveError(e,t){if(e)return e;const r=t.result;if(r.$err||r.errmsg)return new i(r)}class ScramSHA1 extends ScramSHA{constructor(e){super(e,"sha1")}}class ScramSHA256 extends ScramSHA{constructor(e){super(e,"sha256")}}e.exports={ScramSHA1:ScramSHA1,ScramSHA256:ScramSHA256}},7324:(e,t,r)=>{"use strict";const n=r(557).AuthProvider;class X509 extends n{prepare(e,t,r){const n=t.credentials;Object.assign(e,{speculativeAuthenticate:x509AuthenticateCommand(n)});r(undefined,e)}auth(e,t){const r=e.connection;const n=e.credentials;const o=e.response;if(o.speculativeAuthenticate){return t()}r.command("$external.$cmd",x509AuthenticateCommand(n),t)}}function x509AuthenticateCommand(e){const t={authenticate:1,mechanism:"MONGODB-X509"};if(e.username){Object.assign(t,{user:e.username})}return t}e.exports=X509},9815:(e,t,r)=>{"use strict";const n=r(8988).Msg;const o=r(9814).KillCursor;const s=r(9814).GetMore;const i=r(1371).calculateDurationInMs;const a=new Set(["authenticate","saslStart","saslContinue","getnonce","createUser","updateUser","copydbgetnonce","copydbsaslstart","copydb"]);const extractCommandName=e=>Object.keys(e)[0];const namespace=e=>e.ns;const databaseName=e=>e.ns.split(".")[0];const collectionName=e=>e.ns.split(".")[1];const generateConnectionId=e=>e.options?`${e.options.host}:${e.options.port}`:e.address;const maybeRedact=(e,t)=>a.has(e)?{}:t;const isLegacyPool=e=>e.s&&e.queue;const c={$query:"filter",$orderby:"sort",$hint:"hint",$comment:"comment",$maxScan:"maxScan",$max:"max",$min:"min",$returnKey:"returnKey",$showDiskLoc:"showRecordId",$maxTimeMS:"maxTimeMS",$snapshot:"snapshot"};const l={numberToSkip:"skip",numberToReturn:"batchSize",returnFieldsSelector:"projection"};const u=["tailable","oplogReplay","noCursorTimeout","awaitData","partial","exhaust"];const extractCommand=e=>{if(e instanceof s){return{getMore:e.cursorId,collection:collectionName(e),batchSize:e.numberToReturn}}if(e instanceof o){return{killCursors:collectionName(e),cursors:e.cursorIds}}if(e instanceof n){return e.command}if(e.query&&e.query.$query){let t;if(e.ns==="admin.$cmd"){t=Object.assign({},e.query.$query)}else{t={find:collectionName(e)};Object.keys(c).forEach((r=>{if(typeof e.query[r]!=="undefined")t[c[r]]=e.query[r]}))}Object.keys(l).forEach((r=>{if(typeof e[r]!=="undefined")t[l[r]]=e[r]}));u.forEach((r=>{if(e[r])t[r]=e[r]}));if(typeof e.pre32Limit!=="undefined"){t.limit=e.pre32Limit}if(e.query.$explain){return{explain:t}}return t}return e.query?e.query:e};const extractReply=(e,t)=>{if(e instanceof s){return{ok:1,cursor:{id:t.message.cursorId,ns:namespace(e),nextBatch:t.message.documents}}}if(e instanceof o){return{ok:1,cursorsUnknown:e.cursorIds}}if(e.query&&typeof e.query.$query!=="undefined"){return{ok:1,cursor:{id:t.message.cursorId,ns:namespace(e),firstBatch:t.message.documents}}}return t&&t.result?t.result:t};const extractConnectionDetails=e=>{if(isLegacyPool(e)){return{connectionId:generateConnectionId(e)}}const t=e;return{address:t.address,connectionId:t.id}};class CommandStartedEvent{constructor(e,t){const r=extractCommand(t);const n=extractCommandName(r);const o=extractConnectionDetails(e);if(a.has(n)){this.commandObj={};this.commandObj[n]=true}Object.assign(this,o,{requestId:t.requestId,databaseName:databaseName(t),commandName:n,command:r})}}class CommandSucceededEvent{constructor(e,t,r,n){const o=extractCommand(t);const s=extractCommandName(o);const a=extractConnectionDetails(e);Object.assign(this,a,{requestId:t.requestId,commandName:s,duration:i(n),reply:maybeRedact(s,extractReply(t,r))})}}class CommandFailedEvent{constructor(e,t,r,n){const o=extractCommand(t);const s=extractCommandName(o);const a=extractConnectionDetails(e);Object.assign(this,a,{requestId:t.requestId,commandName:s,duration:i(n),failure:maybeRedact(s,r)})}}e.exports={CommandStartedEvent:CommandStartedEvent,CommandSucceededEvent:CommandSucceededEvent,CommandFailedEvent:CommandFailedEvent}},2337:e=>{"use strict";var CommandResult=function(e,t,r){this.result=e;this.connection=t;this.message=r};CommandResult.prototype.toJSON=function(){let e=Object.assign({},this,this.result);delete e.message;return e};CommandResult.prototype.toString=function(){return JSON.stringify(this.toJSON())};e.exports=CommandResult},9814:(e,t,r)=>{"use strict";var n=r(7746).retrieveBSON;var o=n();var s=o.Long;const i=r(1867).Buffer;var a=0;var c=r(7272).opcodes;var l=2;var u=4;var d=8;var p=16;var h=32;var m=64;var y=128;var g=1;var v=2;var b=4;var S=8;var Query=function(e,t,r,n){var o=this;if(t==null)throw new Error("ns must be specified for query");if(r==null)throw new Error("query must be specified for query");if(t.indexOf("\0")!==-1){throw new Error("namespace cannot contain a null character")}this.bson=e;this.ns=t;this.query=r;this.numberToSkip=n.numberToSkip||0;this.numberToReturn=n.numberToReturn||0;this.returnFieldSelector=n.returnFieldSelector||null;this.requestId=Query.getRequestId();this.pre32Limit=n.pre32Limit;this.serializeFunctions=typeof n.serializeFunctions==="boolean"?n.serializeFunctions:false;this.ignoreUndefined=typeof n.ignoreUndefined==="boolean"?n.ignoreUndefined:false;this.maxBsonSize=n.maxBsonSize||1024*1024*16;this.checkKeys=typeof n.checkKeys==="boolean"?n.checkKeys:true;this.batchSize=o.numberToReturn;this.tailable=false;this.slaveOk=typeof n.slaveOk==="boolean"?n.slaveOk:false;this.oplogReplay=false;this.noCursorTimeout=false;this.awaitData=false;this.exhaust=false;this.partial=false};Query.prototype.incRequestId=function(){this.requestId=a++};Query.nextRequestId=function(){return a+1};Query.prototype.toBin=function(){var e=this;var t=[];var r=null;var n=0;if(this.tailable){n|=l}if(this.slaveOk){n|=u}if(this.oplogReplay){n|=d}if(this.noCursorTimeout){n|=p}if(this.awaitData){n|=h}if(this.exhaust){n|=m}if(this.partial){n|=y}if(e.batchSize!==e.numberToReturn)e.numberToReturn=e.batchSize;var o=i.alloc(4*4+4+i.byteLength(e.ns)+1+4+4);t.push(o);var s=e.bson.serialize(this.query,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});t.push(s);if(e.returnFieldSelector&&Object.keys(e.returnFieldSelector).length>0){r=e.bson.serialize(this.returnFieldSelector,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});t.push(r)}var a=o.length+s.length+(r?r.length:0);var g=4;o[3]=a>>24&255;o[2]=a>>16&255;o[1]=a>>8&255;o[0]=a&255;o[g+3]=this.requestId>>24&255;o[g+2]=this.requestId>>16&255;o[g+1]=this.requestId>>8&255;o[g]=this.requestId&255;g=g+4;o[g+3]=0>>24&255;o[g+2]=0>>16&255;o[g+1]=0>>8&255;o[g]=0&255;g=g+4;o[g+3]=c.OP_QUERY>>24&255;o[g+2]=c.OP_QUERY>>16&255;o[g+1]=c.OP_QUERY>>8&255;o[g]=c.OP_QUERY&255;g=g+4;o[g+3]=n>>24&255;o[g+2]=n>>16&255;o[g+1]=n>>8&255;o[g]=n&255;g=g+4;g=g+o.write(this.ns,g,"utf8")+1;o[g-1]=0;o[g+3]=this.numberToSkip>>24&255;o[g+2]=this.numberToSkip>>16&255;o[g+1]=this.numberToSkip>>8&255;o[g]=this.numberToSkip&255;g=g+4;o[g+3]=this.numberToReturn>>24&255;o[g+2]=this.numberToReturn>>16&255;o[g+1]=this.numberToReturn>>8&255;o[g]=this.numberToReturn&255;g=g+4;return t};Query.getRequestId=function(){return++a};var GetMore=function(e,t,r,n){n=n||{};this.numberToReturn=n.numberToReturn||0;this.requestId=a++;this.bson=e;this.ns=t;this.cursorId=r};GetMore.prototype.toBin=function(){var e=4+i.byteLength(this.ns)+1+4+8+4*4;var t=0;var r=i.alloc(e);r[t+3]=e>>24&255;r[t+2]=e>>16&255;r[t+1]=e>>8&255;r[t]=e&255;t=t+4;r[t+3]=this.requestId>>24&255;r[t+2]=this.requestId>>16&255;r[t+1]=this.requestId>>8&255;r[t]=this.requestId&255;t=t+4;r[t+3]=0>>24&255;r[t+2]=0>>16&255;r[t+1]=0>>8&255;r[t]=0&255;t=t+4;r[t+3]=c.OP_GETMORE>>24&255;r[t+2]=c.OP_GETMORE>>16&255;r[t+1]=c.OP_GETMORE>>8&255;r[t]=c.OP_GETMORE&255;t=t+4;r[t+3]=0>>24&255;r[t+2]=0>>16&255;r[t+1]=0>>8&255;r[t]=0&255;t=t+4;t=t+r.write(this.ns,t,"utf8")+1;r[t-1]=0;r[t+3]=this.numberToReturn>>24&255;r[t+2]=this.numberToReturn>>16&255;r[t+1]=this.numberToReturn>>8&255;r[t]=this.numberToReturn&255;t=t+4;r[t+3]=this.cursorId.getLowBits()>>24&255;r[t+2]=this.cursorId.getLowBits()>>16&255;r[t+1]=this.cursorId.getLowBits()>>8&255;r[t]=this.cursorId.getLowBits()&255;t=t+4;r[t+3]=this.cursorId.getHighBits()>>24&255;r[t+2]=this.cursorId.getHighBits()>>16&255;r[t+1]=this.cursorId.getHighBits()>>8&255;r[t]=this.cursorId.getHighBits()&255;t=t+4;return r};var KillCursor=function(e,t,r){this.ns=t;this.requestId=a++;this.cursorIds=r};KillCursor.prototype.toBin=function(){var e=4+4+4*4+this.cursorIds.length*8;var t=0;var r=i.alloc(e);r[t+3]=e>>24&255;r[t+2]=e>>16&255;r[t+1]=e>>8&255;r[t]=e&255;t=t+4;r[t+3]=this.requestId>>24&255;r[t+2]=this.requestId>>16&255;r[t+1]=this.requestId>>8&255;r[t]=this.requestId&255;t=t+4;r[t+3]=0>>24&255;r[t+2]=0>>16&255;r[t+1]=0>>8&255;r[t]=0&255;t=t+4;r[t+3]=c.OP_KILL_CURSORS>>24&255;r[t+2]=c.OP_KILL_CURSORS>>16&255;r[t+1]=c.OP_KILL_CURSORS>>8&255;r[t]=c.OP_KILL_CURSORS&255;t=t+4;r[t+3]=0>>24&255;r[t+2]=0>>16&255;r[t+1]=0>>8&255;r[t]=0&255;t=t+4;r[t+3]=this.cursorIds.length>>24&255;r[t+2]=this.cursorIds.length>>16&255;r[t+1]=this.cursorIds.length>>8&255;r[t]=this.cursorIds.length&255;t=t+4;for(var n=0;n<this.cursorIds.length;n++){r[t+3]=this.cursorIds[n].getLowBits()>>24&255;r[t+2]=this.cursorIds[n].getLowBits()>>16&255;r[t+1]=this.cursorIds[n].getLowBits()>>8&255;r[t]=this.cursorIds[n].getLowBits()&255;t=t+4;r[t+3]=this.cursorIds[n].getHighBits()>>24&255;r[t+2]=this.cursorIds[n].getHighBits()>>16&255;r[t+1]=this.cursorIds[n].getHighBits()>>8&255;r[t]=this.cursorIds[n].getHighBits()&255;t=t+4}return r};var Response=function(e,t,r,n,o){o=o||{promoteLongs:true,promoteValues:true,promoteBuffers:false};this.parsed=false;this.raw=t;this.data=n;this.bson=e;this.opts=o;this.length=r.length;this.requestId=r.requestId;this.responseTo=r.responseTo;this.opCode=r.opCode;this.fromCompressed=r.fromCompressed;this.responseFlags=n.readInt32LE(0);this.cursorId=new s(n.readInt32LE(4),n.readInt32LE(8));this.startingFrom=n.readInt32LE(12);this.numberReturned=n.readInt32LE(16);this.documents=new Array(this.numberReturned);this.cursorNotFound=(this.responseFlags&g)!==0;this.queryFailure=(this.responseFlags&v)!==0;this.shardConfigStale=(this.responseFlags&b)!==0;this.awaitCapable=(this.responseFlags&S)!==0;this.promoteLongs=typeof o.promoteLongs==="boolean"?o.promoteLongs:true;this.promoteValues=typeof o.promoteValues==="boolean"?o.promoteValues:true;this.promoteBuffers=typeof o.promoteBuffers==="boolean"?o.promoteBuffers:false};Response.prototype.isParsed=function(){return this.parsed};Response.prototype.parse=function(e){if(this.parsed)return;e=e||{};var t=e.raw||false;var r=e.documentsReturnedIn||null;var n=typeof e.promoteLongs==="boolean"?e.promoteLongs:this.opts.promoteLongs;var o=typeof e.promoteValues==="boolean"?e.promoteValues:this.opts.promoteValues;var s=typeof e.promoteBuffers==="boolean"?e.promoteBuffers:this.opts.promoteBuffers;var i,a;a={promoteLongs:n,promoteValues:o,promoteBuffers:s};this.index=20;for(var c=0;c<this.numberReturned;c++){i=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24;if(t){this.documents[c]=this.data.slice(this.index,this.index+i)}else{this.documents[c]=this.bson.deserialize(this.data.slice(this.index,this.index+i),a)}this.index=this.index+i}if(this.documents.length===1&&r!=null&&t){const e={};e[r]=true;a.fieldsAsRaw=e;const t=this.bson.deserialize(this.documents[0],a);this.documents=[t]}this.parsed=true};e.exports={Query:Query,GetMore:GetMore,Response:Response,KillCursor:KillCursor}},6573:(e,t,r)=>{"use strict";const n=r(1631);const o=r(8818);const s=r(6096);const i=r(3111).MongoError;const a=r(3111).MongoNetworkError;const c=r(3111).MongoNetworkTimeoutError;const l=r(2192).defaultAuthProviders;const u=r(557).AuthContext;const d=r(7161);const p=r(1178).makeClientMetadata;const h=d.MAX_SUPPORTED_WIRE_VERSION;const m=d.MAX_SUPPORTED_SERVER_VERSION;const y=d.MIN_SUPPORTED_WIRE_VERSION;const g=d.MIN_SUPPORTED_SERVER_VERSION;let v;function connect(e,t,r){if(typeof t==="function"){r=t;t=undefined}const n=e&&e.connectionType?e.connectionType:s;if(v==null){v=l(e.bson)}const o=e.family!==void 0?e.family:0;makeConnection(o,e,t,((t,o)=>{if(t){r(t,o);return}performInitialHandshake(new n(o,e),e,r)}))}function isModernConnectionType(e){return!(e instanceof s)}function checkSupportedServer(e,t){const r=e&&typeof e.maxWireVersion==="number"&&e.maxWireVersion>=y;const n=e&&typeof e.minWireVersion==="number"&&e.minWireVersion<=h;if(r){if(n){return null}const r=`Server at ${t.host}:${t.port} reports minimum wire version ${e.minWireVersion}, but this version of the Node.js Driver requires at most ${h} (MongoDB ${m})`;return new i(r)}const o=`Server at ${t.host}:${t.port} reports maximum wire version ${e.maxWireVersion||0}, but this version of the Node.js Driver requires at least ${y} (MongoDB ${g})`;return new i(o)}function performInitialHandshake(e,t,r){const callback=function(t,n){if(t&&e){e.destroy()}r(t,n)};const n=t.credentials;if(n){if(!n.mechanism.match(/DEFAULT/i)&&!v[n.mechanism]){callback(new i(`authMechanism '${n.mechanism}' not supported`));return}}const o=new u(e,n,t);prepareHandshakeDocument(o,((r,s)=>{if(r){return callback(r)}const a=Object.assign({},t);if(t.connectTimeoutMS||t.connectionTimeout){a.socketTimeout=t.connectTimeoutMS||t.connectionTimeout}const c=(new Date).getTime();e.command("admin.$cmd",s,a,((r,a)=>{if(r){callback(r);return}const l=a.result;if(l.ok===0){callback(new i(l));return}const u=checkSupportedServer(l,t);if(u){callback(u);return}if(!isModernConnectionType(e)){if(l.compression){const r=s.compression.filter((e=>l.compression.indexOf(e)!==-1));if(r.length){e.agreedCompressor=r[0]}if(t.compression&&t.compression.zlibCompressionLevel){e.zlibCompressionLevel=t.compression.zlibCompressionLevel}}}e.ismaster=l;e.lastIsMasterMS=(new Date).getTime()-c;if(!l.arbiterOnly&&n){Object.assign(o,{response:l});const t=n.resolveAuthMechanism(l);const r=v[t.mechanism];r.auth(o,(t=>{if(t)return callback(t);callback(undefined,e)}));return}callback(undefined,e)}))}))}function prepareHandshakeDocument(e,t){const r=e.options;const n=r.compression&&r.compression.compressors?r.compression.compressors:[];const o={ismaster:true,client:r.metadata||p(r),compression:n};const s=e.credentials;if(s){if(s.mechanism.match(/DEFAULT/i)&&s.username){Object.assign(o,{saslSupportedMechs:`${s.source}.${s.username}`});v["scram-sha-256"].prepare(o,e,t);return}const r=v[s.mechanism];r.prepare(o,e,t);return}t(undefined,o)}const b=["pfx","key","passphrase","cert","ca","ciphers","NPNProtocols","ALPNProtocols","servername","ecdhCurve","secureProtocol","secureContext","session","minDHSize","crl","rejectUnauthorized"];function parseConnectOptions(e,t){const r=typeof t.host==="string"?t.host:"localhost";if(r.indexOf("/")!==-1){return{path:r}}const n={family:e,host:r,port:typeof t.port==="number"?t.port:27017,rejectUnauthorized:false};return n}function parseSslOptions(e,t){const r=parseConnectOptions(e,t);for(const e in t){if(t[e]!=null&&b.indexOf(e)!==-1){r[e]=t[e]}}if(t.checkServerIdentity===false){r.checkServerIdentity=function(){return undefined}}else if(typeof t.checkServerIdentity==="function"){r.checkServerIdentity=t.checkServerIdentity}if(r.servername==null&&!n.isIP(r.host)){r.servername=r.host}return r}const S=new Set(["error","close","timeout","parseError"]);function makeConnection(e,t,r,s){const i=typeof t.ssl==="boolean"?t.ssl:false;const a=typeof t.keepAlive==="boolean"?t.keepAlive:true;let c=typeof t.keepAliveInitialDelay==="number"?t.keepAliveInitialDelay:12e4;const l=typeof t.noDelay==="boolean"?t.noDelay:true;const u=typeof t.connectionTimeout==="number"?t.connectionTimeout:typeof t.connectTimeoutMS==="number"?t.connectTimeoutMS:3e4;const d=typeof t.socketTimeout==="number"?t.socketTimeout:0;const p=typeof t.rejectUnauthorized==="boolean"?t.rejectUnauthorized:true;if(c>d){c=Math.round(d/2)}let h;const callback=function(e,t){if(e&&h){h.destroy()}s(e,t)};try{if(i){h=o.connect(parseSslOptions(e,t));if(typeof h.disableRenegotiation==="function"){h.disableRenegotiation()}}else{h=n.createConnection(parseConnectOptions(e,t))}}catch(e){return callback(e)}h.setKeepAlive(a,c);h.setTimeout(u);h.setNoDelay(l);const m=i?"secureConnect":"connect";let y;function errorHandler(e){return t=>{S.forEach((e=>h.removeAllListeners(e)));if(y){r.removeListener("cancel",y)}h.removeListener(m,connectHandler);callback(connectionFailureError(e,t))}}function connectHandler(){S.forEach((e=>h.removeAllListeners(e)));if(y){r.removeListener("cancel",y)}if(h.authorizationError&&p){return callback(h.authorizationError)}h.setTimeout(d);callback(null,h)}S.forEach((e=>h.once(e,errorHandler(e))));if(r){y=errorHandler("cancel");r.once("cancel",y)}h.once(m,connectHandler)}function connectionFailureError(e,t){switch(e){case"error":return new a(t);case"timeout":return new c(`connection timed out`);case"close":return new a(`connection closed`);case"cancel":return new a(`connection establishment was cancelled`);default:return new a(`unknown network error`)}}e.exports=connect},6096:(e,t,r)=>{"use strict";const n=r(8614).EventEmitter;const o=r(6417);const s=r(7746).debugOptions;const i=r(7272).parseHeader;const a=r(7793).decompress;const c=r(9814).Response;const l=r(8988).BinMsg;const u=r(3111).MongoNetworkError;const d=r(3111).MongoNetworkTimeoutError;const p=r(3111).MongoError;const h=r(104);const m=r(7272).opcodes.OP_COMPRESSED;const y=r(7272).opcodes.OP_MSG;const g=r(7272).MESSAGE_HEADER_SIZE;const v=r(1867).Buffer;const b=r(9814).Query;const S=r(2337);let w=0;const _=1024*1024*16*4;const E=["host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","socketTimeout","ssl","ca","crl","cert","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","checkServerIdentity"];let O=undefined;let C=false;let T={};class Connection extends n{constructor(e,t){super();t=t||{};if(!t.bson){throw new TypeError("must pass in valid bson parser")}this.id=w++;this.options=t;this.logger=h("Connection",t);this.bson=t.bson;this.tag=t.tag;this.maxBsonMessageSize=t.maxBsonMessageSize||_;this.port=t.port||27017;this.host=t.host||"localhost";this.socketTimeout=typeof t.socketTimeout==="number"?t.socketTimeout:0;this.keepAlive=typeof t.keepAlive==="boolean"?t.keepAlive:true;this.keepAliveInitialDelay=typeof t.keepAliveInitialDelay==="number"?t.keepAliveInitialDelay:12e4;this.connectionTimeout=typeof t.connectionTimeout==="number"?t.connectionTimeout:3e4;if(this.keepAliveInitialDelay>this.socketTimeout){this.keepAliveInitialDelay=Math.round(this.socketTimeout/2)}if(this.logger.isDebug()){this.logger.debug(`creating connection ${this.id} with options [${JSON.stringify(s(E,t))}]`)}this.responseOptions={promoteLongs:typeof t.promoteLongs==="boolean"?t.promoteLongs:true,promoteValues:typeof t.promoteValues==="boolean"?t.promoteValues:true,promoteBuffers:typeof t.promoteBuffers==="boolean"?t.promoteBuffers:false};this.flushing=false;this.queue=[];this.writeStream=null;this.destroyed=false;this.timedOut=false;const r=o.createHash("sha1");r.update(this.address);this.hashedName=r.digest("hex");this.workItems=[];this.socket=e;this.socket.once("error",errorHandler(this));this.socket.once("timeout",timeoutHandler(this));this.socket.once("close",closeHandler(this));this.socket.on("data",dataHandler(this));if(C){addConnection(this.id,this)}}setSocketTimeout(e){if(this.socket){this.socket.setTimeout(e)}}resetSocketTimeout(){if(this.socket){this.socket.setTimeout(this.socketTimeout)}}static enableConnectionAccounting(e){if(e){O=e}C=true;T={}}static disableConnectionAccounting(){C=false;O=undefined}static connections(){return T}get address(){return`${this.host}:${this.port}`}unref(){if(this.socket==null){this.once("connect",(()=>this.socket.unref()));return}this.socket.unref()}flush(e){while(this.workItems.length>0){const t=this.workItems.shift();if(t.cb){t.cb(e)}}}destroy(e,t){if(typeof e==="function"){t=e;e={}}e=Object.assign({force:false},e);if(C){deleteConnection(this.id)}if(this.socket==null){this.destroyed=true;return}if(e.force||this.timedOut){this.socket.destroy();this.destroyed=true;if(typeof t==="function")t(null,null);return}this.socket.end((e=>{this.destroyed=true;if(typeof t==="function")t(e,null)}))}write(e){if(this.logger.isDebug()){if(!Array.isArray(e)){this.logger.debug(`writing buffer [${e.toString("hex")}] to ${this.address}`)}else{for(let t=0;t<e.length;t++)this.logger.debug(`writing buffer [${e[t].toString("hex")}] to ${this.address}`)}}if(this.socket.destroyed===false){if(!Array.isArray(e)){this.socket.write(e,"binary");return true}for(let t=0;t<e.length;t++){this.socket.write(e[t],"binary")}return true}return false}toString(){return""+this.id}toJSON(){return{id:this.id,host:this.host,port:this.port}}isConnected(){if(this.destroyed)return false;return!this.socket.destroyed&&this.socket.writable}command(e,t,r,n){if(typeof r==="function")n=r,r={};const o=this;const s=typeof r.socketTimeout==="number"?r.socketTimeout:0;const i=o.options.bson;const a=new b(i,e,t,{numberToSkip:0,numberToReturn:1});const noop=()=>{};function _callback(e,t){n(e,t);n=noop}function errorHandler(e){o.resetSocketTimeout();I.forEach((e=>o.removeListener(e,errorHandler)));o.removeListener("message",messageHandler);if(e==null){e=new p(`runCommand failed for connection to '${o.address}'`)}o.on("error",noop);_callback(e)}function messageHandler(e){if(e.responseTo!==a.requestId){return}o.resetSocketTimeout();I.forEach((e=>o.removeListener(e,errorHandler)));o.removeListener("message",messageHandler);e.parse({promoteValues:true});const t=e.documents[0];if(t.ok===0||t.$err||t.errmsg||t.code){_callback(new p(t));return}_callback(undefined,new S(t,this,e))}o.setSocketTimeout(s);I.forEach((e=>o.once(e,errorHandler)));o.on("message",messageHandler);o.write(a.toBin())}}const I=["error","close","timeout","parseError"];function deleteConnection(e){delete T[e];if(O){O.deleteConnection(e)}}function addConnection(e,t){T[e]=t;if(O){O.addConnection(e,t)}}function errorHandler(e){return function(t){if(C)deleteConnection(e.id);if(e.logger.isDebug()){e.logger.debug(`connection ${e.id} for [${e.address}] errored out with [${JSON.stringify(t)}]`)}e.emit("error",new u(t),e)}}function timeoutHandler(e){return function(){if(C)deleteConnection(e.id);if(e.logger.isDebug()){e.logger.debug(`connection ${e.id} for [${e.address}] timed out`)}e.timedOut=true;e.emit("timeout",new d(`connection ${e.id} to ${e.address} timed out`,{beforeHandshake:e.ismaster==null}),e)}}function closeHandler(e){return function(t){if(C)deleteConnection(e.id);if(e.logger.isDebug()){e.logger.debug(`connection ${e.id} with for [${e.address}] closed`)}if(!t){e.emit("close",new u(`connection ${e.id} to ${e.address} closed`),e)}}}function processMessage(e,t){const r=i(t);if(r.opCode!==m){const n=r.opCode===y?l:c;e.emit("message",new n(e.bson,t,r,t.slice(g),e.responseOptions),e);return}r.fromCompressed=true;let n=g;r.opCode=t.readInt32LE(n);n+=4;r.length=t.readInt32LE(n);n+=4;const o=t[n];n++;a(o,t.slice(n),((n,o)=>{if(n){e.emit("error",n);return}if(o.length!==r.length){e.emit("error",new p("Decompressing a compressed message from the server failed. The message is corrupt."));return}const s=r.opCode===y?l:c;e.emit("message",new s(e.bson,t,r,o,e.responseOptions),e)}))}function dataHandler(e){return function(t){while(t.length>0){if(e.bytesRead>0&&e.sizeOfMessage>0){const r=e.sizeOfMessage-e.bytesRead;if(r>t.length){t.copy(e.buffer,e.bytesRead);e.bytesRead=e.bytesRead+t.length;t=v.alloc(0)}else{t.copy(e.buffer,e.bytesRead,0,r);t=t.slice(r);const n=e.buffer;e.buffer=null;e.sizeOfMessage=0;e.bytesRead=0;e.stubBuffer=null;processMessage(e,n)}}else{if(e.stubBuffer!=null&&e.stubBuffer.length>0){if(e.stubBuffer.length+t.length>4){const r=v.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(r,0);t.copy(r,e.stubBuffer.length);t=r;e.buffer=null;e.sizeOfMessage=0;e.bytesRead=0;e.stubBuffer=null}else{const r=v.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(r,0);t.copy(r,e.stubBuffer.length);t=v.alloc(0)}}else{if(t.length>4){const r=t[0]|t[1]<<8|t[2]<<16|t[3]<<24;if(r<0||r>e.maxBsonMessageSize){const t={err:"socketHandler",trace:"",bin:e.buffer,parseState:{sizeOfMessage:r,bytesRead:e.bytesRead,stubBuffer:e.stubBuffer}};e.emit("parseError",t,e);return}if(r>4&&r<e.maxBsonMessageSize&&r>t.length){e.buffer=v.alloc(r);t.copy(e.buffer,0);e.bytesRead=t.length;e.sizeOfMessage=r;e.stubBuffer=null;t=v.alloc(0)}else if(r>4&&r<e.maxBsonMessageSize&&r===t.length){const r=t;e.buffer=null;e.sizeOfMessage=0;e.bytesRead=0;e.stubBuffer=null;t=v.alloc(0);processMessage(e,r)}else if(r<=4||r>e.maxBsonMessageSize){const n={err:"socketHandler",trace:null,bin:t,parseState:{sizeOfMessage:r,bytesRead:0,buffer:null,stubBuffer:null}};e.emit("parseError",n,e);e.buffer=null;e.sizeOfMessage=0;e.bytesRead=0;e.stubBuffer=null;t=v.alloc(0)}else{const n=t.slice(0,r);e.buffer=null;e.sizeOfMessage=0;e.bytesRead=0;e.stubBuffer=null;t=t.slice(r);processMessage(e,n)}}else{e.stubBuffer=v.alloc(t.length);t.copy(e.stubBuffer,0);t=v.alloc(0)}}}}}}e.exports=Connection},104:(e,t,r)=>{"use strict";var n=r(1669).format,o=r(3111).MongoError;var s={};var i={};var a=null;var c=process.pid;var l=null;var Logger=function(e,t){if(!(this instanceof Logger))return new Logger(e,t);t=t||{};this.className=e;if(t.logger){l=t.logger}else if(l==null){l=console.log}if(t.loggerLevel){a=t.loggerLevel||"error"}if(i[this.className]==null)s[this.className]=true};Logger.prototype.debug=function(e,t){if(this.isDebug()&&(Object.keys(i).length>0&&i[this.className]||Object.keys(i).length===0&&s[this.className])){var r=(new Date).getTime();var o=n("[%s-%s:%s] %s %s","DEBUG",this.className,c,r,e);var a={type:"debug",message:e,className:this.className,pid:c,date:r};if(t)a.meta=t;l(o,a)}};Logger.prototype.warn=function(e,t){if(this.isWarn()&&(Object.keys(i).length>0&&i[this.className]||Object.keys(i).length===0&&s[this.className])){var r=(new Date).getTime();var o=n("[%s-%s:%s] %s %s","WARN",this.className,c,r,e);var a={type:"warn",message:e,className:this.className,pid:c,date:r};if(t)a.meta=t;l(o,a)}},Logger.prototype.info=function(e,t){if(this.isInfo()&&(Object.keys(i).length>0&&i[this.className]||Object.keys(i).length===0&&s[this.className])){var r=(new Date).getTime();var o=n("[%s-%s:%s] %s %s","INFO",this.className,c,r,e);var a={type:"info",message:e,className:this.className,pid:c,date:r};if(t)a.meta=t;l(o,a)}},Logger.prototype.error=function(e,t){if(this.isError()&&(Object.keys(i).length>0&&i[this.className]||Object.keys(i).length===0&&s[this.className])){var r=(new Date).getTime();var o=n("[%s-%s:%s] %s %s","ERROR",this.className,c,r,e);var a={type:"error",message:e,className:this.className,pid:c,date:r};if(t)a.meta=t;l(o,a)}},Logger.prototype.isInfo=function(){return a==="info"||a==="debug"},Logger.prototype.isError=function(){return a==="error"||a==="info"||a==="debug"},Logger.prototype.isWarn=function(){return a==="error"||a==="warn"||a==="info"||a==="debug"},Logger.prototype.isDebug=function(){return a==="debug"};Logger.reset=function(){a="error";i={}};Logger.currentLogger=function(){return l};Logger.setCurrentLogger=function(e){if(typeof e!=="function")throw new o("current logger must be a function");l=e};Logger.filter=function(e,t){if(e==="class"&&Array.isArray(t)){i={};t.forEach((function(e){i[e]=true}))}};Logger.setLevel=function(e){if(e!=="info"&&e!=="error"&&e!=="debug"&&e!=="warn"){throw new Error(n("%s is an illegal logging level",e))}a=e};e.exports=Logger},8988:(e,t,r)=>{"use strict";const n=r(1867).Buffer;const o=r(7272).opcodes;const s=r(7272).databaseNamespace;const i=r(4485);const a=r(3111).MongoError;let c=0;const l=1;const u=2;const d=1<<16;class Msg{constructor(e,t,r,n){if(r==null)throw new Error("query must be specified for query");this.bson=e;this.ns=t;this.command=r;this.command.$db=s(t);if(n.readPreference&&n.readPreference.mode!==i.PRIMARY){this.command.$readPreference=n.readPreference.toJSON()}this.options=n||{};this.requestId=n.requestId?n.requestId:Msg.getRequestId();this.serializeFunctions=typeof n.serializeFunctions==="boolean"?n.serializeFunctions:false;this.ignoreUndefined=typeof n.ignoreUndefined==="boolean"?n.ignoreUndefined:false;this.checkKeys=typeof n.checkKeys==="boolean"?n.checkKeys:false;this.maxBsonSize=n.maxBsonSize||1024*1024*16;this.checksumPresent=false;this.moreToCome=n.moreToCome||false;this.exhaustAllowed=typeof n.exhaustAllowed==="boolean"?n.exhaustAllowed:false}toBin(){const e=[];let t=0;if(this.checksumPresent){t|=l}if(this.moreToCome){t|=u}if(this.exhaustAllowed){t|=d}const r=n.alloc(4*4+4);e.push(r);let s=r.length;const i=this.command;s+=this.makeDocumentSegment(e,i);r.writeInt32LE(s,0);r.writeInt32LE(this.requestId,4);r.writeInt32LE(0,8);r.writeInt32LE(o.OP_MSG,12);r.writeUInt32LE(t,16);return e}makeDocumentSegment(e,t){const r=n.alloc(1);r[0]=0;const o=this.serializeBson(t);e.push(r);e.push(o);return r.length+o.length}serializeBson(e){return this.bson.serialize(e,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined})}}Msg.getRequestId=function(){c=c+1&2147483647;return c};class BinMsg{constructor(e,t,r,n,o){o=o||{promoteLongs:true,promoteValues:true,promoteBuffers:false};this.parsed=false;this.raw=t;this.data=n;this.bson=e;this.opts=o;this.length=r.length;this.requestId=r.requestId;this.responseTo=r.responseTo;this.opCode=r.opCode;this.fromCompressed=r.fromCompressed;this.responseFlags=n.readInt32LE(0);this.checksumPresent=(this.responseFlags&l)!==0;this.moreToCome=(this.responseFlags&u)!==0;this.exhaustAllowed=(this.responseFlags&d)!==0;this.promoteLongs=typeof o.promoteLongs==="boolean"?o.promoteLongs:true;this.promoteValues=typeof o.promoteValues==="boolean"?o.promoteValues:true;this.promoteBuffers=typeof o.promoteBuffers==="boolean"?o.promoteBuffers:false;this.documents=[]}isParsed(){return this.parsed}parse(e){if(this.parsed)return;e=e||{};this.index=4;const t=e.raw||false;const r=e.documentsReturnedIn||null;const n=typeof e.promoteLongs==="boolean"?e.promoteLongs:this.opts.promoteLongs;const o=typeof e.promoteValues==="boolean"?e.promoteValues:this.opts.promoteValues;const s=typeof e.promoteBuffers==="boolean"?e.promoteBuffers:this.opts.promoteBuffers;const i={promoteLongs:n,promoteValues:o,promoteBuffers:s};while(this.index<this.data.length){const e=this.data.readUInt8(this.index++);if(e===1){throw new a("OP_MSG Payload Type 1 detected unsupported protocol")}else if(e===0){const e=this.data.readUInt32LE(this.index);const r=this.data.slice(this.index,this.index+e);this.documents.push(t?r:this.bson.deserialize(r,i));this.index+=e}}if(this.documents.length===1&&r!=null&&t){const e={};e[r]=true;i.fieldsAsRaw=e;const t=this.bson.deserialize(this.documents[0],i);this.documents=[t]}this.parsed=true}}e.exports={Msg:Msg,BinMsg:BinMsg}},5500:(e,t,r)=>{"use strict";const n=r(1669).inherits;const o=r(8614).EventEmitter;const s=r(3111).MongoError;const i=r(3111).MongoTimeoutError;const a=r(3111).MongoWriteConcernError;const c=r(104);const l=r(1669).format;const u=r(8988).Msg;const d=r(2337);const p=r(7272).MESSAGE_HEADER_SIZE;const h=r(7272).COMPRESSION_DETAILS_SIZE;const m=r(7272).opcodes;const y=r(7793).compress;const g=r(7793).compressorIDs;const v=r(7793).uncompressibleCommands;const b=r(9815);const S=r(1867).Buffer;const w=r(6573);const _=r(5474).updateSessionFromResponse;const E=r(1178).eachAsync;const O=r(1178).makeStateMachine;const C=r(1371).now;const T="disconnected";const I="connecting";const k="connected";const A="draining";const N="destroying";const R="destroyed";const M=O({[T]:[I,A,T],[I]:[I,k,A,T],[k]:[k,T,A],[A]:[A,N,R],[N]:[N,R],[R]:[R]});const D=new Set(["error","close","timeout","parseError","connect","message"]);var P=0;var Pool=function(e,t){o.call(this);this.topology=e;this.s={state:T,cancellationToken:new o};this.s.cancellationToken.setMaxListeners(Infinity);this.options=Object.assign({host:"localhost",port:27017,size:5,minSize:0,connectionTimeout:3e4,socketTimeout:0,keepAlive:true,keepAliveInitialDelay:12e4,noDelay:true,ssl:false,checkServerIdentity:true,ca:null,crl:null,cert:null,key:null,passphrase:null,rejectUnauthorized:false,promoteLongs:true,promoteValues:true,promoteBuffers:false,reconnect:true,reconnectInterval:1e3,reconnectTries:30,domainsEnabled:false,legacyCompatMode:true},t);this.id=P++;this.retriesLeft=this.options.reconnectTries;this.reconnectId=null;this.reconnectError=null;if(!t.bson||t.bson&&(typeof t.bson.serialize!=="function"||typeof t.bson.deserialize!=="function")){throw new Error("must pass in valid bson parser")}this.logger=c("Pool",t);this.availableConnections=[];this.inUseConnections=[];this.connectingConnections=0;this.executing=false;this.queue=[];this.numberOfConsecutiveTimeouts=0;this.connectionIndex=0;const r=this;this._messageHandler=messageHandler(this);this._connectionCloseHandler=function(e){const t=this;connectionFailureHandler(r,"close",e,t)};this._connectionErrorHandler=function(e){const t=this;connectionFailureHandler(r,"error",e,t)};this._connectionTimeoutHandler=function(e){const t=this;connectionFailureHandler(r,"timeout",e,t)};this._connectionParseErrorHandler=function(e){const t=this;connectionFailureHandler(r,"parseError",e,t)}};n(Pool,o);Object.defineProperty(Pool.prototype,"size",{enumerable:true,get:function(){return this.options.size}});Object.defineProperty(Pool.prototype,"minSize",{enumerable:true,get:function(){return this.options.minSize}});Object.defineProperty(Pool.prototype,"connectionTimeout",{enumerable:true,get:function(){return this.options.connectionTimeout}});Object.defineProperty(Pool.prototype,"socketTimeout",{enumerable:true,get:function(){return this.options.socketTimeout}});Object.defineProperty(Pool.prototype,"state",{enumerable:true,get:function(){return this.s.state}});function resetPoolState(e){e.inUseConnections=[];e.availableConnections=[];e.connectingConnections=0;e.executing=false;e.numberOfConsecutiveTimeouts=0;e.connectionIndex=0;e.retriesLeft=e.options.reconnectTries;e.reconnectId=null}function connectionFailureHandler(e,t,r,n){if(n){if(n._connectionFailHandled){return}n._connectionFailHandled=true;n.destroy();removeConnection(e,n);n.flush(r)}if(t==="timeout"){e.numberOfConsecutiveTimeouts=e.numberOfConsecutiveTimeouts+1;if(e.numberOfConsecutiveTimeouts>e.options.reconnectTries){e.numberOfConsecutiveTimeouts=0;e.destroy(true);return e.emit("close",e)}}if(e.socketCount()===0){if(e.state!==R&&e.state!==N&&e.state!==A){if(e.options.reconnect){M(e,T)}}t=t==="error"?"close":t;e.emit(t,r)}if(!e.reconnectId&&e.options.reconnect){e.reconnectError=r;e.reconnectId=setTimeout(attemptReconnect(e),e.options.reconnectInterval)}const o=totalConnectionCount(e);if(o<e.minSize){createConnection(e)}}function attemptReconnect(e,t){return function(){e.emit("attemptReconnect",e);if(e.state===R||e.state===N){if(typeof t==="function"){t(new s("Cannot create connection when pool is destroyed"))}return}e.retriesLeft=e.retriesLeft-1;if(e.retriesLeft<=0){e.destroy();const r=new i(`failed to reconnect after ${e.options.reconnectTries} attempts with interval ${e.options.reconnectInterval} ms`,e.reconnectError);e.emit("reconnectFailed",r);if(typeof t==="function"){t(r)}return}e.reconnectId=null;createConnection(e,((r,n)=>{if(r==null){e.reconnectId=null;e.retriesLeft=e.options.reconnectTries;e.emit("reconnect",e)}if(typeof t==="function"){t(r,n)}}))}}function moveConnectionBetween(e,t,r){var n=t.indexOf(e);if(n!==-1){t.splice(n,1);r.push(e)}}function messageHandler(e){return function(t,r){var n=null;for(var o=0;o<r.workItems.length;o++){if(r.workItems[o].requestId===t.responseTo){n=r.workItems[o];r.workItems.splice(o,1)}}if(n&&n.monitoring){moveConnectionBetween(r,e.inUseConnections,e.availableConnections)}e.numberOfConsecutiveTimeouts=0;if(n&&n.socketTimeout){r.resetSocketTimeout()}if(e.logger.isDebug()){e.logger.debug(l("message [%s] received from %s:%s",t.raw.toString("hex"),e.options.host,e.options.port))}function handleOperationCallback(e,t,r,n){if(!e.options.domainsEnabled){return process.nextTick((function(){return t(r,n)}))}t(r,n)}if(!e.executing){process.nextTick((function(){_execute(e)()}))}if(n&&!n.immediateRelease){try{t.parse(n)}catch(t){return handleOperationCallback(e,n.cb,new s(t))}if(t.documents[0]){const r=t.documents[0];const o=n.session;if(o){_(o,r)}if(e.topology&&r.$clusterTime){e.topology.clusterTime=r.$clusterTime}}if(n.command&&t.documents[0]){const r=t.documents[0];if(r.writeConcernError){const t=new a(r.writeConcernError,r);return handleOperationCallback(e,n.cb,t)}if(r.ok===0||r.$err||r.errmsg||r.code){return handleOperationCallback(e,n.cb,new s(r))}}t.hashedName=r.hashedName;handleOperationCallback(e,n.cb,null,new d(n.fullResult?t:t.documents[0],r,t))}}}Pool.prototype.socketCount=function(){return this.availableConnections.length+this.inUseConnections.length};function totalConnectionCount(e){return e.availableConnections.length+e.inUseConnections.length+e.connectingConnections}Pool.prototype.allConnections=function(){return this.availableConnections.concat(this.inUseConnections)};Pool.prototype.get=function(){return this.allConnections()[0]};Pool.prototype.isConnected=function(){if(this.state===R||this.state===N){return false}var e=this.availableConnections.concat(this.inUseConnections);for(var t=0;t<e.length;t++){if(e[t].isConnected())return true}return false};Pool.prototype.isDestroyed=function(){return this.state===R||this.state===N};Pool.prototype.isDisconnected=function(){return this.state===T};Pool.prototype.connect=function(e){if(this.state!==T){throw new s("connection in unlawful state "+this.state)}M(this,I);createConnection(this,((t,r)=>{if(t){if(typeof e==="function"){this.destroy();e(t);return}if(this.state===I){this.emit("error",t)}this.destroy();return}M(this,k);if(this.minSize){for(let e=0;e<this.minSize;e++){createConnection(this)}}if(typeof e==="function"){e(null,r)}else{this.emit("connect",this,r)}}))};Pool.prototype.auth=function(e,t){if(typeof t==="function")t(null,null)};Pool.prototype.logout=function(e,t){if(typeof t==="function")t(null,null)};Pool.prototype.unref=function(){var e=this.availableConnections.concat(this.inUseConnections);e.forEach((function(e){e.unref()}))};function destroy(e,t,r,n){M(e,N);e.s.cancellationToken.emit("cancel");E(t,((e,t)=>{for(const t of D){e.removeAllListeners(t)}e.on("error",(()=>{}));e.destroy(r,t)}),(t=>{if(t){if(typeof n==="function")n(t,null);return}resetPoolState(e);e.queue=[];M(e,R);if(typeof n==="function")n(null,null)}))}Pool.prototype.destroy=function(e,t){var r=this;if(typeof e==="function"){t=e;e=false}if(this.state===R||r.state===N){if(typeof t==="function")t(null,null);return}M(this,A);if(e){var n=r.availableConnections.concat(r.inUseConnections);while(r.queue.length>0){var o=r.queue.shift();if(typeof o.cb==="function"){o.cb(new s("Pool was force destroyed"))}}return destroy(r,n,{force:true},t)}if(this.reconnectId){clearTimeout(this.reconnectId)}function checkStatus(){if(r.state===R||r.state===N){if(typeof t==="function"){t()}return}flushMonitoringOperations(r.queue);if(r.queue.length===0){var e=r.availableConnections.concat(r.inUseConnections);for(var n=0;n<e.length;n++){if(e[n].workItems.length>0){return setTimeout(checkStatus,1)}}destroy(r,e,{force:false},t)}else{_execute(r)();setTimeout(checkStatus,1)}}checkStatus()};Pool.prototype.reset=function(e){if(this.s.state!==k){if(typeof e==="function"){e(new s("pool is not connected, reset aborted"))}return}this.s.cancellationToken.emit("cancel");const t=this.availableConnections.concat(this.inUseConnections);E(t,((e,t)=>{for(const t of D){e.removeAllListeners(t)}e.destroy({force:true},t)}),(t=>{if(t){if(typeof e==="function"){e(t,null);return}}resetPoolState(this);createConnection(this,(()=>{if(typeof e==="function"){e(null,null)}}))}))};function serializeCommand(e,t,r){const n=t.toBin();const o=!!e.options.agreedCompressor;if(!o||!canCompress(t)){return r(null,n)}const s=S.concat(n);const i=s.slice(p);const a=s.readInt32LE(12);y(e,i,(function(n,o){if(n)return r(n,null);const s=S.alloc(p);s.writeInt32LE(p+h+o.length,0);s.writeInt32LE(t.requestId,4);s.writeInt32LE(0,8);s.writeInt32LE(m.OP_COMPRESSED,12);const c=S.alloc(h);c.writeInt32LE(a,0);c.writeInt32LE(i.length,4);c.writeUInt8(g[e.options.agreedCompressor],8);return r(null,[s,c,o])}))}Pool.prototype.write=function(e,t,r){var n=this;if(typeof t==="function"){r=t}t=t||{};if(!(typeof r==="function")&&!t.noResponse){throw new s("write method must provide a callback")}if(this.state===R||this.state===N){r(new s("pool destroyed"));return}if(this.state===A){r(new s("pool is draining, new operations prohibited"));return}if(this.options.domainsEnabled&&process.domain&&typeof r==="function"){var o=r;r=process.domain.bind((function(){var e=new Array(arguments.length);for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}process.nextTick((function(){o.apply(null,e)}))}))}var i={cb:r,raw:false,promoteLongs:true,promoteValues:true,promoteBuffers:false,fullResult:false};i.promoteLongs=typeof t.promoteLongs==="boolean"?t.promoteLongs:true;i.promoteValues=typeof t.promoteValues==="boolean"?t.promoteValues:true;i.promoteBuffers=typeof t.promoteBuffers==="boolean"?t.promoteBuffers:false;i.raw=typeof t.raw==="boolean"?t.raw:false;i.immediateRelease=typeof t.immediateRelease==="boolean"?t.immediateRelease:false;i.documentsReturnedIn=t.documentsReturnedIn;i.command=typeof t.command==="boolean"?t.command:false;i.fullResult=typeof t.fullResult==="boolean"?t.fullResult:false;i.noResponse=typeof t.noResponse==="boolean"?t.noResponse:false;i.session=t.session||null;i.socketTimeout=t.socketTimeout;i.monitoring=t.monitoring;i.requestId=e.requestId;if(n.options.monitorCommands){this.emit("commandStarted",new b.CommandStartedEvent(this,e));i.started=C();i.cb=(t,o)=>{if(t){n.emit("commandFailed",new b.CommandFailedEvent(this,e,t,i.started))}else{if(o&&o.result&&(o.result.ok===0||o.result.$err)){n.emit("commandFailed",new b.CommandFailedEvent(this,e,o.result,i.started))}else{n.emit("commandSucceeded",new b.CommandSucceededEvent(this,e,o,i.started))}}if(typeof r==="function")r(t,o)}}serializeCommand(n,e,((e,r)=>{if(e)throw e;i.buffer=r;if(t.monitoring){n.queue.unshift(i)}else{n.queue.push(i)}if(!n.executing){process.nextTick((function(){_execute(n)()}))}}))};function canCompress(e){const t=e instanceof u?e.command:e.query;const r=Object.keys(t)[0];return!v.has(r)}function remove(e,t){for(var r=0;r<t.length;r++){if(t[r]===e){t.splice(r,1);return true}}}function removeConnection(e,t){if(remove(t,e.availableConnections))return;if(remove(t,e.inUseConnections))return}function createConnection(e,t){if(e.state===R||e.state===N){if(typeof t==="function"){t(new s("Cannot create connection when pool is destroyed"))}return}e.connectingConnections++;w(e.options,e.s.cancellationToken,((r,n)=>{e.connectingConnections--;if(r){if(e.logger.isDebug()){e.logger.debug(`connection attempt failed with error [${JSON.stringify(r)}]`)}if(!e.reconnectId&&e.options.reconnect){if(e.state===I&&e.options.legacyCompatMode){t(r);return}e.reconnectError=r;e.reconnectId=setTimeout(attemptReconnect(e,t),e.options.reconnectInterval);return}if(typeof t==="function"){t(r)}return}if(e.state===R||e.state===N){if(typeof t==="function"){t(new s("Pool was destroyed after connection creation"))}n.destroy();return}n.on("error",e._connectionErrorHandler);n.on("close",e._connectionCloseHandler);n.on("timeout",e._connectionTimeoutHandler);n.on("parseError",e._connectionParseErrorHandler);n.on("message",e._messageHandler);e.availableConnections.push(n);if(typeof t==="function"){t(null,n)}_execute(e)()}))}function flushMonitoringOperations(e){for(var t=0;t<e.length;t++){if(e[t].monitoring){var r=e[t];e.splice(t,1);r.cb(new s({message:"no connection available for monitoring",driver:true}))}}}function _execute(e){return function(){if(e.state===R)return;if(e.executing)return;e.executing=true;if(e.connectingConnections>0){e.executing=false;return}while(true){const i=totalConnectionCount(e);if(e.availableConnections.length===0){flushMonitoringOperations(e.queue);if(i<e.options.size&&e.queue.length>0){createConnection(e)}break}if(e.queue.length===0){break}var t=null;const a=e.availableConnections.filter((e=>e.workItems.length===0));if(a.length===0){t=e.availableConnections[e.connectionIndex++%e.availableConnections.length]}else{t=a[e.connectionIndex++%a.length]}if(!t.isConnected()){removeConnection(e,t);flushMonitoringOperations(e.queue);break}var r=e.queue.shift();if(r.monitoring){var n=false;for(let r=0;r<e.availableConnections.length;r++){if(e.availableConnections[r].isConnected()&&e.availableConnections[r].workItems.length===0){n=true;t=e.availableConnections[r];break}}if(!n){e.queue.unshift(r);if(i<e.options.size&&e.queue.length>0){createConnection(e)}setTimeout((()=>_execute(e)()),10);break}}if(i<e.options.size){if(t.workItems.length>0){e.queue.unshift(r);createConnection(e);break}}var o=r.buffer;if(r.monitoring){moveConnectionBetween(t,e.availableConnections,e.inUseConnections)}if(!r.noResponse){t.workItems.push(r)}if(!r.immediateRelease&&typeof r.socketTimeout==="number"){t.setSocketTimeout(r.socketTimeout)}var s=true;if(Array.isArray(o)){for(let e=0;e<o.length;e++){s=t.write(o[e])}}else{s=t.write(o)}if(r.noResponse&&typeof r.cb==="function"){r.cb(null,null)}if(s===false){e.queue.unshift(r);removeConnection(e,t);flushMonitoringOperations(e.queue);break}}e.executing=false}}Pool._execute=_execute;e.exports=Pool},7746:(e,t,r)=>{"use strict";const n=r(3182)(require);function debugOptions(e,t){const r={};e.forEach((function(e){r[e]=t[e]}));return r}function retrieveBSON(){const e=r(4044);e.native=false;const t=n("bson-ext");if(t){t.native=true;return t}return e}function noSnappyWarning(){throw new Error("Attempted to use Snappy compression, but Snappy is not installed. Install or disable Snappy compression and try again.")}function retrieveSnappy(){let e=n("snappy");if(!e){e={compress:noSnappyWarning,uncompress:noSnappyWarning,compressSync:noSnappyWarning,uncompressSync:noSnappyWarning}}return e}e.exports={debugOptions:debugOptions,retrieveBSON:retrieveBSON,retrieveSnappy:retrieveSnappy}},4847:(e,t,r)=>{"use strict";const n=r(104);const o=r(7746).retrieveBSON;const s=r(3111).MongoError;const i=r(3111).MongoNetworkError;const a=r(1178).collationNotSupported;const c=r(4485);const l=r(1178).isUnifiedTopology;const u=r(2548);const d=r(2413).Readable;const p=r(1371).SUPPORTS;const h=r(1371).MongoDBNamespace;const m=r(1371).mergeOptions;const y=r(1018).OperationBase;const g=o();const v=g.Long;const b={INIT:0,OPEN:1,CLOSED:2,GET_MORE:3};function handleCallback(e,t,r){try{e(t,r)}catch(t){process.nextTick((function(){throw t}))}}class CoreCursor extends d{constructor(e,t,r,o){super({objectMode:true});o=o||{};if(t instanceof y){this.operation=t;t=this.operation.ns.toString();o=this.operation.options;r=this.operation.cmd?this.operation.cmd:{}}this.pool=null;this.server=null;this.disconnectHandler=o.disconnectHandler;this.bson=e.s.bson;this.ns=t;this.namespace=h.fromString(t);this.cmd=r;this.options=o;this.topology=e;this.cursorState={cursorId:null,cmd:r,documents:o.documents||[],cursorIndex:0,dead:false,killed:false,init:false,notified:false,limit:o.limit||r.limit||0,skip:o.skip||r.skip||0,batchSize:o.batchSize||r.batchSize||1e3,currentLimit:0,transforms:o.transforms,raw:o.raw||r&&r.raw};if(typeof o.session==="object"){this.cursorState.session=o.session}const s=e.s.options;if(typeof s.promoteLongs==="boolean"){this.cursorState.promoteLongs=s.promoteLongs}else if(typeof o.promoteLongs==="boolean"){this.cursorState.promoteLongs=o.promoteLongs}if(typeof s.promoteValues==="boolean"){this.cursorState.promoteValues=s.promoteValues}else if(typeof o.promoteValues==="boolean"){this.cursorState.promoteValues=o.promoteValues}if(typeof s.promoteBuffers==="boolean"){this.cursorState.promoteBuffers=s.promoteBuffers}else if(typeof o.promoteBuffers==="boolean"){this.cursorState.promoteBuffers=o.promoteBuffers}if(s.reconnect){this.cursorState.reconnect=s.reconnect}this.logger=n("Cursor",s);if(typeof r==="number"){this.cursorState.cursorId=v.fromNumber(r);this.cursorState.lastCursorId=this.cursorState.cursorId}else if(r instanceof v){this.cursorState.cursorId=r;this.cursorState.lastCursorId=r}if(this.operation){this.operation.cursorState=this.cursorState}}setCursorBatchSize(e){this.cursorState.batchSize=e}cursorBatchSize(){return this.cursorState.batchSize}setCursorLimit(e){this.cursorState.limit=e}cursorLimit(){return this.cursorState.limit}setCursorSkip(e){this.cursorState.skip=e}cursorSkip(){return this.cursorState.skip}_next(e){nextFunction(this,e)}clone(){const e=m({},this.options);delete e.session;return this.topology.cursor(this.ns,this.cmd,e)}isDead(){return this.cursorState.dead===true}isKilled(){return this.cursorState.killed===true}isNotified(){return this.cursorState.notified===true}bufferedCount(){return this.cursorState.documents.length-this.cursorState.cursorIndex}readBufferedDocuments(e){const t=this.cursorState.documents.length-this.cursorState.cursorIndex;const r=e<t?e:t;let n=this.cursorState.documents.slice(this.cursorState.cursorIndex,this.cursorState.cursorIndex+r);if(this.cursorState.transforms&&typeof this.cursorState.transforms.doc==="function"){for(let e=0;e<n.length;e++){n[e]=this.cursorState.transforms.doc(n[e])}}if(this.cursorState.limit>0&&this.cursorState.currentLimit+n.length>this.cursorState.limit){n=n.slice(0,this.cursorState.limit-this.cursorState.currentLimit);this.kill()}this.cursorState.currentLimit=this.cursorState.currentLimit+n.length;this.cursorState.cursorIndex=this.cursorState.cursorIndex+n.length;return n}kill(e){this.cursorState.dead=true;this.cursorState.killed=true;this.cursorState.documents=[];if(this.cursorState.cursorId==null||this.cursorState.cursorId.isZero()||this.cursorState.init===false){if(e)e(null,null);return}this.server.killCursors(this.ns,this.cursorState,e)}rewind(){if(this.cursorState.init){if(!this.cursorState.dead){this.kill()}this.cursorState.currentLimit=0;this.cursorState.init=false;this.cursorState.dead=false;this.cursorState.killed=false;this.cursorState.notified=false;this.cursorState.documents=[];this.cursorState.cursorId=null;this.cursorState.cursorIndex=0}}_read(){if(this.s&&this.s.state===b.CLOSED||this.isDead()){return this.push(null)}this._next(((e,t)=>{if(e){if(this.listeners("error")&&this.listeners("error").length>0){this.emit("error",e)}if(!this.isDead())this.close();this.emit("end");return this.emit("finish")}if(this.cursorState.streamOptions&&typeof this.cursorState.streamOptions.transform==="function"&&t!=null){return this.push(this.cursorState.streamOptions.transform(t))}this.push(t);if(t===null&&this.isDead()){this.once("end",(()=>{this.close();this.emit("finish")}))}}))}_endSession(e,t){if(typeof e==="function"){t=e;e={}}e=e||{};const r=this.cursorState.session;if(r&&(e.force||r.owner===this)){this.cursorState.session=undefined;if(this.operation){this.operation.clearSession()}r.endSession(t);return true}if(t){t()}return false}_getMore(e){if(this.logger.isDebug()){this.logger.debug(`schedule getMore call for query [${JSON.stringify(this.query)}]`)}let t=this.cursorState.batchSize;if(this.cursorState.limit>0&&this.cursorState.currentLimit+t>this.cursorState.limit){t=this.cursorState.limit-this.cursorState.currentLimit}const r=this.cursorState;this.server.getMore(this.ns,r,t,this.options,((t,n,o)=>{if(t||r.cursorId&&r.cursorId.isZero()){this._endSession()}e(t,n,o)}))}_initializeCursor(e){const t=this;if(l(t.topology)&&t.topology.shouldCheckForSessionSupport()){t.topology.selectServer(c.primaryPreferred,(t=>{if(t){e(t);return}this._initializeCursor(e)}));return}function done(r,n){const o=t.cursorState;if(r||o.cursorId&&o.cursorId.isZero()){t._endSession()}if(o.documents.length===0&&o.cursorId&&o.cursorId.isZero()&&!t.cmd.tailable&&!t.cmd.awaitData){return setCursorNotified(t,e)}e(r,n)}const queryCallback=(e,r)=>{if(e){return done(e)}const n=r.message;if(Array.isArray(n.documents)&&n.documents.length===1){const e=n.documents[0];if(n.queryFailure){return done(new s(e),null)}if(!t.cmd.find||t.cmd.find&&t.cmd.virtual===false){if(e.$err||e.errmsg){return done(new s(e),null)}if(e.cursor!=null&&typeof e.cursor!=="string"){const r=e.cursor.id;if(e.cursor.ns){t.ns=e.cursor.ns}t.cursorState.cursorId=typeof r==="number"?v.fromNumber(r):r;t.cursorState.lastCursorId=t.cursorState.cursorId;t.cursorState.operationTime=e.operationTime;if(Array.isArray(e.cursor.firstBatch)){t.cursorState.documents=e.cursor.firstBatch}return done(null,n)}}}const o=n.cursorId||0;t.cursorState.cursorId=o instanceof v?o:v.fromNumber(o);t.cursorState.documents=n.documents;t.cursorState.lastCursorId=n.cursorId;if(t.cursorState.transforms&&typeof t.cursorState.transforms.query==="function"){t.cursorState.documents=t.cursorState.transforms.query(n)}done(null,n)};if(t.operation){if(t.logger.isDebug()){t.logger.debug(`issue initial query [${JSON.stringify(t.cmd)}] with flags [${JSON.stringify(t.query)}]`)}u(t.topology,t.operation,((e,r)=>{if(e){done(e);return}t.server=t.operation.server;t.cursorState.init=true;if(t.cursorState.cursorId!=null){return done()}queryCallback(e,r)}));return}const r={};if(t.cursorState.session){r.session=t.cursorState.session}if(t.operation){r.readPreference=t.operation.readPreference}else if(t.options.readPreference){r.readPreference=t.options.readPreference}return t.topology.selectServer(r,((r,n)=>{if(r){const n=t.disconnectHandler;if(n!=null){return n.addObjectAndMethod("cursor",t,"next",[e],e)}return e(r)}t.server=n;t.cursorState.init=true;if(a(t.server,t.cmd)){return e(new s(`server ${t.server.name} does not support collation`))}if(t.cursorState.cursorId!=null){return done()}if(t.logger.isDebug()){t.logger.debug(`issue initial query [${JSON.stringify(t.cmd)}] with flags [${JSON.stringify(t.query)}]`)}if(t.cmd.find!=null){n.query(t.ns,t.cmd,t.cursorState,t.options,queryCallback);return}const o=Object.assign({session:t.cursorState.session},t.options);n.command(t.ns,t.cmd,o,queryCallback)}))}}if(p.ASYNC_ITERATOR){CoreCursor.prototype[Symbol.asyncIterator]=r(1749).asyncIterator}function isConnectionDead(e,t){if(e.pool&&e.pool.isDestroyed()){e.cursorState.killed=true;const r=new i(`connection to host ${e.pool.host}:${e.pool.port} was destroyed`);_setCursorNotifiedImpl(e,(()=>t(r)));return true}return false}function isCursorDeadButNotkilled(e,t){if(e.cursorState.dead&&!e.cursorState.killed){e.cursorState.killed=true;setCursorNotified(e,t);return true}return false}function isCursorDeadAndKilled(e,t){if(e.cursorState.dead&&e.cursorState.killed){handleCallback(t,new s("cursor is dead"));return true}return false}function isCursorKilled(e,t){if(e.cursorState.killed){setCursorNotified(e,t);return true}return false}function setCursorDeadAndNotified(e,t){e.cursorState.dead=true;setCursorNotified(e,t)}function setCursorNotified(e,t){_setCursorNotifiedImpl(e,(()=>handleCallback(t,null,null)))}function _setCursorNotifiedImpl(e,t){e.cursorState.notified=true;e.cursorState.documents=[];e.cursorState.cursorIndex=0;if(e.cursorState.session){e._endSession(t);return}return t()}function nextFunction(e,t){if(e.cursorState.notified){return t(new Error("cursor is exhausted"))}if(isCursorKilled(e,t))return;if(isCursorDeadButNotkilled(e,t))return;if(isCursorDeadAndKilled(e,t))return;if(!e.cursorState.init){if(!e.topology.isConnected(e.options)){if(e.topology._type==="server"&&!e.topology.s.options.reconnect){return t(new s("no connection available"))}if(e.disconnectHandler!=null){if(e.topology.isDestroyed()){return t(new s("Topology was destroyed"))}e.disconnectHandler.addObjectAndMethod("cursor",e,"next",[t],t);return}}e._initializeCursor(((r,n)=>{if(r||n===null){t(r,n);return}nextFunction(e,t)}));return}if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit){e.kill((()=>setCursorDeadAndNotified(e,t)))}else if(e.cursorState.cursorIndex===e.cursorState.documents.length&&!v.ZERO.equals(e.cursorState.cursorId)){e.cursorState.documents=[];e.cursorState.cursorIndex=0;if(e.topology.isDestroyed())return t(new i("connection destroyed, not possible to instantiate cursor"));if(isConnectionDead(e,t))return;e._getMore((function(r,n,o){if(r){return handleCallback(t,r)}e.connection=o;if(e.cursorState.documents.length===0&&e.cmd.tailable&&v.ZERO.equals(e.cursorState.cursorId)){return handleCallback(t,new s({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData}))}else if(e.cursorState.documents.length===0&&e.cmd.tailable&&!v.ZERO.equals(e.cursorState.cursorId)){return nextFunction(e,t)}if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit){return setCursorDeadAndNotified(e,t)}nextFunction(e,t)}))}else if(e.cursorState.documents.length===e.cursorState.cursorIndex&&e.cmd.tailable&&v.ZERO.equals(e.cursorState.cursorId)){return handleCallback(t,new s({message:"No more documents in tailed cursor",tailable:e.cmd.tailable,awaitData:e.cmd.awaitData}))}else if(e.cursorState.documents.length===e.cursorState.cursorIndex&&v.ZERO.equals(e.cursorState.cursorId)){setCursorDeadAndNotified(e,t)}else{if(e.cursorState.limit>0&&e.cursorState.currentLimit>=e.cursorState.limit){e.kill((()=>setCursorDeadAndNotified(e,t)));return}e.cursorState.currentLimit+=1;let r=e.cursorState.documents[e.cursorState.cursorIndex++];if(!r||r.$err){e.kill((()=>setCursorDeadAndNotified(e,(function(){handleCallback(t,new s(r?r.$err:undefined))}))));return}if(e.cursorState.transforms&&typeof e.cursorState.transforms.doc==="function"){r=e.cursorState.transforms.doc(r)}handleCallback(t,null,r)}}e.exports={CursorState:b,CoreCursor:CoreCursor}},3111:e=>{"use strict";const t=Symbol("errorLabels");class MongoError extends Error{constructor(e){if(e instanceof Error){super(e.message);this.stack=e.stack}else{if(typeof e==="string"){super(e)}else{super(e.message||e.errmsg||e.$err||"n/a");if(e.errorLabels){this[t]=new Set(e.errorLabels)}for(var r in e){if(r==="errorLabels"||r==="errmsg"){continue}this[r]=e[r]}}Error.captureStackTrace(this,this.constructor)}this.name="MongoError"}get errmsg(){return this.message}static create(e){return new MongoError(e)}hasErrorLabel(e){if(this[t]==null){return false}return this[t].has(e)}addErrorLabel(e){if(this[t]==null){this[t]=new Set}this[t].add(e)}get errorLabels(){return this[t]?Array.from(this[t]):[]}}const r=Symbol("beforeHandshake");function isNetworkErrorBeforeHandshake(e){return e[r]===true}class MongoNetworkError extends MongoError{constructor(e,t){super(e);this.name="MongoNetworkError";if(t&&typeof t.beforeHandshake==="boolean"){this[r]=t.beforeHandshake}}}class MongoNetworkTimeoutError extends MongoNetworkError{constructor(e,t){super(e,t);this.name="MongoNetworkTimeoutError"}}class MongoParseError extends MongoError{constructor(e){super(e);this.name="MongoParseError"}}class MongoTimeoutError extends MongoError{constructor(e,t){if(t&&t.error){super(t.error.message||t.error)}else{super(e)}this.name="MongoTimeoutError";if(t){this.reason=t}}}class MongoServerSelectionError extends MongoTimeoutError{constructor(e,t){super(e,t);this.name="MongoServerSelectionError"}}function makeWriteConcernResultObject(e){const t=Object.assign({},e);if(t.ok===0){t.ok=1;delete t.errmsg;delete t.code;delete t.codeName}return t}class MongoWriteConcernError extends MongoError{constructor(e,r){super(e);this.name="MongoWriteConcernError";if(r&&Array.isArray(r.errorLabels)){this[t]=new Set(r.errorLabels)}if(r!=null){this.result=makeWriteConcernResultObject(r)}}}const n=new Set([6,7,89,91,189,9001,10107,11600,11602,13435,13436]);const o=new Set([11600,11602,10107,13435,13436,189,91,7,6,89,9001,262]);function isRetryableWriteError(e){if(e instanceof MongoWriteConcernError){return o.has(e.code)||o.has(e.result.code)}return o.has(e.code)}function isRetryableError(e){return n.has(e.code)||e instanceof MongoNetworkError||e.message.match(/not master/)||e.message.match(/node is recovering/)}const s=new Set([91,189,11600,11602,13436]);const i=new Set([10107,13435]);const a=new Set([11600,91]);function isRecoveringError(e){if(e.code&&s.has(e.code)){return true}return e.message.match(/not master or secondary/)||e.message.match(/node is recovering/)}function isNotMasterError(e){if(e.code&&i.has(e.code)){return true}if(isRecoveringError(e)){return false}return e.message.match(/not master/)}function isNodeShuttingDownError(e){return e.code&&a.has(e.code)}function isSDAMUnrecoverableError(e){if(e instanceof MongoParseError||e==null){return true}if(isRecoveringError(e)||isNotMasterError(e)){return true}return false}e.exports={MongoError:MongoError,MongoNetworkError:MongoNetworkError,MongoNetworkTimeoutError:MongoNetworkTimeoutError,MongoParseError:MongoParseError,MongoTimeoutError:MongoTimeoutError,MongoServerSelectionError:MongoServerSelectionError,MongoWriteConcernError:MongoWriteConcernError,isRetryableError:isRetryableError,isSDAMUnrecoverableError:isSDAMUnrecoverableError,isNodeShuttingDownError:isNodeShuttingDownError,isRetryableWriteError:isRetryableWriteError,isNetworkErrorBeforeHandshake:isNetworkErrorBeforeHandshake}},3994:(e,t,r)=>{"use strict";let n=r(4044);const o=r(3182)(require);const s=r(1178).retrieveEJSON();try{const e=o("bson-ext");if(e){n=e}}catch(e){}e.exports={MongoError:r(3111).MongoError,MongoNetworkError:r(3111).MongoNetworkError,MongoParseError:r(3111).MongoParseError,MongoTimeoutError:r(3111).MongoTimeoutError,MongoServerSelectionError:r(3111).MongoServerSelectionError,MongoWriteConcernError:r(3111).MongoWriteConcernError,Connection:r(6096),Server:r(6495),ReplSet:r(1134),Mongos:r(8175),Logger:r(104),Cursor:r(4847).CoreCursor,ReadPreference:r(4485),Sessions:r(5474),BSON:n,EJSON:s,Topology:r(4149).Topology,Query:r(9814).Query,MongoCredentials:r(2222).MongoCredentials,defaultAuthProviders:r(2192).defaultAuthProviders,MongoCR:r(4228),X509:r(7324),Plain:r(8728),GSSAPI:r(2640),ScramSHA1:r(864).ScramSHA1,ScramSHA256:r(864).ScramSHA256,parseConnectionString:r(8767)}},2291:e=>{"use strict";const t="closing";const r="closed";const n="connecting";const o="connected";const s={Single:"Single",ReplicaSetNoPrimary:"ReplicaSetNoPrimary",ReplicaSetWithPrimary:"ReplicaSetWithPrimary",Sharded:"Sharded",Unknown:"Unknown"};const i={Standalone:"Standalone",Mongos:"Mongos",PossiblePrimary:"PossiblePrimary",RSPrimary:"RSPrimary",RSSecondary:"RSSecondary",RSArbiter:"RSArbiter",RSOther:"RSOther",RSGhost:"RSGhost",Unknown:"Unknown"};function serverType(e){let t=e.s.description||e.s.serverDescription;if(t.topologyType===s.Single)return t.servers[0].type;return t.type}const a={useUnifiedTopology:true,localThresholdMS:15,serverSelectionTimeoutMS:3e4,heartbeatFrequencyMS:1e4,minHeartbeatFrequencyMS:500};function drainTimerQueue(e){e.forEach(clearTimeout);e.clear()}function clearAndRemoveTimerFrom(e,t){clearTimeout(e);return t.delete(e)}e.exports={STATE_CLOSING:t,STATE_CLOSED:r,STATE_CONNECTING:n,STATE_CONNECTED:o,TOPOLOGY_DEFAULTS:a,TopologyType:s,ServerType:i,serverType:serverType,drainTimerQueue:drainTimerQueue,clearAndRemoveTimerFrom:clearAndRemoveTimerFrom}},2785:e=>{"use strict";class ServerDescriptionChangedEvent{constructor(e,t,r,n){Object.assign(this,{topologyId:e,address:t,previousDescription:r,newDescription:n})}}class ServerOpeningEvent{constructor(e,t){Object.assign(this,{topologyId:e,address:t})}}class ServerClosedEvent{constructor(e,t){Object.assign(this,{topologyId:e,address:t})}}class TopologyDescriptionChangedEvent{constructor(e,t,r){Object.assign(this,{topologyId:e,previousDescription:t,newDescription:r})}}class TopologyOpeningEvent{constructor(e){Object.assign(this,{topologyId:e})}}class TopologyClosedEvent{constructor(e){Object.assign(this,{topologyId:e})}}class ServerHeartbeatStartedEvent{constructor(e){Object.assign(this,{connectionId:e})}}class ServerHeartbeatSucceededEvent{constructor(e,t,r){Object.assign(this,{connectionId:r,duration:e,reply:t})}}class ServerHeartbeatFailedEvent{constructor(e,t,r){Object.assign(this,{connectionId:r,duration:e,failure:t})}}e.exports={ServerDescriptionChangedEvent:ServerDescriptionChangedEvent,ServerOpeningEvent:ServerOpeningEvent,ServerClosedEvent:ServerClosedEvent,TopologyDescriptionChangedEvent:TopologyDescriptionChangedEvent,TopologyOpeningEvent:TopologyOpeningEvent,TopologyClosedEvent:TopologyClosedEvent,ServerHeartbeatStartedEvent:ServerHeartbeatStartedEvent,ServerHeartbeatSucceededEvent:ServerHeartbeatSucceededEvent,ServerHeartbeatFailedEvent:ServerHeartbeatFailedEvent}},1203:(e,t,r)=>{"use strict";const n=r(2291).ServerType;const o=r(8614);const s=r(6573);const i=r(9820).Connection;const a=r(2291);const c=r(1178).makeStateMachine;const l=r(3111).MongoNetworkError;const u=r(7746).retrieveBSON();const d=r(1371).makeInterruptableAsyncInterval;const p=r(1371).calculateDurationInMs;const h=r(1371).now;const m=r(2785);const y=m.ServerHeartbeatStartedEvent;const g=m.ServerHeartbeatSucceededEvent;const v=m.ServerHeartbeatFailedEvent;const b=Symbol("server");const S=Symbol("monitorId");const w=Symbol("connection");const _=Symbol("cancellationToken");const E=Symbol("rttPinger");const O=Symbol("roundTripTime");const C=a.STATE_CLOSED;const T=a.STATE_CLOSING;const I="idle";const k="monitoring";const A=c({[T]:[T,I,C],[C]:[C,k],[I]:[I,k,T],[k]:[k,I,T]});const N=new Set([T,C,k]);function isInCloseState(e){return e.s.state===C||e.s.state===T}class Monitor extends o{constructor(e,t){super(t);this[b]=e;this[w]=undefined;this[_]=new o;this[_].setMaxListeners(Infinity);this[S]=null;this.s={state:C};this.address=e.description.address;this.options=Object.freeze({connectTimeoutMS:typeof t.connectionTimeout==="number"?t.connectionTimeout:typeof t.connectTimeoutMS==="number"?t.connectTimeoutMS:1e4,heartbeatFrequencyMS:typeof t.heartbeatFrequencyMS==="number"?t.heartbeatFrequencyMS:1e4,minHeartbeatFrequencyMS:typeof t.minHeartbeatFrequencyMS==="number"?t.minHeartbeatFrequencyMS:500});const r=Object.assign({id:"<monitor>",host:e.description.host,port:e.description.port,bson:e.s.bson,connectionType:i},e.s.options,this.options,{raw:false,promoteLongs:true,promoteValues:true,promoteBuffers:true});delete r.credentials;delete r.autoEncrypter;this.connectOptions=Object.freeze(r)}connect(){if(this.s.state!==C){return}const e=this.options.heartbeatFrequencyMS;const t=this.options.minHeartbeatFrequencyMS;this[S]=d(monitorServer(this),{interval:e,minInterval:t,immediate:true})}requestCheck(){if(N.has(this.s.state)){return}this[S].wake()}reset(){const e=this[b].description.topologyVersion;if(isInCloseState(this)||e==null){return}A(this,T);resetMonitorState(this);A(this,I);const t=this.options.heartbeatFrequencyMS;const r=this.options.minHeartbeatFrequencyMS;this[S]=d(monitorServer(this),{interval:t,minInterval:r})}close(){if(isInCloseState(this)){return}A(this,T);resetMonitorState(this);this.emit("close");A(this,C)}}function resetMonitorState(e){if(e[S]){e[S].stop();e[S]=null}if(e[E]){e[E].close();e[E]=undefined}e[_].emit("cancel");if(e[S]){clearTimeout(e[S]);e[S]=undefined}if(e[w]){e[w].destroy({force:true})}}function checkServer(e,t){let r=h();e.emit("serverHeartbeatStarted",new y(e.address));function failureHandler(n){if(e[w]){e[w].destroy({force:true});e[w]=undefined}e.emit("serverHeartbeatFailed",new v(p(r),n,e.address));e.emit("resetServer",n);e.emit("resetConnectionPool");t(n)}if(e[w]!=null&&!e[w].closed){const n=e.options.connectTimeoutMS;const o=e.options.heartbeatFrequencyMS;const s=e[b].description.topologyVersion;const i=s!=null;const a={ismaster:true};const c={socketTimeout:n};if(i){a.maxAwaitTimeMS=o;a.topologyVersion=makeTopologyVersion(s);if(n){c.socketTimeout=n+o}c.exhaustAllowed=true;if(e[E]==null){e[E]=new RTTPinger(e[_],e.connectOptions)}}e[w].command("admin.$cmd",a,c,((n,o)=>{if(n){failureHandler(n);return}const s=o.result;const a=e[E];const c=i&&a?a.roundTripTime:p(r);e.emit("serverHeartbeatSucceeded",new g(c,s,e.address));if(i&&s.topologyVersion){e.emit("serverHeartbeatStarted",new y(e.address));r=h()}else{if(e[E]){e[E].close();e[E]=undefined}t(undefined,s)}}));return}s(e.connectOptions,e[_],((n,o)=>{if(o&&isInCloseState(e)){o.destroy({force:true});return}if(n){e[w]=undefined;if(!(n instanceof l)){e.emit("resetConnectionPool")}failureHandler(n);return}e[w]=o;e.emit("serverHeartbeatSucceeded",new g(p(r),o.ismaster,e.address));t(undefined,o.ismaster)}))}function monitorServer(e){return t=>{A(e,k);function done(){if(!isInCloseState(e)){A(e,I)}t()}process.nextTick((()=>e.emit("monitoring",e[b])));checkServer(e,((t,r)=>{if(t){if(e[b].description.type===n.Unknown){e.emit("resetServer",t);return done()}}if(r&&r.topologyVersion){setTimeout((()=>{if(!isInCloseState(e)){e[S].wake()}}))}done()}))}}function makeTopologyVersion(e){return{processId:e.processId,counter:u.Long.fromNumber(e.counter)}}class RTTPinger{constructor(e,t){this[w]=null;this[_]=e;this[O]=0;this.closed=false;const r=t.heartbeatFrequencyMS;this[S]=setTimeout((()=>measureRoundTripTime(this,t)),r)}get roundTripTime(){return this[O]}close(){this.closed=true;clearTimeout(this[S]);this[S]=undefined;if(this[w]){this[w].destroy({force:true})}}}function measureRoundTripTime(e,t){const r=h();const n=e[_];const o=t.heartbeatFrequencyMS;if(e.closed){return}function measureAndReschedule(n){if(e.closed){n.destroy({force:true});return}if(e[w]==null){e[w]=n}e[O]=p(r);e[S]=setTimeout((()=>measureRoundTripTime(e,t)),o)}if(e[w]==null){s(t,n,((t,r)=>{if(t){e[w]=undefined;e[O]=0;return}measureAndReschedule(r)}));return}e[w].command("admin.$cmd",{ismaster:1},(t=>{if(t){e[w]=undefined;e[O]=0;return}measureAndReschedule()}))}e.exports={Monitor:Monitor}},7062:(e,t,r)=>{"use strict";const n=r(8614);const o=r(2529).ConnectionPool;const s=r(897).CMAP_EVENT_NAMES;const i=r(3111).MongoError;const a=r(1178).relayEvents;const c=r(7746).retrieveBSON();const l=r(104);const u=r(750).ServerDescription;const d=r(750).compareTopologyVersion;const p=r(4485);const h=r(1203).Monitor;const m=r(3111).MongoNetworkError;const y=r(3111).MongoNetworkTimeoutError;const g=r(1178).collationNotSupported;const v=r(7746).debugOptions;const b=r(3111).isSDAMUnrecoverableError;const S=r(3111).isRetryableWriteError;const w=r(3111).isNodeShuttingDownError;const _=r(3111).isNetworkErrorBeforeHandshake;const E=r(1178).maxWireVersion;const O=r(1178).makeStateMachine;const C=r(2291);const T=C.ServerType;const I=r(1707).isTransactionCommand;const k=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"];const A=C.STATE_CLOSING;const N=C.STATE_CLOSED;const R=C.STATE_CONNECTING;const M=C.STATE_CONNECTED;const D=O({[N]:[N,R],[R]:[R,A,M,N],[M]:[M,A,N],[A]:[A,N]});const P=Symbol("monitor");class Server extends n{constructor(e,t,r){super();this.s={description:e,options:t,logger:l("Server",t),bson:t.bson||new c([c.Binary,c.Code,c.DBRef,c.Decimal128,c.Double,c.Int32,c.Long,c.Map,c.MaxKey,c.MinKey,c.ObjectId,c.BSONRegExp,c.Symbol,c.Timestamp]),state:N,credentials:t.credentials,topology:r};const n=Object.assign({host:this.description.host,port:this.description.port,bson:this.s.bson},t);this.s.pool=new o(n);a(this.s.pool,this,["commandStarted","commandSucceeded","commandFailed"].concat(s));this.s.pool.on("clusterTimeReceived",(e=>{this.clusterTime=e}));this[P]=new h(this,this.s.options);a(this[P],this,["serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","monitoring"]);this[P].on("resetConnectionPool",(()=>{this.s.pool.clear()}));this[P].on("resetServer",(e=>markServerUnknown(this,e)));this[P].on("serverHeartbeatSucceeded",(e=>{this.emit("descriptionReceived",new u(this.description.address,e.reply,{roundTripTime:calculateRoundTripTime(this.description.roundTripTime,e.duration)}));if(this.s.state===R){D(this,M);this.emit("connect",this)}}))}get description(){return this.s.description}get name(){return this.s.description.address}get autoEncrypter(){if(this.s.options&&this.s.options.autoEncrypter){return this.s.options.autoEncrypter}return null}connect(){if(this.s.state!==N){return}D(this,R);this[P].connect()}destroy(e,t){if(typeof e==="function")t=e,e={};e=Object.assign({},{force:false},e);if(this.s.state===N){if(typeof t==="function"){t()}return}D(this,A);this[P].close();this.s.pool.close(e,(e=>{D(this,N);this.emit("closed");if(typeof t==="function"){t(e)}}))}requestCheck(){this[P].requestCheck()}command(e,t,r,n){if(typeof r==="function"){n=r,r={},r=r||{}}if(this.s.state===A||this.s.state===N){n(new i("server is closed"));return}const o=basicReadValidations(this,r);if(o){return n(o)}r=Object.assign({},r,{wireProtocolCommand:false});if(this.s.logger.isDebug()){this.s.logger.debug(`executing command [${JSON.stringify({ns:e,cmd:t,options:v(k,r)})}] against ${this.name}`)}if(g(this,t)){n(new i(`server ${this.name} does not support collation`));return}this.s.pool.withConnection(((n,o,s)=>{if(n){markServerUnknown(this,n);return s(n)}o.command(e,t,r,makeOperationHandler(this,o,t,r,s))}),n)}query(e,t,r,n,o){if(this.s.state===A||this.s.state===N){o(new i("server is closed"));return}this.s.pool.withConnection(((o,s,i)=>{if(o){markServerUnknown(this,o);return i(o)}s.query(e,t,r,n,makeOperationHandler(this,s,t,n,i))}),o)}getMore(e,t,r,n,o){if(this.s.state===A||this.s.state===N){o(new i("server is closed"));return}this.s.pool.withConnection(((o,s,i)=>{if(o){markServerUnknown(this,o);return i(o)}s.getMore(e,t,r,n,makeOperationHandler(this,s,null,n,i))}),o)}killCursors(e,t,r){if(this.s.state===A||this.s.state===N){if(typeof r==="function"){r(new i("server is closed"))}return}this.s.pool.withConnection(((r,n,o)=>{if(r){markServerUnknown(this,r);return o(r)}n.killCursors(e,t,makeOperationHandler(this,n,null,undefined,o))}),r)}insert(e,t,r,n){executeWriteOperation({server:this,op:"insert",ns:e,ops:t},r,n)}update(e,t,r,n){executeWriteOperation({server:this,op:"update",ns:e,ops:t},r,n)}remove(e,t,r,n){executeWriteOperation({server:this,op:"remove",ns:e,ops:t},r,n)}}Object.defineProperty(Server.prototype,"clusterTime",{get:function(){return this.s.topology.clusterTime},set:function(e){this.s.topology.clusterTime=e}});function supportsRetryableWrites(e){return e.description.maxWireVersion>=6&&e.description.logicalSessionTimeoutMinutes&&e.description.type!==T.Standalone}function calculateRoundTripTime(e,t){if(e===-1){return t}const r=.2;return r*t+(1-r)*e}function basicReadValidations(e,t){if(t.readPreference&&!(t.readPreference instanceof p)){return new i("readPreference must be an instance of ReadPreference")}}function executeWriteOperation(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};const n=e.server;const o=e.op;const s=e.ns;const a=Array.isArray(e.ops)?e.ops:[e.ops];if(n.s.state===A||n.s.state===N){r(new i("server is closed"));return}if(g(n,t)){r(new i(`server ${n.name} does not support collation`));return}const c=t.writeConcern&&t.writeConcern.w===0;if(c||E(n)<5){if((o==="update"||o==="remove")&&a.find((e=>e.hint))){r(new i(`servers < 3.4 do not support hint on ${o}`));return}}n.s.pool.withConnection(((e,r,i)=>{if(e){markServerUnknown(n,e);return i(e)}r[o](s,a,t,makeOperationHandler(n,r,a,t,i))}),r)}function markServerUnknown(e,t){if(t instanceof m&&!(t instanceof y)){e[P].reset()}e.emit("descriptionReceived",new u(e.description.address,null,{error:t,topologyVersion:t&&t.topologyVersion?t.topologyVersion:e.description.topologyVersion}))}function connectionIsStale(e,t){return t.generation!==e.generation}function shouldHandleStateChangeError(e,t){const r=t.topologyVersion;const n=e.description.topologyVersion;return d(n,r)<0}function inActiveTransaction(e,t){return e&&e.inTransaction()&&!I(t)}function makeOperationHandler(e,t,r,n,o){const s=n&&n.session;return function handleOperationResult(n,i){if(n&&!connectionIsStale(e.s.pool,t)){if(n instanceof m){if(s&&!s.hasEnded){s.serverSession.isDirty=true}if(supportsRetryableWrites(e)&&!inActiveTransaction(s,r)){n.addErrorLabel("RetryableWriteError")}if(!(n instanceof y)||_(n)){markServerUnknown(e,n);e.s.pool.clear()}}else{if(E(e)<9&&S(n)&&!inActiveTransaction(s,r)){n.addErrorLabel("RetryableWriteError")}if(b(n)){if(shouldHandleStateChangeError(e,n)){if(E(e)<=7||w(n)){e.s.pool.clear()}markServerUnknown(e,n);process.nextTick((()=>e.requestCheck()))}}}}o(n,i)}}e.exports={Server:Server}},750:(e,t,r)=>{"use strict";const n=r(1178).arrayStrictEqual;const o=r(1178).tagsStrictEqual;const s=r(1178).errorStrictEqual;const i=r(2291).ServerType;const a=r(1371).now;const c=new Set([i.RSPrimary,i.Standalone,i.Mongos]);const l=new Set([i.RSPrimary,i.RSSecondary,i.Mongos,i.Standalone]);const u=["minWireVersion","maxWireVersion","maxBsonObjectSize","maxMessageSizeBytes","maxWriteBatchSize","compression","me","hosts","passives","arbiters","tags","setName","setVersion","electionId","primary","logicalSessionTimeoutMinutes","saslSupportedMechs","__nodejs_mock_server__","$clusterTime"];class ServerDescription{constructor(e,t,r){r=r||{};t=Object.assign({minWireVersion:0,maxWireVersion:0,hosts:[],passives:[],arbiters:[],tags:[]},t);this.address=e;this.error=r.error;this.roundTripTime=r.roundTripTime||-1;this.lastUpdateTime=a();this.lastWriteDate=t.lastWrite?t.lastWrite.lastWriteDate:null;this.opTime=t.lastWrite?t.lastWrite.opTime:null;this.type=parseServerType(t);this.topologyVersion=r.topologyVersion||t.topologyVersion;u.forEach((e=>{if(typeof t[e]!=="undefined")this[e]=t[e]}));if(this.me)this.me=this.me.toLowerCase();this.hosts=this.hosts.map((e=>e.toLowerCase()));this.passives=this.passives.map((e=>e.toLowerCase()));this.arbiters=this.arbiters.map((e=>e.toLowerCase()))}get allHosts(){return this.hosts.concat(this.arbiters).concat(this.passives)}get isReadable(){return this.type===i.RSSecondary||this.isWritable}get isDataBearing(){return l.has(this.type)}get isWritable(){return c.has(this.type)}get host(){const e=`:${this.port}`.length;return this.address.slice(0,-e)}get port(){const e=this.address.split(":").pop();return e?Number.parseInt(e,10):e}equals(e){const t=this.topologyVersion===e.topologyVersion||compareTopologyVersion(this.topologyVersion,e.topologyVersion)===0;return e!=null&&s(this.error,e.error)&&this.type===e.type&&this.minWireVersion===e.minWireVersion&&this.me===e.me&&n(this.hosts,e.hosts)&&o(this.tags,e.tags)&&this.setName===e.setName&&this.setVersion===e.setVersion&&(this.electionId?e.electionId&&this.electionId.equals(e.electionId):this.electionId===e.electionId)&&this.primary===e.primary&&this.logicalSessionTimeoutMinutes===e.logicalSessionTimeoutMinutes&&t}}function parseServerType(e){if(!e||!e.ok){return i.Unknown}if(e.isreplicaset){return i.RSGhost}if(e.msg&&e.msg==="isdbgrid"){return i.Mongos}if(e.setName){if(e.hidden){return i.RSOther}else if(e.ismaster){return i.RSPrimary}else if(e.secondary){return i.RSSecondary}else if(e.arbiterOnly){return i.RSArbiter}else{return i.RSOther}}return i.Standalone}function compareTopologyVersion(e,t){if(e==null||t==null){return-1}if(e.processId.equals(t.processId)){if(e.counter===t.counter){return 0}else if(e.counter<t.counter){return-1}return 1}return-1}e.exports={ServerDescription:ServerDescription,parseServerType:parseServerType,compareTopologyVersion:compareTopologyVersion}},4547:(e,t,r)=>{"use strict";const n=r(2291).ServerType;const o=r(2291).TopologyType;const s=r(4485);const i=r(3111).MongoError;const a=1e4;const c=90;function writableServerSelector(){return function(e,t){return latencyWindowReducer(e,t.filter((e=>e.isWritable)))}}function maxStalenessReducer(e,t,r){if(e.maxStalenessSeconds==null||e.maxStalenessSeconds<0){return r}const n=e.maxStalenessSeconds;const s=(t.heartbeatFrequencyMS+a)/1e3;if(n<s){throw new i(`maxStalenessSeconds must be at least ${s} seconds`)}if(n<c){throw new i(`maxStalenessSeconds must be at least ${c} seconds`)}if(t.type===o.ReplicaSetWithPrimary){const n=Array.from(t.servers.values()).filter(primaryFilter)[0];return r.reduce(((r,o)=>{const s=o.lastUpdateTime-o.lastWriteDate-(n.lastUpdateTime-n.lastWriteDate)+t.heartbeatFrequencyMS;const i=s/1e3;if(i<=e.maxStalenessSeconds)r.push(o);return r}),[])}if(t.type===o.ReplicaSetNoPrimary){if(r.length===0){return r}const n=r.reduce(((e,t)=>t.lastWriteDate>e.lastWriteDate?t:e));return r.reduce(((r,o)=>{const s=n.lastWriteDate-o.lastWriteDate+t.heartbeatFrequencyMS;const i=s/1e3;if(i<=e.maxStalenessSeconds)r.push(o);return r}),[])}return r}function tagSetMatch(e,t){const r=Object.keys(e);const n=Object.keys(t);for(let o=0;o<r.length;++o){const s=r[o];if(n.indexOf(s)===-1||t[s]!==e[s]){return false}}return true}function tagSetReducer(e,t){if(e.tags==null||Array.isArray(e.tags)&&e.tags.length===0){return t}for(let r=0;r<e.tags.length;++r){const n=e.tags[r];const o=t.reduce(((e,t)=>{if(tagSetMatch(n,t.tags))e.push(t);return e}),[]);if(o.length){return o}}return[]}function latencyWindowReducer(e,t){const r=t.reduce(((e,t)=>e===-1?t.roundTripTime:Math.min(t.roundTripTime,e)),-1);const n=r+e.localThresholdMS;return t.reduce(((e,t)=>{if(t.roundTripTime<=n&&t.roundTripTime>=r)e.push(t);return e}),[])}function primaryFilter(e){return e.type===n.RSPrimary}function secondaryFilter(e){return e.type===n.RSSecondary}function nearestFilter(e){return e.type===n.RSSecondary||e.type===n.RSPrimary}function knownFilter(e){return e.type!==n.Unknown}function readPreferenceServerSelector(e){if(!e.isValid()){throw new TypeError("Invalid read preference specified")}return function(t,r){const n=t.commonWireVersion;if(n&&e.minWireVersion&&e.minWireVersion>n){throw new i(`Minimum wire version '${e.minWireVersion}' required, but found '${n}'`)}if(t.type===o.Unknown){return[]}if(t.type===o.Single||t.type===o.Sharded){return latencyWindowReducer(t,r.filter(knownFilter))}const a=e.mode;if(a===s.PRIMARY){return r.filter(primaryFilter)}if(a===s.PRIMARY_PREFERRED){const e=r.filter(primaryFilter);if(e.length){return e}}const c=a===s.NEAREST?nearestFilter:secondaryFilter;const l=latencyWindowReducer(t,tagSetReducer(e,maxStalenessReducer(e,t,r.filter(c))));if(a===s.SECONDARY_PREFERRED&&l.length===0){return r.filter(primaryFilter)}return l}}e.exports={writableServerSelector:writableServerSelector,readPreferenceServerSelector:readPreferenceServerSelector}},9663:(e,t,r)=>{"use strict";var n;const o=r(104);const s=r(8614).EventEmitter;const i=r(881);function matchesParentDomain(e,t){const r=/^.*?\./;const n=`.${e.replace(r,"")}`;const o=`.${t.replace(r,"")}`;return n.endsWith(o)}class SrvPollingEvent{constructor(e){this.srvRecords=e}addresses(){return new Set(this.srvRecords.map((e=>`${e.name}:${e.port}`)))}}class SrvPoller extends s{constructor(e){super();if(!e||!e.srvHost){throw new TypeError("options for SrvPoller must exist and include srvHost")}this.srvHost=e.srvHost;this.rescanSrvIntervalMS=6e4;this.heartbeatFrequencyMS=e.heartbeatFrequencyMS||1e4;this.logger=o("srvPoller",e);this.haMode=false;this.generation=0;this._timeout=null}get srvAddress(){return`_mongodb._tcp.${this.srvHost}`}get intervalMS(){return this.haMode?this.heartbeatFrequencyMS:this.rescanSrvIntervalMS}start(){if(!this._timeout){this.schedule()}}stop(){if(this._timeout){clearTimeout(this._timeout);this.generation+=1;this._timeout=null}}schedule(){clearTimeout(this._timeout);this._timeout=setTimeout((()=>this._poll()),this.intervalMS)}success(e){this.haMode=false;this.schedule();this.emit("srvRecordDiscovery",new SrvPollingEvent(e))}failure(e,t){this.logger.warn(e,t);this.haMode=true;this.schedule()}parentDomainMismatch(e){this.logger.warn(`parent domain mismatch on SRV record (${e.name}:${e.port})`,e)}_poll(){const e=this.generation;i.resolveSrv(this.srvAddress,((t,r)=>{if(e!==this.generation){return}if(t){this.failure("DNS error",t);return}const n=[];r.forEach((e=>{if(matchesParentDomain(e.name,this.srvHost)){n.push(e)}else{this.parentDomainMismatch(e)}}));if(!n.length){this.failure("No valid addresses found at host");return}this.success(n)}))}}n=SrvPollingEvent;e.exports.D=SrvPoller},4149:(e,t,r)=>{"use strict";const n=r(2342);const o=r(8614);const s=r(750).ServerDescription;const i=r(2291).ServerType;const a=r(7962).TopologyDescription;const c=r(2291).TopologyType;const l=r(2785);const u=r(7062).Server;const d=r(1178).relayEvents;const p=r(4485);const h=r(2306).isRetryableWritesSupported;const m=r(4847).CoreCursor;const y=r(1669).deprecate;const g=r(7746).retrieveBSON();const v=r(2306).createCompressionInfo;const b=r(5474).ClientSession;const S=r(3111).MongoError;const w=r(3111).MongoServerSelectionError;const _=r(2306).resolveClusterTime;const E=r(9663).D;const O=r(2306).getMMAPError;const C=r(1178).makeStateMachine;const T=r(1178).eachAsync;const I=r(1371).emitDeprecationWarning;const k=r(5474).ServerSessionPool;const A=r(1178).makeClientMetadata;const N=r(897).CMAP_EVENT_NAMES;const R=r(750).compareTopologyVersion;const M=r(1371).emitWarning;const D=r(2291);const P=D.drainTimerQueue;const L=D.clearAndRemoveTimerFrom;const B=r(4547);const j=B.readPreferenceServerSelector;const U=B.writableServerSelector;let F=0;const $=["serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","commandStarted","commandSucceeded","commandFailed","monitoring"].concat(N);const W=["connect","descriptionReceived","close","ended"];const z=D.STATE_CLOSING;const q=D.STATE_CLOSED;const V=D.STATE_CONNECTING;const G=D.STATE_CONNECTED;const Y=C({[q]:[q,V],[V]:[V,z,G,q],[G]:[G,z,q],[z]:[z,q]});const K=new Set(["autoReconnect","reconnectTries","reconnectInterval","bufferMaxEntries"]);const X=Symbol("cancelled");const J=Symbol("waitQueue");class Topology extends o{constructor(e,t){super();if(typeof t==="undefined"&&typeof e!=="string"){t=e;e=[];if(t.host){e.push({host:t.host,port:t.port})}}e=e||[];if(typeof e==="string"){e=parseStringSeedlist(e)}t=Object.assign({},D.TOPOLOGY_DEFAULTS,t);t=Object.freeze(Object.assign(t,{metadata:A(t),compression:{compressors:v(t)}}));K.forEach((e=>{if(t[e]){I(`The option \`${e}\` is incompatible with the unified topology, please read more by visiting http://bit.ly/2D8WfT6`,"DeprecationWarning")}}));const r=topologyTypeFromSeedlist(e,t);const o=F++;const i=e.reduce(((e,t)=>{if(t.domain_socket)t.host=t.domain_socket;const r=t.port?`${t.host}:${t.port}`:`${t.host}:27017`;e.set(r,new s(r));return e}),new Map);this[J]=new n;this.s={id:o,options:t,seedlist:e,state:q,description:new a(r,i,t.replicaSet,null,null,null,t),serverSelectionTimeoutMS:t.serverSelectionTimeoutMS,heartbeatFrequencyMS:t.heartbeatFrequencyMS,minHeartbeatFrequencyMS:t.minHeartbeatFrequencyMS,Cursor:t.cursorFactory||m,bson:t.bson||new g([g.Binary,g.Code,g.DBRef,g.Decimal128,g.Double,g.Int32,g.Long,g.Map,g.MaxKey,g.MinKey,g.ObjectId,g.BSONRegExp,g.Symbol,g.Timestamp]),servers:new Map,sessionPool:new k(this),sessions:new Set,promiseLibrary:t.promiseLibrary||Promise,credentials:t.credentials,clusterTime:null,connectionTimers:new Set};if(t.srvHost){this.s.srvPoller=t.srvPoller||new E({heartbeatFrequencyMS:this.s.heartbeatFrequencyMS,srvHost:t.srvHost,logger:t.logger,loggerLevel:t.loggerLevel});this.s.detectTopologyDescriptionChange=e=>{const t=e.previousDescription.type;const r=e.newDescription.type;if(t!==c.Sharded&&r===c.Sharded){this.s.handleSrvPolling=srvPollingHandler(this);this.s.srvPoller.on("srvRecordDiscovery",this.s.handleSrvPolling);this.s.srvPoller.start()}};this.on("topologyDescriptionChanged",this.s.detectTopologyDescriptionChange)}this.setMaxListeners(Infinity)}get description(){return this.s.description}get parserType(){return g.native?"c++":"js"}connect(e,t){if(typeof e==="function")t=e,e={};e=e||{};if(this.s.state===G){if(typeof t==="function"){t()}return}Y(this,V);this.emit("topologyOpening",new l.TopologyOpeningEvent(this.s.id));this.emit("topologyDescriptionChanged",new l.TopologyDescriptionChangedEvent(this.s.id,new a(c.Unknown),this.s.description));connectServers(this,Array.from(this.s.description.servers.values()));p.translate(e);const r=e.readPreference||p.primary;const connectHandler=e=>{if(e){this.close();if(typeof t==="function"){t(e)}else{this.emit("error",e)}return}Y(this,G);this.emit("open",e,this);this.emit("connect",this);if(typeof t==="function")t(e,this)};if(this.s.credentials){this.command("admin.$cmd",{ping:1},{readPreference:r},connectHandler);return}this.selectServer(j(r),e,connectHandler)}close(e,t){if(typeof e==="function"){t=e;e={}}if(typeof e==="boolean"){e={force:e}}e=e||{};if(this.s.state===q||this.s.state===z){if(typeof t==="function"){t()}return}Y(this,z);drainWaitQueue(this[J],new S("Topology closed"));P(this.s.connectionTimers);if(this.s.srvPoller){this.s.srvPoller.stop();if(this.s.handleSrvPolling){this.s.srvPoller.removeListener("srvRecordDiscovery",this.s.handleSrvPolling);delete this.s.handleSrvPolling}}if(this.s.detectTopologyDescriptionChange){this.removeListener("topologyDescriptionChanged",this.s.detectTopologyDescriptionChange);delete this.s.detectTopologyDescriptionChange}this.s.sessions.forEach((e=>e.endSession()));this.s.sessionPool.endAllPooledSessions((()=>{T(Array.from(this.s.servers.values()),((t,r)=>destroyServer(t,this,e,r)),(e=>{this.s.servers.clear();this.emit("topologyClosed",new l.TopologyClosedEvent(this.s.id));Y(this,q);if(typeof t==="function"){t(e)}}))}))}selectServer(e,t,r){if(typeof t==="function"){r=t;if(typeof e!=="function"){t=e;let r;if(e instanceof p){r=e}else if(typeof e==="string"){r=new p(e)}else{p.translate(t);r=t.readPreference||p.primary}e=j(r)}else{t={}}}t=Object.assign({},{serverSelectionTimeoutMS:this.s.serverSelectionTimeoutMS},t);const n=this.description.type===c.Sharded;const o=t.session;const s=o&&o.transaction;if(n&&s&&s.server){r(undefined,s.server);return}let i=e;if(typeof e==="object"){const t=e.readPreference?e.readPreference:p.primary;i=j(t)}const a={serverSelector:i,transaction:s,callback:r};const l=t.serverSelectionTimeoutMS;if(l){a.timer=setTimeout((()=>{a[X]=true;a.timer=undefined;const e=new w(`Server selection timed out after ${l} ms`,this.description);a.callback(e)}),l)}this[J].push(a);processWaitQueue(this)}shouldCheckForSessionSupport(){if(this.description.type===c.Single){return!this.description.hasKnownServers}return!this.description.hasDataBearingServers}hasSessionSupport(){return this.description.logicalSessionTimeoutMinutes!=null}startSession(e,t){const r=new b(this,this.s.sessionPool,e,t);r.once("ended",(()=>{this.s.sessions.delete(r)}));this.s.sessions.add(r);return r}endSessions(e,t){if(!Array.isArray(e)){e=[e]}this.command("admin.$cmd",{endSessions:e},{readPreference:p.primaryPreferred,noResponse:true},(()=>{if(typeof t==="function")t()}))}serverUpdateHandler(e){if(!this.s.description.hasServer(e.address)){return}if(isStaleServerDescription(this.s.description,e)){return}const t=this.s.description;const r=this.s.description.servers.get(e.address);const n=e.$clusterTime;if(n){_(this,n)}const o=r&&r.equals(e);this.s.description=this.s.description.update(e);if(this.s.description.compatibilityError){this.emit("error",new S(this.s.description.compatibilityError));return}if(!o){this.emit("serverDescriptionChanged",new l.ServerDescriptionChangedEvent(this.s.id,e.address,r,this.s.description.servers.get(e.address)))}updateServers(this,e);if(this[J].length>0){processWaitQueue(this)}if(!o){this.emit("topologyDescriptionChanged",new l.TopologyDescriptionChangedEvent(this.s.id,t,this.s.description))}}auth(e,t){if(typeof e==="function")t=e,e=null;if(typeof t==="function")t(null,true)}logout(e){if(typeof e==="function")e(null,true)}insert(e,t,r,n){executeWriteOperation({topology:this,op:"insert",ns:e,ops:t},r,n)}update(e,t,r,n){executeWriteOperation({topology:this,op:"update",ns:e,ops:t},r,n)}remove(e,t,r,n){executeWriteOperation({topology:this,op:"remove",ns:e,ops:t},r,n)}command(e,t,r,n){if(typeof r==="function"){n=r,r={},r=r||{}}p.translate(r);const o=r.readPreference||p.primary;this.selectServer(j(o),r,((o,s)=>{if(o){n(o);return}const i=!r.retrying&&!!r.retryWrites&&r.session&&h(this)&&!r.session.inTransaction()&&isWriteCommand(t);const cb=(o,s)=>{if(!o)return n(null,s);if(!shouldRetryOperation(o)){return n(o)}if(i){const o=Object.assign({},r,{retrying:true});return this.command(e,t,o,n)}return n(o)};if(i){r.session.incrementTransactionNumber();r.willRetryWrite=i}s.command(e,t,r,cb)}))}cursor(e,t,r){r=r||{};const n=r.topology||this;const o=r.cursorFactory||this.s.Cursor;p.translate(r);return new o(n,e,t,r)}get clientMetadata(){return this.s.options.metadata}isConnected(){return this.s.state===G}isDestroyed(){return this.s.state===q}unref(){M("not implemented: `unref`")}lastIsMaster(){const e=Array.from(this.description.servers.values());if(e.length===0)return{};const t=e.filter((e=>e.type!==i.Unknown))[0];const r=t||{maxWireVersion:this.description.commonWireVersion};return r}get logicalSessionTimeoutMinutes(){return this.description.logicalSessionTimeoutMinutes}get bson(){return this.s.bson}}Object.defineProperty(Topology.prototype,"clusterTime",{enumerable:true,get:function(){return this.s.clusterTime},set:function(e){this.s.clusterTime=e}});Topology.prototype.destroy=y(Topology.prototype.close,"destroy() is deprecated, please use close() instead");const Z=["findAndModify","insert","update","delete"];function isWriteCommand(e){return Z.some((t=>e[t]))}function isStaleServerDescription(e,t){const r=e.servers.get(t.address);const n=r.topologyVersion;return R(n,t.topologyVersion)>0}function destroyServer(e,t,r,n){r=r||{};W.forEach((t=>e.removeAllListeners(t)));e.destroy(r,(()=>{t.emit("serverClosed",new l.ServerClosedEvent(t.s.id,e.description.address));$.forEach((t=>e.removeAllListeners(t)));if(typeof n==="function"){n()}}))}function parseStringSeedlist(e){return e.split(",").map((e=>({host:e.split(":")[0],port:e.split(":")[1]||27017})))}function topologyTypeFromSeedlist(e,t){if(t.directConnection){return c.Single}const r=t.replicaSet||t.setName||t.rs_name;if(r==null){return c.Unknown}return c.ReplicaSetNoPrimary}function randomSelection(e){return e[Math.floor(Math.random()*e.length)]}function createAndConnectServer(e,t,r){e.emit("serverOpening",new l.ServerOpeningEvent(e.s.id,t.address));const n=new u(t,e.s.options,e);d(n,e,$);n.on("descriptionReceived",e.serverUpdateHandler.bind(e));if(r){const t=setTimeout((()=>{L(t,e.s.connectionTimers);n.connect()}),r);e.s.connectionTimers.add(t);return n}n.connect();return n}function connectServers(e,t){e.s.servers=t.reduce(((t,r)=>{const n=createAndConnectServer(e,r);t.set(r.address,n);return t}),new Map)}function updateServers(e,t){if(t&&e.s.servers.has(t.address)){const r=e.s.servers.get(t.address);r.s.description=t}for(const t of e.description.servers.values()){if(!e.s.servers.has(t.address)){const r=createAndConnectServer(e,t);e.s.servers.set(t.address,r)}}for(const t of e.s.servers){const r=t[0];if(e.description.hasServer(r)){continue}const n=e.s.servers.get(r);e.s.servers.delete(r);destroyServer(n,e)}}function executeWriteOperation(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};const n=e.topology;const o=e.op;const s=e.ns;const i=e.ops;const a=!e.retrying&&!!t.retryWrites&&t.session&&h(n)&&!t.session.inTransaction()&&t.explain===undefined;n.selectServer(U(),t,((n,c)=>{if(n){r(n,null);return}const handler=(n,o)=>{if(!n)return r(null,o);if(!shouldRetryOperation(n)){n=O(n);return r(n)}if(a){const n=Object.assign({},e,{retrying:true});return executeWriteOperation(n,t,r)}return r(n)};if(r.operationId){handler.operationId=r.operationId}if(a){t.session.incrementTransactionNumber();t.willRetryWrite=a}c[o](s,i,t,handler)}))}function shouldRetryOperation(e){return e instanceof S&&e.hasErrorLabel("RetryableWriteError")}function srvPollingHandler(e){return function handleSrvPolling(t){const r=e.s.description;e.s.description=e.s.description.updateFromSrvPollingEvent(t);if(e.s.description===r){return}updateServers(e);e.emit("topologyDescriptionChanged",new l.TopologyDescriptionChangedEvent(e.s.id,r,e.s.description))}}function drainWaitQueue(e,t){while(e.length){const r=e.shift();clearTimeout(r.timer);if(!r[X]){r.callback(t)}}}function processWaitQueue(e){if(e.s.state===q){drainWaitQueue(e[J],new S("Topology is closed, please connect"));return}const t=Array.from(e.description.servers.values());const r=e[J].length;for(let n=0;n<r&&e[J].length;++n){const r=e[J].shift();if(r[X]){continue}let n;try{const o=r.serverSelector;n=o?o(e.description,t):t}catch(e){clearTimeout(r.timer);r.callback(e);continue}if(n.length===0){e[J].push(r);continue}const o=randomSelection(n);const s=e.s.servers.get(o.address);const i=r.transaction;const a=e.description.type===c.Sharded;if(a&&i&&i.isActive){i.pinServer(s)}clearTimeout(r.timer);r.callback(undefined,s)}if(e[J].length>0){e.s.servers.forEach((e=>process.nextTick((()=>e.requestCheck()))))}}e.exports={Topology:Topology}},7962:(e,t,r)=>{"use strict";const n=r(2291).ServerType;const o=r(750).ServerDescription;const s=r(7161);const i=r(2291).TopologyType;const a=s.MIN_SUPPORTED_SERVER_VERSION;const c=s.MAX_SUPPORTED_SERVER_VERSION;const l=s.MIN_SUPPORTED_WIRE_VERSION;const u=s.MAX_SUPPORTED_WIRE_VERSION;class TopologyDescription{constructor(e,t,r,o,s,d,p){p=p||{};this.type=e||i.Unknown;this.setName=r||null;this.maxSetVersion=o||null;this.maxElectionId=s||null;this.servers=t||new Map;this.stale=false;this.compatible=true;this.compatibilityError=null;this.logicalSessionTimeoutMinutes=null;this.heartbeatFrequencyMS=p.heartbeatFrequencyMS||0;this.localThresholdMS=p.localThresholdMS||0;this.commonWireVersion=d||null;Object.defineProperty(this,"options",{value:p,enumberable:false});for(const e of this.servers.values()){if(e.type===n.Unknown)continue;if(e.minWireVersion>u){this.compatible=false;this.compatibilityError=`Server at ${e.address} requires wire version ${e.minWireVersion}, but this version of the driver only supports up to ${u} (MongoDB ${c})`}if(e.maxWireVersion<l){this.compatible=false;this.compatibilityError=`Server at ${e.address} reports wire version ${e.maxWireVersion}, but this version of the driver requires at least ${l} (MongoDB ${a}).`;break}}this.logicalSessionTimeoutMinutes=null;for(const e of this.servers){const t=e[1];if(t.isReadable){if(t.logicalSessionTimeoutMinutes==null){this.logicalSessionTimeoutMinutes=null;break}if(this.logicalSessionTimeoutMinutes==null){this.logicalSessionTimeoutMinutes=t.logicalSessionTimeoutMinutes;continue}this.logicalSessionTimeoutMinutes=Math.min(this.logicalSessionTimeoutMinutes,t.logicalSessionTimeoutMinutes)}}}updateFromSrvPollingEvent(e){const t=e.addresses();const r=new Map(this.servers);for(const e of this.servers){if(t.has(e[0])){t.delete(e[0])}else{r.delete(e[0])}}if(r.size===this.servers.size&&t.size===0){return this}for(const e of t){r.set(e,new o(e))}return new TopologyDescription(this.type,r,this.setName,this.maxSetVersion,this.maxElectionId,this.commonWireVersion,this.options,null)}update(e){const t=e.address;let r=this.type;let s=this.setName;let a=this.maxSetVersion;let c=this.maxElectionId;let l=this.commonWireVersion;if(e.setName&&s&&e.setName!==s){e=new o(t,null)}const u=e.type;let d=new Map(this.servers);if(e.maxWireVersion!==0){if(l==null){l=e.maxWireVersion}else{l=Math.min(l,e.maxWireVersion)}}d.set(t,e);if(r===i.Single){return new TopologyDescription(i.Single,d,s,a,c,l,this.options)}if(r===i.Unknown){if(u===n.Standalone&&this.servers.size!==1){d.delete(t)}else{r=topologyTypeForServerType(u)}}if(r===i.Sharded){if([n.Mongos,n.Unknown].indexOf(u)===-1){d.delete(t)}}if(r===i.ReplicaSetNoPrimary){if([n.Standalone,n.Mongos].indexOf(u)>=0){d.delete(t)}if(u===n.RSPrimary){const t=updateRsFromPrimary(d,s,e,a,c);r=t[0],s=t[1],a=t[2],c=t[3]}else if([n.RSSecondary,n.RSArbiter,n.RSOther].indexOf(u)>=0){const t=updateRsNoPrimaryFromMember(d,s,e);r=t[0],s=t[1]}}if(r===i.ReplicaSetWithPrimary){if([n.Standalone,n.Mongos].indexOf(u)>=0){d.delete(t);r=checkHasPrimary(d)}else if(u===n.RSPrimary){const t=updateRsFromPrimary(d,s,e,a,c);r=t[0],s=t[1],a=t[2],c=t[3]}else if([n.RSSecondary,n.RSArbiter,n.RSOther].indexOf(u)>=0){r=updateRsWithPrimaryFromMember(d,s,e)}else{r=checkHasPrimary(d)}}return new TopologyDescription(r,d,s,a,c,l,this.options)}get error(){const e=Array.from(this.servers.values()).filter((e=>e.error));if(e.length>0){return e[0].error}return undefined}get hasKnownServers(){return Array.from(this.servers.values()).some((e=>e.type!==n.Unknown))}get hasDataBearingServers(){return Array.from(this.servers.values()).some((e=>e.isDataBearing))}hasServer(e){return this.servers.has(e)}}function topologyTypeForServerType(e){if(e===n.Standalone){return i.Single}if(e===n.Mongos){return i.Sharded}if(e===n.RSPrimary){return i.ReplicaSetWithPrimary}if(e===n.RSGhost||e===n.Unknown){return i.Unknown}return i.ReplicaSetNoPrimary}function compareObjectId(e,t){if(e==null){return-1}if(t==null){return 1}if(e.id instanceof Buffer&&t.id instanceof Buffer){const r=e.id;const n=t.id;return r.compare(n)}const r=e.toString();const n=t.toString();return r.localeCompare(n)}function updateRsFromPrimary(e,t,r,s,i){t=t||r.setName;if(t!==r.setName){e.delete(r.address);return[checkHasPrimary(e),t,s,i]}const a=r.electionId?r.electionId:null;if(r.setVersion&&a){if(s&&i){if(s>r.setVersion||compareObjectId(i,a)>0){e.set(r.address,new o(r.address));return[checkHasPrimary(e),t,s,i]}}i=r.electionId}if(r.setVersion!=null&&(s==null||r.setVersion>s)){s=r.setVersion}for(const t of e.keys()){const s=e.get(t);if(s.type===n.RSPrimary&&s.address!==r.address){e.set(t,new o(s.address));break}}r.allHosts.forEach((t=>{if(!e.has(t)){e.set(t,new o(t))}}));const c=Array.from(e.keys());const l=r.allHosts;c.filter((e=>l.indexOf(e)===-1)).forEach((t=>{e.delete(t)}));return[checkHasPrimary(e),t,s,i]}function updateRsWithPrimaryFromMember(e,t,r){if(t==null){throw new TypeError("setName is required")}if(t!==r.setName||r.me&&r.address!==r.me){e.delete(r.address)}return checkHasPrimary(e)}function updateRsNoPrimaryFromMember(e,t,r){let n=i.ReplicaSetNoPrimary;t=t||r.setName;if(t!==r.setName){e.delete(r.address);return[n,t]}r.allHosts.forEach((t=>{if(!e.has(t)){e.set(t,new o(t))}}));if(r.me&&r.address!==r.me){e.delete(r.address)}return[n,t]}function checkHasPrimary(e){for(const t of e.keys()){if(e.get(t).type===n.RSPrimary){return i.ReplicaSetWithPrimary}}return i.ReplicaSetNoPrimary}e.exports={TopologyDescription:TopologyDescription}},5474:(e,t,r)=>{"use strict";const n=r(7746).retrieveBSON;const o=r(8614);const s=n();const i=s.Binary;const a=r(1178).uuidV4;const c=r(3111).MongoError;const l=r(3111).isRetryableError;const u=r(3111).MongoNetworkError;const d=r(3111).MongoWriteConcernError;const p=r(1707).Transaction;const h=r(1707).TxnState;const m=r(1178).isPromiseLike;const y=r(4485);const g=r(1371).maybePromise;const v=r(1707).isTransactionCommand;const b=r(2306).resolveClusterTime;const S=r(7272).isSharded;const w=r(1178).maxWireVersion;const _=r(1371).now;const E=r(1371).calculateDurationInMs;const O=8;function assertAlive(e,t){if(e.serverSession==null){const e=new c("Cannot use a session that has ended");if(typeof t==="function"){t(e,null);return false}throw e}return true}const C=Symbol("serverSession");class ClientSession extends o{constructor(e,t,r,n){super();if(e==null){throw new Error("ClientSession requires a topology")}if(t==null||!(t instanceof ServerSessionPool)){throw new Error("ClientSession requires a ServerSessionPool")}r=r||{};n=n||{};this.topology=e;this.sessionPool=t;this.hasEnded=false;this.clientOptions=n;this[C]=undefined;this.supports={causalConsistency:typeof r.causalConsistency!=="undefined"?r.causalConsistency:true};this.clusterTime=r.initialClusterTime;this.operationTime=null;this.explicit=!!r.explicit;this.owner=r.owner;this.defaultTransactionOptions=Object.assign({},r.defaultTransactionOptions);this.transaction=new p}get id(){return this.serverSession.id}get serverSession(){if(this[C]==null){this[C]=this.sessionPool.acquire()}return this[C]}endSession(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=this;return g(this,t,(e=>{if(r.hasEnded){return e()}function completeEndSession(){r.sessionPool.release(r.serverSession);r[C]=undefined;r.hasEnded=true;r.emit("ended",r);e()}if(r.serverSession&&r.inTransaction()){r.abortTransaction((t=>{if(t)return e(t);completeEndSession()}));return}completeEndSession()}))}advanceOperationTime(e){if(this.operationTime==null){this.operationTime=e;return}if(e.greaterThan(this.operationTime)){this.operationTime=e}}equals(e){if(!(e instanceof ClientSession)){return false}return this.id.id.buffer.equals(e.id.id.buffer)}incrementTransactionNumber(){this.serverSession.txnNumber++}inTransaction(){return this.transaction.isActive}startTransaction(e){assertAlive(this);if(this.inTransaction()){throw new c("Transaction already in progress")}const t=w(this.topology);if(S(this.topology)&&t!=null&&t<O){throw new c("Transactions are not supported on sharded clusters in MongoDB < 4.2.")}this.incrementTransactionNumber();this.transaction=new p(Object.assign({},this.clientOptions,e||this.defaultTransactionOptions));this.transaction.transition(h.STARTING_TRANSACTION)}commitTransaction(e){return g(this,e,(e=>endTransaction(this,"commitTransaction",e)))}abortTransaction(e){return g(this,e,(e=>endTransaction(this,"abortTransaction",e)))}toBSON(){throw new Error("ClientSession cannot be serialized to BSON.")}withTransaction(e,t){const r=_();return attemptTransaction(this,r,e,t)}}const T=12e4;const I=100;const k=79;const A=50;const N=new Set(["CannotSatisfyWriteConcern","UnknownReplWriteConcern","UnsatisfiableWriteConcern"]);function hasNotTimedOut(e,t){return E(e)<t}function isUnknownTransactionCommitResult(e){return isMaxTimeMSExpiredError(e)||!N.has(e.codeName)&&e.code!==I&&e.code!==k}function isMaxTimeMSExpiredError(e){if(e==null)return false;return e.code===A||e.writeConcernError&&e.writeConcernError.code===A}function attemptTransactionCommit(e,t,r,n){return e.commitTransaction().catch((o=>{if(o instanceof c&&hasNotTimedOut(t,T)&&!isMaxTimeMSExpiredError(o)){if(o.hasErrorLabel("UnknownTransactionCommitResult")){return attemptTransactionCommit(e,t,r,n)}if(o.hasErrorLabel("TransientTransactionError")){return attemptTransaction(e,t,r,n)}}throw o}))}const R=new Set([h.NO_TRANSACTION,h.TRANSACTION_COMMITTED,h.TRANSACTION_ABORTED]);function userExplicitlyEndedTransaction(e){return R.has(e.transaction.state)}function attemptTransaction(e,t,r,n){e.startTransaction(n);let o;try{o=r(e)}catch(e){o=Promise.reject(e)}if(!m(o)){e.abortTransaction();throw new TypeError("Function provided to `withTransaction` must return a Promise")}return o.then((()=>{if(userExplicitlyEndedTransaction(e)){return}return attemptTransactionCommit(e,t,r,n)})).catch((o=>{function maybeRetryOrThrow(o){if(o instanceof c&&o.hasErrorLabel("TransientTransactionError")&&hasNotTimedOut(t,T)){return attemptTransaction(e,t,r,n)}if(isMaxTimeMSExpiredError(o)){o.addErrorLabel("UnknownTransactionCommitResult")}throw o}if(e.transaction.isActive){return e.abortTransaction().then((()=>maybeRetryOrThrow(o)))}return maybeRetryOrThrow(o)}))}function endTransaction(e,t,r){if(!assertAlive(e,r)){return}let n=e.transaction.state;if(n===h.NO_TRANSACTION){r(new c("No transaction started"));return}if(t==="commitTransaction"){if(n===h.STARTING_TRANSACTION||n===h.TRANSACTION_COMMITTED_EMPTY){e.transaction.transition(h.TRANSACTION_COMMITTED_EMPTY);r(null,null);return}if(n===h.TRANSACTION_ABORTED){r(new c("Cannot call commitTransaction after calling abortTransaction"));return}}else{if(n===h.STARTING_TRANSACTION){e.transaction.transition(h.TRANSACTION_ABORTED);r(null,null);return}if(n===h.TRANSACTION_ABORTED){r(new c("Cannot call abortTransaction twice"));return}if(n===h.TRANSACTION_COMMITTED||n===h.TRANSACTION_COMMITTED_EMPTY){r(new c("Cannot call abortTransaction after calling commitTransaction"));return}}const o={[t]:1};let s;if(e.transaction.options.writeConcern){s=Object.assign({},e.transaction.options.writeConcern)}else if(e.clientOptions&&e.clientOptions.w){s={w:e.clientOptions.w}}if(n===h.TRANSACTION_COMMITTED){s=Object.assign({wtimeout:1e4},s,{w:"majority"})}if(s){Object.assign(o,{writeConcern:s})}if(t==="commitTransaction"&&e.transaction.options.maxTimeMS){Object.assign(o,{maxTimeMS:e.transaction.options.maxTimeMS})}function commandHandler(n,o){if(t==="commitTransaction"){e.transaction.transition(h.TRANSACTION_COMMITTED);if(n&&(n instanceof u||n instanceof d||l(n)||isMaxTimeMSExpiredError(n))){if(isUnknownTransactionCommitResult(n)){n.addErrorLabel("UnknownTransactionCommitResult");e.transaction.unpinServer()}}}else{e.transaction.transition(h.TRANSACTION_ABORTED)}r(n,o)}function transactionError(e){return t==="commitTransaction"?e:null}if(e.transaction.recoveryToken&&supportsRecoveryToken(e)){o.recoveryToken=e.transaction.recoveryToken}e.topology.command("admin.$cmd",o,{session:e},((t,r)=>{if(t&&l(t)){if(o.commitTransaction){e.transaction.unpinServer();o.writeConcern=Object.assign({wtimeout:1e4},o.writeConcern,{w:"majority"})}return e.topology.command("admin.$cmd",o,{session:e},((e,t)=>commandHandler(transactionError(e),t)))}commandHandler(transactionError(t),r)}))}function supportsRecoveryToken(e){const t=e.topology;return!!t.s.options.useRecoveryToken}class ServerSession{constructor(){this.id={id:new i(a(),i.SUBTYPE_UUID)};this.lastUse=_();this.txnNumber=0;this.isDirty=false}hasTimedOut(e){const t=Math.round(E(this.lastUse)%864e5%36e5/6e4);return t>e-1}}class ServerSessionPool{constructor(e){if(e==null){throw new Error("ServerSessionPool requires a topology")}this.topology=e;this.sessions=[]}endAllPooledSessions(e){if(this.sessions.length){this.topology.endSessions(this.sessions.map((e=>e.id)),(()=>{this.sessions=[];if(typeof e==="function"){e()}}));return}if(typeof e==="function"){e()}}acquire(){const e=this.topology.logicalSessionTimeoutMinutes;while(this.sessions.length){const t=this.sessions.shift();if(!t.hasTimedOut(e)){return t}}return new ServerSession}release(e){const t=this.topology.logicalSessionTimeoutMinutes;while(this.sessions.length){const e=this.sessions[this.sessions.length-1];if(e.hasTimedOut(t)){this.sessions.pop()}else{break}}if(!e.hasTimedOut(t)){if(e.isDirty){return}this.sessions.unshift(e)}}}function commandSupportsReadConcern(e,t){if(e.aggregate||e.count||e.distinct||e.find||e.parallelCollectionScan||e.geoNear||e.geoSearch){return true}if(e.mapReduce&&t&&t.out&&(t.out.inline===1||t.out==="inline")){return true}return false}function applySession(e,t,r){if(e.hasEnded){return new c("Cannot use a session that has ended")}if(r&&r.writeConcern&&r.writeConcern.w===0){return}const n=e.serverSession;n.lastUse=_();t.lsid=n.id;const o=e.inTransaction()||v(t);const i=r.willRetryWrite;const a=commandSupportsReadConcern(t,r);if(n.txnNumber&&(i||o)){t.txnNumber=s.Long.fromNumber(n.txnNumber)}if(!o){if(e.transaction.state!==h.NO_TRANSACTION){e.transaction.transition(h.NO_TRANSACTION)}if(e.supports.causalConsistency&&e.operationTime&&a){t.readConcern=t.readConcern||{};Object.assign(t.readConcern,{afterClusterTime:e.operationTime})}return}if(r.readPreference&&!r.readPreference.equals(y.primary)){return new c(`Read preference in a transaction must be primary, not: ${r.readPreference.mode}`)}t.autocommit=false;if(e.transaction.state===h.STARTING_TRANSACTION){e.transaction.transition(h.TRANSACTION_IN_PROGRESS);t.startTransaction=true;const r=e.transaction.options.readConcern||e.clientOptions.readConcern;if(r){t.readConcern=r}if(e.supports.causalConsistency&&e.operationTime){t.readConcern=t.readConcern||{};Object.assign(t.readConcern,{afterClusterTime:e.operationTime})}}}function updateSessionFromResponse(e,t){if(t.$clusterTime){b(e,t.$clusterTime)}if(t.operationTime&&e&&e.supports.causalConsistency){e.advanceOperationTime(t.operationTime)}if(t.recoveryToken&&e&&e.inTransaction()){e.transaction._recoveryToken=t.recoveryToken}}e.exports={ClientSession:ClientSession,ServerSession:ServerSession,ServerSessionPool:ServerSessionPool,TxnState:h,applySession:applySession,updateSessionFromResponse:updateSessionFromResponse,commandSupportsReadConcern:commandSupportsReadConcern}},8175:(e,t,r)=>{"use strict";const n=r(1669).inherits;const o=r(1669).format;const s=r(8614).EventEmitter;const i=r(4847).CoreCursor;const a=r(104);const c=r(7746).retrieveBSON;const l=r(3111).MongoError;const u=r(6495);const d=r(2306).diff;const p=r(2306).cloneOptions;const h=r(2306).SessionMixins;const m=r(2306).isRetryableWritesSupported;const y=r(1178).relayEvents;const g=c();const v=r(2306).getMMAPError;const b=r(1178).makeClientMetadata;const S=r(2306).legacyIsRetryableWriteError;var w="disconnected";var _="connecting";var E="connected";var O="unreferenced";var C="destroying";var T="destroyed";function stateTransition(e,t){var r={disconnected:[_,C,T,w],connecting:[_,C,T,E,w],connected:[E,w,C,T,O],unreferenced:[O,C,T],destroyed:[T]};var n=r[e.state];if(n&&n.indexOf(t)!==-1){e.state=t}else{e.s.logger.error(o("Mongos with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}}var I=1;var k=["connect","close","error","timeout","parseError"];var Mongos=function(e,t){t=t||{};this.id=I++;if(Array.isArray(e)){e=e.reduce(((e,t)=>{if(e.find((e=>e.host===t.host&&e.port===t.port))){return e}e.push(t);return e}),[])}this.s={options:Object.assign({metadata:b(t)},t),bson:t.bson||new g([g.Binary,g.Code,g.DBRef,g.Decimal128,g.Double,g.Int32,g.Long,g.Map,g.MaxKey,g.MinKey,g.ObjectId,g.BSONRegExp,g.Symbol,g.Timestamp]),Cursor:t.cursorFactory||i,logger:a("Mongos",t),seedlist:e,haInterval:t.haInterval?t.haInterval:1e4,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:typeof t.debug==="boolean"?t.debug:false,localThresholdMS:t.localThresholdMS||15};if(this.s.logger.isWarn()&&this.s.options.socketTimeout!==0&&this.s.options.socketTimeout<this.s.haInterval){this.s.logger.warn(o("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval))}this.state=w;this.connectingProxies=[];this.connectedProxies=[];this.disconnectedProxies=[];this.index=0;this.haTimeoutId=null;this.ismaster=null;this.topologyDescription={topologyType:"Unknown",servers:[]};this.clusterTime=null;s.call(this)};n(Mongos,s);Object.assign(Mongos.prototype,h);Object.defineProperty(Mongos.prototype,"type",{enumerable:true,get:function(){return"mongos"}});Object.defineProperty(Mongos.prototype,"parserType",{enumerable:true,get:function(){return g.native?"c++":"js"}});Object.defineProperty(Mongos.prototype,"logicalSessionTimeoutMinutes",{enumerable:true,get:function(){if(!this.ismaster)return null;return this.ismaster.logicalSessionTimeoutMinutes||null}});function emitSDAMEvent(e,t,r){if(e.listeners(t).length>0){e.emit(t,r)}}const A=["serverDescriptionChanged","error","close","timeout","parseError"];function destroyServer(e,t,r){t=t||{};A.forEach((t=>e.removeAllListeners(t)));e.destroy(t,r)}Mongos.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{};stateTransition(this,_);var r=this.s.seedlist.map((function(r){const n=new u(Object.assign({},t.s.options,r,e,{reconnect:false,monitoring:false,parent:t}));y(n,t,["serverDescriptionChanged"]);return n}));emitSDAMEvent(this,"topologyOpening",{topologyId:this.id});connectProxies(t,r)};Mongos.prototype.auth=function(e,t){if(typeof t==="function")t(null,null)};function handleEvent(e){return function(){if(e.state===T||e.state===C){return}moveServerFrom(e.connectedProxies,e.disconnectedProxies,this);emitTopologyDescriptionChanged(e);e.emit("left","mongos",this);e.emit("serverClosed",{topologyId:e.id,address:this.name})}}function handleInitialConnectEvent(e,t){return function(){var r=this;if(e.state===T){emitTopologyDescriptionChanged(e);moveServerFrom(e.connectingProxies,e.disconnectedProxies,this);return this.destroy()}if(t==="connect"){e.ismaster=r.lastIsMaster();if(e.ismaster.msg==="isdbgrid"){for(let t=0;t<e.connectedProxies.length;t++){if(e.connectedProxies[t].name===r.name){moveServerFrom(e.connectingProxies,e.disconnectedProxies,r);emitTopologyDescriptionChanged(e);r.destroy();return e.emit("failed",r)}}for(let e=0;e<k.length;e++){r.removeAllListeners(k[e])}r.on("error",handleEvent(e,"error"));r.on("close",handleEvent(e,"close"));r.on("timeout",handleEvent(e,"timeout"));r.on("parseError",handleEvent(e,"parseError"));moveServerFrom(e.connectingProxies,e.connectedProxies,r);e.emit("joined","mongos",r)}else{if(e.s.logger.isWarn()){var n="expected mongos proxy, but found replicaset member mongod for server %s";if(!e.ismaster.hosts){n="expected mongos proxy, but found standalone mongod for server %s"}e.s.logger.warn(o(n,r.name))}r.destroy(true);removeProxyFrom(e.connectingProxies,r);e.emit("left","server",r);e.emit("failed",r)}}else{moveServerFrom(e.connectingProxies,e.disconnectedProxies,this);e.emit("left","mongos",this);e.emit("failed",this)}emitTopologyDescriptionChanged(e);if(e.connectingProxies.length===0){if(e.connectedProxies.length>0&&e.state===_){stateTransition(e,E);e.emit("connect",e);e.emit("fullsetup",e);e.emit("all",e)}else if(e.disconnectedProxies.length===0){if(e.s.logger.isWarn()){e.s.logger.warn(o("no mongos proxies found in seed list, did you mean to connect to a replicaset"))}return e.emit("error",new l("no mongos proxies found in seed list"))}topologyMonitor(e,{firstConnect:true})}}}function connectProxies(e,t){e.connectingProxies=e.connectingProxies.concat(t);var r=0;function connect(t,r){setTimeout((function(){e.emit("serverOpening",{topologyId:e.id,address:t.name});emitTopologyDescriptionChanged(e);t.once("close",handleInitialConnectEvent(e,"close"));t.once("timeout",handleInitialConnectEvent(e,"timeout"));t.once("parseError",handleInitialConnectEvent(e,"parseError"));t.once("error",handleInitialConnectEvent(e,"error"));t.once("connect",handleInitialConnectEvent(e,"connect"));y(t,e,["commandStarted","commandSucceeded","commandFailed"]);t.connect(e.s.connectOptions)}),r)}t.forEach((e=>connect(e,r++)))}function pickProxy(e,t){const r=t&&t.transaction;if(r&&r.server){if(r.server.isConnected()){return r.server}else{r.unpinServer()}}var n=e.connectedProxies.slice(0);var o=Number.MAX_VALUE;for(var s=0;s<n.length;s++){if(n[s].lastIsMasterMS<o){o=n[s].lastIsMasterMS}}n=n.filter((function(t){if(t.lastIsMasterMS<=o+e.s.localThresholdMS&&t.isConnected()){return true}}));let i;if(n.length===0){i=e.connectedProxies[0]}else{i=n[e.index%n.length];e.index=(e.index+1)%n.length}if(r&&r.isActive&&i&&i.isConnected()){r.pinServer(i)}return i}function moveServerFrom(e,t,r){for(var n=0;n<e.length;n++){if(e[n].name===r.name){e.splice(n,1)}}for(n=0;n<t.length;n++){if(t[n].name===r.name){t.splice(n,1)}}t.push(r)}function removeProxyFrom(e,t){for(var r=0;r<e.length;r++){if(e[r].name===t.name){e.splice(r,1)}}}function reconnectProxies(e,t,r){var n=t.length;var _handleEvent=function(e,t){return function(){var o=this;n=n-1;if(e.state===T||e.state===C||e.state===O){moveServerFrom(e.connectingProxies,e.disconnectedProxies,o);return this.destroy()}if(t==="connect"){if(e.state===T||e.state===C||e.state===O){moveServerFrom(e.connectingProxies,e.disconnectedProxies,o);return o.destroy()}for(var s=0;s<k.length;s++){o.removeAllListeners(k[s])}o.on("error",handleEvent(e,"error"));o.on("close",handleEvent(e,"close"));o.on("timeout",handleEvent(e,"timeout"));o.on("parseError",handleEvent(e,"parseError"));moveServerFrom(e.connectingProxies,e.connectedProxies,o);emitTopologyDescriptionChanged(e);e.emit("joined","mongos",o)}else{moveServerFrom(e.connectingProxies,e.disconnectedProxies,o);this.destroy()}if(n===0){r()}}};if(n===0){return r()}function execute(t,r){setTimeout((function(){if(e.state===T||e.state===C||e.state===O){return}var r=new u(Object.assign({},e.s.options,{host:t.name.split(":")[0],port:parseInt(t.name.split(":")[1],10),reconnect:false,monitoring:false,parent:e}));destroyServer(t,{force:true});removeProxyFrom(e.disconnectedProxies,t);y(r,e,["serverDescriptionChanged"]);e.emit("serverOpening",{topologyId:r.s.topologyId!==-1?r.s.topologyId:e.id,address:r.name});r.once("connect",_handleEvent(e,"connect"));r.once("close",_handleEvent(e,"close"));r.once("timeout",_handleEvent(e,"timeout"));r.once("error",_handleEvent(e,"error"));r.once("parseError",_handleEvent(e,"parseError"));y(r,e,["commandStarted","commandSucceeded","commandFailed"]);e.connectingProxies.push(r);r.connect(e.s.connectOptions)}),r)}for(var o=0;o<t.length;o++){execute(t[o],o)}}function topologyMonitor(e,t){t=t||{};if(e.state===T||e.state===C||e.state===O){return}e.haTimeoutId=setTimeout((function(){if(e.state===T||e.state===C||e.state===O){return}if(e.isConnected()&&e.s.disconnectHandler){e.s.disconnectHandler.execute()}var r=e.connectedProxies.slice(0);var n=r.length;function pingServer(t,r,n){var o=(new Date).getTime();emitSDAMEvent(e,"serverHeartbeatStarted",{connectionId:r.name});r.command("admin.$cmd",{ismaster:true},{monitoring:true,socketTimeout:e.s.options.connectionTimeout||2e3},(function(t,s){if(e.state===T||e.state===C||e.state===O){moveServerFrom(e.connectedProxies,e.disconnectedProxies,r);r.destroy();return n(t,s)}var i=(new Date).getTime()-o;if(t){emitSDAMEvent(e,"serverHeartbeatFailed",{durationMS:i,failure:t,connectionId:r.name});moveServerFrom(e.connectedProxies,e.disconnectedProxies,r)}else{r.ismaster=s.result;r.lastIsMasterMS=i;emitSDAMEvent(e,"serverHeartbeatSucceeded",{durationMS:i,reply:s.result,connectionId:r.name})}n(t,s)}))}if(r.length===0){if(e.listeners("close").length>0&&e.state===_){e.emit("error",new l("no mongos proxy available"))}else{e.emit("close",e)}return reconnectProxies(e,e.disconnectedProxies,(function(){if(e.state===T||e.state===C||e.state===O){return}if(e.state===_&&t.firstConnect){e.emit("connect",e);e.emit("fullsetup",e);e.emit("all",e)}else if(e.isConnected()){e.emit("reconnect",e)}else if(!e.isConnected()&&e.listeners("close").length>0){e.emit("close",e)}topologyMonitor(e)}))}for(var o=0;o<r.length;o++){pingServer(e,r[o],(function(){n=n-1;if(n===0){if(e.state===T||e.state===C||e.state===O){return}reconnectProxies(e,e.disconnectedProxies,(function(){if(e.state===T||e.state===C||e.state===O){return}topologyMonitor(e)}))}}))}}),e.s.haInterval)}Mongos.prototype.lastIsMaster=function(){return this.ismaster};Mongos.prototype.unref=function(){stateTransition(this,O);var e=this.connectedProxies.concat(this.connectingProxies);e.forEach((function(e){e.unref()}));clearTimeout(this.haTimeoutId)};Mongos.prototype.destroy=function(e,t){if(typeof e==="function"){t=e;e={}}e=e||{};stateTransition(this,C);if(this.haTimeoutId){clearTimeout(this.haTimeoutId)}const r=this.connectedProxies.concat(this.connectingProxies);let n=r.length;const serverDestroyed=()=>{n--;if(n>0){return}emitTopologyDescriptionChanged(this);emitSDAMEvent(this,"topologyClosed",{topologyId:this.id});stateTransition(this,T);if(typeof t==="function"){t(null,null)}};if(n===0){serverDestroyed();return}r.forEach((t=>{this.emit("serverClosed",{topologyId:this.id,address:t.name});destroyServer(t,e,serverDestroyed);moveServerFrom(this.connectedProxies,this.disconnectedProxies,t)}))};Mongos.prototype.isConnected=function(){return this.connectedProxies.length>0};Mongos.prototype.isDestroyed=function(){return this.state===T};function executeWriteOperation(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};const n=e.self;const o=e.op;const s=e.ns;const i=e.ops;let a=pickProxy(n,t.session);if(!a)return r(new l("no mongos proxy available"));const c=!e.retrying&&!!t.retryWrites&&t.session&&m(n)&&!t.session.inTransaction()&&t.explain===undefined;const handler=(o,s)=>{if(!o)return r(null,s);if(!S(o,n)||!c){o=v(o);return r(o)}a=pickProxy(n,t.session);if(!a){return r(o)}const i=Object.assign({},e,{retrying:true});return executeWriteOperation(i,t,r)};if(r.operationId){handler.operationId=r.operationId}if(c){t.session.incrementTransactionNumber();t.willRetryWrite=c}a[o](s,i,t,handler)}Mongos.prototype.insert=function(e,t,r,n){if(typeof r==="function"){n=r,r={},r=r||{}}if(this.state===T){return n(new l(o("topology was destroyed")))}if(!this.isConnected()&&this.s.disconnectHandler!=null){return this.s.disconnectHandler.add("insert",e,t,r,n)}if(!this.isConnected()){return n(new l("no mongos proxy available"))}executeWriteOperation({self:this,op:"insert",ns:e,ops:t},r,n)};Mongos.prototype.update=function(e,t,r,n){if(typeof r==="function"){n=r,r={},r=r||{}}if(this.state===T){return n(new l(o("topology was destroyed")))}if(!this.isConnected()&&this.s.disconnectHandler!=null){return this.s.disconnectHandler.add("update",e,t,r,n)}if(!this.isConnected()){return n(new l("no mongos proxy available"))}executeWriteOperation({self:this,op:"update",ns:e,ops:t},r,n)};Mongos.prototype.remove=function(e,t,r,n){if(typeof r==="function"){n=r,r={},r=r||{}}if(this.state===T){return n(new l(o("topology was destroyed")))}if(!this.isConnected()&&this.s.disconnectHandler!=null){return this.s.disconnectHandler.add("remove",e,t,r,n)}if(!this.isConnected()){return n(new l("no mongos proxy available"))}executeWriteOperation({self:this,op:"remove",ns:e,ops:t},r,n)};const N=["findAndModify","insert","update","delete"];function isWriteCommand(e){return N.some((t=>e[t]))}Mongos.prototype.command=function(e,t,r,n){if(typeof r==="function"){n=r,r={},r=r||{}}if(this.state===T){return n(new l(o("topology was destroyed")))}var s=this;var i=pickProxy(s,r.session);if((i==null||!i.isConnected())&&this.s.disconnectHandler!=null){return this.s.disconnectHandler.add("command",e,t,r,n)}if(i==null){return n(new l("no mongos proxy available"))}var a=p(r);a.topology=s;const c=!r.retrying&&r.retryWrites&&r.session&&m(s)&&!r.session.inTransaction()&&isWriteCommand(t);const cb=(r,o)=>{if(!r)return n(null,o);if(!S(r,s)){return n(r)}if(c){const r=Object.assign({},a,{retrying:true});return this.command(e,t,r,n)}return n(r)};if(c){a.session.incrementTransactionNumber();a.willRetryWrite=c}i.command(e,t,a,cb)};Mongos.prototype.cursor=function(e,t,r){r=r||{};const n=r.topology||this;var o=r.cursorFactory||this.s.Cursor;return new o(n,e,t,r)};Mongos.prototype.selectServer=function(e,t,r){if(typeof e==="function"&&typeof r==="undefined")r=e,e=undefined,t={};if(typeof t==="function")r=t,t=e,e=undefined;t=t||{};const n=pickProxy(this,t.session);if(n==null){r(new l("server selection failed"));return}if(this.s.debug)this.emit("pickedServer",null,n);r(null,n)};Mongos.prototype.connections=function(){var e=[];for(var t=0;t<this.connectedProxies.length;t++){e=e.concat(this.connectedProxies[t].connections())}return e};function emitTopologyDescriptionChanged(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown";if(e.connectedProxies.length>0){t="Sharded"}var r={topologyType:t,servers:[]};var n=e.disconnectedProxies.concat(e.connectingProxies);r.servers=r.servers.concat(n.map((function(e){var t=e.getDescription();t.type="Unknown";return t})));r.servers=r.servers.concat(e.connectedProxies.map((function(e){var t=e.getDescription();t.type="Mongos";return t})));var o=d(e.topologyDescription,r);var s={topologyId:e.id,previousDescription:e.topologyDescription,newDescription:r,diff:o};if(o.servers.length>0){e.emit("topologyDescriptionChanged",s)}e.topologyDescription=r}}e.exports=Mongos},4485:(e,t,r)=>{"use strict";const n=r(1371).emitWarningOnce;const ReadPreference=function(e,t,r){if(!ReadPreference.isValid(e)){throw new TypeError(`Invalid read preference mode ${e}`)}if(t&&!Array.isArray(t)){n("ReadPreference tags must be an array, this will change in the next major version");const e=typeof t.maxStalenessSeconds!=="undefined";const o=typeof t.hedge!=="undefined";const s=e||o;if(s){r=t;t=undefined}else{t=[t]}}this.mode=e;this.tags=t;this.hedge=r&&r.hedge;r=r||{};if(r.maxStalenessSeconds!=null){if(r.maxStalenessSeconds<=0){throw new TypeError("maxStalenessSeconds must be a positive integer")}this.maxStalenessSeconds=r.maxStalenessSeconds;this.minWireVersion=5}if(this.mode===ReadPreference.PRIMARY){if(this.tags&&Array.isArray(this.tags)&&this.tags.length>0){throw new TypeError("Primary read preference cannot be combined with tags")}if(this.maxStalenessSeconds){throw new TypeError("Primary read preference cannot be combined with maxStalenessSeconds")}if(this.hedge){throw new TypeError("Primary read preference cannot be combined with hedge")}}};Object.defineProperty(ReadPreference.prototype,"preference",{enumerable:true,get:function(){return this.mode}});ReadPreference.PRIMARY="primary";ReadPreference.PRIMARY_PREFERRED="primaryPreferred";ReadPreference.SECONDARY="secondary";ReadPreference.SECONDARY_PREFERRED="secondaryPreferred";ReadPreference.NEAREST="nearest";const o=[ReadPreference.PRIMARY,ReadPreference.PRIMARY_PREFERRED,ReadPreference.SECONDARY,ReadPreference.SECONDARY_PREFERRED,ReadPreference.NEAREST,null];ReadPreference.fromOptions=function(e){if(!e)return null;const t=e.readPreference;if(!t)return null;const r=e.readPreferenceTags;const n=e.maxStalenessSeconds;if(typeof t==="string"){return new ReadPreference(t,r)}else if(!(t instanceof ReadPreference)&&typeof t==="object"){const e=t.mode||t.preference;if(e&&typeof e==="string"){return new ReadPreference(e,t.tags,{maxStalenessSeconds:t.maxStalenessSeconds||n,hedge:t.hedge})}}return t};ReadPreference.resolve=function(e,t){t=t||{};const r=t.session;const n=e&&e.readPreference;let o;if(t.readPreference){o=ReadPreference.fromOptions(t)}else if(r&&r.inTransaction()&&r.transaction.options.readPreference){o=r.transaction.options.readPreference}else if(n!=null){o=n}else{o=ReadPreference.primary}return typeof o==="string"?new ReadPreference(o):o};ReadPreference.translate=function(e){if(e.readPreference==null)return e;const t=e.readPreference;if(typeof t==="string"){e.readPreference=new ReadPreference(t)}else if(t&&!(t instanceof ReadPreference)&&typeof t==="object"){const r=t.mode||t.preference;if(r&&typeof r==="string"){e.readPreference=new ReadPreference(r,t.tags,{maxStalenessSeconds:t.maxStalenessSeconds})}}else if(!(t instanceof ReadPreference)){throw new TypeError("Invalid read preference: "+t)}return e};ReadPreference.isValid=function(e){return o.indexOf(e)!==-1};ReadPreference.prototype.isValid=function(e){return ReadPreference.isValid(typeof e==="string"?e:this.mode)};const s=["primaryPreferred","secondary","secondaryPreferred","nearest"];ReadPreference.prototype.slaveOk=function(){return s.indexOf(this.mode)!==-1};ReadPreference.prototype.equals=function(e){return e.mode===this.mode};ReadPreference.prototype.toJSON=function(){const e={mode:this.mode};if(Array.isArray(this.tags))e.tags=this.tags;if(this.maxStalenessSeconds)e.maxStalenessSeconds=this.maxStalenessSeconds;if(this.hedge)e.hedge=this.hedge;return e};ReadPreference.primary=new ReadPreference("primary");ReadPreference.primaryPreferred=new ReadPreference("primaryPreferred");ReadPreference.secondary=new ReadPreference("secondary");ReadPreference.secondaryPreferred=new ReadPreference("secondaryPreferred");ReadPreference.nearest=new ReadPreference("nearest");e.exports=ReadPreference},1134:(e,t,r)=>{"use strict";const n=r(1669).inherits;const o=r(1669).format;const s=r(8614).EventEmitter;const i=r(4485);const a=r(4847).CoreCursor;const c=r(7746).retrieveBSON;const l=r(104);const u=r(3111).MongoError;const d=r(6495);const p=r(8742);const h=r(2306).Timeout;const m=r(2306).Interval;const y=r(2306).SessionMixins;const g=r(2306).isRetryableWritesSupported;const v=r(1178).relayEvents;const b=c();const S=r(2306).getMMAPError;const w=r(1178).makeClientMetadata;const _=r(2306).legacyIsRetryableWriteError;const E=r(1371).now;const O=r(1371).calculateDurationInMs;var C="disconnected";var T="connecting";var I="connected";var k="unreferenced";var A="destroyed";function stateTransition(e,t){var r={disconnected:[T,A,C],connecting:[T,A,I,C],connected:[I,C,A,k],unreferenced:[k,A],destroyed:[A]};var n=r[e.state];if(n&&n.indexOf(t)!==-1){e.state=t}else{e.s.logger.error(o("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}}var N=1;var R=["connect","close","error","timeout","parseError"];var ReplSet=function(e,t){var r=this;t=t||{};if(!Array.isArray(e))throw new u("seedlist must be an array");if(e.length===0)throw new u("seedlist must contain at least one entry");e.forEach((function(e){if(typeof e.host!=="string"||typeof e.port!=="number")throw new u("seedlist entry must contain a host and port")}));s.call(this);this.id=N++;var n=t.localThresholdMS||15;if(t.acceptableLatency)n=t.acceptableLatency;var i=l("ReplSet",t);this.s={options:Object.assign({metadata:w(t)},t),bson:t.bson||new b([b.Binary,b.Code,b.DBRef,b.Decimal128,b.Double,b.Int32,b.Long,b.Map,b.MaxKey,b.MinKey,b.ObjectId,b.BSONRegExp,b.Symbol,b.Timestamp]),Cursor:t.cursorFactory||a,logger:i,seedlist:e,replicaSetState:new p({id:this.id,setName:t.setName,acceptableLatency:n,heartbeatFrequencyMS:t.haInterval?t.haInterval:1e4,logger:i}),connectingServers:[],haInterval:t.haInterval?t.haInterval:1e4,minHeartbeatFrequencyMS:500,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:typeof t.debug==="boolean"?t.debug:false};this.s.replicaSetState.on("topologyDescriptionChanged",(function(e){r.emit("topologyDescriptionChanged",e)}));if(this.s.logger.isWarn()&&this.s.options.socketTimeout!==0&&this.s.options.socketTimeout<this.s.haInterval){this.s.logger.warn(o("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval))}var c=["joined","left"];c.forEach((function(e){r.s.replicaSetState.on(e,(function(t,n){r.emit(e,t,n)}))}));this.initialConnectState={connect:false,fullsetup:false,all:false};this.state=C;this.haTimeoutId=null;this.ismaster=null;this.intervalIds=[];this.clusterTime=null};n(ReplSet,s);Object.assign(ReplSet.prototype,y);Object.defineProperty(ReplSet.prototype,"type",{enumerable:true,get:function(){return"replset"}});Object.defineProperty(ReplSet.prototype,"parserType",{enumerable:true,get:function(){return b.native?"c++":"js"}});Object.defineProperty(ReplSet.prototype,"logicalSessionTimeoutMinutes",{enumerable:true,get:function(){return this.s.replicaSetState.logicalSessionTimeoutMinutes||null}});function rexecuteOperations(e){if(e.s.replicaSetState.hasPrimaryAndSecondary()&&e.s.disconnectHandler){e.s.disconnectHandler.execute()}else if(e.s.replicaSetState.hasPrimary()&&e.s.disconnectHandler){e.s.disconnectHandler.execute({executePrimary:true})}else if(e.s.replicaSetState.hasSecondary()&&e.s.disconnectHandler){e.s.disconnectHandler.execute({executeSecondary:true})}}function connectNewServers(e,t,r){if(t.length===0){return r()}var n=t.length;var o=null;function done(){n=n-1;if(n===0){r(o)}}var _handleEvent=function(e,t){return function(r){var n=this;if(e.state===A||e.state===k){this.destroy({force:true});return done()}if(t==="connect"){var s=e.s.replicaSetState.update(n);if(s){if(n.lastIsMaster()&&n.lastIsMaster().ismaster){e.ismaster=n.lastIsMaster()}for(let e=0;e<R.length;e++){n.removeAllListeners(R[e])}n.on("error",handleEvent(e,"error"));n.on("close",handleEvent(e,"close"));n.on("timeout",handleEvent(e,"timeout"));n.on("parseError",handleEvent(e,"parseError"));monitorServer(n.lastIsMaster().me,e,{});rexecuteOperations(e)}else{n.destroy({force:true})}}else if(t==="error"){o=r}rexecuteOperations(e);done()}};function execute(t,r){setTimeout((function(){if(e.state===A||e.state===k){return}const r=e.s.connectingServers.findIndex((e=>e.name===t));if(r>=0){const t=e.s.connectingServers[r];t.destroy({force:true});e.s.connectingServers.splice(r,1);return done()}var n=new d(Object.assign({},e.s.options,{host:t.split(":")[0],port:parseInt(t.split(":")[1],10),reconnect:false,monitoring:false,parent:e}));n.once("connect",_handleEvent(e,"connect"));n.once("close",_handleEvent(e,"close"));n.once("timeout",_handleEvent(e,"timeout"));n.once("error",_handleEvent(e,"error"));n.once("parseError",_handleEvent(e,"parseError"));n.on("serverOpening",(t=>e.emit("serverOpening",t)));n.on("serverDescriptionChanged",(t=>e.emit("serverDescriptionChanged",t)));n.on("serverClosed",(t=>e.emit("serverClosed",t)));v(n,e,["commandStarted","commandSucceeded","commandFailed"]);e.s.connectingServers.push(n);n.connect(e.s.connectOptions)}),r)}for(var s=0;s<t.length;s++){execute(t[s],s)}}var pingServer=function(e,t,r){var n=(new Date).getTime();emitSDAMEvent(e,"serverHeartbeatStarted",{connectionId:t.name});t.command("admin.$cmd",{ismaster:true},{monitoring:true,socketTimeout:e.s.options.connectionTimeout||2e3},(function(o,s){if(e.state===A||e.state===k){t.destroy({force:true});return r(o,s)}var i=(new Date).getTime()-n;t.lastUpdateTime=E();if(o){emitSDAMEvent(e,"serverHeartbeatFailed",{durationMS:i,failure:o,connectionId:t.name});e.s.replicaSetState.remove(t)}else{t.ismaster=s.result;if(t.ismaster.lastWrite&&t.ismaster.lastWrite.lastWriteDate){t.lastWriteDate=t.ismaster.lastWrite.lastWriteDate.getTime()}if(t.lastIsMasterMS===-1){t.lastIsMasterMS=i}else if(t.lastIsMasterMS){t.lastIsMasterMS=.2*i+(1-.2)*t.lastIsMasterMS}if(e.s.replicaSetState.update(t)){if(t.lastIsMaster()&&t.lastIsMaster().ismaster){e.ismaster=t.lastIsMaster()}}emitSDAMEvent(e,"serverHeartbeatSucceeded",{durationMS:i,reply:s.result,connectionId:t.name})}e.s.replicaSetState.updateServerMaxStaleness(t,e.s.haInterval);r(o,s)}))};var monitorServer=function(e,t,r){if(!r.haInterval){for(var n=0;n<t.intervalIds.length;n++){if(t.intervalIds[n].__host===e){return}}}var o=r.haInterval?h:m;var s=r.haInterval?r.haInterval:t.s.haInterval;var i=new o((function(){if(t.state===A||t.state===k){i.stop();return}var r=t.s.replicaSetState.get(e);if(r){return pingServer(t,r,(function(e){if(e){return}if(t.state===A||t.state===k){i.stop();return}t.intervalIds=t.intervalIds.filter((function(e){return e.isRunning()}));if(o===h){if(t.state===T&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())){stateTransition(t,I);process.nextTick((function(){t.emit("connect",t)}));topologyMonitor(t,{})}}else{if(t.state===C&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())){stateTransition(t,T);rexecuteOperations(t);process.nextTick((function(){t.emit("reconnect",t)}))}}if(t.initialConnectState.connect&&!t.initialConnectState.fullsetup&&t.s.replicaSetState.hasPrimaryAndSecondary()){t.initialConnectState.fullsetup=true;t.initialConnectState.all=true;process.nextTick((function(){t.emit("fullsetup",t);t.emit("all",t)}))}}))}}),s);i.start();i.__host=e;t.intervalIds.push(i)};function topologyMonitor(e,t){if(e.state===A||e.state===k)return;t=t||{};var r=Object.keys(e.s.replicaSetState.set);var n=t.haInterval?h:m;var o=t.haInterval?t.haInterval:e.s.haInterval;if(n===h){return connectNewServers(e,e.s.replicaSetState.unknownServers,(function(n){if(e.state===A||e.state===k){return}if(!e.s.replicaSetState.hasPrimary()&&!e.s.options.secondaryOnlyConnectionAllowed){if(n){return e.emit("error",n)}e.emit("error",new u("no primary found in replicaset or invalid replica set name"));return e.destroy({force:true})}else if(!e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed){if(n){return e.emit("error",n)}e.emit("error",new u("no secondary found in replicaset or invalid replica set name"));return e.destroy({force:true})}for(var o=0;o<r.length;o++){monitorServer(r[o],e,t)}}))}else{for(var s=0;s<r.length;s++){monitorServer(r[s],e,t)}}function executeReconnect(e){return function(){if(e.state===A||e.state===k){return}connectNewServers(e,e.s.replicaSetState.unknownServers,(function(){var t=e.s.replicaSetState.hasPrimary()?o:e.s.minHeartbeatFrequencyMS;e.intervalIds.push(new h(executeReconnect(e),t).start())}))}}var i=!e.s.replicaSetState.hasPrimary()?e.s.minHeartbeatFrequencyMS:o;e.intervalIds.push(new h(executeReconnect(e),i).start())}function addServerToList(e,t){for(var r=0;r<e.length;r++){if(e[r].name.toLowerCase()===t.name.toLowerCase())return true}e.push(t)}function handleEvent(e,t){return function(){if(e.state===A||e.state===k)return;if(e.s.logger.isDebug()){e.s.logger.debug(o("handleEvent %s from server %s in replset with id %s",t,this.name,e.id))}e.s.replicaSetState.remove(this);if(e.state===A||e.state===k)return;if(!e.s.replicaSetState.hasPrimary()&&!e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed){stateTransition(e,C)}else if(!e.s.replicaSetState.hasPrimary()){stateTransition(e,C)}addServerToList(e.s.connectingServers,this)}}function shouldTriggerConnect(e){const t=e.state===T;const r=e.s.replicaSetState.hasPrimary();const n=e.s.replicaSetState.hasSecondary();const o=e.s.options.secondaryOnlyConnectionAllowed;const s=e.s.connectOptions.readPreference&&e.s.connectOptions.readPreference.equals(i.secondary);return t&&(s&&n||!s&&r)||n&&o}function handleInitialConnectEvent(e,t){return function(){var r=this;if(e.s.logger.isDebug()){e.s.logger.debug(o("handleInitialConnectEvent %s from server %s in replset with id %s",t,this.name,e.id))}if(e.state===A||e.state===k){return this.destroy({force:true})}if(t==="connect"){var n=e.s.replicaSetState.update(r);if(n===true){if(r.lastIsMaster()&&r.lastIsMaster().ismaster){e.ismaster=r.lastIsMaster()}if(e.s.logger.isDebug()){e.s.logger.debug(o("handleInitialConnectEvent %s from server %s in replset with id %s has state [%s]",t,r.name,e.id,JSON.stringify(e.s.replicaSetState.set)))}for(let e=0;e<R.length;e++){r.removeAllListeners(R[e])}r.on("error",handleEvent(e,"error"));r.on("close",handleEvent(e,"close"));r.on("timeout",handleEvent(e,"timeout"));r.on("parseError",handleEvent(e,"parseError"));if(shouldTriggerConnect(e)){stateTransition(e,I);e.initialConnectState.connect=true;process.nextTick((function(){e.emit("connect",e)}));topologyMonitor(e,{})}}else if(n instanceof u){r.destroy({force:true});e.destroy({force:true});return e.emit("error",n)}else{r.destroy({force:true})}}else{e.emit("failed",this);addServerToList(e.s.connectingServers,this);e.s.replicaSetState.remove(this)}if(e.initialConnectState.connect&&!e.initialConnectState.fullsetup&&e.s.replicaSetState.hasPrimaryAndSecondary()){e.initialConnectState.fullsetup=true;e.initialConnectState.all=true;process.nextTick((function(){e.emit("fullsetup",e);e.emit("all",e)}))}for(var s=0;s<e.s.connectingServers.length;s++){if(e.s.connectingServers[s].equals(this)){e.s.connectingServers.splice(s,1)}}if(e.s.connectingServers.length===0&&e.state===T){topologyMonitor(e,{haInterval:1})}}}function connectServers(e,t){e.s.connectingServers=e.s.connectingServers.concat(t);var r=0;function connect(t,r){setTimeout((function(){if(e.s.replicaSetState.update(t)){if(t.lastIsMaster()&&t.lastIsMaster().ismaster){e.ismaster=t.lastIsMaster()}}t.once("close",handleInitialConnectEvent(e,"close"));t.once("timeout",handleInitialConnectEvent(e,"timeout"));t.once("parseError",handleInitialConnectEvent(e,"parseError"));t.once("error",handleInitialConnectEvent(e,"error"));t.once("connect",handleInitialConnectEvent(e,"connect"));t.on("serverOpening",(t=>e.emit("serverOpening",t)));t.on("serverDescriptionChanged",(t=>e.emit("serverDescriptionChanged",t)));t.on("serverClosed",(t=>e.emit("serverClosed",t)));v(t,e,["commandStarted","commandSucceeded","commandFailed"]);t.connect(e.s.connectOptions)}),r)}while(t.length>0){connect(t.shift(),r++)}}function emitSDAMEvent(e,t,r){if(e.listeners(t).length>0){e.emit(t,r)}}ReplSet.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{};stateTransition(this,T);var r=this.s.seedlist.map((function(r){return new d(Object.assign({},t.s.options,r,e,{reconnect:false,monitoring:false,parent:t}))}));if(this.s.options.socketTimeout>0&&this.s.options.socketTimeout<=this.s.options.haInterval){return t.emit("error",new u(o("haInterval [%s] MS must be set to less than socketTimeout [%s] MS",this.s.options.haInterval,this.s.options.socketTimeout)))}emitSDAMEvent(this,"topologyOpening",{topologyId:this.id});connectServers(t,r)};ReplSet.prototype.auth=function(e,t){if(typeof t==="function")t(null,null)};ReplSet.prototype.destroy=function(e,t){if(typeof e==="function"){t=e;e={}}e=e||{};let r=this.s.connectingServers.length+1;const serverDestroyed=()=>{r--;if(r>0){return}emitSDAMEvent(this,"topologyClosed",{topologyId:this.id});if(typeof t==="function"){t(null,null)}};if(this.state===A){if(typeof t==="function")t(null,null);return}stateTransition(this,A);if(this.haTimeoutId)clearTimeout(this.haTimeoutId);for(var n=0;n<this.intervalIds.length;n++){this.intervalIds[n].stop()}this.intervalIds=[];if(r===0){serverDestroyed();return}this.s.replicaSetState.destroy(e,serverDestroyed);this.s.connectingServers.forEach((function(t){t.destroy(e,serverDestroyed)}))};ReplSet.prototype.unref=function(){stateTransition(this,k);this.s.replicaSetState.allServers().forEach((function(e){e.unref()}));clearTimeout(this.haTimeoutId)};ReplSet.prototype.lastIsMaster=function(){if(this.s.options.secondaryOnlyConnectionAllowed&&!this.s.replicaSetState.hasPrimary()&&this.s.replicaSetState.hasSecondary()){return this.s.replicaSetState.secondaries[0].lastIsMaster()}return this.s.replicaSetState.primary?this.s.replicaSetState.primary.lastIsMaster():this.ismaster};ReplSet.prototype.connections=function(){var e=this.s.replicaSetState.allServers();var t=[];for(var r=0;r<e.length;r++){t=t.concat(e[r].connections())}return t};ReplSet.prototype.isConnected=function(e){e=e||{};if(e.readPreference&&e.readPreference.equals(i.secondary)){return this.s.replicaSetState.hasSecondary()}if(e.readPreference&&e.readPreference.equals(i.primary)){return this.s.replicaSetState.hasPrimary()}if(e.readPreference&&e.readPreference.equals(i.primaryPreferred)){return this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary()}if(e.readPreference&&e.readPreference.equals(i.secondaryPreferred)){return this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary()}if(this.s.options.secondaryOnlyConnectionAllowed&&this.s.replicaSetState.hasSecondary()){return true}return this.s.replicaSetState.hasPrimary()};ReplSet.prototype.isDestroyed=function(){return this.state===A};const M=1e4;const D=1e3;ReplSet.prototype.selectServer=function(e,t,r){if(typeof e==="function"&&typeof r==="undefined")r=e,e=undefined,t={};if(typeof t==="function")r=t,t=e;t=t||{};let n;if(e instanceof i){n=e}else{n=t.readPreference||i.primary}let o;const s=E();const _selectServer=()=>{if(O(s)>=M){if(o!=null){r(o,null)}else{r(new u("Server selection timed out"))}return}const e=this.s.replicaSetState.pickServer(n);if(e==null){setTimeout(_selectServer,D);return}if(!(e instanceof d)){o=e;setTimeout(_selectServer,D);return}if(this.s.debug)this.emit("pickedServer",t.readPreference,e);r(null,e)};_selectServer()};ReplSet.prototype.getServers=function(){return this.s.replicaSetState.allServers()};function executeWriteOperation(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};const n=e.self;const s=e.op;const i=e.ns;const a=e.ops;if(n.state===A){return r(new u(o("topology was destroyed")))}const c=!e.retrying&&!!t.retryWrites&&t.session&&g(n)&&!t.session.inTransaction()&&t.explain===undefined;if(!n.s.replicaSetState.hasPrimary()){if(n.s.disconnectHandler){return n.s.disconnectHandler.add(s,i,a,t,r)}else if(!c){return r(new u("no primary server found"))}}const handler=(o,s)=>{if(!o)return r(null,s);if(!_(o,n)){o=S(o);return r(o)}if(c){const n=Object.assign({},e,{retrying:true});return executeWriteOperation(n,t,r)}if(n.s.replicaSetState.primary){n.s.replicaSetState.primary.destroy();n.s.replicaSetState.remove(n.s.replicaSetState.primary,{force:true})}return r(o)};if(r.operationId){handler.operationId=r.operationId}if(c){t.session.incrementTransactionNumber();t.willRetryWrite=c}n.s.replicaSetState.primary[s](i,a,t,handler)}ReplSet.prototype.insert=function(e,t,r,n){executeWriteOperation({self:this,op:"insert",ns:e,ops:t},r,n)};ReplSet.prototype.update=function(e,t,r,n){executeWriteOperation({self:this,op:"update",ns:e,ops:t},r,n)};ReplSet.prototype.remove=function(e,t,r,n){executeWriteOperation({self:this,op:"remove",ns:e,ops:t},r,n)};const P=["findAndModify","insert","update","delete"];function isWriteCommand(e){return P.some((t=>e[t]))}ReplSet.prototype.command=function(e,t,r,n){if(typeof r==="function"){n=r,r={},r=r||{}}if(this.state===A)return n(new u(o("topology was destroyed")));var s=this;var a=r.readPreference?r.readPreference:i.primary;if(a.preference==="primary"&&!this.s.replicaSetState.hasPrimary()&&this.s.disconnectHandler!=null){return this.s.disconnectHandler.add("command",e,t,r,n)}else if(a.preference==="secondary"&&!this.s.replicaSetState.hasSecondary()&&this.s.disconnectHandler!=null){return this.s.disconnectHandler.add("command",e,t,r,n)}else if(a.preference!=="primary"&&!this.s.replicaSetState.hasSecondary()&&!this.s.replicaSetState.hasPrimary()&&this.s.disconnectHandler!=null){return this.s.disconnectHandler.add("command",e,t,r,n)}var c=this.s.replicaSetState.pickServer(a);if(!(c instanceof d))return n(c);if(s.s.debug)s.emit("pickedServer",i.primary,c);if(c==null){return n(new u(o("no server found that matches the provided readPreference %s",a)))}const l=!r.retrying&&!!r.retryWrites&&r.session&&g(s)&&!r.session.inTransaction()&&isWriteCommand(t);const cb=(o,i)=>{if(!o)return n(null,i);if(!_(o,s)){return n(o)}if(l){const o=Object.assign({},r,{retrying:true});return this.command(e,t,o,n)}if(this.s.replicaSetState.primary){this.s.replicaSetState.primary.destroy();this.s.replicaSetState.remove(this.s.replicaSetState.primary,{force:true})}return n(o)};if(l){r.session.incrementTransactionNumber();r.willRetryWrite=l}c.command(e,t,r,cb)};ReplSet.prototype.cursor=function(e,t,r){r=r||{};const n=r.topology||this;var o=r.cursorFactory||this.s.Cursor;return new o(n,e,t,r)};e.exports=ReplSet},8742:(e,t,r)=>{"use strict";var n=r(1669).inherits,o=r(1669).format,s=r(2306).diff,i=r(8614).EventEmitter,a=r(104),c=r(4485),l=r(3111).MongoError,u=r(1867).Buffer;var d={Single:"Single",ReplicaSetNoPrimary:"ReplicaSetNoPrimary",ReplicaSetWithPrimary:"ReplicaSetWithPrimary",Sharded:"Sharded",Unknown:"Unknown"};var p={Standalone:"Standalone",Mongos:"Mongos",PossiblePrimary:"PossiblePrimary",RSPrimary:"RSPrimary",RSSecondary:"RSSecondary",RSArbiter:"RSArbiter",RSOther:"RSOther",RSGhost:"RSGhost",Unknown:"Unknown"};var ReplSetState=function(e){e=e||{};i.call(this);this.topologyType=d.ReplicaSetNoPrimary;this.setName=e.setName;this.set={};this.id=e.id;this.setName=e.setName;this.logger=e.logger||a("ReplSet",e);this.index=0;this.acceptableLatency=e.acceptableLatency||15;this.heartbeatFrequencyMS=e.heartbeatFrequencyMS||1e4;this.primary=null;this.secondaries=[];this.arbiters=[];this.passives=[];this.ghosts=[];this.unknownServers=[];this.set={};this.maxElectionId=null;this.maxSetVersion=0;this.replicasetDescription={topologyType:"Unknown",servers:[]};this.logicalSessionTimeoutMinutes=undefined};n(ReplSetState,i);ReplSetState.prototype.hasPrimaryAndSecondary=function(){return this.primary!=null&&this.secondaries.length>0};ReplSetState.prototype.hasPrimaryOrSecondary=function(){return this.hasPrimary()||this.hasSecondary()};ReplSetState.prototype.hasPrimary=function(){return this.primary!=null};ReplSetState.prototype.hasSecondary=function(){return this.secondaries.length>0};ReplSetState.prototype.get=function(e){var t=this.allServers();for(var r=0;r<t.length;r++){if(t[r].name.toLowerCase()===e.toLowerCase()){return t[r]}}return null};ReplSetState.prototype.allServers=function(e){e=e||{};var t=this.primary?[this.primary]:[];t=t.concat(this.secondaries);if(!e.ignoreArbiters)t=t.concat(this.arbiters);t=t.concat(this.passives);return t};ReplSetState.prototype.destroy=function(e,t){const r=this.secondaries.concat(this.arbiters).concat(this.passives).concat(this.ghosts);if(this.primary)r.push(this.primary);let n=r.length;const serverDestroyed=()=>{n--;if(n>0){return}this.secondaries=[];this.arbiters=[];this.passives=[];this.ghosts=[];this.unknownServers=[];this.set={};this.primary=null;emitTopologyDescriptionChanged(this);if(typeof t==="function"){t(null,null)}};if(n===0){serverDestroyed();return}r.forEach((t=>t.destroy(e,serverDestroyed)))};ReplSetState.prototype.remove=function(e,t){t=t||{};var r=e.name.toLowerCase();var n=this.primary?[this.primary]:[];n=n.concat(this.secondaries);n=n.concat(this.arbiters);n=n.concat(this.passives);for(var o=0;o<n.length;o++){if(!t.force&&n[o].equals(e)&&n[o].isConnected&&n[o].isConnected()){return}}if(this.set[r]){this.set[r].type=p.Unknown;this.set[r].electionId=null;this.set[r].setName=null;this.set[r].setVersion=null}var s=null;if(this.primary&&this.primary.equals(e)){this.primary=null;this.topologyType=d.ReplicaSetNoPrimary;s="primary"}s=removeFrom(e,this.secondaries)?"secondary":s;s=removeFrom(e,this.arbiters)?"arbiter":s;s=removeFrom(e,this.passives)?"secondary":s;removeFrom(e,this.ghosts);removeFrom(e,this.unknownServers);this.unknownServers.push(r);if(s){this.emit("left",s,e)}};const isArbiter=e=>e.arbiterOnly&&e.setName;ReplSetState.prototype.update=function(e){var t=this;var r=e.lastIsMaster();var n=e.name.toLowerCase();if(r){var s=Array.isArray(r.hosts)?r.hosts:[];s=s.concat(Array.isArray(r.arbiters)?r.arbiters:[]);s=s.concat(Array.isArray(r.passives)?r.passives:[]);s=s.map((function(e){return e.toLowerCase()}));for(var i=0;i<s.length;i++){if(this.unknownServers.indexOf(s[i])===-1&&(!this.set[s[i]]||this.set[s[i]].type===p.Unknown)){this.unknownServers.push(s[i].toLowerCase())}if(!this.set[s[i]]){this.set[s[i]]={type:p.Unknown,electionId:null,setName:null,setVersion:null}}}}if(!r&&!inList(r,e,this.unknownServers)){t.set[n]={type:p.Unknown,setVersion:null,electionId:null,setName:null};t.set[n].type=p.Unknown;t.set[n].electionId=r?r.electionId:r;t.set[n].setName=r?r.setName:r;t.set[n].setVersion=r?r.setVersion:r;if(t.unknownServers.indexOf(e.name)===-1){t.unknownServers.push(n)}return false}if(r.logicalSessionTimeoutMinutes!==undefined&&!isArbiter(r)){if(t.logicalSessionTimeoutMinutes===undefined||r.logicalSessionTimeoutMinutes===null){t.logicalSessionTimeoutMinutes=r.logicalSessionTimeoutMinutes}else{t.logicalSessionTimeoutMinutes=Math.min(t.logicalSessionTimeoutMinutes,r.logicalSessionTimeoutMinutes)}}if(r&&r.msg==="isdbgrid"){if(this.primary&&this.primary.name===n){this.primary=null;this.topologyType=d.ReplicaSetNoPrimary}return false}if(r.isreplicaset){t.set[n]={type:p.RSGhost,setVersion:null,electionId:null,setName:r.setName};if(this.primary&&this.primary.name===n){this.primary=null}this.topologyType=this.primary?d.ReplicaSetWithPrimary:d.ReplicaSetNoPrimary;if(r.setName)this.setName=r.setName;return false}if(r.setName&&r.hidden||r.setName&&!r.ismaster&&!r.secondary&&!r.arbiterOnly&&!r.passive){t.set[n]={type:p.RSOther,setVersion:null,electionId:null,setName:r.setName};this.topologyType=this.primary?d.ReplicaSetWithPrimary:d.ReplicaSetNoPrimary;if(r.setName)this.setName=r.setName;return false}if(r&&r.ismaster&&!r.setName){this.topologyType=this.primary?d.ReplicaSetWithPrimary:d.Unknown;this.remove(e,{force:true});return false}if(r&&!r.ismaster&&!r.secondary&&!r.arbiterOnly){this.remove(e,{force:true});return false}if(r.me&&r.me.toLowerCase()!==n){if(this.logger.isWarn()){this.logger.warn(o("the seedlist server was removed due to its address %s not matching its ismaster.me address %s",e.name,r.me))}delete this.set[n];removeFrom(e,t.unknownServers);e.destroy({force:true});if(this.primary&&!this.primary.equals(e)){this.topologyType=d.ReplicaSetWithPrimary}else{this.topologyType=d.ReplicaSetNoPrimary}if(!this.primary&&r.primary){this.set[r.primary.toLowerCase()]={type:p.PossiblePrimary,setName:null,electionId:null,setVersion:null}}return false}if(!this.primary&&r.ismaster&&r.setName){var a=e.lastIsMaster().electionId;if(this.setName&&this.setName!==r.setName){this.topologyType=d.ReplicaSetNoPrimary;return new l(o("setName from ismaster does not match provided connection setName [%s] != [%s]",r.setName,this.setName))}if(!this.maxElectionId&&a){this.maxElectionId=a}else if(this.maxElectionId&&a){var c=compareObjectIds(this.maxElectionId,a);var u=e.lastIsMaster().setVersion;if(c===1){this.topologyType=d.ReplicaSetNoPrimary;return false}else if(c===0&&u){if(u<this.maxSetVersion){this.topologyType=d.ReplicaSetNoPrimary;return false}}this.maxSetVersion=u;this.maxElectionId=a}var h=r.hosts.map((function(e){return e.toLowerCase()}));var m=h.indexOf(n);if(m!==-1){t.primary=e;t.set[n]={type:p.RSPrimary,setVersion:r.setVersion,electionId:r.electionId,setName:r.setName};this.topologyType=d.ReplicaSetWithPrimary;if(r.setName)this.setName=r.setName;removeFrom(e,t.unknownServers);removeFrom(e,t.secondaries);removeFrom(e,t.passives);t.emit("joined","primary",e)}else{this.topologyType=d.ReplicaSetNoPrimary}emitTopologyDescriptionChanged(t);return true}else if(r.ismaster&&r.setName){var y=t.set[t.primary.name.toLowerCase()].electionId;var g=t.set[t.primary.name.toLowerCase()].setVersion;var v=t.set[t.primary.name.toLowerCase()].setName;a=e.lastIsMaster().electionId;u=e.lastIsMaster().setVersion;var b=e.lastIsMaster().setName;if(this.primary.equals(e)&&v===b){return false}if(v&&v!==b){if(!this.primary.equals(e)){this.topologyType=d.ReplicaSetWithPrimary}else{this.topologyType=d.ReplicaSetNoPrimary}return false}if(y&&a){c=compareObjectIds(y,a);if(c===1){return false}else if(c===0&&g>u){return false}}else if(!y&&a&&u){if(u<this.maxSetVersion){return false}}if(!this.maxElectionId&&a){this.maxElectionId=a}else if(this.maxElectionId&&a){c=compareObjectIds(this.maxElectionId,a);if(c===1){return false}else if(c===0&&g&&u){if(u<this.maxSetVersion){return false}}else{if(u<this.maxSetVersion){return false}}this.maxElectionId=a;this.maxSetVersion=u}else{this.maxSetVersion=u}t.set[t.primary.name.toLowerCase()]={type:p.Unknown,setVersion:null,electionId:null,setName:null};t.emit("left","primary",this.primary);t.primary.destroy({force:true});t.primary=e;t.set[n]={type:p.RSPrimary,setVersion:r.setVersion,electionId:r.electionId,setName:r.setName};this.topologyType=d.ReplicaSetWithPrimary;if(r.setName)this.setName=r.setName;removeFrom(e,t.unknownServers);removeFrom(e,t.secondaries);removeFrom(e,t.passives);t.emit("joined","primary",e);emitTopologyDescriptionChanged(t);return true}if(!this.primary&&r.primary){t.set[r.primary.toLowerCase()]={type:p.PossiblePrimary,setVersion:null,electionId:null,setName:null}}if(r.secondary&&r.setName&&!inList(r,e,this.secondaries)&&this.setName&&this.setName===r.setName){addToList(t,p.RSSecondary,r,e,this.secondaries);this.topologyType=this.primary?d.ReplicaSetWithPrimary:d.ReplicaSetNoPrimary;if(r.setName)this.setName=r.setName;removeFrom(e,t.unknownServers);if(this.primary&&this.primary.name.toLowerCase()===n){e.destroy({force:true});this.primary=null;t.emit("left","primary",e)}t.emit("joined","secondary",e);emitTopologyDescriptionChanged(t);return true}if(isArbiter(r)&&!inList(r,e,this.arbiters)&&this.setName&&this.setName===r.setName){addToList(t,p.RSArbiter,r,e,this.arbiters);this.topologyType=this.primary?d.ReplicaSetWithPrimary:d.ReplicaSetNoPrimary;if(r.setName)this.setName=r.setName;removeFrom(e,t.unknownServers);t.emit("joined","arbiter",e);emitTopologyDescriptionChanged(t);return true}if(r.passive&&r.setName&&!inList(r,e,this.passives)&&this.setName&&this.setName===r.setName){addToList(t,p.RSSecondary,r,e,this.passives);this.topologyType=this.primary?d.ReplicaSetWithPrimary:d.ReplicaSetNoPrimary;if(r.setName)this.setName=r.setName;removeFrom(e,t.unknownServers);if(this.primary&&this.primary.name.toLowerCase()===n){e.destroy({force:true});this.primary=null;t.emit("left","primary",e)}t.emit("joined","secondary",e);emitTopologyDescriptionChanged(t);return true}if(this.set[n]&&this.set[n].type===p.RSPrimary){t.emit("left","primary",this.primary);this.primary.destroy({force:true});this.primary=null;this.topologyType=d.ReplicaSetNoPrimary;return false}this.topologyType=this.primary?d.ReplicaSetWithPrimary:d.ReplicaSetNoPrimary;return false};ReplSetState.prototype.updateServerMaxStaleness=function(e,t){var r=0;for(var n=0;n<this.secondaries.length;n++){r=Math.max(r,this.secondaries[n].lastWriteDate)}if(e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&this.hasPrimary()){e.staleness=e.lastUpdateTime-e.lastWriteDate-(this.primary.lastUpdateTime-this.primary.lastWriteDate)+t}else if(e.ismaster.maxWireVersion>=5&&e.ismaster.secondary){e.staleness=r-e.lastWriteDate+t}};ReplSetState.prototype.updateSecondariesMaxStaleness=function(e){for(var t=0;t<this.secondaries.length;t++){this.updateServerMaxStaleness(this.secondaries[t],e)}};ReplSetState.prototype.pickServer=function(e){e=e||c.primary;if(e.preference==="primary"&&e.maxStalenessSeconds!=null){return new l("primary readPreference incompatible with maxStalenessSeconds")}var t=this.primary?[this.primary]:[];t=t.concat(this.secondaries);if(e.maxStalenessSeconds!=null){for(var r=0;r<t.length;r++){if(t[r].ismaster.maxWireVersion<5){return new l("maxStalenessSeconds not supported by at least one of the replicaset members")}}}if(e.preference==="nearest"&&e.maxStalenessSeconds==null){return pickNearest(this,e)}else if(e.preference==="nearest"&&e.maxStalenessSeconds!=null){return pickNearestMaxStalenessSeconds(this,e)}var n=this.secondaries;if(e.equals(c.secondary)&&n.length===0){return new l("no secondary server available")}if(e.equals(c.secondaryPreferred)&&n.length===0&&this.primary==null){return new l("no secondary or primary server available")}if(e.equals(c.primary)&&this.primary==null){return new l("no primary server available")}if(e.equals(c.secondaryPreferred)||e.equals(c.secondary)){if(n.length>0&&e.maxStalenessSeconds==null){var o=pickNearest(this,e);if(o){return o}}else if(n.length>0&&e.maxStalenessSeconds!=null){o=pickNearestMaxStalenessSeconds(this,e);if(o){return o}}if(e.equals(c.secondaryPreferred)){return this.primary}return null}if(e.equals(c.primaryPreferred)){o=null;if(this.primary){return this.primary}if(n.length>0&&e.maxStalenessSeconds==null){o=pickNearest(this,e)}else if(n.length>0&&e.maxStalenessSeconds!=null){o=pickNearestMaxStalenessSeconds(this,e)}if(o)return o}return this.primary};var filterByTags=function(e,t){if(e.tags==null)return t;var r=[];var n=Array.isArray(e.tags)?e.tags:[e.tags];for(var o=0;o<n.length;o++){var s=n[o];for(var i=0;i<t.length;i++){var a=t[i].lastIsMaster().tags||{};var c=true;for(var l in s){if(a[l]!==s[l]){c=false}}if(c){r.push(t[i])}}}return r};function pickNearestMaxStalenessSeconds(e,t){var r=[];var n=t.maxStalenessSeconds*1e3;if(n<90*1e3){return new l("maxStalenessSeconds must be set to at least 90 seconds")}if(e.primary&&t.preference!=="secondary"&&t.preference!=="secondaryPreferred"){r.push(e.primary)}for(var o=0;o<e.secondaries.length;o++){r.push(e.secondaries[o])}if(e.primary&&r.length===0&&t.preference!=="secondaryPreferred"){r.push(e.primary)}r=filterByTags(t,r);r=r.filter((function(e){return e.staleness<=n}));r.sort((function(e,t){return e.lastIsMasterMS-t.lastIsMasterMS}));if(r.length===0){return null}e.index=e.index%r.length;var s=r[e.index];e.index=e.index+1;return s}function pickNearest(e,t){var r=[];if(e.primary&&t.preference!=="secondary"&&t.preference!=="secondaryPreferred"){r.push(e.primary)}for(var n=0;n<e.secondaries.length;n++){r.push(e.secondaries[n])}if(r.length===0&&e.primary&&t.preference!=="secondaryPreferred"){r.push(e.primary)}r=filterByTags(t,r);r.sort((function(e,t){return e.lastIsMasterMS-t.lastIsMasterMS}));var o=r.length>0?r[0].lastIsMasterMS:0;r=r.filter((function(t){return t.lastIsMasterMS<=o+e.acceptableLatency}));if(r.length===0){return null}e.index=e.index%r.length;var s=r[e.index];e.index=e.index+1;return s}function inList(e,t,r){for(var n=0;n<r.length;n++){if(r[n]&&r[n].name&&r[n].name.toLowerCase()===t.name.toLowerCase())return true}return false}function addToList(e,t,r,n,o){var s=n.name.toLowerCase();e.set[s].type=t;e.set[s].electionId=r?r.electionId:r;e.set[s].setName=r?r.setName:r;e.set[s].setVersion=r?r.setVersion:r;o.push(n)}function compareObjectIds(e,t){var r=u.from(e.toHexString(),"hex");var n=u.from(t.toHexString(),"hex");if(r===n){return 0}if(typeof u.compare==="function"){return u.compare(r,n)}var o=r.length;var s=n.length;var i=Math.min(o,s);for(var a=0;a<i;a++){if(r[a]!==n[a]){break}}if(a!==i){o=r[a];s=n[a]}return o<s?-1:s<o?1:0}function removeFrom(e,t){for(var r=0;r<t.length;r++){if(t[r].equals&&t[r].equals(e)){t.splice(r,1);return true}else if(typeof t[r]==="string"&&t[r].toLowerCase()===e.name.toLowerCase()){t.splice(r,1);return true}}return false}function emitTopologyDescriptionChanged(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown";var r=e.setName;if(e.hasPrimaryAndSecondary()){t="ReplicaSetWithPrimary"}else if(!e.hasPrimary()&&e.hasSecondary()){t="ReplicaSetNoPrimary"}var n={topologyType:t,setName:r,servers:[]};if(e.hasPrimary()){var o=e.primary.getDescription();o.type="RSPrimary";n.servers.push(o)}n.servers=n.servers.concat(e.secondaries.map((function(e){var t=e.getDescription();t.type="RSSecondary";return t})));n.servers=n.servers.concat(e.arbiters.map((function(e){var t=e.getDescription();t.type="RSArbiter";return t})));n.servers=n.servers.concat(e.passives.map((function(e){var t=e.getDescription();t.type="RSSecondary";return t})));var i=s(e.replicasetDescription,n);var a={topologyId:e.id,previousDescription:e.replicasetDescription,newDescription:n,diff:i};e.emit("topologyDescriptionChanged",a);e.replicasetDescription=n}}e.exports=ReplSetState},6495:(e,t,r)=>{"use strict";var n=r(1669).inherits,o=r(1669).format,s=r(8614).EventEmitter,i=r(4485),a=r(104),c=r(7746).debugOptions,l=r(7746).retrieveBSON,u=r(5500),d=r(3111).MongoError,p=r(3111).MongoNetworkError,h=r(9206),m=r(4847).CoreCursor,y=r(2306),g=r(2306).createCompressionInfo,v=r(2306).resolveClusterTime,b=r(2306).SessionMixins,S=r(1178).relayEvents;const w=r(1178).collationNotSupported;const _=r(1178).makeClientMetadata;var E=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"];var O=0;var C=false;var T={};var I=l();function topologyId(e){return e.s.parent==null?e.id:e.s.parent.id}var Server=function(e){e=e||{};s.call(this);this.id=O++;this.s={options:Object.assign({metadata:_(e)},e),logger:a("Server",e),Cursor:e.cursorFactory||m,bson:e.bson||new I([I.Binary,I.Code,I.DBRef,I.Decimal128,I.Double,I.Int32,I.Long,I.Map,I.MaxKey,I.MinKey,I.ObjectId,I.BSONRegExp,I.Symbol,I.Timestamp]),pool:null,disconnectHandler:e.disconnectHandler,monitoring:typeof e.monitoring==="boolean"?e.monitoring:true,inTopology:!!e.parent,monitoringInterval:typeof e.monitoringInterval==="number"?e.monitoringInterval:5e3,compression:{compressors:g(e)},parent:e.parent};if(!this.s.parent){this.s.clusterTime=null}this.ismaster=null;this.lastIsMasterMS=-1;this.monitoringProcessId=null;this.initialConnect=true;this._type="server";this.lastUpdateTime=0;this.lastWriteDate=0;this.staleness=0};n(Server,s);Object.assign(Server.prototype,b);Object.defineProperty(Server.prototype,"type",{enumerable:true,get:function(){return this._type}});Object.defineProperty(Server.prototype,"parserType",{enumerable:true,get:function(){return I.native?"c++":"js"}});Object.defineProperty(Server.prototype,"logicalSessionTimeoutMinutes",{enumerable:true,get:function(){if(!this.ismaster)return null;return this.ismaster.logicalSessionTimeoutMinutes||null}});Object.defineProperty(Server.prototype,"clientMetadata",{enumerable:true,get:function(){return this.s.options.metadata}});Object.defineProperty(Server.prototype,"clusterTime",{enumerable:true,set:function(e){const t=this.s.parent?this.s.parent:this.s;v(t,e)},get:function(){const e=this.s.parent?this.s.parent:this.s;return e.clusterTime||null}});Server.enableServerAccounting=function(){C=true;T={}};Server.disableServerAccounting=function(){C=false};Server.servers=function(){return T};Object.defineProperty(Server.prototype,"name",{enumerable:true,get:function(){return this.s.options.host+":"+this.s.options.port}});function disconnectHandler(e,t,r,n,s,i){if(!e.s.pool.isConnected()&&e.s.options.reconnect&&e.s.disconnectHandler!=null&&!s.monitoring){e.s.disconnectHandler.add(t,r,n,s,i);return true}if(!e.s.pool.isConnected()){i(new d(o("no connection available to server %s",e.name)));return true}}function monitoringProcess(e){return function(){if(e.s.pool.isDestroyed())return;e.emit("monitoring",e);var t=(new Date).getTime();e.command("admin.$cmd",{ismaster:true},{socketTimeout:typeof e.s.options.connectionTimeout!=="number"?2e3:e.s.options.connectionTimeout,monitoring:true},((r,n)=>{e.lastIsMasterMS=(new Date).getTime()-t;if(e.s.pool.isDestroyed())return;if(n){e.ismaster=n.result}e.monitoringProcessId=setTimeout(monitoringProcess(e),e.s.monitoringInterval)}))}}var eventHandler=function(e,t){return function(r,n){if(e.s.logger.isInfo()){var s=r instanceof d?JSON.stringify(r):{};e.s.logger.info(o("server %s fired event %s out with message %s",e.name,t,s))}if(t==="connect"){e.initialConnect=false;e.ismaster=n.ismaster;e.lastIsMasterMS=n.lastIsMasterMS;if(n.agreedCompressor){e.s.pool.options.agreedCompressor=n.agreedCompressor}if(n.zlibCompressionLevel){e.s.pool.options.zlibCompressionLevel=n.zlibCompressionLevel}if(n.ismaster.$clusterTime){const t=n.ismaster.$clusterTime;e.clusterTime=t}if(e.ismaster.msg==="isdbgrid"){e._type="mongos"}if(e.s.monitoring){e.monitoringProcessId=setTimeout(monitoringProcess(e),e.s.monitoringInterval)}y.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:y.getTopologyType(e)});if(!e.s.inTopology){y.emitTopologyDescriptionChanged(e,{topologyType:"Single",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:y.getTopologyType(e)}]})}if(e.s.logger.isInfo()){e.s.logger.info(o("server %s connected with ismaster [%s]",e.name,JSON.stringify(e.ismaster)))}e.emit("connect",e)}else if(t==="error"||t==="parseError"||t==="close"||t==="timeout"||t==="reconnect"||t==="attemptReconnect"||t==="reconnectFailed"){if(C&&["close","timeout","error","parseError","reconnectFailed"].indexOf(t)!==-1){if(!e.s.inTopology){e.emit("topologyOpening",{topologyId:e.id})}delete T[e.id]}if(t==="close"){y.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"})}if(t==="reconnectFailed"){e.emit("reconnectFailed",r);if(e.listeners("error").length>0){e.emit("error",r)}return}if(["disconnected","connecting"].indexOf(e.s.pool.state)!==-1&&e.initialConnect&&["close","timeout","error","parseError"].indexOf(t)!==-1){e.initialConnect=false;return e.emit("error",new p(o("failed to connect to server [%s] on first connect [%s]",e.name,r)))}if(t==="reconnect"){y.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:y.getTopologyType(e)});return e.emit(t,e)}e.emit(t,r)}}};Server.prototype.connect=function(e){var t=this;e=e||{};if(C)T[this.id]=this;if(t.s.pool&&!t.s.pool.isDisconnected()&&!t.s.pool.isDestroyed()){throw new d(o("server instance in invalid state %s",t.s.pool.state))}t.s.pool=new u(this,Object.assign(t.s.options,e,{bson:this.s.bson}));t.s.pool.on("close",eventHandler(t,"close"));t.s.pool.on("error",eventHandler(t,"error"));t.s.pool.on("timeout",eventHandler(t,"timeout"));t.s.pool.on("parseError",eventHandler(t,"parseError"));t.s.pool.on("connect",eventHandler(t,"connect"));t.s.pool.on("reconnect",eventHandler(t,"reconnect"));t.s.pool.on("reconnectFailed",eventHandler(t,"reconnectFailed"));S(t.s.pool,t,["commandStarted","commandSucceeded","commandFailed"]);if(!t.s.inTopology){this.emit("topologyOpening",{topologyId:topologyId(t)})}t.emit("serverOpening",{topologyId:topologyId(t),address:t.name});t.s.pool.connect()};Server.prototype.auth=function(e,t){if(typeof t==="function")t(null,null)};Server.prototype.getDescription=function(){var e=this.ismaster||{};var t={type:y.getTopologyType(this),address:this.name};if(e.hosts)t.hosts=e.hosts;if(e.arbiters)t.arbiters=e.arbiters;if(e.passives)t.passives=e.passives;if(e.setName)t.setName=e.setName;return t};Server.prototype.lastIsMaster=function(){return this.ismaster};Server.prototype.unref=function(){this.s.pool.unref()};Server.prototype.isConnected=function(){if(!this.s.pool)return false;return this.s.pool.isConnected()};Server.prototype.isDestroyed=function(){if(!this.s.pool)return false;return this.s.pool.isDestroyed()};function basicWriteValidations(e){if(!e.s.pool)return new d("server instance is not connected");if(e.s.pool.isDestroyed())return new d("server instance pool was destroyed")}function basicReadValidations(e,t){basicWriteValidations(e,t);if(t.readPreference&&!(t.readPreference instanceof i)){throw new Error("readPreference must be an instance of ReadPreference")}}Server.prototype.command=function(e,t,r,n){var s=this;if(typeof r==="function"){n=r,r={},r=r||{}}var i=basicReadValidations(s,r);if(i)return n(i);r=Object.assign({},r,{wireProtocolCommand:false});if(s.s.logger.isDebug())s.s.logger.debug(o("executing command [%s] against %s",JSON.stringify({ns:e,cmd:t,options:c(E,r)}),s.name));if(disconnectHandler(s,"command",e,t,r,n))return;if(w(this,t)){return n(new d(`server ${this.name} does not support collation`))}h.command(s,e,t,r,n)};Server.prototype.query=function(e,t,r,n,o){h.query(this,e,t,r,n,o)};Server.prototype.getMore=function(e,t,r,n,o){h.getMore(this,e,t,r,n,o)};Server.prototype.killCursors=function(e,t,r){h.killCursors(this,e,t,r)};Server.prototype.insert=function(e,t,r,n){var o=this;if(typeof r==="function"){n=r,r={},r=r||{}}var s=basicWriteValidations(o,r);if(s)return n(s);if(disconnectHandler(o,"insert",e,t,r,n))return;t=Array.isArray(t)?t:[t];return h.insert(o,e,t,r,n)};Server.prototype.update=function(e,t,r,n){var o=this;if(typeof r==="function"){n=r,r={},r=r||{}}var s=basicWriteValidations(o,r);if(s)return n(s);if(disconnectHandler(o,"update",e,t,r,n))return;if(w(this,r)){return n(new d(`server ${this.name} does not support collation`))}t=Array.isArray(t)?t:[t];return h.update(o,e,t,r,n)};Server.prototype.remove=function(e,t,r,n){var o=this;if(typeof r==="function"){n=r,r={},r=r||{}}var s=basicWriteValidations(o,r);if(s)return n(s);if(disconnectHandler(o,"remove",e,t,r,n))return;if(w(this,r)){return n(new d(`server ${this.name} does not support collation`))}t=Array.isArray(t)?t:[t];return h.remove(o,e,t,r,n)};Server.prototype.cursor=function(e,t,r){r=r||{};const n=r.topology||this;var o=r.cursorFactory||this.s.Cursor;return new o(n,e,t,r)};Server.prototype.equals=function(e){if(typeof e==="string")return this.name.toLowerCase()===e.toLowerCase();if(e.name)return this.name.toLowerCase()===e.name.toLowerCase();return false};Server.prototype.connections=function(){return this.s.pool.allConnections()};Server.prototype.selectServer=function(e,t,r){if(typeof e==="function"&&typeof r==="undefined")r=e,e=undefined,t={};if(typeof t==="function")r=t,t=e,e=undefined;r(null,this)};var k=["close","error","timeout","parseError","connect"];Server.prototype.destroy=function(e,t){if(this._destroyed){if(typeof t==="function")t(null,null);return}if(typeof e==="function"){t=e;e={}}e=e||{};var r=this;if(C)delete T[this.id];if(this.monitoringProcessId){clearTimeout(this.monitoringProcessId)}if(!r.s.pool||this._destroyed){this._destroyed=true;if(typeof t==="function")t(null,null);return}this._destroyed=true;if(e.emitClose){r.emit("close",r)}if(e.emitDestroy){r.emit("destroy",r)}k.forEach((function(e){r.s.pool.removeAllListeners(e)}));if(r.listeners("serverClosed").length>0)r.emit("serverClosed",{topologyId:topologyId(r),address:r.name});if(r.listeners("topologyClosed").length>0&&!r.s.inTopology){r.emit("topologyClosed",{topologyId:topologyId(r)})}if(r.s.logger.isDebug()){r.s.logger.debug(o("destroy called on server %s",r.name))}this.s.pool.destroy(e.force,t)};e.exports=Server},2306:(e,t,r)=>{"use strict";const n=r(4485);const o=r(2291).TopologyType;const s=r(3111).MongoError;const i=r(3111).isRetryableWriteError;const a=r(1178).maxWireVersion;const c=r(3111).MongoNetworkError;const l=20;function emitSDAMEvent(e,t,r){if(e.listeners(t).length>0){e.emit(t,r)}}function createCompressionInfo(e){if(!e.compression||!e.compression.compressors){return[]}e.compression.compressors.forEach((function(e){if(e!=="snappy"&&e!=="zlib"){throw new Error("compressors must be at least one of snappy or zlib")}}));return e.compression.compressors}function clone(e){return JSON.parse(JSON.stringify(e))}var getPreviousDescription=function(e){if(!e.s.serverDescription){e.s.serverDescription={address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}}return e.s.serverDescription};var emitServerDescriptionChanged=function(e,t){if(e.listeners("serverDescriptionChanged").length>0){e.emit("serverDescriptionChanged",{topologyId:e.s.topologyId!==-1?e.s.topologyId:e.id,address:e.name,previousDescription:getPreviousDescription(e),newDescription:t});e.s.serverDescription=t}};var getPreviousTopologyDescription=function(e){if(!e.s.topologyDescription){e.s.topologyDescription={topologyType:"Unknown",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}]}}return e.s.topologyDescription};var emitTopologyDescriptionChanged=function(e,t){if(e.listeners("topologyDescriptionChanged").length>0){e.emit("topologyDescriptionChanged",{topologyId:e.s.topologyId!==-1?e.s.topologyId:e.id,address:e.name,previousDescription:getPreviousTopologyDescription(e),newDescription:t});e.s.serverDescription=t}};var changedIsMaster=function(e,t,r){var n=getTopologyType(e,t);var o=getTopologyType(e,r);if(o!==n)return true;return false};var getTopologyType=function(e,t){if(!t){t=e.ismaster}if(!t)return"Unknown";if(t.ismaster&&t.msg==="isdbgrid")return"Mongos";if(t.ismaster&&!t.hosts)return"Standalone";if(t.ismaster)return"RSPrimary";if(t.secondary)return"RSSecondary";if(t.arbiterOnly)return"RSArbiter";return"Unknown"};var inquireServerState=function(e){return function(t){if(e.s.state==="destroyed")return;var r=(new Date).getTime();emitSDAMEvent(e,"serverHeartbeatStarted",{connectionId:e.name});e.command("admin.$cmd",{ismaster:true},{monitoring:true},(function(n,o){if(!n){e.emit("ismaster",o,e);var s=(new Date).getTime()-r;emitSDAMEvent(e,"serverHeartbeatSucceeded",{durationMS:s,reply:o.result,connectionId:e.name});if(changedIsMaster(e,e.s.ismaster,o.result)){emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:!e.s.inTopology?"Standalone":getTopologyType(e)})}e.s.ismaster=o.result;e.s.isMasterLatencyMS=s}else{emitSDAMEvent(e,"serverHeartbeatFailed",{durationMS:s,failure:n,connectionId:e.name})}if(typeof t==="function"){return t(n,o)}e.s.inquireServerStateTimeout=setTimeout(inquireServerState(e),e.s.haInterval)}))}};var cloneOptions=function(e){var t={};for(var r in e){t[r]=e[r]}return t};function Interval(e,t){var r=false;this.start=function(){if(!this.isRunning()){r=setInterval(e,t)}return this};this.stop=function(){clearInterval(r);r=false;return this};this.isRunning=function(){return r!==false}}function Timeout(e,t){var r=false;var func=()=>{if(r){clearTimeout(r);r=false;e()}};this.start=function(){if(!this.isRunning()){r=setTimeout(func,t)}return this};this.stop=function(){clearTimeout(r);r=false;return this};this.isRunning=function(){return r!==false}}function diff(e,t){var r={servers:[]};if(!e){e={servers:[]}}for(var n=0;n<e.servers.length;n++){var o=false;for(var s=0;s<t.servers.length;s++){if(t.servers[s].address.toLowerCase()===e.servers[n].address.toLowerCase()){o=true;break}}if(!o){r.servers.push({address:e.servers[n].address,from:e.servers[n].type,to:"Unknown"})}}for(s=0;s<t.servers.length;s++){o=false;for(n=0;n<e.servers.length;n++){if(e.servers[n].address.toLowerCase()===t.servers[s].address.toLowerCase()){o=true;break}}if(!o){r.servers.push({address:t.servers[s].address,from:"Unknown",to:t.servers[s].type})}}for(n=0;n<e.servers.length;n++){var i=e.servers[n];for(s=0;s<t.servers.length;s++){var a=t.servers[s];if(i.address.toLowerCase()===a.address.toLowerCase()){if(i.type!==a.type){r.servers.push({address:i.address,from:i.type,to:a.type})}}}}return r}function resolveClusterTime(e,t){if(e.clusterTime==null){e.clusterTime=t}else{if(t.clusterTime.greaterThan(e.clusterTime.clusterTime)){e.clusterTime=t}}}const u={endSessions:function(e,t){if(!Array.isArray(e)){e=[e]}this.command("admin.$cmd",{endSessions:e},{readPreference:n.primaryPreferred},(()=>{if(typeof t==="function")t()}))}};function topologyType(e){if(e.description){return e.description.type}if(e.type==="mongos"){return o.Sharded}else if(e.type==="replset"){return o.ReplicaSetWithPrimary}return o.Single}const d=6;const isRetryableWritesSupported=function(e){const t=e.lastIsMaster().maxWireVersion;if(t<d){return false}if(!e.logicalSessionTimeoutMinutes){return false}if(topologyType(e)===o.Single){return false}return true};const p="This MongoDB deployment does not support retryable writes. Please add retryWrites=false to your connection string.";function getMMAPError(e){if(e.code!==l||!e.errmsg.includes("Transaction numbers")){return e}const t=new s({message:p,errmsg:p,originalError:e});return t}function legacyIsRetryableWriteError(e,t){if(!(e instanceof s)){return false}if(isRetryableWritesSupported(t)&&(e instanceof c||a(t)<9&&i(e))){e.addErrorLabel("RetryableWriteError")}return e.hasErrorLabel("RetryableWriteError")}e.exports={SessionMixins:u,resolveClusterTime:resolveClusterTime,inquireServerState:inquireServerState,getTopologyType:getTopologyType,emitServerDescriptionChanged:emitServerDescriptionChanged,emitTopologyDescriptionChanged:emitTopologyDescriptionChanged,cloneOptions:cloneOptions,createCompressionInfo:createCompressionInfo,clone:clone,diff:diff,Interval:Interval,Timeout:Timeout,isRetryableWritesSupported:isRetryableWritesSupported,getMMAPError:getMMAPError,topologyType:topologyType,legacyIsRetryableWriteError:legacyIsRetryableWriteError}},1707:(e,t,r)=>{"use strict";const n=r(3111).MongoError;const o=r(4485);const s=r(7289);const i=r(2481);let a;let c;(()=>{const e="NO_TRANSACTION";const t="STARTING_TRANSACTION";const r="TRANSACTION_IN_PROGRESS";const n="TRANSACTION_COMMITTED";const o="TRANSACTION_COMMITTED_EMPTY";const s="TRANSACTION_ABORTED";a={NO_TRANSACTION:e,STARTING_TRANSACTION:t,TRANSACTION_IN_PROGRESS:r,TRANSACTION_COMMITTED:n,TRANSACTION_COMMITTED_EMPTY:o,TRANSACTION_ABORTED:s};c={[e]:[e,t],[t]:[r,n,o,s],[r]:[r,n,s],[n]:[n,o,t,e],[s]:[t,e],[o]:[o,e]}})();class Transaction{constructor(e){e=e||{};this.state=a.NO_TRANSACTION;this.options={};const t=i.fromOptions(e);if(t){if(t.w<=0){throw new n("Transactions do not support unacknowledged write concern")}this.options.writeConcern=t}if(e.readConcern){this.options.readConcern=s.fromOptions(e)}if(e.readPreference){this.options.readPreference=o.fromOptions(e)}if(e.maxCommitTimeMS){this.options.maxTimeMS=e.maxCommitTimeMS}this._pinnedServer=undefined;this._recoveryToken=undefined}get server(){return this._pinnedServer}get recoveryToken(){return this._recoveryToken}get isPinned(){return!!this.server}get isActive(){return[a.STARTING_TRANSACTION,a.TRANSACTION_IN_PROGRESS].indexOf(this.state)!==-1}transition(e){const t=c[this.state];if(t&&t.indexOf(e)!==-1){this.state=e;if(this.state===a.NO_TRANSACTION||this.state===a.STARTING_TRANSACTION){this.unpinServer()}return}throw new n(`Attempted illegal state transition from [${this.state}] to [${e}]`)}pinServer(e){if(this.isActive){this._pinnedServer=e}}unpinServer(){this._pinnedServer=undefined}}function isTransactionCommand(e){return!!(e.commitTransaction||e.abortTransaction)}e.exports={TxnState:a,Transaction:Transaction,isTransactionCommand:isTransactionCommand}},8767:(e,t,r)=>{"use strict";const n=r(8835);const o=r(1191);const s=r(881);const i=r(3111).MongoParseError;const a=r(4485);const c=r(1371).emitWarningOnce;const l=/(mongodb(?:\+srv|)):\/\/(?: (?:[^:]*) (?: : ([^@]*) )? @ )?([^/?]*)(?:\/|)(.*)/;const u=new Set(["sslCA","sslCert","sslKey","tlsCAFile","tlsCertificateKeyFile"].map((e=>e.toLowerCase())));function matchesParentDomain(e,t){const r=/^.*?\./;const n=`.${e.replace(r,"")}`;const o=`.${t.replace(r,"")}`;return n.endsWith(o)}function parseSrvConnectionString(e,t,r){const a=n.parse(e,true);if(t.directConnection||t.directconnection){return r(new i("directConnection not supported with SRV URI"))}if(a.hostname.split(".").length<3){return r(new i("URI does not have hostname, domain name and tld"))}a.domainLength=a.hostname.split(".").length;const c=e.substring("mongodb+srv://".length).split("/")[0];if(c.match(",")){return r(new i("Invalid URI, cannot contain multiple hostnames"))}if(a.port){return r(new i(`Ports not accepted with '${v}' URIs`))}const l=a.host;s.resolveSrv(`_mongodb._tcp.${l}`,((e,c)=>{if(e)return r(e);if(c.length===0){return r(new i("No addresses found at host"))}for(let e=0;e<c.length;e++){if(!matchesParentDomain(c[e].name,a.hostname,a.domainLength)){return r(new i("Server record does not share hostname with parent URI"))}}a.protocol="mongodb";a.host=c.map((e=>`${e.name}:${e.port}`)).join(",");if(!("ssl"in t)&&(!a.search||!("ssl"in a.query)||a.query.ssl===null)){a.query.ssl=true}s.resolveTxt(l,((e,s)=>{if(e){if(e.code!=="ENODATA"&&e.code!=="ENOTFOUND"){return r(e)}s=null}if(s){if(s.length>1){return r(new i("Multiple text records not allowed"))}s=o.parse(s[0].join(""));if(Object.keys(s).some((e=>e!=="authSource"&&e!=="replicaSet"))){return r(new i("Text record must only set `authSource` or `replicaSet`"))}a.query=Object.assign({},s,a.query)}a.search=o.stringify(a.query);const c=n.format(a);parseConnectionString(c,t,((e,t)=>{if(e){r(e);return}r(null,Object.assign({},t,{srvHost:l}))}))}))}))}function parseQueryStringItemValue(e,t){if(Array.isArray(t)){t=t.filter(((e,r)=>t.indexOf(e)===r));if(t.length===1)t=t[0]}else if(t.indexOf(":")>0){t=t.split(",").reduce(((t,r)=>{const n=r.split(":");t[n[0]]=parseQueryStringItemValue(e,n[1]);return t}),{})}else if(t.indexOf(",")>0){t=t.split(",").map((t=>parseQueryStringItemValue(e,t)))}else if(t.toLowerCase()==="true"||t.toLowerCase()==="false"){t=t.toLowerCase()==="true"}else if(!Number.isNaN(t)&&!p.has(e)){const e=parseFloat(t);if(!Number.isNaN(e)){t=parseFloat(t)}}return t}const d=new Set(["slaveok","slave_ok","sslvalidate","fsync","safe","retrywrites","j"]);const p=new Set(["authsource","replicaset"]);const h=new Set(["GSSAPI","MONGODB-AWS","MONGODB-X509","MONGODB-CR","DEFAULT","SCRAM-SHA-1","SCRAM-SHA-256","PLAIN"]);const m={replicaset:"replicaSet",connecttimeoutms:"connectTimeoutMS",sockettimeoutms:"socketTimeoutMS",maxpoolsize:"maxPoolSize",minpoolsize:"minPoolSize",maxidletimems:"maxIdleTimeMS",waitqueuemultiple:"waitQueueMultiple",waitqueuetimeoutms:"waitQueueTimeoutMS",wtimeoutms:"wtimeoutMS",readconcern:"readConcern",readconcernlevel:"readConcernLevel",readpreference:"readPreference",maxstalenessseconds:"maxStalenessSeconds",readpreferencetags:"readPreferenceTags",authsource:"authSource",authmechanism:"authMechanism",authmechanismproperties:"authMechanismProperties",gssapiservicename:"gssapiServiceName",localthresholdms:"localThresholdMS",serverselectiontimeoutms:"serverSelectionTimeoutMS",serverselectiontryonce:"serverSelectionTryOnce",heartbeatfrequencyms:"heartbeatFrequencyMS",retrywrites:"retryWrites",uuidrepresentation:"uuidRepresentation",zlibcompressionlevel:"zlibCompressionLevel",tlsallowinvalidcertificates:"tlsAllowInvalidCertificates",tlsallowinvalidhostnames:"tlsAllowInvalidHostnames",tlsinsecure:"tlsInsecure",tlscafile:"tlsCAFile",tlscertificatekeyfile:"tlsCertificateKeyFile",tlscertificatekeyfilepassword:"tlsCertificateKeyFilePassword",wtimeout:"wTimeoutMS",j:"journal",directconnection:"directConnection"};function applyConnectionStringOption(e,t,r,n){if(t==="journal"){t="j"}else if(t==="wtimeoutms"){t="wtimeout"}if(d.has(t)){r=r==="true"||r===true}else if(t==="appname"){r=decodeURIComponent(r)}else if(t==="readconcernlevel"){e["readConcernLevel"]=r;t="readconcern";r={level:r}}if(t==="compressors"){r=Array.isArray(r)?r:[r];if(!r.every((e=>e==="snappy"||e==="zlib"))){throw new i("Value for `compressors` must be at least one of: `snappy`, `zlib`")}}if(t==="authmechanism"&&!h.has(r)){throw new i(`Value for authMechanism must be one of: ${Array.from(h).join(", ")}, found: ${r}`)}if(t==="readpreference"&&!a.isValid(r)){throw new i("Value for `readPreference` must be one of: `primary`, `primaryPreferred`, `secondary`, `secondaryPreferred`, `nearest`")}if(t==="zlibcompressionlevel"&&(r<-1||r>9)){throw new i("zlibCompressionLevel must be an integer between -1 and 9")}if(t==="compressors"||t==="zlibcompressionlevel"){e.compression=e.compression||{};e=e.compression}if(t==="authmechanismproperties"){if(typeof r.SERVICE_NAME==="string")e.gssapiServiceName=r.SERVICE_NAME;if(typeof r.SERVICE_REALM==="string")e.gssapiServiceRealm=r.SERVICE_REALM;if(typeof r.CANONICALIZE_HOST_NAME!=="undefined"){e.gssapiCanonicalizeHostName=r.CANONICALIZE_HOST_NAME}}if(t==="readpreferencetags"){r=Array.isArray(r)?splitArrayOfMultipleReadPreferenceTags(r):[r]}if(n.caseTranslate&&m[t]){e[m[t]]=r;return}e[t]=r}const y=new Set(["GSSAPI","MONGODB-CR","PLAIN","SCRAM-SHA-1","SCRAM-SHA-256"]);function splitArrayOfMultipleReadPreferenceTags(e){const t=[];for(let r=0;r<e.length;r++){t[r]={};e[r].split(",").forEach((e=>{const n=e.split(":");t[r][n[0]]=n[1]}))}return t}function applyAuthExpectations(e){if(e.options==null){return}const t=e.options;const r=t.authsource||t.authSource;if(r!=null){e.auth=Object.assign({},e.auth,{db:r})}const n=t.authmechanism||t.authMechanism;if(n!=null){if(y.has(n)&&(!e.auth||e.auth.username==null)){throw new i(`Username required for mechanism \`${n}\``)}if(n==="GSSAPI"){if(r!=null&&r!=="$external"){throw new i(`Invalid source \`${r}\` for mechanism \`${n}\` specified.`)}e.auth=Object.assign({},e.auth,{db:"$external"})}if(n==="MONGODB-AWS"){if(r!=null&&r!=="$external"){throw new i(`Invalid source \`${r}\` for mechanism \`${n}\` specified.`)}e.auth=Object.assign({},e.auth,{db:"$external"})}if(n==="MONGODB-X509"){if(e.auth&&e.auth.password!=null){throw new i(`Password not allowed for mechanism \`${n}\``)}if(r!=null&&r!=="$external"){throw new i(`Invalid source \`${r}\` for mechanism \`${n}\` specified.`)}e.auth=Object.assign({},e.auth,{db:"$external"})}if(n==="PLAIN"){if(e.auth&&e.auth.db==null){e.auth=Object.assign({},e.auth,{db:"$external"})}}}if(e.auth&&e.auth.db==null){e.auth=Object.assign({},e.auth,{db:"admin"})}return e}function parseQueryString(e,t){const r={};let n=o.parse(e);checkTLSOptions(n);for(const e in n){const o=n[e];if(o===""||o==null){throw new i("Incomplete key value pair for option")}const s=e.toLowerCase();const a=u.has(s)?o:parseQueryStringItemValue(s,o);applyConnectionStringOption(r,s,a,t)}if(r.wtimeout&&r.wtimeoutms){delete r.wtimeout;c("Unsupported option `wtimeout` specified")}return Object.keys(r).length?r:null}function translateTLSOptions(e){if(e.tls){e.ssl=e.tls}if(e.tlsInsecure){e.checkServerIdentity=false;e.sslValidate=false}else{Object.assign(e,{checkServerIdentity:e.tlsAllowInvalidHostnames?false:true,sslValidate:e.tlsAllowInvalidCertificates?false:true})}if(e.tlsCAFile){e.ssl=true;e.sslCA=e.tlsCAFile}if(e.tlsCertificateKeyFile){e.ssl=true;if(e.tlsCertificateFile){e.sslCert=e.tlsCertificateFile;e.sslKey=e.tlsCertificateKeyFile}else{e.sslKey=e.tlsCertificateKeyFile;e.sslCert=e.tlsCertificateKeyFile}}if(e.tlsCertificateKeyFilePassword){e.ssl=true;e.sslPass=e.tlsCertificateKeyFilePassword}return e}function checkTLSOptions(e){const t=Object.keys(e);if(t.indexOf("tlsInsecure")!==-1&&(t.indexOf("tlsAllowInvalidCertificates")!==-1||t.indexOf("tlsAllowInvalidHostnames")!==-1)){throw new i("The `tlsInsecure` option cannot be used with `tlsAllowInvalidCertificates` or `tlsAllowInvalidHostnames`.")}const r=assertTlsOptionsAreEqual("tls",e,t);const n=assertTlsOptionsAreEqual("ssl",e,t);if(r!=null&&n!=null){if(r!==n){throw new i("All values of `tls` and `ssl` must be the same.")}}}function assertTlsOptionsAreEqual(e,t,r){const n=r.indexOf(e)!==-1;let o;if(Array.isArray(t[e])){o=t[e][0]}else{o=t[e]}if(n){if(Array.isArray(t[e])){const r=t[e][0];t[e].forEach((t=>{if(t!==r){throw new i(`All values of ${e} must be the same.`)}}))}}return o}const g="mongodb";const v="mongodb+srv";const b=[g,v];function parseConnectionString(e,t,r){if(typeof t==="function")r=t,t={};t=Object.assign({},{caseTranslate:true},t);try{n.parse(e)}catch(e){return r(new i("URI malformed, cannot be parsed"))}const s=e.match(l);if(!s){return r(new i("Invalid connection string"))}const a=s[1];if(b.indexOf(a)===-1){return r(new i("Invalid protocol provided"))}const c=s[4].split("?");const u=c.length>0?c[0]:null;const d=c.length>1?c[1]:null;let p;try{p=parseQueryString(d,t)}catch(e){return r(e)}p=Object.assign({},p,t);if(a===v){return parseSrvConnectionString(e,p,r)}const h={username:null,password:null,db:u&&u!==""?o.unescape(u):null};if(p.auth){if(p.auth.username)h.username=p.auth.username;if(p.auth.user)h.username=p.auth.user;if(p.auth.password)h.password=p.auth.password}else{if(p.username)h.username=p.username;if(p.user)h.username=p.user;if(p.password)h.password=p.password}if(s[4].split("?")[0].indexOf("@")!==-1){return r(new i("Unescaped slash in userinfo section"))}const m=s[3].split("@");if(m.length>2){return r(new i("Unescaped at-sign in authority section"))}if(m[0]==null||m[0]===""){return r(new i("No username provided in authority section"))}if(m.length>1){const e=m.shift().split(":");if(e.length>2){return r(new i("Unescaped colon in authority section"))}if(e[0]===""){return r(new i("Invalid empty username provided"))}if(!h.username)h.username=o.unescape(e[0]);if(!h.password)h.password=e[1]?o.unescape(e[1]):null}let y=null;const g=m.shift().split(",").map((e=>{let t=n.parse(`mongodb://${e}`);if(t.path==="/:"){y=new i("Double colon in host identifier");return null}if(e.match(/\.sock/)){t.hostname=o.unescape(e);t.port=null}if(Number.isNaN(t.port)){y=new i("Invalid port (non-numeric string)");return}const r={host:t.hostname,port:t.port?parseInt(t.port):27017};if(r.port===0){y=new i("Invalid port (zero) with hostname");return}if(r.port>65535){y=new i("Invalid port (larger than 65535) with hostname");return}if(r.port<0){y=new i("Invalid port (negative number)");return}return r})).filter((e=>!!e));if(y){return r(y)}if(g.length===0||g[0].host===""||g[0].host===null){return r(new i("No hostname or hostnames provided in connection string"))}const S=!!p.directConnection;if(S&&g.length!==1){return r(new i("directConnection option requires exactly one host"))}if(p.directConnection==null&&g.length===1&&p.replicaSet==null){p.directConnection=true}const w={hosts:g,auth:h.db||h.username?h:null,options:Object.keys(p).length?p:null};if(w.auth&&w.auth.db){w.defaultDatabase=w.auth.db}else{w.defaultDatabase="test"}w.options=translateTLSOptions(w.options);try{applyAuthExpectations(w)}catch(e){return r(e)}r(null,w)}e.exports=parseConnectionString},1178:(e,t,r)=>{"use strict";const n=r(2087);const o=r(6417);const s=r(3182)(require);const uuidV4=()=>{const e=o.randomBytes(16);e[6]=e[6]&15|64;e[8]=e[8]&63|128;return e};function relayEvents(e,t,r){r.forEach((r=>e.on(r,(e=>t.emit(r,e)))))}function retrieveKerberos(){let e;try{e=s("kerberos")}catch(e){if(e.code==="MODULE_NOT_FOUND"){throw new Error("The `kerberos` module was not found. Please install it and try again.")}throw e}return e}const noEJSONError=function(){throw new Error("The `mongodb-extjson` module was not found. Please install it and try again.")};function retrieveEJSON(){let e=s("mongodb-extjson");if(!e){e={parse:noEJSONError,deserialize:noEJSONError,serialize:noEJSONError,stringify:noEJSONError,setBSONModule:noEJSONError,BSON:noEJSONError}}return e}function maxWireVersion(e){if(e){if(e.ismaster){return e.ismaster.maxWireVersion}if(typeof e.lastIsMaster==="function"){const t=e.lastIsMaster();if(t){return t.maxWireVersion}}if(e.description){return e.description.maxWireVersion}}return 0}function collationNotSupported(e,t){return t&&t.collation&&maxWireVersion(e)<5}function isPromiseLike(e){return e&&typeof e.then==="function"}function eachAsync(e,t,r){e=e||[];let n=0;let o=0;for(n=0;n<e.length;++n){o++;t(e[n],eachCallback)}if(o===0){r();return}function eachCallback(t){o--;if(t){r(t);return}if(n===e.length&&o<=0){r()}}}function eachAsyncSeries(e,t,r){e=e||[];let n=0;let o=e.length;if(o===0){r();return}function eachCallback(s){n++;o--;if(s){r(s);return}if(n===e.length&&o<=0){r();return}t(e[n],eachCallback)}t(e[n],eachCallback)}function isUnifiedTopology(e){return e.description!=null}function arrayStrictEqual(e,t){if(!Array.isArray(e)||!Array.isArray(t)){return false}return e.length===t.length&&e.every(((e,r)=>e===t[r]))}function tagsStrictEqual(e,t){const r=Object.keys(e);const n=Object.keys(t);return r.length===n.length&&r.every((r=>t[r]===e[r]))}function errorStrictEqual(e,t){if(e===t){return true}if(e==null&&t!=null||e!=null&&t==null){return false}if(e.constructor.name!==t.constructor.name){return false}if(e.message!==t.message){return false}return true}function makeStateMachine(e){return function stateTransition(t,r){const n=e[t.s.state];if(n&&n.indexOf(r)<0){throw new TypeError(`illegal state transition from [${t.s.state}] => [${r}], allowed: [${n}]`)}t.emit("stateChanged",t.s.state,r);t.s.state=r}}function makeClientMetadata(e){e=e||{};const t={driver:{name:"nodejs",version:r(306).i8},os:{type:n.type(),name:process.platform,architecture:process.arch,version:n.release()},platform:`'Node.js ${process.version}, ${n.endianness} (${e.useUnifiedTopology?"unified":"legacy"})`};if(e.driverInfo){if(e.driverInfo.name){t.driver.name=`${t.driver.name}|${e.driverInfo.name}`}if(e.driverInfo.version){t.version=`${t.driver.version}|${e.driverInfo.version}`}if(e.driverInfo.platform){t.platform=`${t.platform}|${e.driverInfo.platform}`}}if(e.appname){const r=Buffer.from(e.appname);t.application={name:r.length>128?r.slice(0,128).toString("utf8"):e.appname}}return t}const noop=()=>{};e.exports={uuidV4:uuidV4,relayEvents:relayEvents,collationNotSupported:collationNotSupported,retrieveEJSON:retrieveEJSON,retrieveKerberos:retrieveKerberos,maxWireVersion:maxWireVersion,isPromiseLike:isPromiseLike,eachAsync:eachAsync,eachAsyncSeries:eachAsyncSeries,isUnifiedTopology:isUnifiedTopology,arrayStrictEqual:arrayStrictEqual,tagsStrictEqual:tagsStrictEqual,errorStrictEqual:errorStrictEqual,makeStateMachine:makeStateMachine,makeClientMetadata:makeClientMetadata,noop:noop}},7276:(e,t,r)=>{"use strict";const n=r(9814).Query;const o=r(8988).Msg;const s=r(3111).MongoError;const i=r(7272).getReadPreference;const a=r(7272).isSharded;const c=r(7272).databaseNamespace;const l=r(1707).isTransactionCommand;const u=r(5474).applySession;const d=r(3111).MongoNetworkError;const p=r(1178).maxWireVersion;function isClientEncryptionEnabled(e){const t=p(e);return t&&e.autoEncrypter}function command(e,t,r,n,o){if(typeof n==="function")o=n,n={};n=n||{};if(r==null){return o(new s(`command ${JSON.stringify(r)} does not return a cursor`))}if(!isClientEncryptionEnabled(e)){_command(e,t,r,n,o);return}const i=p(e);if(typeof i!=="number"||i<8){o(new s("Auto-encryption requires a minimum MongoDB version of 4.2"));return}_cryptCommand(e,t,r,n,o)}function _command(e,t,r,p,h){const m=e.s.bson;const y=e.s.pool;const g=i(r,p);const v=supportsOpMsg(e);const b=p.session;const S=e.clusterTime;let w=S;let _=Object.assign({},r);if(hasSessionSupport(e)&&b){const e=b.clusterTime;if(S&&S.clusterTime&&e&&e.clusterTime&&e.clusterTime.greaterThan(S.clusterTime)){w=e}const t=u(b,_,p);if(t){return h(t)}}if(w){_.$clusterTime=w}if(a(e)&&!v&&g&&g.mode!=="primary"){_={$query:_,$readPreference:g.toJSON()}}const E=Object.assign({command:true,numberToSkip:0,numberToReturn:-1,checkKeys:false},p);E.slaveOk=g.slaveOk();const O=`${c(t)}.$cmd`;const C=v?new o(m,O,_,E):new n(m,O,_,E);const T=b&&(b.inTransaction()||l(_));const I=T?function(e){if(e&&e instanceof d&&!e.hasErrorLabel("TransientTransactionError")){e.addErrorLabel("TransientTransactionError")}if(!r.commitTransaction&&e&&e instanceof s&&e.hasErrorLabel("TransientTransactionError")){b.transaction.unpinServer()}return h.apply(null,arguments)}:h;try{y.write(C,E,I)}catch(e){I(e)}}function hasSessionSupport(e){if(e==null)return false;if(e.description){return e.description.maxWireVersion>=6}return e.ismaster==null?false:e.ismaster.maxWireVersion>=6}function supportsOpMsg(e){const t=e.ismaster?e.ismaster:e.description;if(t==null){return false}return t.maxWireVersion>=6&&t.__nodejs_mock_server__==null}function _cryptCommand(e,t,r,n,o){const s=e.autoEncrypter;function commandResponseHandler(e,t){if(e||t==null){o(e,t);return}s.decrypt(t.result,n,((e,r)=>{if(e){o(e,null);return}t.result=r;t.message.documents=[r];o(null,t)}))}s.encrypt(t,r,n,((r,s)=>{if(r){o(r,null);return}_command(e,t,s,n,commandResponseHandler)}))}e.exports=command},7793:(e,t,r)=>{"use strict";const n=r(7746).retrieveSnappy();const o=r(8761);const s={snappy:1,zlib:2};const i=new Set(["ismaster","saslStart","saslContinue","getnonce","authenticate","createUser","updateUser","copydbSaslStart","copydbgetnonce","copydb"]);function compress(e,t,r){switch(e.options.agreedCompressor){case"snappy":n.compress(t,r);break;case"zlib":var s={};if(e.options.zlibCompressionLevel){s.level=e.options.zlibCompressionLevel}o.deflate(t,s,r);break;default:throw new Error('Attempt to compress message using unknown compressor "'+e.options.agreedCompressor+'".')}}function decompress(e,t,r){if(e<0||e>s.length){throw new Error("Server sent message compressed using an unsupported compressor. (Received compressor ID "+e+")")}switch(e){case s.snappy:n.uncompress(t,r);break;case s.zlib:o.inflate(t,r);break;default:r(null,t)}}e.exports={compressorIDs:s,uncompressibleCommands:i,compress:compress,decompress:decompress}},7161:e=>{"use strict";const t="2.6";const r="4.4";const n=2;const o=9;e.exports={MIN_SUPPORTED_SERVER_VERSION:t,MAX_SUPPORTED_SERVER_VERSION:r,MIN_SUPPORTED_WIRE_VERSION:n,MAX_SUPPORTED_WIRE_VERSION:o}},1971:(e,t,r)=>{"use strict";const n=r(9814).GetMore;const o=r(7746).retrieveBSON;const s=r(3111).MongoError;const i=r(3111).MongoNetworkError;const a=o();const c=a.Long;const l=r(7272).collectionNamespace;const u=r(1178).maxWireVersion;const d=r(7272).applyCommonQueryOptions;const p=r(7276);function getMore(e,t,r,o,a,h){a=a||{};const m=u(e);function queryCallback(e,t){if(e)return h(e);const n=t.message;if(n.cursorNotFound){return h(new i("cursor killed or timed out"),null)}if(m<4){const e=typeof n.cursorId==="number"?c.fromNumber(n.cursorId):n.cursorId;r.documents=n.documents;r.cursorId=e;h(null,null,n.connection);return}if(n.documents[0].ok===0){return h(new s(n.documents[0]))}const o=typeof n.documents[0].cursor.id==="number"?c.fromNumber(n.documents[0].cursor.id):n.documents[0].cursor.id;r.documents=n.documents[0].cursor.nextBatch;r.cursorId=o;h(null,n.documents[0],n.connection)}if(m<4){const s=e.s.bson;const i=new n(s,t,r.cursorId,{numberToReturn:o});const a=d({},r);e.s.pool.write(i,a,queryCallback);return}const y=r.cursorId instanceof c?r.cursorId:c.fromNumber(r.cursorId);const g={getMore:y,collection:l(t),batchSize:Math.abs(o)};if(r.cmd.tailable&&typeof r.cmd.maxAwaitTimeMS==="number"){g.maxTimeMS=r.cmd.maxAwaitTimeMS}const v=Object.assign({returnFieldSelector:null,documentsReturnedIn:"nextBatch"},a);if(r.session){v.session=r.session}p(e,t,g,v,queryCallback)}e.exports=getMore},9206:(e,t,r)=>{"use strict";const n=r(779);e.exports={insert:function insert(e,t,r,o,s){n(e,"insert","documents",t,r,o,s)},update:function update(e,t,r,o,s){n(e,"update","updates",t,r,o,s)},remove:function remove(e,t,r,o,s){n(e,"delete","deletes",t,r,o,s)},killCursors:r(6044),getMore:r(1971),query:r(1820),command:r(7276)}},6044:(e,t,r)=>{"use strict";const n=r(9814).KillCursor;const o=r(3111).MongoError;const s=r(3111).MongoNetworkError;const i=r(7272).collectionNamespace;const a=r(1178).maxWireVersion;const c=r(1178).emitWarning;const l=r(7276);function killCursors(e,t,r,u){u=typeof u==="function"?u:()=>{};const d=r.cursorId;if(a(e)<4){const o=e.s.bson;const s=e.s.pool;const i=new n(o,t,[d]);const a={immediateRelease:true,noResponse:true};if(typeof r.session==="object"){a.session=r.session}if(s&&s.isConnected()){try{s.write(i,a,u)}catch(e){if(typeof u==="function"){u(e,null)}else{c(e)}}}return}const p={killCursors:i(t),cursors:[d]};const h={};if(typeof r.session==="object")h.session=r.session;l(e,t,p,h,((e,t)=>{if(e){return u(e)}const r=t.message;if(r.cursorNotFound){return u(new s("cursor killed or timed out"),null)}if(!Array.isArray(r.documents)||r.documents.length===0){return u(new o(`invalid killCursors result returned for cursor id ${d}`))}u(null,r.documents[0])}))}e.exports=killCursors},1820:(e,t,r)=>{"use strict";const n=r(9814).Query;const o=r(3111).MongoError;const s=r(7272).getReadPreference;const i=r(7272).collectionNamespace;const a=r(7272).isSharded;const c=r(1178).maxWireVersion;const l=r(7272).applyCommonQueryOptions;const u=r(7276);const d=r(1371).decorateWithExplain;const p=r(5293).Explain;function query(e,t,r,n,i,a){i=i||{};if(n.cursorId!=null){return a()}if(r==null){return a(new o(`command ${JSON.stringify(r)} does not return a cursor`))}if(c(e)<4){const o=prepareLegacyFindQuery(e,t,r,n,i);const s=l({},n);if(typeof o.documentsReturnedIn==="string"){s.documentsReturnedIn=o.documentsReturnedIn}e.s.pool.write(o,s,a);return}const h=s(r,i);let m=prepareFindCommand(e,t,r,n,i);const y=p.fromOptions(i);if(y){m=d(m,y)}r.virtual=false;const g=Object.assign({documentsReturnedIn:"firstBatch",numberToReturn:1,slaveOk:h.slaveOk()},i);if(r.readPreference){g.readPreference=h}if(n.session){g.session=n.session}u(e,t,m,g,a)}function prepareFindCommand(e,t,r,n){n.batchSize=r.batchSize||n.batchSize;const o={find:i(t)};if(r.query){if(r.query["$query"]){o.filter=r.query["$query"]}else{o.filter=r.query}}let s=r.sort;if(Array.isArray(s)){const e={};if(s.length>0&&!Array.isArray(s[0])){let t=s[1];if(t==="asc"){t=1}else if(t==="desc"){t=-1}e[s[0]]=t}else{for(let t=0;t<s.length;t++){let r=s[t][1];if(r==="asc"){r=1}else if(r==="desc"){r=-1}e[s[t][0]]=r}}s=e}if(typeof r.allowDiskUse==="boolean"){o.allowDiskUse=r.allowDiskUse}if(r.sort)o.sort=s;if(r.fields)o.projection=r.fields;if(r.hint)o.hint=r.hint;if(r.skip)o.skip=r.skip;if(r.limit)o.limit=r.limit;if(r.limit<0){o.limit=Math.abs(r.limit);o.singleBatch=true}if(typeof r.batchSize==="number"){if(r.batchSize<0){if(r.limit!==0&&Math.abs(r.batchSize)<Math.abs(r.limit)){o.limit=Math.abs(r.batchSize)}o.singleBatch=true}o.batchSize=Math.abs(r.batchSize)}if(r.comment)o.comment=r.comment;if(r.maxScan)o.maxScan=r.maxScan;if(r.maxTimeMS)o.maxTimeMS=r.maxTimeMS;if(r.min)o.min=r.min;if(r.max)o.max=r.max;o.returnKey=r.returnKey?r.returnKey:false;o.showRecordId=r.showDiskLoc?r.showDiskLoc:false;if(r.snapshot)o.snapshot=r.snapshot;if(r.tailable)o.tailable=r.tailable;if(r.oplogReplay)o.oplogReplay=r.oplogReplay;if(r.noCursorTimeout)o.noCursorTimeout=r.noCursorTimeout;if(r.awaitData)o.awaitData=r.awaitData;if(r.awaitdata)o.awaitData=r.awaitdata;if(r.partial)o.partial=r.partial;if(r.collation)o.collation=r.collation;if(r.readConcern)o.readConcern=r.readConcern;return o}function prepareLegacyFindQuery(e,t,r,i,c){c=c||{};const l=e.s.bson;const u=s(r,c);i.batchSize=r.batchSize||i.batchSize;let d=0;if(i.limit<0||i.limit!==0&&i.limit<i.batchSize||i.limit>0&&i.batchSize===0){d=i.limit}else{d=i.batchSize}const p=i.skip||0;const h={};if(a(e)&&u){h["$readPreference"]=u.toJSON()}if(r.sort)h["$orderby"]=r.sort;if(r.hint)h["$hint"]=r.hint;if(r.snapshot)h["$snapshot"]=r.snapshot;if(typeof r.returnKey!=="undefined")h["$returnKey"]=r.returnKey;if(r.maxScan)h["$maxScan"]=r.maxScan;if(r.min)h["$min"]=r.min;if(r.max)h["$max"]=r.max;if(typeof r.showDiskLoc!=="undefined")h["$showDiskLoc"]=r.showDiskLoc;if(r.comment)h["$comment"]=r.comment;if(r.maxTimeMS)h["$maxTimeMS"]=r.maxTimeMS;if(c.explain!==undefined){d=-Math.abs(r.limit||0);h["$explain"]=true}h["$query"]=r.query;if(r.readConcern&&r.readConcern.level!=="local"){throw new o(`server find command does not support a readConcern level of ${r.readConcern.level}`)}if(r.readConcern){r=Object.assign({},r);delete r["readConcern"]}const m=typeof c.serializeFunctions==="boolean"?c.serializeFunctions:false;const y=typeof c.ignoreUndefined==="boolean"?c.ignoreUndefined:false;const g=new n(l,t,h,{numberToSkip:p,numberToReturn:d,pre32Limit:typeof r.limit!=="undefined"?r.limit:undefined,checkKeys:false,returnFieldSelector:r.fields,serializeFunctions:m,ignoreUndefined:y});if(typeof r.tailable==="boolean")g.tailable=r.tailable;if(typeof r.oplogReplay==="boolean")g.oplogReplay=r.oplogReplay;if(typeof r.noCursorTimeout==="boolean")g.noCursorTimeout=r.noCursorTimeout;if(typeof r.awaitData==="boolean")g.awaitData=r.awaitData;if(typeof r.partial==="boolean")g.partial=r.partial;g.slaveOk=u.slaveOk();return g}e.exports=query},7272:(e,t,r)=>{"use strict";const n=r(4485);const o=r(3111).MongoError;const s=r(2291).ServerType;const i=r(7962).TopologyDescription;const a=16;const c=9;var l={OP_REPLY:1,OP_UPDATE:2001,OP_INSERT:2002,OP_QUERY:2004,OP_GETMORE:2005,OP_DELETE:2006,OP_KILL_CURSORS:2007,OP_COMPRESSED:2012,OP_MSG:2013};var getReadPreference=function(e,t){var r=e.readPreference||new n("primary");if(t.readPreference){r=t.readPreference}if(typeof r==="string"){r=new n(r)}if(!(r instanceof n)){throw new o("read preference must be a ReadPreference instance")}return r};var parseHeader=function(e){return{length:e.readInt32LE(0),requestId:e.readInt32LE(4),responseTo:e.readInt32LE(8),opCode:e.readInt32LE(12)}};function applyCommonQueryOptions(e,t){Object.assign(e,{raw:typeof t.raw==="boolean"?t.raw:false,promoteLongs:typeof t.promoteLongs==="boolean"?t.promoteLongs:true,promoteValues:typeof t.promoteValues==="boolean"?t.promoteValues:true,promoteBuffers:typeof t.promoteBuffers==="boolean"?t.promoteBuffers:false,monitoring:typeof t.monitoring==="boolean"?t.monitoring:false,fullResult:typeof t.fullResult==="boolean"?t.fullResult:false});if(typeof t.socketTimeout==="number"){e.socketTimeout=t.socketTimeout}if(t.session){e.session=t.session}if(typeof t.documentsReturnedIn==="string"){e.documentsReturnedIn=t.documentsReturnedIn}return e}function isSharded(e){if(e.type==="mongos")return true;if(e.description&&e.description.type===s.Mongos){return true}if(e.description&&e.description instanceof i){const t=Array.from(e.description.servers.values());return t.some((e=>e.type===s.Mongos))}return false}function databaseNamespace(e){return e.split(".")[0]}function collectionNamespace(e){return e.split(".").slice(1).join(".")}e.exports={getReadPreference:getReadPreference,MESSAGE_HEADER_SIZE:a,COMPRESSION_DETAILS_SIZE:c,opcodes:l,parseHeader:parseHeader,applyCommonQueryOptions:applyCommonQueryOptions,isSharded:isSharded,databaseNamespace:databaseNamespace,collectionNamespace:collectionNamespace}},779:(e,t,r)=>{"use strict";const n=r(3111).MongoError;const o=r(7272).collectionNamespace;const s=r(7276);const i=r(1371).decorateWithExplain;const a=r(5293).Explain;function writeCommand(e,t,r,c,l,u,d){if(l.length===0)throw new n(`${t} must contain at least one document`);if(typeof u==="function"){d=u;u={}}u=u||{};const p=typeof u.ordered==="boolean"?u.ordered:true;const h=u.writeConcern;let m={};m[t]=o(c);m[r]=l;m.ordered=p;if(h&&Object.keys(h).length>0){m.writeConcern=h}if(u.collation){for(let e=0;e<m[r].length;e++){if(!m[r][e].collation){m[r][e].collation=u.collation}}}if(u.bypassDocumentValidation===true){m.bypassDocumentValidation=u.bypassDocumentValidation}const y=a.fromOptions(u);if(y){m=i(m,y)}const g=Object.assign({checkKeys:t==="insert",numberToReturn:1},u);s(e,c,m,g,d)}e.exports=writeCommand},7159:(e,t,r)=>{"use strict";const n=r(2413).Transform;const o=r(2413).PassThrough;const s=r(1669).deprecate;const i=r(1371).handleCallback;const a=r(3994).ReadPreference;const c=r(3994).MongoError;const l=r(4847).CoreCursor;const u=r(4847).CursorState;const d=r(3994).BSON.Map;const p=r(1371).maybePromise;const h=r(2548);const m=r(1371).formattedOrderClause;const y=r(5293).Explain;const g=r(1018).Aspect;const v=r(3554).each;const b=r(7885);const S=["tailable","oplogReplay","noCursorTimeout","awaitData","exhaust","partial"];const w=["numberOfRetries","tailableRetryInterval"];class Cursor extends l{constructor(e,t,r,n){super(e,t,r,n);if(this.operation){n=this.operation.options}const o=n.numberOfRetries||5;const s=n.tailableRetryInterval||500;const i=o;const a=n.promiseLibrary||Promise;this.s={numberOfRetries:o,tailableRetryInterval:s,currentNumberOfRetries:i,state:u.INIT,promiseLibrary:a,explicitlyIgnoreSession:!!n.explicitlyIgnoreSession};if(!n.explicitlyIgnoreSession&&n.session){this.cursorState.session=n.session}if(this.options.noCursorTimeout===true){this.addCursorFlag("noCursorTimeout",true)}let c=1e3;if(this.cmd.cursor&&this.cmd.cursor.batchSize){c=this.cmd.cursor.batchSize}else if(n.cursor&&n.cursor.batchSize){c=n.cursor.batchSize}else if(typeof n.batchSize==="number"){c=n.batchSize}this.setCursorBatchSize(c)}get readPreference(){if(this.operation){return this.operation.readPreference}return this.options.readPreference}get sortValue(){return this.cmd.sort}_initializeCursor(e){if(this.operation&&this.operation.session!=null){this.cursorState.session=this.operation.session}else{if(!this.s.explicitlyIgnoreSession&&!this.cursorState.session&&this.topology.hasSessionSupport()){this.cursorState.session=this.topology.startSession({owner:this});if(this.operation){this.operation.session=this.cursorState.session}}}super._initializeCursor(e)}hasNext(e){if(this.s.state===u.CLOSED||this.isDead&&this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}return p(this,e,(e=>{const t=this;if(t.isNotified()){return e(null,false)}t._next(((r,n)=>{if(r)return e(r);if(n==null||t.s.state===Cursor.CLOSED||t.isDead()){return e(null,false)}t.s.state=u.OPEN;t.cursorState.cursorIndex--;if(t.cursorState.limit>0){t.cursorState.currentLimit--}e(null,true)}))}))}next(e){return p(this,e,(e=>{const t=this;if(t.s.state===u.CLOSED||t.isDead&&t.isDead()){e(c.create({message:"Cursor is closed",driver:true}));return}if(t.s.state===u.INIT&&t.cmd.sort){try{t.cmd.sort=m(t.cmd.sort)}catch(t){return e(t)}}t._next(((r,n)=>{if(r)return e(r);t.s.state=u.OPEN;e(null,n)}))}))}filter(e){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.query=e;return this}maxScan(e){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.maxScan=e;return this}hint(e){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.hint=e;return this}min(e){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.min=e;return this}max(e){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.max=e;return this}returnKey(e){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.returnKey=e;return this}showRecordId(e){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.showDiskLoc=e;return this}snapshot(e){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.snapshot=e;return this}setCursorOption(e,t){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}if(w.indexOf(e)===-1){throw c.create({message:`option ${e} is not a supported option ${w}`,driver:true})}this.s[e]=t;if(e==="numberOfRetries")this.s.currentNumberOfRetries=t;return this}addCursorFlag(e,t){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}if(S.indexOf(e)===-1){throw c.create({message:`flag ${e} is not a supported flag ${S}`,driver:true})}if(typeof t!=="boolean"){throw c.create({message:`flag ${e} must be a boolean value`,driver:true})}this.cmd[e]=t;return this}addQueryModifier(e,t){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}if(e[0]!=="$"){throw c.create({message:`${e} is not a valid query modifier`,driver:true})}const r=e.substr(1);this.cmd[r]=t;if(r==="orderby")this.cmd.sort=this.cmd[r];return this}comment(e){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.comment=e;return this}maxAwaitTimeMS(e){if(typeof e!=="number"){throw c.create({message:"maxAwaitTimeMS must be a number",driver:true})}if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.maxAwaitTimeMS=e;return this}maxTimeMS(e){if(typeof e!=="number"){throw c.create({message:"maxTimeMS must be a number",driver:true})}if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.maxTimeMS=e;return this}project(e){if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}this.cmd.fields=e;return this}sort(e,t){if(this.options.tailable){throw c.create({message:"Tailable cursor doesn't support sorting",driver:true})}if(this.s.state===u.CLOSED||this.s.state===u.OPEN||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}let r=e;if(Array.isArray(r)&&Array.isArray(r[0])){r=new d(r.map((e=>{const t=[e[0],null];if(e[1]==="asc"){t[1]=1}else if(e[1]==="desc"){t[1]=-1}else if(e[1]===1||e[1]===-1||e[1].$meta){t[1]=e[1]}else{throw new c("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]")}return t})))}if(t!=null){r=[[e,t]]}this.cmd.sort=r;return this}batchSize(e){if(this.options.tailable){throw c.create({message:"Tailable cursor doesn't support batchSize",driver:true})}if(this.s.state===u.CLOSED||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}if(typeof e!=="number"){throw c.create({message:"batchSize requires an integer",driver:true})}this.cmd.batchSize=e;this.setCursorBatchSize(e);return this}collation(e){this.cmd.collation=e;return this}limit(e){if(this.options.tailable){throw c.create({message:"Tailable cursor doesn't support limit",driver:true})}if(this.s.state===u.OPEN||this.s.state===u.CLOSED||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}if(typeof e!=="number"){throw c.create({message:"limit requires an integer",driver:true})}this.cmd.limit=e;this.setCursorLimit(e);return this}skip(e){if(this.options.tailable){throw c.create({message:"Tailable cursor doesn't support skip",driver:true})}if(this.s.state===u.OPEN||this.s.state===u.CLOSED||this.isDead()){throw c.create({message:"Cursor is closed",driver:true})}if(typeof e!=="number"){throw c.create({message:"skip requires an integer",driver:true})}this.cmd.skip=e;this.setCursorSkip(e);return this}each(e){this.rewind();this.s.state=u.INIT;v(this,e)}forEach(e,t){this.rewind();this.s.state=u.INIT;if(typeof t==="function"){v(this,((r,n)=>{if(r){t(r);return false}if(n!=null){e(n);return true}if(n==null&&t){const e=t;t=null;e(null);return false}}))}else{return new this.s.promiseLibrary(((t,r)=>{v(this,((n,o)=>{if(n){r(n);return false}else if(o==null){t(null);return false}else{e(o);return true}}))}))}}setReadPreference(e){if(this.s.state!==u.INIT){throw c.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:true})}if(e instanceof a){this.options.readPreference=e}else if(typeof e==="string"){this.options.readPreference=new a(e)}else{throw new TypeError("Invalid read preference: "+e)}return this}toArray(e){if(this.options.tailable){throw c.create({message:"Tailable cursor cannot be converted to array",driver:true})}return p(this,e,(e=>{const t=this;const r=[];t.rewind();t.s.state=u.INIT;const fetchDocs=()=>{t._next(((n,o)=>{if(n){return i(e,n)}if(o==null){return t.close({skipKillCursors:true},(()=>i(e,null,r)))}r.push(o);if(t.bufferedCount()>0){let e=t.readBufferedDocuments(t.bufferedCount());Array.prototype.push.apply(r,e)}fetchDocs()}))};fetchDocs()}))}count(e,t,r){if(this.cmd.query==null)throw c.create({message:"count can only be used with find command",driver:true});if(typeof t==="function")r=t,t={};t=t||{};if(typeof e==="function"){r=e;e=true}if(this.cursorState.session){t=Object.assign({},t,{session:this.cursorState.session})}const n=new b(this,e,t);return h(this.topology,n,r)}close(e,t){if(typeof e==="function")t=e,e={};e=Object.assign({},{skipKillCursors:false},e);return p(this,t,(t=>{this.s.state=u.CLOSED;if(!e.skipKillCursors){this.kill()}this._endSession((()=>{this.emit("close");t(null,this)}))}))}map(e){if(this.cursorState.transforms&&this.cursorState.transforms.doc){const t=this.cursorState.transforms.doc;this.cursorState.transforms.doc=r=>e(t(r))}else{this.cursorState.transforms={doc:e}}return this}isClosed(){return this.isDead()}destroy(e){if(e)this.emit("error",e);this.pause();this.close()}stream(e){this.cursorState.streamOptions=e||{};return this}transformStream(e){const t=e||{};if(typeof t.transform==="function"){const e=new n({objectMode:true,transform:function(e,r,n){this.push(t.transform(e));n()}});return this.pipe(e)}return this.pipe(new o({objectMode:true}))}explain(e,t){if(typeof e==="function")t=e,e=true;if(e===undefined)e=true;if(!this.operation||!this.operation.hasAspect(g.EXPLAINABLE)){throw new c("This command cannot be explained")}this.operation.explain=new y(e);return p(this,t,(e=>{l.prototype._next.apply(this,[e])}))}getLogger(){return this.logger}}Cursor.prototype.maxTimeMs=Cursor.prototype.maxTimeMS;s(Cursor.prototype.each,"Cursor.each is deprecated. Use Cursor.forEach instead.");s(Cursor.prototype.maxScan,"Cursor.maxScan is deprecated, and will be removed in a later version");s(Cursor.prototype.snapshot,"Cursor Snapshot is deprecated, and will be removed in a later version");e.exports=Cursor},6662:(e,t,r)=>{"use strict";const n=r(8614).EventEmitter;const o=r(1669).inherits;const s=r(1371).getSingleProperty;const i=r(538);const a=r(1371).handleCallback;const c=r(1371).filterOptions;const l=r(1371).toError;const u=r(3994).ReadPreference;const d=r(3994).MongoError;const p=r(3994).ObjectID;const h=r(3994).Logger;const m=r(5193);const y=r(1371).conditionallyMergeWriteConcern;const g=r(1371).executeLegacyOperation;const v=r(1117);const b=r(1669).deprecate;const S=r(1371).deprecateOptions;const w=r(1371).MongoDBNamespace;const _=r(147);const E=r(2481);const O=r(7289);const C=r(7429);const T=r(2226).createListener;const I=r(2226).ensureIndex;const k=r(2226).evaluate;const A=r(2226).profilingInfo;const N=r(2226).validateDatabaseName;const R=r(1554);const M=r(7057);const D=r(286);const P=r(499);const L=r(1363);const B=r(5561);const j=r(6394);const U=r(2360).DropCollectionOperation;const F=r(2360).DropDatabaseOperation;const $=r(1681);const W=r(4245);const z=r(840);const q=r(3969);const V=r(1969);const G=r(2808);const Y=r(6301);const K=r(2548);const X=["w","wtimeout","fsync","j","writeConcern","readPreference","readPreferenceTags","native_parser","forceServerObjectId","pkFactory","serializeFunctions","raw","bufferMaxEntries","authSource","ignoreUndefined","promoteLongs","promiseLibrary","readConcern","retryMiliSeconds","numberOfRetries","parentDb","noListener","loggerLevel","logger","promoteBuffers","promoteLongs","promoteValues","compression","retryWrites"];function Db(e,t,r){r=r||{};if(!(this instanceof Db))return new Db(e,t,r);n.call(this);const o=r.promiseLibrary||Promise;r=c(r,X);r.promiseLibrary=o;this.s={dbCache:{},children:[],topology:t,options:r,logger:h("Db",r),bson:t?t.bson:null,readPreference:u.fromOptions(r),bufferMaxEntries:typeof r.bufferMaxEntries==="number"?r.bufferMaxEntries:-1,parentDb:r.parentDb||null,pkFactory:r.pkFactory||p,nativeParser:r.nativeParser||r.native_parser,promiseLibrary:o,noListener:typeof r.noListener==="boolean"?r.noListener:false,readConcern:O.fromOptions(r),writeConcern:E.fromOptions(r),namespace:new w(e)};N(e);s(this,"serverConfig",this.s.topology);s(this,"bufferMaxEntries",this.s.bufferMaxEntries);s(this,"databaseName",this.s.namespace.db);if(r.parentDb)return;if(this.s.noListener)return;t.on("error",T(this,"error",this));t.on("timeout",T(this,"timeout",this));t.on("close",T(this,"close",this));t.on("parseError",T(this,"parseError",this));t.once("open",T(this,"open",this));t.once("fullsetup",T(this,"fullsetup",this));t.once("all",T(this,"all",this));t.on("reconnect",T(this,"reconnect",this))}o(Db,n);Db.prototype.on=b((function(){return Db.super_.prototype.on.apply(this,arguments)}),"Listening to events on the Db class has been deprecated and will be removed in the next major version.");Db.prototype.once=b((function(){return Db.super_.prototype.once.apply(this,arguments)}),"Listening to events on the Db class has been deprecated and will be removed in the next major version.");Object.defineProperty(Db.prototype,"topology",{enumerable:true,get:function(){return this.s.topology}});Object.defineProperty(Db.prototype,"options",{enumerable:true,get:function(){return this.s.options}});Object.defineProperty(Db.prototype,"slaveOk",{enumerable:true,get:function(){if(this.s.options.readPreference!=null&&(this.s.options.readPreference!=="primary"||this.s.options.readPreference.mode!=="primary")){return true}return false}});Object.defineProperty(Db.prototype,"readConcern",{enumerable:true,get:function(){return this.s.readConcern}});Object.defineProperty(Db.prototype,"readPreference",{enumerable:true,get:function(){if(this.s.readPreference==null){return u.primary}return this.s.readPreference}});Object.defineProperty(Db.prototype,"writeConcern",{enumerable:true,get:function(){return this.s.writeConcern}});Object.defineProperty(Db.prototype,"namespace",{enumerable:true,get:function(){return this.s.namespace.toString()}});Db.prototype.command=function(e,t,r){if(typeof t==="function")r=t,t={};t=Object.assign({},t);const n=new L(this,e,t);return K(this.s.topology,n,r)};Db.prototype.aggregate=function(e,t,r){if(typeof t==="function"){r=t;t={}}if(t==null&&r==null){t={}}const n=new C(this.s.topology,new R(this,e,t),t);if(typeof r==="function"){r(null,n);return}return n};Db.prototype.admin=function(){const e=r(3238);return new e(this,this.s.topology,this.s.promiseLibrary)};const J=["pkFactory","readPreference","serializeFunctions","strict","readConcern","ignoreUndefined","promoteValues","promoteBuffers","promoteLongs"];Db.prototype.collection=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};t=Object.assign({},t);t.promiseLibrary=this.s.promiseLibrary;t.readConcern=t.readConcern?new O(t.readConcern.level):this.readConcern;if(this.s.options.ignoreUndefined){t.ignoreUndefined=this.s.options.ignoreUndefined}for(const e of J){if(!(e in t)&&this.s.options[e]!==undefined){t[e]=this.s.options[e]}}t=y(t,this.s.options);if(t==null||!t.strict){try{const n=new m(this,this.s.topology,this.databaseName,e,this.s.pkFactory,t);if(r)r(null,n);return n}catch(e){if(e instanceof d&&r)return r(e);throw e}}if(typeof r!=="function"){throw l(`A callback is required in strict mode. While getting collection ${e}`)}if(this.serverConfig&&this.serverConfig.isDestroyed()){return r(new d("topology was destroyed"))}const n=Object.assign({},t,{nameOnly:true});this.listCollections({name:e},n).toArray(((n,o)=>{if(n!=null)return a(r,n,null);if(o.length===0)return a(r,l(`Collection ${e} does not exist. Currently in strict mode.`),null);try{return a(r,null,new m(this,this.s.topology,this.databaseName,e,this.s.pkFactory,t))}catch(n){return a(r,n,null)}}))};Db.prototype.createCollection=S({name:"Db.createCollection",deprecatedOptions:["autoIndexId","strict","w","wtimeout","j"],optionsIndex:1},(function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};t.promiseLibrary=t.promiseLibrary||this.s.promiseLibrary;t.readConcern=t.readConcern?new O(t.readConcern.level):this.readConcern;const n=new B(this,e,t);return K(this.s.topology,n,r)}));Db.prototype.stats=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r={dbStats:true};if(e["scale"]!=null)r["scale"]=e["scale"];if(e.readPreference==null&&this.s.readPreference){e.readPreference=this.s.readPreference}const n=new P(this,e,null,r);return K(this.s.topology,n,t)};Db.prototype.listCollections=function(e,t){e=e||{};t=t||{};return new i(this.s.topology,new z(this,e,t),t)};Db.prototype.eval=b((function(e,t,r,n){const o=Array.prototype.slice.call(arguments,1);n=typeof o[o.length-1]==="function"?o.pop():undefined;t=o.length?o.shift():t;r=o.length?o.shift()||{}:{};return g(this.s.topology,k,[this,e,t,r,n])}),"Db.eval is deprecated as of MongoDB version 3.2");Db.prototype.renameCollection=function(e,t,r,n){if(typeof r==="function")n=r,r={};r=Object.assign({},r,{readPreference:u.PRIMARY});r.new_collection=true;const o=new G(this.collection(e),t,r);return K(this.s.topology,o,n)};Db.prototype.dropCollection=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};const n=new U(this,e,t);return K(this.s.topology,n,r)};Db.prototype.dropDatabase=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=new F(this,e);return K(this.s.topology,r,t)};Db.prototype.collections=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=new D(this,e);return K(this.s.topology,r,t)};Db.prototype.executeDbAdminCommand=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};t.readPreference=u.resolve(this,t);const n=new $(this,e,t);return K(this.s.topology,n,r)};Db.prototype.createIndex=function(e,t,r,n){if(typeof r==="function")n=r,r={};r=r?Object.assign({},r):{};const o=new j(this,e,t,r);return K(this.s.topology,o,n)};Db.prototype.ensureIndex=b((function(e,t,r,n){if(typeof r==="function")n=r,r={};r=r||{};return g(this.s.topology,I,[this,e,t,r,n])}),"Db.ensureIndex is deprecated as of MongoDB version 3.0 / driver version 2.0");Db.prototype.addChild=function(e){if(this.s.parentDb)return this.s.parentDb.addChild(e);this.s.children.push(e)};Db.prototype.addUser=function(e,t,r,n){if(typeof r==="function")n=r,r={};r=r||{};if(typeof e==="string"&&t!=null&&typeof t==="object"){r=t;t=null}const o=new M(this,e,t,r);return K(this.s.topology,o,n)};Db.prototype.removeUser=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};const n=new V(this,e,t);return K(this.s.topology,n,r)};Db.prototype.setProfilingLevel=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};const n=new Y(this,e,t);return K(this.s.topology,n,r)};Db.prototype.profilingInfo=b((function(e,t){if(typeof e==="function")t=e,e={};e=e||{};return g(this.s.topology,A,[this,e,t])}),"Db.profilingInfo is deprecated. Query the system.profile collection directly.");Db.prototype.profilingLevel=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};const r=new q(this,e);return K(this.s.topology,r,t)};Db.prototype.indexInformation=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};const n=new W(this,e,t);return K(this.s.topology,n,r)};Db.prototype.unref=function(){this.s.topology.unref()};Db.prototype.watch=function(e,t){e=e||[];t=t||{};if(!Array.isArray(e)){t=e;e=[]}return new v(this,e,t)};Db.prototype.getLogger=function(){return this.s.logger};Db.SYSTEM_NAMESPACE_COLLECTION=_.SYSTEM_NAMESPACE_COLLECTION;Db.SYSTEM_INDEX_COLLECTION=_.SYSTEM_INDEX_COLLECTION;Db.SYSTEM_PROFILE_COLLECTION=_.SYSTEM_PROFILE_COLLECTION;Db.SYSTEM_USER_COLLECTION=_.SYSTEM_USER_COLLECTION;Db.SYSTEM_COMMAND_COLLECTION=_.SYSTEM_COMMAND_COLLECTION;Db.SYSTEM_JS_COLLECTION=_.SYSTEM_JS_COLLECTION;e.exports=Db},8275:(e,t,r)=>{"use strict";let n;let o;let s;function loadCollection(){if(!n){n=r(5193)}return n}function loadCursor(){if(!o){o=r(7159)}return o}function loadDb(){if(!s){s=r(6662)}return s}e.exports={loadCollection:loadCollection,loadCursor:loadCursor,loadDb:loadDb}},3012:(e,t,r)=>{"use strict";const n=r(1545);const o=r(7746).retrieveBSON();const s=r(3111).MongoError;try{require.resolve("mongodb-client-encryption")}catch(e){throw new s("Auto-encryption requested, but the module is not installed. "+"Please add `mongodb-client-encryption` as a dependency of your project")}const i=r(5764);if(typeof i.extension!=="function"){throw new s("loaded version of `mongodb-client-encryption` does not have property `extension`. "+"Please make sure you are loading the correct version of `mongodb-client-encryption`")}const a=i.extension(r(5711)).AutoEncrypter;const c=Symbol("internalClient");class Encrypter{constructor(e,t){this.bypassAutoEncryption=!!t.autoEncryption.bypassAutoEncryption;this.needsConnecting=false;if(t.maxPoolSize===0&&t.autoEncryption.keyVaultClient==null){t.autoEncryption.keyVaultClient=e}else if(t.autoEncryption.keyVaultClient==null){t.autoEncryption.keyVaultClient=this.getInternalClient(e)}if(this.bypassAutoEncryption){t.autoEncryption.metadataClient=undefined}else if(t.maxPoolSize===0){t.autoEncryption.metadataClient=e}else{t.autoEncryption.metadataClient=this.getInternalClient(e)}t.autoEncryption.bson=Encrypter.makeBSON(t);this.autoEncrypter=new a(e,t.autoEncryption)}getInternalClient(e){if(!this[c]){const t={};for(const r of Object.keys(e.s.options)){if(["autoEncryption","minPoolSize","servers","caseTranslate","dbName"].indexOf(r)!==-1)continue;t[r]=e.s.options[r]}t.minPoolSize=0;const r=["commandStarted","commandSucceeded","commandFailed","serverOpening","serverClosed","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","topologyOpening","topologyClosed","topologyDescriptionChanged","joined","left","ping","ha","connectionPoolCreated","connectionPoolClosed","connectionCreated","connectionReady","connectionClosed","connectionCheckOutStarted","connectionCheckOutFailed","connectionCheckedOut","connectionCheckedIn","connectionPoolCleared"];this[c]=new n(e.s.url,t);for(const t of r){for(const r of e.listeners(t)){this[c].on(t,r)}}e.on("newListener",((e,t)=>{this[c].on(e,t)}));this.needsConnecting=true}return this[c]}connectInternalClient(e){if(this.needsConnecting){this.needsConnecting=false;return this[c].connect(e)}return e()}close(e,t,r){this.autoEncrypter.teardown((n=>{if(this[c]&&e!==this[c]){return this[c].close(t,r)}r(n)}))}static makeBSON(e){return(e||{}).bson||new o([o.Binary,o.Code,o.DBRef,o.Decimal128,o.Double,o.Int32,o.Long,o.Map,o.MaxKey,o.MinKey,o.ObjectId,o.BSONRegExp,o.Symbol,o.Timestamp])}}e.exports={Encrypter:Encrypter}},9386:(e,t,r)=>{"use strict";const n=r(3994).MongoNetworkError;const o=new Set([6,7,89,91,189,262,9001,10107,11600,11602,13435,13436,63,150,13388,234,133,43]);function isResumableError(e,t){if(e instanceof n){return true}if(t>=9){if(e.code===43){return true}return e.hasErrorLabel("ResumableChangeStreamError")}return o.has(e.code)}e.exports={GET_MORE_RESUMABLE_CODES:o,isResumableError:isResumableError}},5293:(e,t,r)=>{"use strict";const n=r(3111).MongoError;const o={queryPlanner:"queryPlanner",queryPlannerExtended:"queryPlannerExtended",executionStats:"executionStats",allPlansExecution:"allPlansExecution"};class Explain{constructor(e){if(typeof e==="boolean"){this.verbosity=e?"allPlansExecution":"queryPlanner"}else{this.verbosity=e}}static fromOptions(e){if(e==null||e.explain===undefined){return}const t=e.explain;if(typeof t==="boolean"||t in o){return new Explain(e.explain)}throw new n(`explain must be one of ${Object.keys(o)} or a boolean`)}}e.exports={Explain:Explain}},4190:(e,t,r)=>{"use strict";var n=r(2413),o=r(1669);e.exports=GridFSBucketReadStream;function GridFSBucketReadStream(e,t,r,o,s){this.s={bytesRead:0,chunks:e,cursor:null,expected:0,files:t,filter:o,init:false,expectedEnd:0,file:null,options:s,readPreference:r};n.Readable.call(this)}o.inherits(GridFSBucketReadStream,n.Readable);GridFSBucketReadStream.prototype._read=function(){var e=this;if(this.destroyed){return}waitForFile(e,(function(){doRead(e)}))};GridFSBucketReadStream.prototype.start=function(e){throwIfInitialized(this);this.s.options.start=e;return this};GridFSBucketReadStream.prototype.end=function(e){throwIfInitialized(this);this.s.options.end=e;return this};GridFSBucketReadStream.prototype.abort=function(e){var t=this;this.push(null);this.destroyed=true;if(this.s.cursor){this.s.cursor.close((function(r){t.emit("close");e&&e(r)}))}else{if(!this.s.init){t.emit("close")}e&&e()}};function throwIfInitialized(e){if(e.s.init){throw new Error("You cannot change options after the stream has entered"+"flowing mode!")}}function doRead(e){if(e.destroyed){return}e.s.cursor.next((function(t,r){if(e.destroyed){return}if(t){return __handleError(e,t)}if(!r){e.push(null);process.nextTick((()=>{e.s.cursor.close((function(t){if(t){__handleError(e,t);return}e.emit("close")}))}));return}var n=e.s.file.length-e.s.bytesRead;var o=e.s.expected++;var s=Math.min(e.s.file.chunkSize,n);if(r.n>o){var i="ChunkIsMissing: Got unexpected n: "+r.n+", expected: "+o;return __handleError(e,new Error(i))}if(r.n<o){i="ExtraChunk: Got unexpected n: "+r.n+", expected: "+o;return __handleError(e,new Error(i))}var a=Buffer.isBuffer(r.data)?r.data:r.data.buffer;if(a.length!==s){if(n<=0){i="ExtraChunk: Got unexpected n: "+r.n;return __handleError(e,new Error(i))}i="ChunkIsWrongSize: Got unexpected length: "+a.length+", expected: "+s;return __handleError(e,new Error(i))}e.s.bytesRead+=a.length;if(a.length===0){return e.push(null)}var c=null;var l=null;if(e.s.bytesToSkip!=null){c=e.s.bytesToSkip;e.s.bytesToSkip=0}const u=o===e.s.expectedEnd-1;const d=e.s.options.end-e.s.bytesToSkip;if(u&&e.s.bytesToTrim!=null){l=e.s.file.chunkSize-e.s.bytesToTrim}else if(e.s.options.end&&d<r.data.length()){l=d}if(c!=null||l!=null){a=a.slice(c||0,l||a.length)}e.push(a)}))}function init(e){var t={};if(e.s.readPreference){t.readPreference=e.s.readPreference}if(e.s.options&&e.s.options.sort){t.sort=e.s.options.sort}if(e.s.options&&e.s.options.skip){t.skip=e.s.options.skip}e.s.files.findOne(e.s.filter,t,(function(t,r){if(t){return __handleError(e,t)}if(!r){var n=e.s.filter._id?e.s.filter._id.toString():e.s.filter.filename;var o="FileNotFound: file "+n+" was not found";var s=new Error(o);s.code="ENOENT";return __handleError(e,s)}if(r.length<=0){e.push(null);return}if(e.destroyed){e.emit("close");return}try{e.s.bytesToSkip=handleStartOption(e,r,e.s.options)}catch(t){return __handleError(e,t)}var i={files_id:r._id};if(e.s.options&&e.s.options.start!=null){var a=Math.floor(e.s.options.start/r.chunkSize);if(a>0){i["n"]={$gte:a}}}e.s.cursor=e.s.chunks.find(i).sort({n:1});if(e.s.readPreference){e.s.cursor.setReadPreference(e.s.readPreference)}e.s.expectedEnd=Math.ceil(r.length/r.chunkSize);e.s.file=r;try{e.s.bytesToTrim=handleEndOption(e,r,e.s.cursor,e.s.options)}catch(t){return __handleError(e,t)}e.emit("file",r)}))}function waitForFile(e,t){if(e.s.file){return t()}if(!e.s.init){init(e);e.s.init=true}e.once("file",(function(){t()}))}function handleStartOption(e,t,r){if(r&&r.start!=null){if(r.start>t.length){throw new Error("Stream start ("+r.start+") must not be "+"more than the length of the file ("+t.length+")")}if(r.start<0){throw new Error("Stream start ("+r.start+") must not be "+"negative")}if(r.end!=null&&r.end<r.start){throw new Error("Stream start ("+r.start+") must not be "+"greater than stream end ("+r.end+")")}e.s.bytesRead=Math.floor(r.start/t.chunkSize)*t.chunkSize;e.s.expected=Math.floor(r.start/t.chunkSize);return r.start-e.s.bytesRead}}function handleEndOption(e,t,r,n){if(n&&n.end!=null){if(n.end>t.length){throw new Error("Stream end ("+n.end+") must not be "+"more than the length of the file ("+t.length+")")}if(n.start<0){throw new Error("Stream end ("+n.end+") must not be "+"negative")}var o=n.start!=null?Math.floor(n.start/t.chunkSize):0;r.limit(Math.ceil(n.end/t.chunkSize)-o);e.s.expectedEnd=Math.ceil(n.end/t.chunkSize);return Math.ceil(n.end/t.chunkSize)*t.chunkSize-n.end}}function __handleError(e,t){e.emit("error",t)}},2573:(e,t,r)=>{"use strict";var n=r(8614).EventEmitter;var o=r(4190);var s=r(1413);var i=r(1371).shallowClone;var a=r(1371).toError;var c=r(1669);var l=r(1371).executeLegacyOperation;var u={bucketName:"fs",chunkSizeBytes:255*1024};e.exports=GridFSBucket;function GridFSBucket(e,t){n.apply(this);this.setMaxListeners(0);if(t&&typeof t==="object"){t=i(t);var r=Object.keys(u);for(var o=0;o<r.length;++o){if(!t[r[o]]){t[r[o]]=u[r[o]]}}}else{t=u}this.s={db:e,options:t,_chunksCollection:e.collection(t.bucketName+".chunks"),_filesCollection:e.collection(t.bucketName+".files"),checkedIndexes:false,calledOpenUploadStream:false,promiseLibrary:e.s.promiseLibrary||Promise}}c.inherits(GridFSBucket,n);GridFSBucket.prototype.openUploadStream=function(e,t){if(t){t=i(t)}else{t={}}if(!t.chunkSizeBytes){t.chunkSizeBytes=this.s.options.chunkSizeBytes}return new s(this,e,t)};GridFSBucket.prototype.openUploadStreamWithId=function(e,t,r){if(r){r=i(r)}else{r={}}if(!r.chunkSizeBytes){r.chunkSizeBytes=this.s.options.chunkSizeBytes}r.id=e;return new s(this,t,r)};GridFSBucket.prototype.openDownloadStream=function(e,t){var r={_id:e};t={start:t&&t.start,end:t&&t.end};return new o(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,r,t)};GridFSBucket.prototype.delete=function(e,t){return l(this.s.db.s.topology,_delete,[this,e,t],{skipSessions:true})};function _delete(e,t,r){e.s._filesCollection.deleteOne({_id:t},(function(n,o){if(n){return r(n)}e.s._chunksCollection.deleteMany({files_id:t},(function(e){if(e){return r(e)}if(!o.result.n){var n="FileNotFound: no file with id "+t+" found";return r(new Error(n))}r()}))}))}GridFSBucket.prototype.find=function(e,t){e=e||{};t=t||{};var r=this.s._filesCollection.find(e);if(t.batchSize!=null){r.batchSize(t.batchSize)}if(t.limit!=null){r.limit(t.limit)}if(t.maxTimeMS!=null){r.maxTimeMS(t.maxTimeMS)}if(t.noCursorTimeout!=null){r.addCursorFlag("noCursorTimeout",t.noCursorTimeout)}if(t.skip!=null){r.skip(t.skip)}if(t.sort!=null){r.sort(t.sort)}return r};GridFSBucket.prototype.openDownloadStreamByName=function(e,t){var r={uploadDate:-1};var n=null;if(t&&t.revision!=null){if(t.revision>=0){r={uploadDate:1};n=t.revision}else{n=-t.revision-1}}var s={filename:e};t={sort:r,skip:n,start:t&&t.start,end:t&&t.end};return new o(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,s,t)};GridFSBucket.prototype.rename=function(e,t,r){return l(this.s.db.s.topology,_rename,[this,e,t,r],{skipSessions:true})};function _rename(e,t,r,n){var o={_id:t};var s={$set:{filename:r}};e.s._filesCollection.updateOne(o,s,(function(e,r){if(e){return n(e)}if(!r.result.n){return n(a("File with id "+t+" not found"))}n()}))}GridFSBucket.prototype.drop=function(e){return l(this.s.db.s.topology,_drop,[this,e],{skipSessions:true})};GridFSBucket.prototype.getLogger=function(){return this.s.db.s.logger};function _drop(e,t){e.s._filesCollection.drop((function(r){if(r){return t(r)}e.s._chunksCollection.drop((function(e){if(e){return t(e)}return t()}))}))}},1413:(e,t,r)=>{"use strict";var n=r(3994);var o=r(6417);var s=r(2413);var i=r(1669);var a=r(1867).Buffer;var c=26;e.exports=GridFSBucketWriteStream;function GridFSBucketWriteStream(e,t,r){r=r||{};s.Writable.call(this,r);this.bucket=e;this.chunks=e.s._chunksCollection;this.filename=t;this.files=e.s._filesCollection;this.options=r;this.done=false;this.id=r.id?r.id:n.BSON.ObjectId();this.chunkSizeBytes=this.options.chunkSizeBytes;this.bufToStore=a.alloc(this.chunkSizeBytes);this.length=0;this.md5=!r.disableMD5&&o.createHash("md5");this.n=0;this.pos=0;this.state={streamEnd:false,outstandingRequests:0,errored:false,aborted:false,promiseLibrary:this.bucket.s.promiseLibrary};if(!this.bucket.s.calledOpenUploadStream){this.bucket.s.calledOpenUploadStream=true;var i=this;checkIndexes(this,(function(){i.bucket.s.checkedIndexes=true;i.bucket.emit("index")}))}}i.inherits(GridFSBucketWriteStream,s.Writable);GridFSBucketWriteStream.prototype.write=function(e,t,r){var n=this;return waitForIndexes(this,(function(){return doWrite(n,e,t,r)}))};GridFSBucketWriteStream.prototype.abort=function(e){if(this.state.streamEnd){var t=new Error("Cannot abort a stream that has already completed");if(typeof e==="function"){return e(t)}return this.state.promiseLibrary.reject(t)}if(this.state.aborted){t=new Error("Cannot call abort() on a stream twice");if(typeof e==="function"){return e(t)}return this.state.promiseLibrary.reject(t)}this.state.aborted=true;this.chunks.deleteMany({files_id:this.id},(function(t){if(typeof e==="function")e(t)}))};GridFSBucketWriteStream.prototype.end=function(e,t,r){var n=this;if(typeof e==="function"){r=e,e=null,t=null}else if(typeof t==="function"){r=t,t=null}if(checkAborted(this,r)){return}this.state.streamEnd=true;if(r){this.once("finish",(function(e){r(null,e)}))}if(!e){waitForIndexes(this,(function(){writeRemnant(n)}));return}this.write(e,t,(function(){writeRemnant(n)}))};function __handleError(e,t,r){if(e.state.errored){return}e.state.errored=true;if(r){return r(t)}e.emit("error",t)}function createChunkDoc(e,t,r){return{_id:n.BSON.ObjectId(),files_id:e,n:t,data:r}}function checkChunksIndex(e,t){e.chunks.listIndexes().toArray((function(r,n){if(r){if(r.code===c){var o={files_id:1,n:1};e.chunks.createIndex(o,{background:false,unique:true},(function(e){if(e){return t(e)}t()}));return}return t(r)}var s=false;n.forEach((function(e){if(e.key){var t=Object.keys(e.key);if(t.length===2&&e.key.files_id===1&&e.key.n===1){s=true}}}));if(s){t()}else{o={files_id:1,n:1};var i=getWriteOptions(e);i.background=false;i.unique=true;e.chunks.createIndex(o,i,(function(e){if(e){return t(e)}t()}))}}))}function checkDone(e,t){if(e.done)return true;if(e.state.streamEnd&&e.state.outstandingRequests===0&&!e.state.errored){e.done=true;var r=createFilesDoc(e.id,e.length,e.chunkSizeBytes,e.md5&&e.md5.digest("hex"),e.filename,e.options.contentType,e.options.aliases,e.options.metadata);if(checkAborted(e,t)){return false}e.files.insertOne(r,getWriteOptions(e),(function(n){if(n){return __handleError(e,n,t)}e.emit("finish",r);e.emit("close")}));return true}return false}function checkIndexes(e,t){e.files.findOne({},{_id:1},(function(r,n){if(r){return t(r)}if(n){return t()}e.files.listIndexes().toArray((function(r,n){if(r){if(r.code===c){var o={filename:1,uploadDate:1};e.files.createIndex(o,{background:false},(function(r){if(r){return t(r)}checkChunksIndex(e,t)}));return}return t(r)}var s=false;n.forEach((function(e){var t=Object.keys(e.key);if(t.length===2&&e.key.filename===1&&e.key.uploadDate===1){s=true}}));if(s){checkChunksIndex(e,t)}else{o={filename:1,uploadDate:1};var i=getWriteOptions(e);i.background=false;e.files.createIndex(o,i,(function(r){if(r){return t(r)}checkChunksIndex(e,t)}))}}))}))}function createFilesDoc(e,t,r,n,o,s,i,a){var c={_id:e,length:t,chunkSize:r,uploadDate:new Date,filename:o};if(n){c.md5=n}if(s){c.contentType=s}if(i){c.aliases=i}if(a){c.metadata=a}return c}function doWrite(e,t,r,n){if(checkAborted(e,n)){return false}var o=a.isBuffer(t)?t:a.from(t,r);e.length+=o.length;if(e.pos+o.length<e.chunkSizeBytes){o.copy(e.bufToStore,e.pos);e.pos+=o.length;n&&n();return true}var s=o.length;var i=e.chunkSizeBytes-e.pos;var c=Math.min(i,o.length);var l=0;while(s>0){var u=o.length-s;o.copy(e.bufToStore,e.pos,u,u+c);e.pos+=c;i-=c;if(i===0){if(e.md5){e.md5.update(e.bufToStore)}var d=createChunkDoc(e.id,e.n,a.from(e.bufToStore));++e.state.outstandingRequests;++l;if(checkAborted(e,n)){return false}e.chunks.insertOne(d,getWriteOptions(e),(function(t){if(t){return __handleError(e,t)}--e.state.outstandingRequests;--l;if(!l){e.emit("drain",d);n&&n();checkDone(e)}}));i=e.chunkSizeBytes;e.pos=0;++e.n}s-=c;c=Math.min(i,s)}return false}function getWriteOptions(e){var t={};if(e.options.writeConcern){t.w=e.options.writeConcern.w;t.wtimeout=e.options.writeConcern.wtimeout;t.j=e.options.writeConcern.j}return t}function waitForIndexes(e,t){if(e.bucket.s.checkedIndexes){return t(false)}e.bucket.once("index",(function(){t(true)}));return true}function writeRemnant(e,t){if(e.pos===0){return checkDone(e,t)}++e.state.outstandingRequests;var r=a.alloc(e.pos);e.bufToStore.copy(r,0,0,e.pos);if(e.md5){e.md5.update(r)}var n=createChunkDoc(e.id,e.n,r);if(checkAborted(e,t)){return false}e.chunks.insertOne(n,getWriteOptions(e),(function(t){if(t){return __handleError(e,t)}--e.state.outstandingRequests;checkDone(e)}))}function checkAborted(e,t){if(e.state.aborted){if(typeof t==="function"){t(new Error("this stream has been aborted"))}return true}return false}},3890:(e,t,r)=>{"use strict";var n=r(3994).BSON.Binary,o=r(3994).BSON.ObjectID;var s=r(1867).Buffer;var Chunk=function(e,t,r){if(!(this instanceof Chunk))return new Chunk(e,t);this.file=e;var i=t==null?{}:t;this.writeConcern=r||{w:1};this.objectId=i._id==null?new o:i._id;this.chunkNumber=i.n==null?0:i.n;this.data=new n;if(typeof i.data==="string"){var a=s.alloc(i.data.length);a.write(i.data,0,i.data.length,"binary");this.data=new n(a)}else if(Array.isArray(i.data)){a=s.alloc(i.data.length);var c=i.data.join("");a.write(c,0,c.length,"binary");this.data=new n(a)}else if(i.data&&i.data._bsontype==="Binary"){this.data=i.data}else if(!s.isBuffer(i.data)&&!(i.data==null)){throw Error("Illegal chunk format")}this.internalPosition=0};Chunk.prototype.write=function(e,t){this.data.write(e,this.internalPosition,e.length,"binary");this.internalPosition=this.data.length();if(t!=null)return t(null,this);return this};Chunk.prototype.read=function(e){e=e==null||e===0?this.length():e;if(this.length()-this.internalPosition+1>=e){var t=this.data.read(this.internalPosition,e);this.internalPosition=this.internalPosition+e;return t}else{return""}};Chunk.prototype.readSlice=function(e){if(this.length()-this.internalPosition>=e){var t=null;if(this.data.buffer!=null){t=this.data.buffer.slice(this.internalPosition,this.internalPosition+e)}else{t=s.alloc(e);e=this.data.readInto(t,this.internalPosition)}this.internalPosition=this.internalPosition+e;return t}else{return null}};Chunk.prototype.eof=function(){return this.internalPosition===this.length()?true:false};Chunk.prototype.getc=function(){return this.read(1)};Chunk.prototype.rewind=function(){this.internalPosition=0;this.data=new n};Chunk.prototype.save=function(e,t){var r=this;if(typeof e==="function"){t=e;e={}}r.file.chunkCollection((function(n,o){if(n)return t(n);var s={upsert:true};for(var i in e)s[i]=e[i];for(i in r.writeConcern)s[i]=r.writeConcern[i];if(r.data.length()>0){r.buildMongoObject((function(e){var n={forceServerObjectId:true};for(var i in r.writeConcern){n[i]=r.writeConcern[i]}o.replaceOne({_id:r.objectId},e,s,(function(e){t(e,r)}))}))}else{t(null,r)}}))};Chunk.prototype.buildMongoObject=function(e){var t={files_id:this.file.fileId,n:this.chunkNumber,data:this.data};if(this.objectId!=null)t._id=this.objectId;e(t)};Chunk.prototype.length=function(){return this.data.length()};Object.defineProperty(Chunk.prototype,"position",{enumerable:true,get:function(){return this.internalPosition},set:function(e){this.internalPosition=e}});Chunk.DEFAULT_CHUNK_SIZE=1024*255;e.exports=Chunk},9406:(e,t,r)=>{"use strict";const n=r(3890);const o=r(3994).BSON.ObjectID;const s=r(3994).ReadPreference;const i=r(1867).Buffer;const a=r(5747);const c=r(1669).format;const l=r(1669);const u=r(3994).MongoError;const d=l.inherits;const p=r(2413).Duplex;const h=r(1371).shallowClone;const m=r(1371).executeLegacyOperation;const y=r(1669).deprecate;var g=0,v=1;const b=y((()=>{}),"GridStore is deprecated, and will be removed in a future version. Please use GridFSBucket instead");var S=function GridStore(e,t,r,i,a){b();if(!(this instanceof GridStore))return new GridStore(e,t,r,i,a);this.db=e;if(typeof a==="undefined")a={};if(typeof i==="undefined"){i=r;r=undefined}else if(typeof i==="object"){a=i;i=r;r=undefined}if(t&&t._bsontype==="ObjectID"){this.referenceBy=v;this.fileId=t;this.filename=r}else if(typeof r==="undefined"){this.referenceBy=g;this.filename=t;if(i.indexOf("w")!=null){this.fileId=new o}}else{this.referenceBy=v;this.fileId=t;this.filename=r}this.mode=i==null?"r":i;this.options=a||{};this.isOpen=false;this.root=this.options["root"]==null?GridStore.DEFAULT_ROOT_COLLECTION:this.options["root"];this.position=0;this.readPreference=this.options.readPreference||e.options.readPreference||s.primary;this.writeConcern=_getWriteConcern(e,this.options);this.internalChunkSize=this.options["chunkSize"]==null?n.DEFAULT_CHUNK_SIZE:this.options["chunkSize"];var c=this.options.promiseLibrary||Promise;this.promiseLibrary=c;Object.defineProperty(this,"chunkSize",{enumerable:true,get:function(){return this.internalChunkSize},set:function(e){if(!(this.mode[0]==="w"&&this.position===0&&this.uploadDate==null)){this.internalChunkSize=this.internalChunkSize}else{this.internalChunkSize=e}}});Object.defineProperty(this,"md5",{enumerable:true,get:function(){return this.internalMd5}});Object.defineProperty(this,"chunkNumber",{enumerable:true,get:function(){return this.currentChunk&&this.currentChunk.chunkNumber?this.currentChunk.chunkNumber:null}})};S.prototype.open=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};if(this.mode!=="w"&&this.mode!=="w+"&&this.mode!=="r"){throw u.create({message:"Illegal mode "+this.mode,driver:true})}return m(this.db.s.topology,open,[this,e,t],{skipSessions:true})};var open=function(e,t,r){var n=_getWriteConcern(e.db,e.options);if(e.mode==="w"||e.mode==="w+"){var o=e.collection();o.ensureIndex([["filename",1]],n,(function(){var t=e.chunkCollection();var o=h(n);o.unique=true;t.ensureIndex([["files_id",1],["n",1]],o,(function(){_open(e,n,(function(t,n){if(t)return r(t);e.isOpen=true;r(t,n)}))}))}))}else{_open(e,n,(function(t,n){if(t)return r(t);e.isOpen=true;r(t,n)}))}};S.prototype.eof=function(){return this.position===this.length?true:false};S.prototype.getc=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};return m(this.db.s.topology,getc,[this,e,t],{skipSessions:true})};var getc=function(e,t,r){if(e.eof()){r(null,null)}else if(e.currentChunk.eof()){nthChunk(e,e.currentChunk.chunkNumber+1,(function(t,n){e.currentChunk=n;e.position=e.position+1;r(t,e.currentChunk.getc())}))}else{e.position=e.position+1;r(null,e.currentChunk.getc())}};S.prototype.puts=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};var n=e.match(/\n$/)==null?e+"\n":e;return m(this.db.s.topology,this.write.bind(this),[n,t,r],{skipSessions:true})};S.prototype.stream=function(){return new GridStoreStream(this)};S.prototype.write=function write(e,t,r,n){if(typeof r==="function")n=r,r={};r=r||{};return m(this.db.s.topology,_writeNormal,[this,e,t,r,n],{skipSessions:true})};S.prototype.destroy=function destroy(){if(!this.writable)return;this.readable=false;if(this.writable){this.writable=false;this._q.length=0;this.emit("close")}};S.prototype.writeFile=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};return m(this.db.s.topology,writeFile,[this,e,t,r],{skipSessions:true})};var writeFile=function(e,t,r,o){if(typeof t==="string"){a.open(t,"r",(function(t,r){if(t)return o(t);e.writeFile(r,o)}));return}e.open((function(e,r){if(e)return o(e,r);a.fstat(t,(function(e,s){if(e)return o(e,r);var c=0;var l=0;var writeChunk=function(){var e=i.alloc(r.chunkSize);a.read(t,e,0,e.length,c,(function(e,i,u){if(e)return o(e,r);c=c+i;var d=new n(r,{n:l++},r.writeConcern);d.write(u.slice(0,i),(function(e,n){if(e)return o(e,r);n.save({},(function(e){if(e)return o(e,r);r.position=r.position+i;r.currentChunk=n;if(c>=s.size){a.close(t,(function(e){if(e)return o(e);r.close((function(e){if(e)return o(e,r);return o(null,r)}))}))}else{return process.nextTick(writeChunk)}}))}))}))};process.nextTick(writeChunk)}))}))};S.prototype.close=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};return m(this.db.s.topology,close,[this,e,t],{skipSessions:true})};var close=function(e,t,r){if(e.mode[0]==="w"){t=Object.assign({},e.writeConcern,t);if(e.currentChunk!=null&&e.currentChunk.position>0){e.currentChunk.save({},(function(n){if(n&&typeof r==="function")return r(n);e.collection((function(n,o){if(n&&typeof r==="function")return r(n);if(e.uploadDate!=null){buildMongoObject(e,(function(e,n){if(e){if(typeof r==="function")return r(e);else throw e}o.save(n,t,(function(e){if(typeof r==="function")r(e,n)}))}))}else{e.uploadDate=new Date;buildMongoObject(e,(function(e,n){if(e){if(typeof r==="function")return r(e);else throw e}o.save(n,t,(function(e){if(typeof r==="function")r(e,n)}))}))}}))}))}else{e.collection((function(n,o){if(n&&typeof r==="function")return r(n);e.uploadDate=new Date;buildMongoObject(e,(function(e,n){if(e){if(typeof r==="function")return r(e);else throw e}o.save(n,t,(function(e){if(typeof r==="function")r(e,n)}))}))}))}}else if(e.mode[0]==="r"){if(typeof r==="function")r(null,null)}else{if(typeof r==="function")r(u.create({message:c("Illegal mode %s",e.mode),driver:true}))}};S.prototype.chunkCollection=function(e){if(typeof e==="function")return this.db.collection(this.root+".chunks",e);return this.db.collection(this.root+".chunks")};S.prototype.unlink=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};return m(this.db.s.topology,unlink,[this,e,t],{skipSessions:true})};var unlink=function(e,t,r){deleteChunks(e,(function(t){if(t!==null){t.message="at deleteChunks: "+t.message;return r(t)}e.collection((function(t,n){if(t!==null){t.message="at collection: "+t.message;return r(t)}n.remove({_id:e.fileId},e.writeConcern,(function(t){r(t,e)}))}))}))};S.prototype.collection=function(e){if(typeof e==="function")this.db.collection(this.root+".files",e);return this.db.collection(this.root+".files")};S.prototype.readlines=function(e,t,r){var n=Array.prototype.slice.call(arguments,0);r=typeof n[n.length-1]==="function"?n.pop():undefined;e=n.length?n.shift():"\n";e=e||"\n";t=n.length?n.shift():{};return m(this.db.s.topology,readlines,[this,e,t,r],{skipSessions:true})};var readlines=function(e,t,r,n){e.read((function(e,r){if(e)return n(e);var o=r.toString().split(t);o=o.length>0?o.splice(0,o.length-1):[];for(var s=0;s<o.length;s++){o[s]=o[s]+t}n(null,o)}))};S.prototype.rewind=function(e,t){if(typeof e==="function")t=e,e={};e=e||{};return m(this.db.s.topology,rewind,[this,e,t],{skipSessions:true})};var rewind=function(e,t,r){if(e.currentChunk.chunkNumber!==0){if(e.mode[0]==="w"){deleteChunks(e,(function(t){if(t)return r(t);e.currentChunk=new n(e,{n:0},e.writeConcern);e.position=0;r(null,e)}))}else{e.currentChunk(0,(function(t,n){if(t)return r(t);e.currentChunk=n;e.currentChunk.rewind();e.position=0;r(null,e)}))}}else{e.currentChunk.rewind();e.position=0;r(null,e)}};S.prototype.read=function(e,t,r,n){var o=Array.prototype.slice.call(arguments,0);n=typeof o[o.length-1]==="function"?o.pop():undefined;e=o.length?o.shift():null;t=o.length?o.shift():null;r=o.length?o.shift():{};return m(this.db.s.topology,read,[this,e,t,r,n],{skipSessions:true})};var read=function(e,t,r,n,o){var s=t==null?e.length-e.position:t;var a=r==null?i.alloc(s):r;a._index=r!=null&&r._index!=null?r._index:0;if(e.currentChunk.length()-e.currentChunk.position+a._index>=s){var c=e.currentChunk.readSlice(s-a._index);c.copy(a,a._index);e.position=e.position+a.length;if(s===0&&a.length===0)return o(u.create({message:"File does not exist",driver:true}),null);return o(null,a)}c=e.currentChunk.readSlice(e.currentChunk.length()-e.currentChunk.position);c.copy(a,a._index);a._index+=c.length;nthChunk(e,e.currentChunk.chunkNumber+1,(function(r,n){if(r)return o(r);if(n.length()>0){e.currentChunk=n;e.read(t,a,o)}else{if(a._index>0){o(null,a)}else{o(u.create({message:"no chunks found for file, possibly corrupt",driver:true}),null)}}}))};S.prototype.tell=function(e){var t=this;if(typeof e==="function")return e(null,this.position);return new t.promiseLibrary((function(e){e(t.position)}))};S.prototype.seek=function(e,t,r,n){var o=Array.prototype.slice.call(arguments,1);n=typeof o[o.length-1]==="function"?o.pop():undefined;t=o.length?o.shift():null;r=o.length?o.shift():{};return m(this.db.s.topology,seek,[this,e,t,r,n],{skipSessions:true})};var seek=function(e,t,r,n,o){if(e.mode!=="r"){return o(u.create({message:"seek is only supported for mode r",driver:true}))}var s=r==null?S.IO_SEEK_SET:r;var i=t;var a=0;if(s===S.IO_SEEK_CUR){a=e.position+i}else if(s===S.IO_SEEK_END){a=e.length+i}else{a=i}var c=Math.floor(a/e.chunkSize);var seekChunk=function(){nthChunk(e,c,(function(t,r){if(t)return o(t,null);if(r==null)return o(new Error("no chunk found"));e.currentChunk=r;e.position=a;e.currentChunk.position=e.position%e.chunkSize;o(t,e)}))};seekChunk()};var _open=function(e,t,r){var s=e.collection();var i=e.referenceBy===v?{_id:e.fileId}:{filename:e.filename};i=null==e.fileId&&e.filename==null?null:i;t.readPreference=e.readPreference;if(i!=null){s.findOne(i,t,(function(s,i){if(s){return error(s)}if(i!=null){e.fileId=i._id;e.filename=e.mode==="r"||e.filename===undefined?i.filename:e.filename;e.contentType=i.contentType;e.internalChunkSize=i.chunkSize;e.uploadDate=i.uploadDate;e.aliases=i.aliases;e.length=i.length;e.metadata=i.metadata;e.internalMd5=i.md5}else if(e.mode!=="r"){e.fileId=e.fileId==null?new o:e.fileId;e.contentType=S.DEFAULT_CONTENT_TYPE;e.internalChunkSize=e.internalChunkSize==null?n.DEFAULT_CHUNK_SIZE:e.internalChunkSize;e.length=0}else{e.length=0;var a=e.fileId._bsontype==="ObjectID"?e.fileId.toHexString():e.fileId;return error(u.create({message:c("file with id %s not opened for writing",e.referenceBy===v?a:e.filename),driver:true}),e)}if(e.mode==="r"){nthChunk(e,0,t,(function(t,n){if(t)return error(t);e.currentChunk=n;e.position=0;r(null,e)}))}else if(e.mode==="w"&&i){deleteChunks(e,t,(function(t){if(t)return error(t);e.currentChunk=new n(e,{n:0},e.writeConcern);e.contentType=e.options["content_type"]==null?e.contentType:e.options["content_type"];e.internalChunkSize=e.options["chunk_size"]==null?e.internalChunkSize:e.options["chunk_size"];e.metadata=e.options["metadata"]==null?e.metadata:e.options["metadata"];e.aliases=e.options["aliases"]==null?e.aliases:e.options["aliases"];e.position=0;r(null,e)}))}else if(e.mode==="w"){e.currentChunk=new n(e,{n:0},e.writeConcern);e.contentType=e.options["content_type"]==null?e.contentType:e.options["content_type"];e.internalChunkSize=e.options["chunk_size"]==null?e.internalChunkSize:e.options["chunk_size"];e.metadata=e.options["metadata"]==null?e.metadata:e.options["metadata"];e.aliases=e.options["aliases"]==null?e.aliases:e.options["aliases"];e.position=0;r(null,e)}else if(e.mode==="w+"){nthChunk(e,lastChunkNumber(e),t,(function(t,o){if(t)return error(t);e.currentChunk=o==null?new n(e,{n:0},e.writeConcern):o;e.currentChunk.position=e.currentChunk.data.length();e.metadata=e.options["metadata"]==null?e.metadata:e.options["metadata"];e.aliases=e.options["aliases"]==null?e.aliases:e.options["aliases"];e.position=e.length;r(null,e)}))}}))}else{e.fileId=null==e.fileId?new o:e.fileId;e.contentType=S.DEFAULT_CONTENT_TYPE;e.internalChunkSize=e.internalChunkSize==null?n.DEFAULT_CHUNK_SIZE:e.internalChunkSize;e.length=0;if(e.mode==="w"){deleteChunks(e,t,(function(t){if(t)return error(t);e.currentChunk=new n(e,{n:0},e.writeConcern);e.contentType=e.options["content_type"]==null?e.contentType:e.options["content_type"];e.internalChunkSize=e.options["chunk_size"]==null?e.internalChunkSize:e.options["chunk_size"];e.metadata=e.options["metadata"]==null?e.metadata:e.options["metadata"];e.aliases=e.options["aliases"]==null?e.aliases:e.options["aliases"];e.position=0;r(null,e)}))}else if(e.mode==="w+"){nthChunk(e,lastChunkNumber(e),t,(function(t,o){if(t)return error(t);e.currentChunk=o==null?new n(e,{n:0},e.writeConcern):o;e.currentChunk.position=e.currentChunk.data.length();e.metadata=e.options["metadata"]==null?e.metadata:e.options["metadata"];e.aliases=e.options["aliases"]==null?e.aliases:e.options["aliases"];e.position=e.length;r(null,e)}))}}function error(e){if(error.err)return;r(error.err=e)}};var writeBuffer=function(e,t,r,o){if(typeof r==="function"){o=r;r=null}var s=typeof r==="boolean"?r:false;if(e.mode!=="w"){o(u.create({message:c("file with id %s not opened for writing",e.referenceBy===v?e.referenceBy:e.filename),driver:true}),null)}else{if(e.currentChunk.position+t.length>=e.chunkSize){var i=e.currentChunk.chunkNumber;var a=e.chunkSize-e.currentChunk.position;var l=t.slice(0,a);var d=t.slice(a);var p=[e.currentChunk.write(l)];while(d.length>=e.chunkSize){var h=new n(e,{n:i+1},e.writeConcern);l=d.slice(0,e.chunkSize);d=d.slice(e.chunkSize);i=i+1;h.write(l);p.push(h)}e.currentChunk=new n(e,{n:i+1},e.writeConcern);if(d.length>0)e.currentChunk.write(d);e.position=e.position+t.length;var m=p.length;for(var y=0;y<p.length;y++){p[y].save({},(function(t){if(t)return o(t);m=m-1;if(m<=0){if(s){return e.close((function(t){o(t,e)}))}return o(null,e)}}))}}else{e.position=e.position+t.length;e.currentChunk.write(t);if(s){return e.close((function(t){o(t,e)}))}return o(null,e)}}};var buildMongoObject=function(e,t){var r={_id:e.fileId,filename:e.filename,contentType:e.contentType,length:e.position?e.position:0,chunkSize:e.chunkSize,uploadDate:e.uploadDate,aliases:e.aliases,metadata:e.metadata};var n={filemd5:e.fileId,root:e.root};e.db.command(n,(function(e,n){if(e)return t(e);r.md5=n.md5;t(null,r)}))};var nthChunk=function(e,t,r,o){if(typeof r==="function"){o=r;r={}}r=r||e.writeConcern;r.readPreference=e.readPreference;e.chunkCollection().findOne({files_id:e.fileId,n:t},r,(function(t,r){if(t)return o(t);var s=r==null?{}:r;o(null,new n(e,s,e.writeConcern))}))};var lastChunkNumber=function(e){return Math.floor((e.length?e.length-1:0)/e.chunkSize)};var deleteChunks=function(e,t,r){if(typeof t==="function"){r=t;t={}}t=t||e.writeConcern;if(e.fileId!=null){e.chunkCollection().remove({files_id:e.fileId},t,(function(e){if(e)return r(e,false);r(null,true)}))}else{r(null,true)}};S.DEFAULT_ROOT_COLLECTION="fs";S.DEFAULT_CONTENT_TYPE="binary/octet-stream";S.IO_SEEK_SET=0;S.IO_SEEK_CUR=1;S.IO_SEEK_END=2;S.exist=function(e,t,r,n,o){var s=Array.prototype.slice.call(arguments,2);o=typeof s[s.length-1]==="function"?s.pop():undefined;r=s.length?s.shift():null;n=s.length?s.shift():{};n=n||{};return m(e.s.topology,exists,[e,t,r,n,o],{skipSessions:true})};var exists=function(e,t,r,n,o){var i=n.readPreference||s.PRIMARY;var a=r!=null?r:S.DEFAULT_ROOT_COLLECTION;e.collection(a+".files",(function(e,r){if(e)return o(e);var n=typeof t==="string"||Object.prototype.toString.call(t)==="[object RegExp]"?{filename:t}:{_id:t};if(t!=null&&typeof t==="object"&&Object.prototype.toString.call(t)!=="[object RegExp]"){n=t}r.findOne(n,{readPreference:i},(function(e,t){if(e)return o(e);o(null,t==null?false:true)}))}))};S.list=function(e,t,r,n){var o=Array.prototype.slice.call(arguments,1);n=typeof o[o.length-1]==="function"?o.pop():undefined;t=o.length?o.shift():null;r=o.length?o.shift():{};r=r||{};return m(e.s.topology,list,[e,t,r,n],{skipSessions:true})};var list=function(e,t,r,n){if(t!=null&&typeof t==="object"){r=t;t=null}var o=r.readPreference||s.primary;var i=r["id"]!=null?r["id"]:false;var a=t!=null?t:S.DEFAULT_ROOT_COLLECTION;var c=[];e.collection(a+".files",(function(e,t){if(e)return n(e);t.find({},{readPreference:o},(function(e,t){if(e)return n(e);t.each((function(e,t){if(t!=null){c.push(i?t._id:t.filename)}else{n(e,c)}}))}))}))};S.read=function(e,t,r,n,o,s){var i=Array.prototype.slice.call(arguments,2);s=typeof i[i.length-1]==="function"?i.pop():undefined;r=i.length?i.shift():null;n=i.length?i.shift():null;o=i.length?i.shift():null;o=o||{};return m(e.s.topology,readStatic,[e,t,r,n,o,s],{skipSessions:true})};var readStatic=function(e,t,r,n,o,s){new S(e,t,"r",o).open((function(e,t){if(e)return s(e);if(n&&n>=t.length)return s("offset larger than size of file",null);if(r&&r>t.length)return s("length is larger than the size of the file",null);if(n&&r&&n+r>t.length)return s("offset and length is larger than the size of the file",null);if(n!=null){t.seek(n,(function(e,t){if(e)return s(e);t.read(r,s)}))}else{t.read(r,s)}}))};S.readlines=function(e,t,r,n,o){var s=Array.prototype.slice.call(arguments,2);o=typeof s[s.length-1]==="function"?s.pop():undefined;r=s.length?s.shift():null;n=s.length?s.shift():null;n=n||{};return m(e.s.topology,readlinesStatic,[e,t,r,n,o],{skipSessions:true})};var readlinesStatic=function(e,t,r,n,o){var s=r==null?"\n":r;new S(e,t,"r",n).open((function(e,t){if(e)return o(e);t.readlines(s,o)}))};S.unlink=function(e,t,r,n){var o=Array.prototype.slice.call(arguments,2);n=typeof o[o.length-1]==="function"?o.pop():undefined;r=o.length?o.shift():{};r=r||{};return m(e.s.topology,unlinkStatic,[this,e,t,r,n],{skipSessions:true})};var unlinkStatic=function(e,t,r,n,o){var s=_getWriteConcern(t,n);if(r.constructor===Array){var i=0;for(var a=0;a<r.length;a++){++i;S.unlink(t,r[a],n,(function(){if(--i===0){o(null,e)}}))}}else{new S(t,r,"w",n).open((function(t,r){if(t)return o(t);deleteChunks(r,(function(t){if(t)return o(t);r.collection((function(t,n){if(t)return o(t);n.remove({_id:r.fileId},s,(function(t){o(t,e)}))}))}))}))}};var _writeNormal=function(e,t,r,n,o){if(i.isBuffer(t)){return writeBuffer(e,t,r,o)}else{return writeBuffer(e,i.from(t,"binary"),r,o)}};var _setWriteConcernHash=function(e){const t=Object.assign(e,e.writeConcern);var r={};if(t.w!=null)r.w=t.w;if(t.journal===true)r.j=t.journal;if(t.j===true)r.j=t.j;if(t.fsync===true)r.fsync=t.fsync;if(t.wtimeout!=null)r.wtimeout=t.wtimeout;return r};var _getWriteConcern=function(e,t){var r={w:1};t=t||{};if(t.writeConcern!=null||t.w!=null||typeof t.j==="boolean"||typeof t.journal==="boolean"||typeof t.fsync==="boolean"){r=_setWriteConcernHash(t)}else if(t.safe!=null&&typeof t.safe==="object"){r=_setWriteConcernHash(t.safe)}else if(typeof t.safe==="boolean"){r={w:t.safe?1:0}}else if(e.options.writeConcern!=null||e.options.w!=null||typeof e.options.j==="boolean"||typeof e.options.journal==="boolean"||typeof e.options.fsync==="boolean"){r=_setWriteConcernHash(e.options)}else if(e.safe&&(e.safe.w!=null||typeof e.safe.j==="boolean"||typeof e.safe.journal==="boolean"||typeof e.safe.fsync==="boolean")){r=_setWriteConcernHash(e.safe)}else if(typeof e.safe==="boolean"){r={w:e.safe?1:0}}if(r.w<1&&(r.journal===true||r.j===true||r.fsync===true))throw u.create({message:"No acknowledgement using w < 1 cannot be combined with journal:true or fsync:true",driver:true});return r};var GridStoreStream=function(e){p.call(this);this.gs=e;this.endCalled=false;this.totalBytesToRead=this.gs.length-this.gs.position;this.seekPosition=this.gs.position};d(GridStoreStream,p);GridStoreStream.prototype._pipe=GridStoreStream.prototype.pipe;GridStoreStream.prototype.pipe=function(e){var t=this;if(!t.gs.isOpen){t.gs.open((function(r){if(r)return t.emit("error",r);t.totalBytesToRead=t.gs.length-t.gs.position;t._pipe.apply(t,[e])}))}else{t.totalBytesToRead=t.gs.length-t.gs.position;t._pipe.apply(t,[e])}return e};GridStoreStream.prototype._read=function(){var e=this;var read=function(){e.gs.read(t,(function(t,r){if(t&&!e.endCalled)return e.emit("error",t);if(e.endCalled||r==null)return e.push(null);if(r.length<=e.totalBytesToRead){e.totalBytesToRead=e.totalBytesToRead-r.length;e.push(r)}else if(r.length>e.totalBytesToRead){e.totalBytesToRead=e.totalBytesToRead-r._index;e.push(r.slice(0,r._index))}if(e.totalBytesToRead<=0){e.endCalled=true}}))};var t=e.gs.length<e.gs.chunkSize?e.gs.length-e.seekPosition:e.gs.chunkSize;if(!e.gs.isOpen){e.gs.open((function(t){e.totalBytesToRead=e.gs.length-e.gs.position;if(t)return e.emit("error",t);read()}))}else{read()}};GridStoreStream.prototype.destroy=function(){this.pause();this.endCalled=true;this.gs.close();this.emit("end")};GridStoreStream.prototype.write=function(e){var t=this;if(t.endCalled)return t.emit("error",u.create({message:"attempting to write to stream after end called",driver:true}));if(!t.gs.isOpen){t.gs.open((function(){t.gs.isOpen=true;t.gs.write(e,(function(){process.nextTick((function(){t.emit("drain")}))}))}));return false}else{t.gs.write(e,(function(){t.emit("drain")}));return true}};GridStoreStream.prototype.end=function(e,t,r){var n=this;var o=Array.prototype.slice.call(arguments,0);r=typeof o[o.length-1]==="function"?o.pop():undefined;e=o.length?o.shift():null;t=o.length?o.shift():null;n.endCalled=true;if(e){n.gs.write(e,(function(){n.gs.close((function(){if(typeof r==="function")r();n.emit("end")}))}))}n.gs.close((function(){if(typeof r==="function")r();n.emit("end")}))};e.exports=S},1545:(e,t,r)=>{"use strict";const n=r(1117);const o=r(6662);const s=r(8614).EventEmitter;const i=r(1669).inherits;const a=r(3994).MongoError;const c=r(1669).deprecate;const l=r(2481);const u=r(1371).MongoDBNamespace;const d=r(4485);const p=r(1371).maybePromise;const h=r(2632);const m=r(5210).connect;const y=r(5210).validOptions;function MongoClient(e,t){if(!(this instanceof MongoClient))return new MongoClient(e,t);s.call(this);if(t&&t.autoEncryption)r(3012);this.s={url:e,options:t||{},promiseLibrary:t&&t.promiseLibrary||Promise,dbCache:new Map,sessions:new Set,writeConcern:l.fromOptions(t),readPreference:d.fromOptions(t)||d.primary,namespace:new u("admin")}}i(MongoClient,s);Object.defineProperty(MongoClient.prototype,"writeConcern",{enumerable:true,get:function(){return this.s.writeConcern}});Object.defineProperty(MongoClient.prototype,"readPreference",{enumerable:true,get:function(){return this.s.readPreference}});MongoClient.prototype.connect=function(e){if(typeof e==="string"){throw new TypeError("`connect` only accepts a callback")}const t=this;return p(this,e,(e=>{const r=y(t.s.options);if(r)return e(r);m(t,t.s.url,t.s.options,(r=>{if(r)return e(r);e(null,t)}))}))};MongoClient.prototype.logout=c((function(e,t){if(typeof e==="function")t=e,e={};if(typeof t==="function")t(null,true)}),"Multiple authentication is prohibited on a connected client, please only authenticate once per MongoClient");MongoClient.prototype.close=function(e,t){if(typeof e==="function"){t=e;e=false}const r=this;return p(this,t,(t=>{const completeClose=e=>{r.emit("close",r);if(!(r.topology instanceof h)){for(const e of r.s.dbCache){e[1].emit("close",r)}}r.removeAllListeners("close");t(e)};if(r.topology==null){completeClose();return}r.topology.close(e,(t=>{const n=r.topology.s.options.encrypter;if(n){return n.close(r,e,(e=>{completeClose(t||e)}))}completeClose(t)}))}))};MongoClient.prototype.db=function(e,t){t=t||{};if(!e){e=this.s.options.dbName}const r=Object.assign({},this.s.options,t);if(this.s.dbCache.has(e)&&r.returnNonCachedInstance!==true){return this.s.dbCache.get(e)}r.promiseLibrary=this.s.promiseLibrary;if(!this.topology){throw new a("MongoClient must be connected before calling MongoClient.prototype.db")}const n=new o(e,this.topology,r);this.s.dbCache.set(e,n);return n};MongoClient.prototype.isConnected=function(e){e=e||{};if(!this.topology)return false;return this.topology.isConnected(e)};MongoClient.connect=function(e,t,r){const n=Array.prototype.slice.call(arguments,1);r=typeof n[n.length-1]==="function"?n.pop():undefined;t=n.length?n.shift():null;t=t||{};const o=new MongoClient(e,t);return o.connect(r)};MongoClient.prototype.startSession=function(e){e=Object.assign({explicit:true},e);if(!this.topology){throw new a("Must connect to a server before calling this method")}return this.topology.startSession(e,this.s.options)};MongoClient.prototype.withSession=function(e,t){if(typeof e==="function")t=e,e=undefined;const r=this.startSession(e);let cleanupHandler=(e,t,n)=>{cleanupHandler=()=>{throw new ReferenceError("cleanupHandler was called too many times")};n=Object.assign({throw:true},n);r.endSession();if(e){if(n.throw)throw e;return Promise.reject(e)}};try{const e=t(r);return Promise.resolve(e).then((e=>cleanupHandler(null,e))).catch((e=>cleanupHandler(e,null,{throw:true})))}catch(e){return cleanupHandler(e,null,{throw:false})}};MongoClient.prototype.watch=function(e,t){e=e||[];t=t||{};if(!Array.isArray(e)){t=e;e=[]}return new n(this,e,t)};MongoClient.prototype.getLogger=function(){return this.s.options.logger};e.exports=MongoClient},7057:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(499);const s=r(1018).defineAspects;const i=r(6417);const a=r(1371).handleCallback;const c=r(1371).toError;const l=r(1371).emitWarning;class AddUserOperation extends o{constructor(e,t,r,n){super(e,n);this.username=t;this.password=r}_buildCommand(){const e=this.db;const t=this.username;const r=this.password;const n=this.options;let o=[];if(Array.isArray(n.roles))o=n.roles;if(typeof n.roles==="string")o=[n.roles];if(o.length===0){l("Creating a user without roles is deprecated in MongoDB >= 2.6")}if((e.databaseName.toLowerCase()==="admin"||n.dbName==="admin")&&!Array.isArray(n.roles)){o=["root"]}else if(!Array.isArray(n.roles)){o=["dbOwner"]}const s=e.s.topology.lastIsMaster().maxWireVersion>=7;let a=r;if(!s){const e=i.createHash("md5");e.update(t+":mongo:"+r);a=e.digest("hex")}const c={createUser:t,customData:n.customData||{},roles:o,digestPassword:s};if(typeof r==="string"){c.pwd=a}return c}execute(e){const t=this.options;if(t.digestPassword!=null){return e(c("The digestPassword option is not supported via add_user. Please use db.command('createUser', ...) instead for this option."))}super.execute(((t,r)=>{if(!t){return a(e,t,r)}return a(e,t,null)}))}}s(AddUserOperation,n.WRITE_OPERATION);e.exports=AddUserOperation},1554:(e,t,r)=>{"use strict";const n=r(1189);const o=r(3994).MongoError;const s=r(1178).maxWireVersion;const i=r(3994).ReadPreference;const a=r(1018).Aspect;const c=r(1018).defineAspects;const l=1;const u=8;class AggregateOperation extends n{constructor(e,t,r){super(e,r,{fullResponse:true});this.target=e.s.namespace&&e.s.namespace.collection?e.s.namespace.collection:l;this.pipeline=t;this.hasWriteStage=false;if(typeof r.out==="string"){this.pipeline=this.pipeline.concat({$out:r.out});this.hasWriteStage=true}else if(t.length>0){const e=t[t.length-1];if(e.$out||e.$merge){this.hasWriteStage=true}}if(this.hasWriteStage){this.readPreference=i.primary}if(this.explain&&this.writeConcern){throw new o('"explain" cannot be used on an aggregate call with writeConcern')}if(r.cursor!=null&&typeof r.cursor!=="object"){throw new o("cursor options must be an object")}}get canRetryRead(){return!this.hasWriteStage}addToPipeline(e){this.pipeline.push(e)}execute(e,t){const r=this.options;const n=s(e);const o={aggregate:this.target,pipeline:this.pipeline};if(this.hasWriteStage&&n<u){this.readConcern=null}if(n>=5){if(this.hasWriteStage&&this.writeConcern){Object.assign(o,{writeConcern:this.writeConcern})}}if(r.bypassDocumentValidation===true){o.bypassDocumentValidation=r.bypassDocumentValidation}if(typeof r.allowDiskUse==="boolean"){o.allowDiskUse=r.allowDiskUse}if(r.hint){o.hint=r.hint}if(this.explain){r.full=false}o.cursor=r.cursor||{};if(r.batchSize&&!this.hasWriteStage){o.cursor.batchSize=r.batchSize}super.executeCommand(e,o,t)}}c(AggregateOperation,[a.READ_OPERATION,a.RETRYABLE,a.EXECUTE_WITH_SELECTION,a.EXPLAINABLE]);e.exports=AggregateOperation},6976:(e,t,r)=>{"use strict";const n=r(1371).applyRetryableWrites;const o=r(1371).applyWriteConcern;const s=r(3994).MongoError;const i=r(1018).OperationBase;class BulkWriteOperation extends i{constructor(e,t,r){super(r);this.collection=e;this.operations=t}execute(e){const t=this.collection;const r=this.operations;let i=this.options;if(t.s.options.ignoreUndefined){i=Object.assign({},i);i.ignoreUndefined=t.s.options.ignoreUndefined}const a=i.ordered===true||i.ordered==null?t.initializeOrderedBulkOp(i):t.initializeUnorderedBulkOp(i);let c=false;try{for(let e=0;e<r.length;e++){const t=Object.keys(r[e])[0];if(r[e][t].collation){c=true}a.raw(r[e])}}catch(t){return e(t,null)}let l=Object.assign({},i);l=n(l,t.s.db);l=o(l,{db:t.s.db,collection:t},i);const u=l.writeConcern?l.writeConcern:{};const d=t.s.topology.capabilities();if(c&&d&&!d.commandsTakeCollation){return e(new s("server/primary/mongos does not support collation"))}a.execute(u,l,((t,r)=>{if(!r&&t){return e(t,null)}e(null,r)}))}}e.exports=BulkWriteOperation},6716:(e,t,r)=>{"use strict";const n=r(1371).applyWriteConcern;const o=r(3994).BSON.Code;const s=r(2226).createIndex;const i=r(1371).decorateWithCollation;const a=r(1371).decorateWithReadConcern;const c=r(2226).ensureIndex;const l=r(2226).evaluate;const u=r(2226).executeCommand;const d=r(1371).handleCallback;const p=r(2226).indexInformation;const h=r(3994).BSON.Long;const m=r(3994).MongoError;const y=r(3994).ReadPreference;const g=r(2296).insertDocuments;const v=r(2296).updateDocuments;const b='function () {\nvar c = db[ns].find(condition);\nvar map = new Map();\nvar reduce_function = reduce;\n\nwhile (c.hasNext()) {\nvar obj = c.next();\nvar key = {};\n\nfor (var i = 0, len = keys.length; i < len; ++i) {\nvar k = keys[i];\nkey[k] = obj[k];\n}\n\nvar aggObj = map.get(key);\n\nif (aggObj == null) {\nvar newObj = Object.extend({}, key);\naggObj = Object.extend(newObj, initial);\nmap.put(key, aggObj);\n}\n\nreduce_function(obj, aggObj);\n}\n\nreturn { "result": map.values() };\n}';function createIndex(e,t,r,n){s(e.s.db,e.collectionName,t,r,n)}function createIndexes(e,t,r,n){const o=e.s.topology.capabilities();for(let e=0;e<t.length;e++){if(t[e].name==null){const r=[];if(t[e].collation&&o&&!o.commandsTakeCollation){return n(new m("server/primary/mongos does not support collation"))}for(let n in t[e].key){r.push(`${n}_${t[e].key[n]}`)}t[e].name=r.join("_")}}r=Object.assign({},r,{readPreference:y.PRIMARY});u(e.s.db,{createIndexes:e.collectionName,indexes:t},r,n)}function ensureIndex(e,t,r,n){c(e.s.db,e.collectionName,t,r,n)}function group(e,t,r,n,s,c,p,h,m){if(p){const l=s&&s._bsontype==="Code"?s:new o(s);const p={group:{ns:e.collectionName,$reduce:l,cond:r,initial:n,out:"inline"}};if(c!=null)p.group["finalize"]=c;if("function"===typeof t||t&&t._bsontype==="Code"){p.group.$keyf=t&&t._bsontype==="Code"?t:new o(t)}else{const e={};t.forEach((t=>{e[t]=1}));p.group.key=e}h=Object.assign({},h);h.readPreference=y.resolve(e,h);a(p,e,h);try{i(p,e,h)}catch(e){return m(e,null)}u(e.s.db,p,h,((e,t)=>{if(e)return d(m,e,null);d(m,null,t.retval)}))}else{const i=s!=null&&s._bsontype==="Code"?s.scope:{};i.ns=e.collectionName;i.keys=t;i.condition=r;i.initial=n;const a=b.replace(/ reduce;/,s.toString()+";");l(e.s.db,new o(a,i),null,h,((e,t)=>{if(e)return d(m,e,null);d(m,null,t.result||t)}))}}function indexes(e,t,r){t=Object.assign({},{full:true},t);p(e.s.db,e.collectionName,t,r)}function indexExists(e,t,r,n){indexInformation(e,r,((e,r)=>{if(e!=null)return d(n,e,null);if(!Array.isArray(t))return d(n,null,r[t]!=null);for(let e=0;e<t.length;e++){if(r[t[e]]==null){return d(n,null,false)}}return d(n,null,true)}))}function indexInformation(e,t,r){p(e.s.db,e.collectionName,t,r)}function parallelCollectionScan(e,t,r){const n={parallelCollectionScan:e.collectionName,numCursors:t.numCursors};a(n,e,t);const o=t.raw;delete t["raw"];u(e.s.db,n,t,((n,s)=>{if(n)return d(r,n,null);if(s==null)return d(r,new Error("no result returned for parallelCollectionScan"),null);t=Object.assign({explicitlyIgnoreSession:true},t);const i=[];if(o)t.raw=o;for(let r=0;r<s.cursors.length;r++){const n=s.cursors[r].cursor.id;const o=typeof n==="number"?h.fromNumber(n):n;i.push(e.s.topology.cursor(e.namespace,o,t))}d(r,null,i)}))}function save(e,t,r,o){const s=n(Object.assign({},r),{db:e.s.db,collection:e},r);if(t._id!=null){s.upsert=true;return v(e,{_id:t._id},t,s,o)}g(e,[t],s,((e,r)=>{if(o==null)return;if(t==null)return d(o,null,null);if(e)return d(o,e,null);d(o,null,r)}))}e.exports={createIndex:createIndex,createIndexes:createIndexes,ensureIndex:ensureIndex,group:group,indexes:indexes,indexExists:indexExists,indexInformation:indexInformation,parallelCollectionScan:parallelCollectionScan,save:save}},286:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(1371).handleCallback;let s;function loadCollection(){if(!s){s=r(5193)}return s}class CollectionsOperation extends n{constructor(e,t){super(t);this.db=e}execute(e){const t=this.db;let r=this.options;let n=loadCollection();r=Object.assign({},r,{nameOnly:true});t.listCollections({},r).toArray(((r,s)=>{if(r!=null)return o(e,r,null);s=s.filter((e=>e.name.indexOf("$")===-1));o(e,null,s.map((e=>new n(t,t.s.topology,t.databaseName,e.name,t.s.pkFactory,t.s.options))))}))}}e.exports=CollectionsOperation},499:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(1018).OperationBase;const s=r(1371).applyWriteConcern;const i=r(1371).debugOptions;const a=r(1371).handleCallback;const c=r(3994).MongoError;const l=r(3994).ReadPreference;const u=r(1371).MongoDBNamespace;const d=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"];class CommandOperation extends o{constructor(e,t,r,o){super(t);if(!this.hasAspect(n.WRITE_OPERATION)){if(r!=null){this.options.readPreference=l.resolve(r,t)}else{this.options.readPreference=l.resolve(e,t)}}else{if(r!=null){s(this.options,{db:e,coll:r},this.options)}else{s(this.options,{db:e},this.options)}this.options.readPreference=l.primary}this.db=e;if(o!=null){this.command=o}if(r!=null){this.collection=r}}_buildCommand(){if(this.command!=null){return this.command}}execute(e){const t=this.db;const r=Object.assign({},this.options);if(t.serverConfig&&t.serverConfig.isDestroyed()){return e(new c("topology was destroyed"))}let o;try{o=this._buildCommand()}catch(t){return e(t)}const s=r.dbName||r.authdb||t.databaseName;if(this.hasAspect(n.WRITE_OPERATION)){if(r.writeConcern&&(!r.session||!r.session.inTransaction())){o.writeConcern=r.writeConcern}}if(t.s.logger.isDebug()){t.s.logger.debug(`executing command ${JSON.stringify(o)} against ${s}.$cmd with options [${JSON.stringify(i(d,r))}]`)}const l=this.namespace!=null?this.namespace:new u(s,"$cmd");t.s.topology.command(l,o,r,((t,n)=>{if(t)return a(e,t);if(r.full)return a(e,null,n);a(e,null,n.result)}))}}e.exports=CommandOperation},1189:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(1018).OperationBase;const s=r(3994).ReadPreference;const i=r(7289);const a=r(2481);const c=r(1178).maxWireVersion;const l=r(1371).decorateWithExplain;const u=r(5474).commandSupportsReadConcern;const d=r(3111).MongoError;const p=5;class CommandOperationV2 extends o{constructor(e,t,r){super(t);this.ns=e.s.namespace.withCollection("$cmd");const o=this.hasAspect(n.NO_INHERIT_OPTIONS)?undefined:e;this.readPreference=this.hasAspect(n.WRITE_OPERATION)?s.primary:s.resolve(o,this.options);this.readConcern=resolveReadConcern(o,this.options);this.writeConcern=resolveWriteConcern(o,this.options);if(r&&typeof r.fullResponse==="boolean"){this.fullResponse=true}this.options.readPreference=this.readPreference;if(e.s.logger){this.logger=e.s.logger}else if(e.s.db&&e.s.db.logger){this.logger=e.s.db.logger}}executeCommand(e,t,r){this.server=e;const o=this.options;const s=c(e);const i=this.session&&this.session.inTransaction();if(this.readConcern&&u(t)&&!i){Object.assign(t,{readConcern:this.readConcern})}if(o.collation&&s<p){r(new d(`Server ${e.name}, which reports wire version ${s}, does not support collation`));return}if(s>=p){if(this.writeConcern&&this.hasAspect(n.WRITE_OPERATION)){Object.assign(t,{writeConcern:this.writeConcern})}if(o.collation&&typeof o.collation==="object"){Object.assign(t,{collation:o.collation})}}if(typeof o.maxTimeMS==="number"){t.maxTimeMS=o.maxTimeMS}if(typeof o.comment==="string"){t.comment=o.comment}if(this.hasAspect(n.EXPLAINABLE)&&this.explain){if(s<6&&t.aggregate){t.explain=true}else{t=l(t,this.explain)}}if(this.logger&&this.logger.isDebug()){this.logger.debug(`executing command ${JSON.stringify(t)} against ${this.ns}`)}e.command(this.ns.toString(),t,this.options,((e,t)=>{if(e){r(e,null);return}if(this.fullResponse){r(null,t);return}r(null,t.result)}))}}function resolveWriteConcern(e,t){return a.fromOptions(t)||e&&e.writeConcern}function resolveReadConcern(e,t){return i.fromOptions(t)||e&&e.readConcern}e.exports=CommandOperationV2},2296:(e,t,r)=>{"use strict";const n=r(1371).applyRetryableWrites;const o=r(1371).applyWriteConcern;const s=r(1371).decorateWithCollation;const i=r(1371).decorateWithReadConcern;const a=r(2226).executeCommand;const c=r(1371).formattedOrderClause;const l=r(1371).handleCallback;const u=r(3994).MongoError;const d=r(3994).ReadPreference;const p=r(1371).toError;const h=r(4847).CursorState;const m=r(1178).maxWireVersion;function buildCountCommand(e,t,r){const n=r.skip;const o=r.limit;let a=r.hint;const c=r.maxTimeMS;t=t||{};const l={count:r.collectionName,query:t};if(e.s.numberOfRetries){if(e.options.hint){a=e.options.hint}else if(e.cmd.hint){a=e.cmd.hint}s(l,e,e.cmd)}else{s(l,e,r)}if(typeof n==="number")l.skip=n;if(typeof o==="number")l.limit=o;if(typeof c==="number")l.maxTimeMS=c;if(a)l.hint=a;i(l,e);return l}function findAndModify(e,t,r,i,u,p){const h={findAndModify:e.collectionName,query:t};r=c(r);if(r){h.sort=r}h.new=u.new?true:false;h.remove=u.remove?true:false;h.upsert=u.upsert?true:false;const m=u.projection||u.fields;if(m){h.fields=m}if(u.arrayFilters){h.arrayFilters=u.arrayFilters;delete u.arrayFilters}if(i&&!u.remove){h.update=i}if(u.maxTimeMS)h.maxTimeMS=u.maxTimeMS;u.serializeFunctions=u.serializeFunctions||e.s.serializeFunctions;u.checkKeys=false;let y=Object.assign({},u);y=n(y,e.s.db);y=o(y,{db:e.s.db,collection:e},u);if(y.writeConcern){h.writeConcern=y.writeConcern}if(y.bypassDocumentValidation===true){h.bypassDocumentValidation=y.bypassDocumentValidation}y.readPreference=d.primary;try{s(h,e,y)}catch(e){return p(e,null)}a(e.s.db,h,y,((e,t)=>{if(e)return l(p,e,null);return l(p,null,t)}))}function indexInformation(e,t,r,n){const o=r["full"]==null?false:r["full"];if(e.serverConfig&&e.serverConfig.isDestroyed())return n(new u("topology was destroyed"));function processResults(e){let t={};for(let r=0;r<e.length;r++){const n=e[r];t[n.name]=[];for(let e in n.key){t[n.name].push([e,n.key[e]])}}return t}e.collection(t).listIndexes(r).toArray(((e,t)=>{if(e)return n(p(e));if(!Array.isArray(t))return l(n,null,[]);if(o)return l(n,null,t);l(n,null,processResults(t))}))}function prepareDocs(e,t,r){const n=typeof r.forceServerObjectId==="boolean"?r.forceServerObjectId:e.s.db.options.forceServerObjectId;if(n===true){return t}return t.map((t=>{if(n!==true&&t._id==null){t._id=e.s.pkFactory.createPk()}return t}))}function nextObject(e,t){if(e.s.state===h.CLOSED||e.isDead&&e.isDead()){return l(t,u.create({message:"Cursor is closed",driver:true}))}if(e.s.state===h.INIT&&e.cmd&&e.cmd.sort){try{e.cmd.sort=c(e.cmd.sort)}catch(e){return l(t,e)}}e._next(((r,n)=>{e.s.state=h.OPEN;if(r)return l(t,r);l(t,null,n)}))}function insertDocuments(e,t,r,s){if(typeof r==="function")s=r,r={};r=r||{};t=Array.isArray(t)?t:[t];let i=Object.assign({},r);i=n(i,e.s.db);i=o(i,{db:e.s.db,collection:e},r);if(i.keepGoing===true)i.ordered=false;i.serializeFunctions=r.serializeFunctions||e.s.serializeFunctions;t=prepareDocs(e,t,r);e.s.topology.insert(e.s.namespace,t,i,((e,r)=>{if(s==null)return;if(e)return l(s,e);if(r==null)return l(s,null,null);if(r.result.code)return l(s,p(r.result));if(r.result.writeErrors)return l(s,p(r.result.writeErrors[0]));r.ops=t;l(s,null,r)}))}function removeDocuments(e,t,r,i){if(typeof r==="function"){i=r,r={}}else if(typeof t==="function"){i=t;r={};t={}}r=r||{};let a=Object.assign({},r);a=n(a,e.s.db);a=o(a,{db:e.s.db,collection:e},r);if(t==null)t={};const c={q:t,limit:0};if(r.single){c.limit=1}else if(a.retryWrites){a.retryWrites=false}if(r.hint){c.hint=r.hint}try{s(a,e,r)}catch(e){return i(e,null)}if(r.explain!==undefined&&m(e.s.topology)<3){return i?i(new u(`server does not support explain on remove`)):undefined}e.s.topology.remove(e.s.namespace,[c],a,((e,t)=>{if(i==null)return;if(e)return l(i,e,null);if(t==null)return l(i,null,null);if(t.result.code)return l(i,p(t.result));if(t.result.writeErrors){return l(i,p(t.result.writeErrors[0]))}l(i,null,t)}))}function updateDocuments(e,t,r,i,a){if("function"===typeof i)a=i,i=null;if(i==null)i={};if(!("function"===typeof a))a=null;if(t==null||typeof t!=="object")return a(p("selector must be a valid JavaScript object"));if(r==null||typeof r!=="object")return a(p("document must be a valid JavaScript object"));let c=Object.assign({},i);c=n(c,e.s.db);c=o(c,{db:e.s.db,collection:e},i);c.serializeFunctions=i.serializeFunctions||e.s.serializeFunctions;const d={q:t,u:r};d.upsert=i.upsert!==void 0?!!i.upsert:false;d.multi=i.multi!==void 0?!!i.multi:false;if(i.hint){d.hint=i.hint}if(c.arrayFilters){d.arrayFilters=c.arrayFilters;delete c.arrayFilters}if(c.retryWrites&&d.multi){c.retryWrites=false}try{s(c,e,i)}catch(e){return a(e,null)}if(i.explain!==undefined&&m(e.s.topology)<3){return a?a(new u(`server does not support explain on update`)):undefined}e.s.topology.update(e.s.namespace,[d],c,((e,t)=>{if(a==null)return;if(e)return l(a,e,null);if(t==null)return l(a,null,null);if(t.result.code)return l(a,p(t.result));if(t.result.writeErrors)return l(a,p(t.result.writeErrors[0]));l(a,null,t)}))}e.exports={buildCountCommand:buildCountCommand,findAndModify:findAndModify,indexInformation:indexInformation,nextObject:nextObject,prepareDocs:prepareDocs,insertDocuments:insertDocuments,removeDocuments:removeDocuments,updateDocuments:updateDocuments}},5210:(e,t,r)=>{"use strict";const n=r(1669).deprecate;const o=r(3994).Logger;const s=r(3994).MongoCredentials;const i=r(3994).MongoError;const a=r(2048);const c=r(2632);const l=r(3994).parseConnectionString;const u=r(7289);const d=r(3994).ReadPreference;const p=r(382);const h=r(8421);const m=r(3994).Sessions.ServerSessionPool;const y=r(1371).emitDeprecationWarning;const g=r(1371).emitWarningOnce;const v=r(5747);const b=r(2481);const S=r(897).CMAP_EVENT_NAMES;let w;function loadClient(){if(!w){w=r(1545)}return w}const _=n(r(8729),"current URL string parser is deprecated, and will be removed in a future version. "+"To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect.");const E={DEFAULT:"default",PLAIN:"plain",GSSAPI:"gssapi","MONGODB-CR":"mongocr","MONGODB-X509":"x509","MONGODB-AWS":"mongodb-aws","SCRAM-SHA-1":"scram-sha-1","SCRAM-SHA-256":"scram-sha-256"};const O=["timeout","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha","all","fullsetup","open"];const C=new Set(["DEFAULT","PLAIN","GSSAPI","MONGODB-CR","MONGODB-X509","MONGODB-AWS","SCRAM-SHA-1","SCRAM-SHA-256"]);const T=["poolSize","ssl","sslValidate","sslCA","sslCert","sslKey","sslPass","sslCRL","autoReconnect","noDelay","keepAlive","keepAliveInitialDelay","connectTimeoutMS","family","socketTimeoutMS","reconnectTries","reconnectInterval","ha","haInterval","replicaSet","secondaryAcceptableLatencyMS","acceptableLatencyMS","connectWithNoPrimary","authSource","w","wtimeout","j","writeConcern","forceServerObjectId","serializeFunctions","ignoreUndefined","raw","bufferMaxEntries","readPreference","pkFactory","promiseLibrary","readConcern","maxStalenessSeconds","loggerLevel","logger","promoteValues","promoteBuffers","promoteLongs","domainsEnabled","checkServerIdentity","validateOptions","appname","auth","user","password","authMechanism","compression","fsync","readPreferenceTags","numberOfRetries","auto_reconnect","minSize","monitorCommands","retryWrites","retryReads","useNewUrlParser","useUnifiedTopology","serverSelectionTimeoutMS","useRecoveryToken","autoEncryption","driverInfo","tls","tlsInsecure","tlsinsecure","tlsAllowInvalidCertificates","tlsAllowInvalidHostnames","tlsCAFile","tlsCertificateFile","tlsCertificateKeyFile","tlsCertificateKeyFilePassword","minHeartbeatFrequencyMS","heartbeatFrequencyMS","directConnection","appName","maxPoolSize","minPoolSize","maxIdleTimeMS","waitQueueTimeoutMS"];const I=["native_parser"];const k=["server","replset","replSet","mongos","db"];function validOptions(e){const t=T.concat(k);for(const r in e){if(I.indexOf(r)!==-1){continue}if(t.indexOf(r)===-1){if(e.validateOptions){return new i(`option ${r} is not supported`)}else{g(`the options [${r}] is not supported`)}}if(k.indexOf(r)!==-1){g(`the server/replset/mongos/db options are deprecated, `+`all their options are supported at the top level of the options object [${T}]`)}}}const A=T.reduce(((e,t)=>{e[t.toLowerCase()]=t;return e}),{});function addListeners(e,t){t.on("authenticated",createListener(e,"authenticated"));t.on("error",createListener(e,"error"));t.on("timeout",createListener(e,"timeout"));t.on("close",createListener(e,"close"));t.on("parseError",createListener(e,"parseError"));t.once("open",createListener(e,"open"));t.once("fullsetup",createListener(e,"fullsetup"));t.once("all",createListener(e,"all"));t.on("reconnect",createListener(e,"reconnect"))}function assignTopology(e,t){e.topology=t;if(!(t instanceof c)){t.s.sessionPool=new m(t.s.coreTopology)}}function clearAllEvents(e){O.forEach((t=>e.removeAllListeners(t)))}function collectEvents(e,t){let r=loadClient();const n=[];if(e instanceof r){O.forEach((r=>{t.on(r,((t,o)=>{if(r==="open"){n.push({event:r,object1:e})}else{n.push({event:r,object1:t,object2:o})}}))}))}return n}function resolveTLSOptions(e){if(e.tls==null){return}["sslCA","sslKey","sslCert"].forEach((t=>{if(e[t]){e[t]=v.readFileSync(e[t])}}))}function connect(e,t,r,n){r=Object.assign({},r);if(n==null){throw new Error("no callback function provided")}let s=false;const c=o("MongoClient",r);if(t instanceof h||t instanceof p||t instanceof a){return connectWithUrl(e,t,r,connectCallback)}const u=r.useNewUrlParser!==false;const m=u?l:_;const y=u?transformUrlOptions:legacyTransformUrlOptions;m(t,r,((t,o)=>{if(t)return n(t);const i=y(o);const a=createUnifiedOptions(i,r);if(a.socketTimeoutMS==null)a.socketTimeoutMS=0;if(a.connectTimeoutMS==null)a.connectTimeoutMS=1e4;if(a.retryWrites==null)a.retryWrites=true;if(a.useRecoveryToken==null)a.useRecoveryToken=true;if(a.readPreference==null)a.readPreference="primary";if(a.db_options&&a.db_options.auth){delete a.db_options.auth}resolveTLSOptions(a);e.s.options=a;e.s.readPreference=d.fromOptions(a);e.s.writeConcern=b.fromOptions(a);if(i.servers.length===0){return n(new Error("connection string must contain at least one seed host"))}if(a.auth&&!a.credentials){try{s=true;a.credentials=generateCredentials(e,a.auth.user,a.auth.password,a)}catch(t){return n(t)}}if(a.useUnifiedTopology){return createTopology(e,"unified",a,connectCallback)}g("Current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.");if(a.replicaSet||a.rs_name){return createTopology(e,"replicaset",a,connectCallback)}else if(i.servers.length>1){return createTopology(e,"mongos",a,connectCallback)}else{return createServer(e,a,connectCallback)}}));function connectCallback(t,r){const o=`seed list contains no mongos proxies, replicaset connections requires the parameter replicaSet to be supplied in the URI or options object, mongodb://server:port/db?replicaSet=name`;if(t&&t.message==="no mongos proxies found in seed list"){if(c.isWarn()){c.warn(o)}return n(new i(o))}if(s){e.emit("authenticated",null,true)}n(t,r)}}function connectWithUrl(e,t,r,n){assignTopology(e,t);addListeners(e,t);relayEvents(e,t);let o=Object.assign({},r);if(typeof r.readPreference==="string"||typeof r.read_preference==="string"){o.readPreference=new d(r.readPreference||r.read_preference)}const s=o.user||o.password||o.authMechanism;if(s&&!o.credentials){try{o.credentials=generateCredentials(e,o.user,o.password,o)}catch(e){return n(e,t)}}return t.connect(o,n)}function createListener(e,t){const r=new Set(["all","fullsetup","open","reconnect"]);return(n,o)=>{if(r.has(t)){return e.emit(t,e)}e.emit(t,n,o)}}function createServer(e,t,r){t.promiseLibrary=e.s.promiseLibrary;const n=translateOptions(t);const o=n[0];const s=collectEvents(e,o);o.connect(t,((n,i)=>{if(n){o.close(true);return r(n)}clearAllEvents(o);relayEvents(e,o);addListeners(e,o);const a=i.lastIsMaster();assignTopology(e,i);if(a&&a.msg==="isdbgrid"){i.close();return createTopology(e,"mongos",t,r)}replayEvents(e,s);r(n,i)}))}const N=new Set(["reconnect","reconnectFailed","attemptReconnect","joined","left","ping","ha","all","fullsetup","open"]);function registerDeprecatedEventNotifiers(e){e.on("newListener",(e=>{if(N.has(e)){y(`The \`${e}\` event is no longer supported by the unified topology, please read more by visiting http://bit.ly/2D8WfT6`,"DeprecationWarning")}}))}function createTopology(e,t,n,o){n.promiseLibrary=e.s.promiseLibrary;const s={};if(t==="unified")s.createServers=false;const i=translateOptions(n,s);if(n.autoEncryption!=null){const t=r(3012).Encrypter;n.encrypter=new t(e,n);n.autoEncrypter=n.encrypter.autoEncrypter}let l;if(t==="mongos"){l=new a(i,n)}else if(t==="replicaset"){l=new p(i,n)}else if(t==="unified"){l=new c(n.servers,n);registerDeprecatedEventNotifiers(e)}addListeners(e,l);relayEvents(e,l);assignTopology(e,l);if(n.autoEncrypter){n.autoEncrypter.init((e=>{if(e){o(e);return}l.connect(n,(e=>{if(e){l.close(true);o(e);return}n.encrypter.connectInternalClient((e=>{if(e)return o(e);o(undefined,l)}))}))}));return}l.connect(n,(e=>{if(e){l.close(true);return o(e)}o(undefined,l);return}))}function createUnifiedOptions(e,t){const r=["mongos","server","db","replset","db_options","server_options","rs_options","mongos_options"];const n=["readconcern","compression","autoencryption"];const o=["w","wtimeout","j","journal","fsync","writeconcern"];for(const s in t){if(o.indexOf(s.toLowerCase())!==-1){continue}else if(n.indexOf(s.toLowerCase())!==-1){e[s]=t[s]}else if(r.indexOf(s.toLowerCase())!==-1){e=mergeOptions(e,t[s],false)}else{if(t[s]&&typeof t[s]==="object"&&!Buffer.isBuffer(t[s])&&!Array.isArray(t[s])){e=mergeOptions(e,t[s],true)}else{e[s]=t[s]}}}const s=b.fromOptions(t);if(s){e.writeConcern=Object.assign({},e.writeConcern,s)}return e}function generateCredentials(e,t,r,n){n=Object.assign({},n);const o=n.authSource||n.authdb||n.dbName;const a=n.authMechanism||"DEFAULT";const c=a.toUpperCase();const l=n.authMechanismProperties;if(!C.has(c)){throw i.create({message:`authentication mechanism ${a} not supported', options.authMechanism`,driver:true})}return new s({mechanism:E[c],mechanismProperties:l,source:o,username:t,password:r})}function legacyTransformUrlOptions(e){return mergeOptions(createUnifiedOptions({},e),e,false)}function mergeOptions(e,t,r){for(const n in t){if(t[n]&&typeof t[n]==="object"&&r){e=mergeOptions(e,t[n],r)}else{e[n]=t[n]}}return e}function relayEvents(e,t){const r=["commandStarted","commandSucceeded","commandFailed","serverOpening","serverClosed","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","topologyOpening","topologyClosed","topologyDescriptionChanged","joined","left","ping","ha"].concat(S);r.forEach((r=>{t.on(r,((t,n)=>{e.emit(r,t,n)}))}))}function replayEvents(e,t){for(let r=0;r<t.length;r++){e.emit(t[r].event,t[r].object1,t[r].object2)}}function transformUrlOptions(e){let t=Object.assign({servers:e.hosts},e.options);for(let e in t){const r=A[e];if(r){t[r]=t[e]}}const r=e.auth&&e.auth.username;const n=e.options&&e.options.authMechanism;if(r||n){t.auth=Object.assign({},e.auth);if(t.auth.db){t.authSource=t.authSource||t.auth.db}if(t.auth.username){t.auth.user=t.auth.username}}if(e.defaultDatabase){t.dbName=e.defaultDatabase}if(t.maxPoolSize){t.poolSize=t.maxPoolSize}if(t.readConcernLevel){t.readConcern=new u(t.readConcernLevel)}if(t.wTimeoutMS){t.wtimeout=t.wTimeoutMS;t.wTimeoutMS=undefined}if(e.srvHost){t.srvHost=e.srvHost}const o=["w","wtimeout","j","journal","fsync"];for(const e of o){if(t[e]!==undefined){if(t.writeConcern===undefined)t.writeConcern={};t.writeConcern[e]=t[e];t[e]=undefined}}return t}function translateOptions(e,t){t=Object.assign({},{createServers:true},t);if(typeof e.readPreference==="string"||typeof e.read_preference==="string"){e.readPreference=new d(e.readPreference||e.read_preference)}if(e.readPreference&&(e.readPreferenceTags||e.read_preference_tags)){e.readPreference.tags=e.readPreferenceTags||e.read_preference_tags}if(e.maxStalenessSeconds){e.readPreference.maxStalenessSeconds=e.maxStalenessSeconds}if(e.socketTimeoutMS==null)e.socketTimeoutMS=0;if(e.connectTimeoutMS==null)e.connectTimeoutMS=1e4;if(!t.createServers){return}return e.servers.map((t=>t.domain_socket?new h(t.domain_socket,27017,e):new h(t.host,t.port,e)))}e.exports={validOptions:validOptions,connect:connect}},7885:(e,t,r)=>{"use strict";const n=r(2296).buildCountCommand;const o=r(1018).OperationBase;class CountOperation extends o{constructor(e,t,r){super(r);this.cursor=e;this.applySkipLimit=t}execute(e){const t=this.cursor;const r=this.applySkipLimit;const o=this.options;if(r){if(typeof t.cursorSkip()==="number")o.skip=t.cursorSkip();if(typeof t.cursorLimit()==="number")o.limit=t.cursorLimit()}if(o.readPreference){t.setReadPreference(o.readPreference)}if(typeof o.maxTimeMS!=="number"&&t.cmd&&typeof t.cmd.maxTimeMS==="number"){o.maxTimeMS=t.cmd.maxTimeMS}let s={};s.skip=o.skip;s.limit=o.limit;s.hint=o.hint;s.maxTimeMS=o.maxTimeMS;s.collectionName=t.namespace.collection;let i;try{i=n(t,t.cmd.query,s)}catch(t){return e(t)}t.server=t.topology.s.coreTopology;t.topology.command(t.namespace.withCollection("$cmd"),i,t.options,((t,r)=>{e(t,r?r.result.n:null)}))}}e.exports=CountOperation},5131:(e,t,r)=>{"use strict";const n=r(1554);class CountDocumentsOperation extends n{constructor(e,t,r){const n=[{$match:t}];if(typeof r.skip==="number"){n.push({$skip:r.skip})}if(typeof r.limit==="number"){n.push({$limit:r.limit})}n.push({$group:{_id:1,n:{$sum:1}}});super(e,n,r)}execute(e,t){super.execute(e,((e,r)=>{if(e){t(e,null);return}const n=r.result;if(n.cursor==null||n.cursor.firstBatch==null){t(null,0);return}const o=n.cursor.firstBatch;t(null,o.length?o[0].n:0)}))}}e.exports=CountDocumentsOperation},5561:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(1018).defineAspects;const s=r(499);const i=r(1371).applyWriteConcern;const a=r(8275).loadCollection;const c=r(3994).MongoError;const l=r(3994).ReadPreference;const u=new Set(["w","wtimeout","j","fsync","autoIndexId","strict","serializeFunctions","pkFactory","raw","readPreference","session","readConcern","writeConcern"]);class CreateCollectionOperation extends s{constructor(e,t,r){super(e,r);this.name=t}_buildCommand(){const e=this.name;const t=this.options;const r={create:e};for(let e in t){if(t[e]!=null&&typeof t[e]!=="function"&&!u.has(e)){r[e]=t[e]}}return r}execute(e){const t=this.db;const r=this.name;const n=this.options;const o=a();let s=Object.assign({nameOnly:true,strict:false},n);s=i(s,{db:t},s);function done(s){if(s){return e(s)}try{e(null,new o(t,t.s.topology,t.databaseName,r,t.s.pkFactory,n))}catch(s){e(s)}}const u=s.strict;if(u){t.listCollections({name:r},s).setReadPreference(l.PRIMARY).toArray(((t,n)=>{if(t){return e(t)}if(n.length>0){return e(new c(`Collection ${r} already exists. Currently in strict mode.`))}super.execute(done)}));return}super.execute(done)}}o(CreateCollectionOperation,n.WRITE_OPERATION);e.exports=CreateCollectionOperation},6394:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(1018).defineAspects;const s=r(1189);const i=r(3994).MongoError;const a=r(1371).parseIndexOptions;const c=r(1178).maxWireVersion;const l=new Set(["background","unique","name","partialFilterExpression","sparse","expireAfterSeconds","storageEngine","collation","weights","default_language","language_override","textIndexVersion","2dsphereIndexVersion","bits","min","max","bucketSize","wildcardProjection"]);class CreateIndexesOperation extends s{constructor(e,t,r,n){super(e,n);this.collection=t;if(!Array.isArray(r)||Array.isArray(r[0])){this.onlyReturnNameOfCreatedIndex=true;const e=a(r);const t=typeof n.name==="string"?n.name:e.name;const o={name:t,key:e.fieldHash};for(let e in n){if(l.has(e)){o[e]=n[e]}}this.indexes=[o];return}this.indexes=r}execute(e,t){const r=this.options;const n=this.indexes;const o=c(e);for(let r=0;r<n.length;r++){if(n[r].collation&&o<5){t(new i(`Server ${e.name}, which reports wire version ${o}, does not support collation`));return}if(n[r].name==null){const e=[];for(let t in n[r].key){e.push(`${t}_${n[r].key[t]}`)}n[r].name=e.join("_")}}const s={createIndexes:this.collection,indexes:n};if(r.commitQuorum!=null){if(o<9){t(new i("`commitQuorum` option for `createIndexes` not supported on servers < 4.4"));return}s.commitQuorum=r.commitQuorum}this.options.collation=undefined;super.executeCommand(e,s,((e,r)=>{if(e){t(e);return}t(null,this.onlyReturnNameOfCreatedIndex?n[0].name:r)}))}}o(CreateIndexesOperation,[n.WRITE_OPERATION,n.EXECUTE_WITH_SELECTION]);e.exports=CreateIndexesOperation},3554:(e,t,r)=>{"use strict";const n=r(6716).buildCountCommand;const o=r(1371).handleCallback;const s=r(3994).MongoError;const i=Array.prototype.push;const a=r(4847).CursorState;function count(e,t,r,o){if(t){if(typeof e.cursorSkip()==="number")r.skip=e.cursorSkip();if(typeof e.cursorLimit()==="number")r.limit=e.cursorLimit()}if(r.readPreference){e.setReadPreference(r.readPreference)}if(typeof r.maxTimeMS!=="number"&&e.cmd&&typeof e.cmd.maxTimeMS==="number"){r.maxTimeMS=e.cmd.maxTimeMS}let s={};s.skip=r.skip;s.limit=r.limit;s.hint=r.hint;s.maxTimeMS=r.maxTimeMS;s.collectionName=e.namespace.collection;let i;try{i=n(e,e.cmd.query,s)}catch(e){return o(e)}e.server=e.topology.s.coreTopology;e.topology.command(e.namespace.withCollection("$cmd"),i,e.options,((e,t)=>{o(e,t?t.result.n:null)}))}function each(e,t){if(!t)throw s.create({message:"callback is mandatory",driver:true});if(e.isNotified())return;if(e.s.state===a.CLOSED||e.isDead()){return o(t,s.create({message:"Cursor is closed",driver:true}))}if(e.s.state===a.INIT){e.s.state=a.OPEN}let r=null;if(e.bufferedCount()>0){while(r=loop(e,t))r(e,t);each(e,t)}else{e.next(((r,n)=>{if(r)return o(t,r);if(n==null){return e.close({skipKillCursors:true},(()=>o(t,null,null)))}if(o(t,null,n)===false)return;each(e,t)}))}}function loop(e,t){if(e.bufferedCount()===0)return;e._next(t);return loop}function toArray(e,t){const r=[];e.rewind();e.s.state=a.INIT;const fetchDocs=()=>{e._next(((n,s)=>{if(n){return o(t,n)}if(s==null){return e.close({skipKillCursors:true},(()=>o(t,null,r)))}r.push(s);if(e.bufferedCount()>0){let t=e.readBufferedDocuments(e.bufferedCount());if(e.s.transforms&&typeof e.s.transforms.doc==="function"){t=t.map(e.s.transforms.doc)}i.apply(r,t)}fetchDocs()}))};fetchDocs()}e.exports={count:count,each:each,toArray:toArray}},2226:(e,t,r)=>{"use strict";const n=r(1371).applyWriteConcern;const o=r(3994).BSON.Code;const s=r(1371).debugOptions;const i=r(1371).handleCallback;const a=r(3994).MongoError;const c=r(1371).parseIndexOptions;const l=r(3994).ReadPreference;const u=r(1371).toError;const d=r(147);const p=r(1371).MongoDBNamespace;const h=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"];function createIndex(e,t,r,o,s){let c=Object.assign({},{readPreference:l.PRIMARY},o);c=n(c,{db:e},o);if(c.writeConcern&&typeof s!=="function"){throw a.create({message:"Cannot use a writeConcern without a provided callback",driver:true})}if(e.serverConfig&&e.serverConfig.isDestroyed())return s(new a("topology was destroyed"));createIndexUsingCreateIndexes(e,t,r,c,((n,l)=>{if(n==null)return i(s,n,l);if(n.code===67||n.code===11e3||n.code===85||n.code===86||n.code===11600||n.code===197){return i(s,n,l)}const u=createCreateIndexCommand(e,t,r,o);c.checkKeys=false;e.s.topology.insert(e.s.namespace.withCollection(d.SYSTEM_INDEX_COLLECTION),u,c,((e,t)=>{if(s==null)return;if(e)return i(s,e);if(t==null)return i(s,null,null);if(t.result.writeErrors)return i(s,a.create(t.result.writeErrors[0]),null);i(s,null,u.name)}))}))}function createListener(e,t,r){function listener(n){if(r.listeners(t).length>0){r.emit(t,n,e);for(let r=0;r<e.s.children.length;r++){e.s.children[r].emit(t,n,e.s.children[r])}}}return listener}function ensureIndex(e,t,r,o,s){const c=n({},{db:e},o);const u=createCreateIndexCommand(e,t,r,o);const d=u.name;if(e.serverConfig&&e.serverConfig.isDestroyed())return s(new a("topology was destroyed"));c.readPreference=l.PRIMARY;indexInformation(e,t,c,((n,a)=>{if(n!=null&&n.code!==26)return i(s,n,null);if(a==null||!a[d]){createIndex(e,t,r,o,s)}else{if(typeof s==="function")return i(s,null,d)}}))}function evaluate(e,t,r,n,s){let c=t;let u=[];if(e.serverConfig&&e.serverConfig.isDestroyed())return s(new a("topology was destroyed"));if(!(c&&c._bsontype==="Code"))c=new o(c);if(r!=null&&!Array.isArray(r)&&typeof r!=="function"){u=[r]}else if(r!=null&&Array.isArray(r)&&typeof r!=="function"){u=r}let d={$eval:c,args:u};if(n["nolock"]){d["nolock"]=n["nolock"]}n.readPreference=new l(l.PRIMARY);executeCommand(e,d,n,((e,t)=>{if(e)return i(s,e,null);if(t&&t.ok===1)return i(s,null,t.retval);if(t)return i(s,a.create({message:`eval failed: ${t.errmsg}`,driver:true}),null);i(s,e,t)}))}function executeCommand(e,t,r,n){if(e.serverConfig&&e.serverConfig.isDestroyed())return n(new a("topology was destroyed"));const o=r.dbName||r.authdb||e.databaseName;r.readPreference=l.resolve(e,r);if(e.s.logger.isDebug())e.s.logger.debug(`executing command ${JSON.stringify(t)} against ${o}.$cmd with options [${JSON.stringify(s(h,r))}]`);e.s.topology.command(e.s.namespace.withCollection("$cmd"),t,r,((e,t)=>{if(e)return i(n,e);if(r.full)return i(n,null,t);i(n,null,t.result)}))}function executeDbAdminCommand(e,t,r,n){const o=new p("admin","$cmd");e.s.topology.command(o,t,r,((t,r)=>{if(e.serverConfig&&e.serverConfig.isDestroyed()){return n(new a("topology was destroyed"))}if(t)return i(n,t);i(n,null,r.result)}))}function indexInformation(e,t,r,n){const o=r["full"]==null?false:r["full"];if(e.serverConfig&&e.serverConfig.isDestroyed())return n(new a("topology was destroyed"));function processResults(e){let t={};for(let r=0;r<e.length;r++){const n=e[r];t[n.name]=[];for(let e in n.key){t[n.name].push([e,n.key[e]])}}return t}e.collection(t).listIndexes(r).toArray(((e,t)=>{if(e)return n(u(e));if(!Array.isArray(t))return i(n,null,[]);if(o)return i(n,null,t);i(n,null,processResults(t))}))}function profilingInfo(e,t,r){try{e.collection("system.profile").find({},t).toArray(r)}catch(e){return r(e,null)}}function validateDatabaseName(e){if(typeof e!=="string")throw a.create({message:"database name must be a string",driver:true});if(e.length===0)throw a.create({message:"database name cannot be the empty string",driver:true});if(e==="$external")return;const t=[" ",".","$","/","\\"];for(let r=0;r<t.length;r++){if(e.indexOf(t[r])!==-1)throw a.create({message:"database names cannot contain the character '"+t[r]+"'",driver:true})}}function createCreateIndexCommand(e,t,r,n){const o=c(r);const s=o.fieldHash;const i=typeof n.name==="string"?n.name:o.name;const a={ns:e.s.namespace.withCollection(t).toString(),key:s,name:i};const l=n==null||"object"===typeof n?false:n;n=n==null||typeof n==="boolean"?{}:n;const u=Object.keys(a);for(let e in n){if(u.indexOf(e)===-1){a[e]=n[e]}}if(a["unique"]==null)a["unique"]=l;const d=["w","wtimeout","j","fsync","readPreference","session"];for(let e=0;e<d.length;e++){delete a[d[e]]}return a}function createIndexUsingCreateIndexes(e,t,r,o,s){const d=c(r);const p=typeof o.name==="string"?o.name:d.name;const h=[{name:p,key:d.fieldHash}];const m=Object.keys(h[0]).concat(["writeConcern","w","wtimeout","j","fsync","readPreference","session"]);for(let e in o){if(m.indexOf(e)===-1){h[0][e]=o[e]}}const y=e.s.topology.capabilities();if(h[0].collation&&y&&!y.commandsTakeCollation){const e=new a("server/primary/mongos does not support collation");e.code=67;return s(e)}const g=n({createIndexes:t,indexes:h},{db:e},o);o.readPreference=l.PRIMARY;executeCommand(e,g,o,((e,t)=>{if(e)return i(s,e,null);if(t.ok===0)return i(s,u(t),null);i(s,null,p)}))}e.exports={createListener:createListener,createIndex:createIndex,ensureIndex:ensureIndex,evaluate:evaluate,executeCommand:executeCommand,executeDbAdminCommand:executeDbAdminCommand,indexInformation:indexInformation,profilingInfo:profilingInfo,validateDatabaseName:validateDatabaseName}},323:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(2296).removeDocuments;const s=r(1018).Aspect;const i=r(1018).defineAspects;class DeleteManyOperation extends n{constructor(e,t,r){super(r);this.collection=e;this.filter=t}execute(e){const t=this.collection;const r=this.filter;const n=this.options;n.single=false;o(t,r,n,((t,r)=>{if(e==null)return;if(t&&e)return e(t);if(r==null)return e(null,{result:{ok:1}});if(this.explain)return e(undefined,r.result);r.deletedCount=r.result.n;e(null,r)}))}}i(DeleteManyOperation,[s.EXPLAINABLE]);e.exports=DeleteManyOperation},6352:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(2296).removeDocuments;const s=r(1018).Aspect;const i=r(1018).defineAspects;class DeleteOneOperation extends n{constructor(e,t,r){super(r);this.collection=e;this.filter=t}execute(e){const t=this.collection;const r=this.filter;const n=this.options;n.single=true;o(t,r,n,((t,r)=>{if(e==null)return;if(t&&e)return e(t);if(r==null)return e(null,{result:{ok:1}});if(this.explain)return e(undefined,r.result);r.deletedCount=r.result.n;e(null,r)}))}}i(DeleteOneOperation,[s.EXPLAINABLE]);e.exports=DeleteOneOperation},6469:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(1018).defineAspects;const s=r(1189);const i=r(1371).decorateWithCollation;const a=r(1371).decorateWithReadConcern;const c=r(1178).maxWireVersion;const l=r(9386).MongoError;class DistinctOperation extends s{constructor(e,t,r,n){super(e,n);this.collection=e;this.key=t;this.query=r}execute(e,t){const r=this.collection;const n=this.key;const o=this.query;const s=this.options;const u={distinct:r.collectionName,key:n,query:o};if(typeof s.maxTimeMS==="number"){u.maxTimeMS=s.maxTimeMS}a(u,r,s);try{i(u,r,s)}catch(e){return t(e,null)}if(this.explain&&c(e)<4){t(new l(`server does not support explain on distinct`));return}super.executeCommand(e,u,((e,r)=>{if(e){t(e);return}t(null,this.options.full||this.explain?r:r.values)}))}}o(DistinctOperation,[n.READ_OPERATION,n.RETRYABLE,n.EXECUTE_WITH_SELECTION,n.EXPLAINABLE]);e.exports=DistinctOperation},2360:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(499);const s=r(1018).defineAspects;const i=r(1371).handleCallback;class DropOperation extends o{constructor(e,t){const r=Object.assign({},t,e.s.options);if(t.session){r.session=t.session}super(e,r)}execute(e){super.execute(((t,r)=>{if(t)return i(e,t);if(r.ok)return i(e,null,true);i(e,null,false)}))}}s(DropOperation,n.WRITE_OPERATION);class DropCollectionOperation extends DropOperation{constructor(e,t,r){super(e,r);this.name=t;this.namespace=`${e.namespace}.${t}`}_buildCommand(){return{drop:this.name}}}class DropDatabaseOperation extends DropOperation{_buildCommand(){return{dropDatabase:1}}}e.exports={DropOperation:DropOperation,DropCollectionOperation:DropCollectionOperation,DropDatabaseOperation:DropDatabaseOperation}},3560:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(1018).defineAspects;const s=r(499);const i=r(1371).applyWriteConcern;const a=r(1371).handleCallback;class DropIndexOperation extends s{constructor(e,t,r){super(e.s.db,r,e);this.collection=e;this.indexName=t}_buildCommand(){const e=this.collection;const t=this.indexName;const r=this.options;let n={dropIndexes:e.collectionName,index:t};n=i(n,{db:e.s.db,collection:e},r);return n}execute(e){super.execute(((t,r)=>{if(typeof e!=="function")return;if(t)return a(e,t,null);a(e,null,r)}))}}o(DropIndexOperation,n.WRITE_OPERATION);e.exports=DropIndexOperation},5328:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(1018).defineAspects;const s=r(3560);const i=r(1371).handleCallback;class DropIndexesOperation extends s{constructor(e,t){super(e,"*",t)}execute(e){super.execute((t=>{if(t)return i(e,t,false);i(e,null,true)}))}}o(DropIndexesOperation,n.WRITE_OPERATION);e.exports=DropIndexesOperation},4451:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(1018).defineAspects;const s=r(1189);class EstimatedDocumentCountOperation extends s{constructor(e,t,r){if(typeof r==="undefined"){r=t;t=undefined}super(e,r);this.collectionName=e.s.namespace.collection;if(t){this.query=t}}execute(e,t){const r=this.options;const n={count:this.collectionName};if(this.query){n.query=this.query}if(typeof r.skip==="number"){n.skip=r.skip}if(typeof r.limit==="number"){n.limit=r.limit}if(r.hint){n.hint=r.hint}super.executeCommand(e,n,((e,r)=>{if(e){t(e);return}t(null,r.n)}))}}o(EstimatedDocumentCountOperation,[n.READ_OPERATION,n.RETRYABLE,n.EXECUTE_WITH_SELECTION]);e.exports=EstimatedDocumentCountOperation},1681:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(1371).handleCallback;const s=r(3994).MongoError;const i=r(1371).MongoDBNamespace;class ExecuteDbAdminCommandOperation extends n{constructor(e,t,r){super(r);this.db=e;this.selector=t}execute(e){const t=this.db;const r=this.selector;const n=this.options;const a=new i("admin","$cmd");t.s.topology.command(a,r,n,((r,n)=>{if(t.serverConfig&&t.serverConfig.isDestroyed()){return e(new s("topology was destroyed"))}if(r)return o(e,r);o(e,null,n.result)}))}}e.exports=ExecuteDbAdminCommandOperation},2548:(e,t,r)=>{"use strict";const n=r(1371).maybePromise;const o=r(3111).MongoError;const s=r(1018).Aspect;const i=r(1018).OperationBase;const a=r(4485);const c=r(3111).isRetryableError;const l=r(1178).maxWireVersion;const u=r(1178).isUnifiedTopology;function executeOperation(e,t,r){if(e==null){throw new TypeError("This method requires a valid topology instance")}if(!(t instanceof i)){throw new TypeError("This method requires a valid operation instance")}return n(e,r,(r=>{if(u(e)&&e.shouldCheckForSessionSupport()){return selectServerForSessionSupport(e,t,r)}let n,i;if(e.hasSessionSupport()){if(t.session==null){i=Symbol();n=e.startSession({owner:i});t.session=n}else if(t.session.hasEnded){return r(new o("Use of expired sessions is not permitted"))}}else if(t.session){return r(new o("Current topology does not support sessions"))}function executeCallback(e,o){if(n&&n.owner===i){n.endSession();if(t.session===n){t.clearSession()}}r(e,o)}try{if(t.hasAspect(s.EXECUTE_WITH_SELECTION)){executeWithServerSelection(e,t,executeCallback)}else{t.execute(executeCallback)}}catch(e){if(n&&n.owner===i){n.endSession();if(t.session===n){t.clearSession()}}r(e)}}))}function supportsRetryableReads(e){return l(e)>=6}function executeWithServerSelection(e,t,r){const n=t.readPreference||a.primary;const i=t.session&&t.session.inTransaction();if(i&&!n.equals(a.primary)){r(new o(`Read preference in a transaction must be primary, not: ${n.mode}`));return}const l={readPreference:n,session:t.session};function callbackWithRetry(n,o){if(n==null){return r(null,o)}if(!c(n)){return r(n)}e.selectServer(l,((e,n)=>{if(e||!supportsRetryableReads(n)){r(e,null);return}t.execute(n,r)}))}e.selectServer(l,((n,o)=>{if(n){r(n,null);return}const a=e.s.options.retryReads!==false&&t.session&&!i&&supportsRetryableReads(o)&&t.canRetryRead;if(t.hasAspect(s.RETRYABLE)&&a){t.execute(o,callbackWithRetry);return}t.execute(o,r)}))}function selectServerForSessionSupport(e,t,r){e.selectServer(a.primaryPreferred,(n=>{if(n){return r(n)}executeOperation(e,t,r)}))}e.exports=executeOperation},9961:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(1018).Aspect;const s=r(1018).defineAspects;const i=r(3994).ReadPreference;const a=r(1178).maxWireVersion;const c=r(3111).MongoError;class FindOperation extends n{constructor(e,t,r,n){super(n);this.ns=t;this.cmd=r;this.readPreference=i.resolve(e,this.options)}execute(e,t){this.server=e;this.readPreference=i.resolve(this,this.options);if(typeof this.cmd.allowDiskUse!=="undefined"&&a(e)<4){t(new c("The `allowDiskUse` option is not supported on MongoDB < 3.2"));return}if(this.explain){this.options.explain=this.explain.verbosity}const r=this.cursorState||{};e.query(this.ns.toString(),this.cmd,r,this.options,t)}}s(FindOperation,[o.READ_OPERATION,o.RETRYABLE,o.EXECUTE_WITH_SELECTION,o.EXPLAINABLE]);e.exports=FindOperation},711:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(1371).applyRetryableWrites;const s=r(1371).applyWriteConcern;const i=r(1371).decorateWithCollation;const a=r(2226).executeCommand;const c=r(1371).formattedOrderClause;const l=r(1371).handleCallback;const u=r(3994).ReadPreference;const d=r(1178).maxWireVersion;const p=r(9386).MongoError;const h=r(1018).Aspect;const m=r(1018).defineAspects;const y=r(1371).decorateWithExplain;class FindAndModifyOperation extends n{constructor(e,t,r,n,o){super(o);this.collection=e;this.query=t;this.sort=r;this.doc=n}execute(e){const t=this.collection;const r=this.query;const n=c(this.sort);const h=this.doc;let m=this.options;let g={findAndModify:t.collectionName,query:r};if(n){g.sort=n}g.new=m.new?true:false;g.remove=m.remove?true:false;g.upsert=m.upsert?true:false;const v=m.projection||m.fields;if(v){g.fields=v}if(m.arrayFilters){g.arrayFilters=m.arrayFilters}if(h&&!m.remove){g.update=h}if(m.maxTimeMS)g.maxTimeMS=m.maxTimeMS;m.serializeFunctions=m.serializeFunctions||t.s.serializeFunctions;m.checkKeys=false;m=o(m,t.s.db);m=s(m,{db:t.s.db,collection:t},m);if(m.writeConcern){g.writeConcern=m.writeConcern}if(m.bypassDocumentValidation===true){g.bypassDocumentValidation=m.bypassDocumentValidation}m.readPreference=u.primary;try{i(g,t,m)}catch(t){return e(t,null)}if(m.hint){const r=m.writeConcern&&m.writeConcern.w===0;if(r||d(t.s.topology)<8){e(new p("The current topology does not support a hint on findAndModify commands"));return}g.hint=m.hint}if(this.explain){if(d(t.s.topology)<4){e(new p(`server does not support explain on findAndModify`));return}g=y(g,this.explain)}a(t.s.db,g,m,((t,r)=>{if(t)return l(e,t,null);return l(e,null,r)}))}}m(FindAndModifyOperation,[h.EXPLAINABLE]);e.exports=FindAndModifyOperation},4497:(e,t,r)=>{"use strict";const n=r(1371).handleCallback;const o=r(1018).OperationBase;const s=r(1371).toError;const i=r(1018).Aspect;const a=r(1018).defineAspects;class FindOneOperation extends o{constructor(e,t,r){super(r);this.collection=e;this.query=t}execute(e){const t=this.collection;const r=this.query;const o=this.options;try{const i=t.find(r,o).limit(-1).batchSize(1);i.next(((t,r)=>{if(t!=null)return n(e,s(t),null);n(e,null,r)}))}catch(t){e(t)}}}a(FindOneOperation,[i.EXPLAINABLE]);e.exports=FindOneOperation},5841:(e,t,r)=>{"use strict";const n=r(711);class FindOneAndDeleteOperation extends n{constructor(e,t,r){const n=Object.assign({},r);n.fields=r.projection;n.remove=true;if(t==null||typeof t!=="object"){throw new TypeError("Filter parameter must be an object")}super(e,t,n.sort,null,n)}}e.exports=FindOneAndDeleteOperation},4316:(e,t,r)=>{"use strict";const n=r(3994).MongoError;const o=r(711);const s=r(1371).hasAtomicOperators;class FindOneAndReplaceOperation extends o{constructor(e,t,r,o){if("returnDocument"in o&&"returnOriginal"in o){throw new n("findOneAndReplace option returnOriginal is deprecated in favor of returnDocument and cannot be combined")}const i=Object.assign({},o);i.fields=o.projection;i.update=true;i.new=o.returnDocument==="after"||o.returnOriginal===false;i.upsert=o.upsert===true;if(t==null||typeof t!=="object"){throw new TypeError("Filter parameter must be an object")}if(r==null||typeof r!=="object"){throw new TypeError("Replacement parameter must be an object")}if(s(r)){throw new TypeError("Replacement document must not contain atomic operators")}super(e,t,i.sort,r,i)}}e.exports=FindOneAndReplaceOperation},1925:(e,t,r)=>{"use strict";const n=r(3994).MongoError;const o=r(711);const s=r(1371).hasAtomicOperators;class FindOneAndUpdateOperation extends o{constructor(e,t,r,o){if("returnDocument"in o&&"returnOriginal"in o){throw new n("findOneAndUpdate option returnOriginal is deprecated in favor of returnDocument and cannot be combined")}const i=Object.assign({},o);i.fields=o.projection;i.update=true;i.new=o.returnDocument==="after"||o.returnOriginal===false;i.upsert=o.upsert===true;if(t==null||typeof t!=="object"){throw new TypeError("Filter parameter must be an object")}if(r==null||typeof r!=="object"){throw new TypeError("Update parameter must be an object")}if(!s(r)){throw new TypeError("Update document requires atomic operators")}super(e,t,i.sort,r,i)}}e.exports=FindOneAndUpdateOperation},8169:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(1018).defineAspects;const s=r(1018).OperationBase;const i=r(1371).decorateCommand;const a=r(1371).decorateWithReadConcern;const c=r(2226).executeCommand;const l=r(1371).handleCallback;const u=r(3994).ReadPreference;const d=r(1371).toError;class GeoHaystackSearchOperation extends s{constructor(e,t,r,n){super(n);this.collection=e;this.x=t;this.y=r}execute(e){const t=this.collection;const r=this.x;const n=this.y;let o=this.options;let s={geoSearch:t.collectionName,near:[r,n]};s=i(s,o,["readPreference","session"]);o=Object.assign({},o);o.readPreference=u.resolve(t,o);a(s,t,o);c(t.s.db,s,o,((t,r)=>{if(t)return l(e,t);if(r.err||r.errmsg)l(e,d(r));l(e,null,r)}))}}o(GeoHaystackSearchOperation,n.READ_OPERATION);e.exports=GeoHaystackSearchOperation},7809:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(1371).handleCallback;const s=r(2226).indexInformation;class IndexExistsOperation extends n{constructor(e,t,r){super(r);this.collection=e;this.indexes=t}execute(e){const t=this.collection;const r=this.indexes;const n=this.options;s(t.s.db,t.collectionName,n,((t,n)=>{if(t!=null)return o(e,t,null);if(!Array.isArray(r))return o(e,null,n[r]!=null);for(let t=0;t<r.length;t++){if(n[r[t]]==null){return o(e,null,false)}}return o(e,null,true)}))}}e.exports=IndexExistsOperation},4245:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(2296).indexInformation;class IndexInformationOperation extends n{constructor(e,t,r){super(r);this.db=e;this.name=t}execute(e){const t=this.db;const r=this.name;const n=this.options;o(t,r,n,e)}}e.exports=IndexInformationOperation},4218:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(2296).indexInformation;class IndexesOperation extends n{constructor(e,t){super(t);this.collection=e}execute(e){const t=this.collection;let r=this.options;r=Object.assign({},{full:true},r);o(t.s.db,t.collectionName,r,e)}}e.exports=IndexesOperation},3592:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(6976);const s=r(3994).MongoError;const i=r(2296).prepareDocs;class InsertManyOperation extends n{constructor(e,t,r){super(r);this.collection=e;this.docs=t}execute(e){const t=this.collection;let r=this.docs;const n=this.options;if(!Array.isArray(r)){return e(s.create({message:"docs parameter must be an array of documents",driver:true}))}n["serializeFunctions"]=n["serializeFunctions"]||t.s.serializeFunctions;r=i(t,r,n);const a=r.map((e=>({insertOne:{document:e}})));const c=new o(t,a,n);c.execute(((t,n)=>{if(t)return e(t,null);e(null,mapInsertManyResults(r,n))}))}}function mapInsertManyResults(e,t){const r={result:{ok:1,n:t.insertedCount},ops:e,insertedCount:t.insertedCount,insertedIds:t.insertedIds};if(t.getLastOp()){r.result.opTime=t.getLastOp()}return r}e.exports=InsertManyOperation},9915:(e,t,r)=>{"use strict";const n=r(3994).MongoError;const o=r(1018).OperationBase;const s=r(2296).insertDocuments;class InsertOneOperation extends o{constructor(e,t,r){super(r);this.collection=e;this.doc=t}execute(e){const t=this.collection;const r=this.doc;const o=this.options;if(Array.isArray(r)){return e(n.create({message:"doc parameter must be an object",driver:true}))}s(t,[r],o,((t,n)=>{if(e==null)return;if(t&&e)return e(t);if(n==null)return e(null,{result:{ok:1}});n.insertedCount=n.result.n;n.insertedId=r._id;if(e)e(null,n)}))}}e.exports=InsertOneOperation},4956:(e,t,r)=>{"use strict";const n=r(43);const o=r(1371).handleCallback;class IsCappedOperation extends n{constructor(e,t){super(e,t)}execute(e){super.execute(((t,r)=>{if(t)return o(e,t);o(e,null,!!(r&&r.capped))}))}}e.exports=IsCappedOperation},840:(e,t,r)=>{"use strict";const n=r(1189);const o=r(1018).Aspect;const s=r(1018).defineAspects;const i=r(1178).maxWireVersion;const a=r(147);const c=3;function listCollectionsTransforms(e){const t=`${e}.`;return{doc:e=>{const r=e.name.indexOf(t);if(e.name&&r===0){e.name=e.name.substr(r+t.length)}return e}}}class ListCollectionsOperation extends n{constructor(e,t,r){super(e,r,{fullResponse:true});this.db=e;this.filter=t;this.nameOnly=!!this.options.nameOnly;if(typeof this.options.batchSize==="number"){this.batchSize=this.options.batchSize}}execute(e,t){if(i(e)<c){let r=this.filter;const n=this.db.s.namespace.db;if(typeof r.name==="string"&&!new RegExp("^"+n+"\\.").test(r.name)){r=Object.assign({},r);r.name=this.db.s.namespace.withCollection(r.name).toString()}if(r==null){r.name=`/${n}/`}if(r.name){r={$and:[{name:r.name},{name:/^((?!\$).)*$/}]}}else{r={name:/^((?!\$).)*$/}}const o=listCollectionsTransforms(n);e.query(`${n}.${a.SYSTEM_NAMESPACE_COLLECTION}`,{query:r},{batchSize:this.batchSize||1e3},{},((e,r)=>{if(r&&r.message&&r.message.documents&&Array.isArray(r.message.documents)){r.message.documents=r.message.documents.map(o.doc)}t(e,r)}));return}const r={listCollections:1,filter:this.filter,cursor:this.batchSize?{batchSize:this.batchSize}:{},nameOnly:this.nameOnly};return super.executeCommand(e,r,t)}}s(ListCollectionsOperation,[o.READ_OPERATION,o.RETRYABLE,o.EXECUTE_WITH_SELECTION]);e.exports=ListCollectionsOperation},9929:(e,t,r)=>{"use strict";const n=r(1189);const o=r(1018).Aspect;const s=r(1018).defineAspects;const i=r(1371).MongoDBNamespace;class ListDatabasesOperation extends n{constructor(e,t){super(e,t);this.ns=new i("admin","$cmd")}execute(e,t){const r={listDatabases:1};if(this.options.nameOnly){r.nameOnly=Number(r.nameOnly)}if(this.options.filter){r.filter=this.options.filter}if(typeof this.options.authorizedDatabases==="boolean"){r.authorizedDatabases=this.options.authorizedDatabases}super.executeCommand(e,r,t)}}s(ListDatabasesOperation,[o.READ_OPERATION,o.RETRYABLE,o.EXECUTE_WITH_SELECTION]);e.exports=ListDatabasesOperation},28:(e,t,r)=>{"use strict";const n=r(1189);const o=r(1018).Aspect;const s=r(1018).defineAspects;const i=r(1178).maxWireVersion;const a=3;class ListIndexesOperation extends n{constructor(e,t){super(e,t,{fullResponse:true});this.collectionNamespace=e.s.namespace}execute(e,t){const r=i(e);if(r<a){const r=this.collectionNamespace.withCollection("system.indexes").toString();const n=this.collectionNamespace.toString();e.query(r,{query:{ns:n}},{},this.options,t);return}const n=this.options.batchSize?{batchSize:this.options.batchSize}:{};super.executeCommand(e,{listIndexes:this.collectionNamespace.collection,cursor:n},t)}}s(ListIndexesOperation,[o.READ_OPERATION,o.RETRYABLE,o.EXECUTE_WITH_SELECTION]);e.exports=ListIndexesOperation},2779:(e,t,r)=>{"use strict";const n=r(1371).applyWriteConcern;const o=r(3994).BSON.Code;const s=r(1371).decorateWithCollation;const i=r(1371).decorateWithReadConcern;const a=r(2226).executeCommand;const c=r(1371).handleCallback;const l=r(1371).isObject;const u=r(8275).loadDb;const d=r(1018).OperationBase;const p=r(3994).ReadPreference;const h=r(1371).toError;const m=r(1018).Aspect;const y=r(1018).defineAspects;const g=r(1371).decorateWithExplain;const v=r(1178).maxWireVersion;const b=r(9386).MongoError;const S=["explain","readPreference","session","bypassDocumentValidation","w","wtimeout","j","writeConcern"];class MapReduceOperation extends d{constructor(e,t,r,n){super(n);this.collection=e;this.map=t;this.reduce=r}execute(e){const t=this.collection;const r=this.map;const o=this.reduce;let l=this.options;let d={mapReduce:t.collectionName,map:r,reduce:o};for(let e in l){if("scope"===e){d[e]=processScope(l[e])}else{if(S.indexOf(e)===-1){d[e]=l[e]}}}l=Object.assign({},l);l.readPreference=p.resolve(t,l);if(l.readPreference!==false&&l.readPreference!=="primary"&&l["out"]&&l["out"].inline!==1&&l["out"]!=="inline"){l.readPreference="primary";n(d,{db:t.s.db,collection:t},l)}else{i(d,t,l)}if(l.bypassDocumentValidation===true){d.bypassDocumentValidation=l.bypassDocumentValidation}try{s(d,t,l)}catch(t){return e(t,null)}if(this.explain){if(v(t.s.topology)<9){e(new b(`server does not support explain on mapReduce`));return}d=g(d,this.explain)}a(t.s.db,d,l,((r,n)=>{if(r)return c(e,r);if(1!==n.ok||n.err||n.errmsg){return c(e,h(n))}if(this.explain)return e(undefined,n);const o={};if(n.timeMillis)o["processtime"]=n.timeMillis;if(n.counts)o["counts"]=n.counts;if(n.timing)o["timing"]=n.timing;if(n.results){if(l["verbose"]==null||!l["verbose"]){return c(e,null,n.results)}return c(e,null,{results:n.results,stats:o})}let s=null;if(n.result!=null&&typeof n.result==="object"){const e=n.result;let r=u();s=new r(e.db,t.s.db.s.topology,t.s.db.s.options).collection(e.collection)}else{s=t.s.db.collection(n.result)}if(l["verbose"]==null||!l["verbose"]){return c(e,r,s)}c(e,r,{collection:s,stats:o})}))}}function processScope(e){if(!l(e)||e._bsontype==="ObjectID"){return e}const t=Object.keys(e);let r;const n={};for(let s=t.length-1;s>=0;s--){r=t[s];if("function"===typeof e[r]){n[r]=new o(String(e[r]))}else{n[r]=processScope(e[r])}}return n}y(MapReduceOperation,[m.EXPLAINABLE]);e.exports=MapReduceOperation},1018:(e,t,r)=>{"use strict";const n=r(5293).Explain;const o=r(3111).MongoError;const s={READ_OPERATION:Symbol("READ_OPERATION"),WRITE_OPERATION:Symbol("WRITE_OPERATION"),RETRYABLE:Symbol("RETRYABLE"),EXECUTE_WITH_SELECTION:Symbol("EXECUTE_WITH_SELECTION"),NO_INHERIT_OPTIONS:Symbol("NO_INHERIT_OPTIONS"),EXPLAINABLE:Symbol("EXPLAINABLE")};class OperationBase{constructor(e){this.options=Object.assign({},e);if(this.hasAspect(s.EXPLAINABLE)){this.explain=n.fromOptions(e)}else if(this.options.explain!==undefined){throw new o(`explain is not supported on this command`)}}hasAspect(e){if(this.constructor.aspects==null){return false}return this.constructor.aspects.has(e)}set session(e){Object.assign(this.options,{session:e})}get session(){return this.options.session}clearSession(){delete this.options.session}get canRetryRead(){return true}execute(){throw new TypeError("`execute` must be implemented for OperationBase subclasses")}}function defineAspects(e,t){if(!Array.isArray(t)&&!(t instanceof Set)){t=[t]}t=new Set(t);Object.defineProperty(e,"aspects",{value:t,writable:false});return t}e.exports={Aspect:s,defineAspects:defineAspects,OperationBase:OperationBase}},43:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(1371).handleCallback;const s=r(3994).MongoError;class OptionsOperation extends n{constructor(e,t){super(t);this.collection=e}execute(e){const t=this.collection;const r=this.options;t.s.db.listCollections({name:t.collectionName},r).toArray(((r,n)=>{if(r)return o(e,r);if(n.length===0){return o(e,s.create({message:`collection ${t.namespace} not found`,driver:true}))}o(e,r,n[0].options||null)}))}}e.exports=OptionsOperation},3969:(e,t,r)=>{"use strict";const n=r(499);class ProfilingLevelOperation extends n{constructor(e,t,r){super(e,r)}_buildCommand(){const e={profile:-1};return e}execute(e){super.execute(((t,r)=>{if(t==null&&r.ok===1){const t=r.was;if(t===0)return e(null,"off");if(t===1)return e(null,"slow_only");if(t===2)return e(null,"all");return e(new Error("Error: illegal profiling level value "+t),null)}else{t!=null?e(t,null):e(new Error("Error with profile command"),null)}}))}}e.exports=ProfilingLevelOperation},6331:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(1018).defineAspects;const s=r(1189);const i=r(2291).serverType;const a=r(2291).ServerType;const c=r(3994).MongoError;class ReIndexOperation extends s{constructor(e,t){super(e,t);this.collectionName=e.collectionName}execute(e,t){if(i(e)!==a.Standalone){t(new c(`reIndex can only be executed on standalone servers.`));return}super.executeCommand(e,{reIndex:this.collectionName},((e,r)=>{if(e){t(e);return}t(null,!!r.ok)}))}}o(ReIndexOperation,[n.EXECUTE_WITH_SELECTION]);e.exports=ReIndexOperation},1969:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(499);const s=r(1018).defineAspects;const i=r(1371).handleCallback;const a=r(2481);class RemoveUserOperation extends o{constructor(e,t,r){const n={};const o=a.fromOptions(r);if(o!=null){n.writeConcern=o}if(r.dbName){n.dbName=r.dbName}if(typeof r.maxTimeMS==="number"){n.maxTimeMS=r.maxTimeMS}super(e,n);this.username=t}_buildCommand(){const e=this.username;const t={dropUser:e};return t}execute(e){super.execute(((t,r)=>{if(t)return i(e,t,null);i(e,t,r.ok?true:false)}))}}s(RemoveUserOperation,n.WRITE_OPERATION);e.exports=RemoveUserOperation},2808:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(1371).applyWriteConcern;const s=r(1371).checkCollectionName;const i=r(2226).executeDbAdminCommand;const a=r(1371).handleCallback;const c=r(8275).loadCollection;const l=r(1371).toError;class RenameOperation extends n{constructor(e,t,r){super(r);this.collection=e;this.newName=t}execute(e){const t=this.collection;const r=this.newName;const n=this.options;let u=c();s(r);const d=t.namespace;const p=t.s.namespace.withCollection(r).toString();const h=typeof n.dropTarget==="boolean"?n.dropTarget:false;const m={renameCollection:d,to:p,dropTarget:h};o(m,{db:t.s.db,collection:t},n);i(t.s.db.admin().s.db,m,n,((n,o)=>{if(n)return a(e,n,null);if(o.errmsg)return a(e,l(o),null);try{return a(e,null,new u(t.s.db,t.s.topology,t.s.namespace.db,r,t.s.pkFactory,t.s.options))}catch(n){return a(e,l(n),null)}}))}}e.exports=RenameOperation},2508:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(2296).updateDocuments;const s=r(1371).hasAtomicOperators;class ReplaceOneOperation extends n{constructor(e,t,r,n){super(n);if(s(r)){throw new TypeError("Replacement document must not contain atomic operators")}this.collection=e;this.filter=t;this.replacement=r}execute(e){const t=this.collection;const r=this.filter;const n=this.replacement;const s=this.options;s.multi=false;o(t,r,n,s,((t,r)=>replaceCallback(t,r,n,e)))}}function replaceCallback(e,t,r,n){if(n==null)return;if(e&&n)return n(e);if(t==null)return n(null,{result:{ok:1}});t.modifiedCount=t.result.nModified!=null?t.result.nModified:t.result.n;t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null;t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0;t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n;t.ops=[r];if(n)n(null,t)}e.exports=ReplaceOneOperation},1363:(e,t,r)=>{"use strict";const n=r(1189);const o=r(1018).defineAspects;const s=r(1018).Aspect;class RunCommandOperation extends n{constructor(e,t,r){super(e,r);this.command=t}execute(e,t){const r=this.command;this.executeCommand(e,r,t)}}o(RunCommandOperation,[s.EXECUTE_WITH_SELECTION,s.NO_INHERIT_OPTIONS]);e.exports=RunCommandOperation},6301:(e,t,r)=>{"use strict";const n=r(499);const o=new Set(["off","slow_only","all"]);class SetProfilingLevelOperation extends n{constructor(e,t,r){let n=0;if(t==="off"){n=0}else if(t==="slow_only"){n=1}else if(t==="all"){n=2}super(e,r);this.level=t;this.profile=n}_buildCommand(){const e=this.profile;const t={profile:e};return t}execute(e){const t=this.level;if(!o.has(t)){return e(new Error("Error: illegal profiling level value "+t))}super.execute(((r,n)=>{if(r==null&&n.ok===1)return e(null,t);return r!=null?e(r,null):e(new Error("Error with profile command"),null)}))}}e.exports=SetProfilingLevelOperation},968:(e,t,r)=>{"use strict";const n=r(1018).Aspect;const o=r(499);const s=r(1018).defineAspects;class StatsOperation extends o{constructor(e,t){super(e.s.db,t,e)}_buildCommand(){const e=this.collection;const t=this.options;const r={collStats:e.collectionName};if(t["scale"]!=null){r["scale"]=t["scale"]}return r}}s(StatsOperation,n.READ_OPERATION);e.exports=StatsOperation},9350:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(2296).updateDocuments;const s=r(1371).hasAtomicOperators;const i=r(1018).Aspect;const a=r(1018).defineAspects;class UpdateManyOperation extends n{constructor(e,t,r,n){super(n);if(!s(r)){throw new TypeError("Update document requires atomic operators")}this.collection=e;this.filter=t;this.update=r}execute(e){const t=this.collection;const r=this.filter;const n=this.update;const s=this.options;s.multi=true;o(t,r,n,s,((t,r)=>{if(e==null)return;if(t)return e(t);if(r==null)return e(null,{result:{ok:1}});if(this.explain)return e(undefined,r.result);r.modifiedCount=r.result.nModified!=null?r.result.nModified:r.result.n;r.upsertedId=Array.isArray(r.result.upserted)&&r.result.upserted.length>0?r.result.upserted[0]:null;r.upsertedCount=Array.isArray(r.result.upserted)&&r.result.upserted.length?r.result.upserted.length:0;r.matchedCount=Array.isArray(r.result.upserted)&&r.result.upserted.length>0?0:r.result.n;e(null,r)}))}}a(UpdateManyOperation,[i.EXPLAINABLE]);e.exports=UpdateManyOperation},9068:(e,t,r)=>{"use strict";const n=r(1018).OperationBase;const o=r(2296).updateDocuments;const s=r(1371).hasAtomicOperators;const i=r(1018).Aspect;const a=r(1018).defineAspects;class UpdateOneOperation extends n{constructor(e,t,r,n){super(n);if(!s(r)){throw new TypeError("Update document requires atomic operators")}this.collection=e;this.filter=t;this.update=r}execute(e){const t=this.collection;const r=this.filter;const n=this.update;const s=this.options;s.multi=false;o(t,r,n,s,((t,r)=>{if(e==null)return;if(t)return e(t);if(r==null)return e(null,{result:{ok:1}});if(this.explain)return e(undefined,r.result);r.modifiedCount=r.result.nModified!=null?r.result.nModified:r.result.n;r.upsertedId=Array.isArray(r.result.upserted)&&r.result.upserted.length>0?r.result.upserted[0]:null;r.upsertedCount=Array.isArray(r.result.upserted)&&r.result.upserted.length?r.result.upserted.length:0;r.matchedCount=Array.isArray(r.result.upserted)&&r.result.upserted.length>0?0:r.result.n;e(null,r)}))}}a(UpdateOneOperation,[i.EXPLAINABLE]);e.exports=UpdateOneOperation},9263:(e,t,r)=>{"use strict";const n=r(499);class ValidateCollectionOperation extends n{constructor(e,t,r){let n={validate:t};const o=Object.keys(r);for(let e=0;e<o.length;e++){if(Object.prototype.hasOwnProperty.call(r,o[e])&&o[e]!=="session"){n[o[e]]=r[o[e]]}}super(e.s.db,r,null,n);this.collectionName=t}execute(e){const t=this.collectionName;super.execute(((r,n)=>{if(r!=null)return e(r,null);if(n.ok===0)return e(new Error("Error with validate command"),null);if(n.result!=null&&n.result.constructor!==String)return e(new Error("Error with validation data"),null);if(n.result!=null&&n.result.match(/exception|corrupt/)!=null)return e(new Error("Error: invalid collection "+t),null);if(n.valid!=null&&!n.valid)return e(new Error("Error: invalid collection "+t),null);return e(null,n)}))}}e.exports=ValidateCollectionOperation},7289:e=>{"use strict";class ReadConcern{constructor(e){if(e!=null){this.level=e}}static fromOptions(e){if(e==null){return}if(e.readConcern){if(e.readConcern instanceof ReadConcern){return e.readConcern}return new ReadConcern(e.readConcern.level)}if(e.level){return new ReadConcern(e.level)}}static get MAJORITY(){return"majority"}static get AVAILABLE(){return"available"}static get LINEARIZABLE(){return"linearizable"}static get SNAPSHOT(){return"snapshot"}}e.exports=ReadConcern},2048:(e,t,r)=>{"use strict";const n=r(8589).oF;const o=r(3994).MongoError;const s=r(3994).Mongos;const i=r(7159);const a=r(8421);const c=r(8589).yh;const l=r(1371).MAX_JS_INT;const u=r(1371).translateOptions;const d=r(1371).filterOptions;const p=r(1371).mergeOptions;var h=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","promiseLibrary","monitorCommands"];class Mongos extends n{constructor(e,t){super();t=t||{};var r=this;t=d(t,h);for(var n=0;n<e.length;n++){if(!(e[n]instanceof a)){throw o.create({message:"all seed list instances must be of the Server type",driver:true})}}var m={force:false,bufferMaxEntries:typeof t.bufferMaxEntries==="number"?t.bufferMaxEntries:l};var y=t.store||new c(r,m);var g=e.map((function(e){return{host:e.host,port:e.port}}));var v=typeof t.auto_reconnect==="boolean"?t.auto_reconnect:true;v=typeof t.autoReconnect==="boolean"?t.autoReconnect:v;var b=p({},{disconnectHandler:y,cursorFactory:i,reconnect:v,emitError:typeof t.emitError==="boolean"?t.emitError:true,size:typeof t.poolSize==="number"?t.poolSize:5,monitorCommands:typeof t.monitorCommands==="boolean"?t.monitorCommands:false});b=u(b,t);var S=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;b=u(b,S);this.s={coreTopology:new s(g,b),sCapabilities:null,debug:b.debug,storeOptions:m,clonedOptions:b,store:y,options:t,sessionPool:null,sessions:new Set,promiseLibrary:t.promiseLibrary||Promise}}connect(e,t){var r=this;if("function"===typeof e)t=e,e={};if(e==null)e={};if(!("function"===typeof t))t=null;e=Object.assign({},this.s.clonedOptions,e);r.s.options=e;r.s.storeOptions.bufferMaxEntries=typeof e.bufferMaxEntries==="number"?e.bufferMaxEntries:-1;var connectErrorHandler=function(){return function(e){var n=["timeout","error","close"];n.forEach((function(e){r.removeListener(e,connectErrorHandler)}));r.s.coreTopology.removeListener("connect",connectErrorHandler);r.close(true);try{t(e)}catch(e){process.nextTick((function(){throw e}))}}};var errorHandler=function(e){return function(t){if(e!=="error"){r.emit(e,t)}}};var reconnectHandler=function(){r.emit("reconnect");r.s.store.execute()};var relay=function(e){return function(t,n){r.emit(e,t,n)}};var connectHandler=function(){var e=["timeout","error","close","fullsetup"];e.forEach((function(e){r.s.coreTopology.removeAllListeners(e)}));r.s.coreTopology.on("timeout",errorHandler("timeout"));r.s.coreTopology.on("error",errorHandler("error"));r.s.coreTopology.on("close",errorHandler("close"));r.s.coreTopology.on("fullsetup",(function(){r.emit("fullsetup",r)}));r.emit("open",null,r);try{t(null,r)}catch(e){process.nextTick((function(){throw e}))}};var n=["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"];n.forEach((function(e){r.s.coreTopology.removeAllListeners(e)}));r.s.coreTopology.on("serverDescriptionChanged",relay("serverDescriptionChanged"));r.s.coreTopology.on("serverHeartbeatStarted",relay("serverHeartbeatStarted"));r.s.coreTopology.on("serverHeartbeatSucceeded",relay("serverHeartbeatSucceeded"));r.s.coreTopology.on("serverHeartbeatFailed",relay("serverHeartbeatFailed"));r.s.coreTopology.on("serverOpening",relay("serverOpening"));r.s.coreTopology.on("serverClosed",relay("serverClosed"));r.s.coreTopology.on("topologyOpening",relay("topologyOpening"));r.s.coreTopology.on("topologyClosed",relay("topologyClosed"));r.s.coreTopology.on("topologyDescriptionChanged",relay("topologyDescriptionChanged"));r.s.coreTopology.on("commandStarted",relay("commandStarted"));r.s.coreTopology.on("commandSucceeded",relay("commandSucceeded"));r.s.coreTopology.on("commandFailed",relay("commandFailed"));r.s.coreTopology.once("timeout",connectErrorHandler("timeout"));r.s.coreTopology.once("error",connectErrorHandler("error"));r.s.coreTopology.once("close",connectErrorHandler("close"));r.s.coreTopology.once("connect",connectHandler);r.s.coreTopology.on("joined",relay("joined"));r.s.coreTopology.on("left",relay("left"));r.s.coreTopology.on("reconnect",reconnectHandler);r.s.coreTopology.connect(e)}}Object.defineProperty(Mongos.prototype,"haInterval",{enumerable:true,get:function(){return this.s.coreTopology.s.haInterval}});e.exports=Mongos},2632:(e,t,r)=>{"use strict";const n=r(3994).Topology;const o=r(8589).ug;const s=r(7159);const i=r(1371).translateOptions;class NativeTopology extends n{constructor(e,t){t=t||{};let r=Object.assign({},{cursorFactory:s,reconnect:false,emitError:typeof t.emitError==="boolean"?t.emitError:true,maxPoolSize:typeof t.maxPoolSize==="number"?t.maxPoolSize:typeof t.poolSize==="number"?t.poolSize:10,minPoolSize:typeof t.minPoolSize==="number"?t.minPoolSize:typeof t.minSize==="number"?t.minSize:0,monitorCommands:typeof t.monitorCommands==="boolean"?t.monitorCommands:false});r=i(r,t);var n=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;r=i(r,n);super(e,r)}capabilities(){if(this.s.sCapabilities)return this.s.sCapabilities;if(this.lastIsMaster()==null)return null;this.s.sCapabilities=new o(this.lastIsMaster());return this.s.sCapabilities}command(e,t,r,n){super.command(e.toString(),t,r,n)}insert(e,t,r,n){super.insert(e.toString(),t,r,n)}update(e,t,r,n){super.update(e.toString(),t,r,n)}remove(e,t,r,n){super.remove(e.toString(),t,r,n)}}e.exports=NativeTopology},382:(e,t,r)=>{"use strict";const n=r(8421);const o=r(7159);const s=r(3994).MongoError;const i=r(8589).oF;const a=r(8589).yh;const c=r(3994).ReplSet;const l=r(1371).MAX_JS_INT;const u=r(1371).translateOptions;const d=r(1371).filterOptions;const p=r(1371).mergeOptions;var h=["ha","haInterval","replicaSet","rs_name","secondaryAcceptableLatencyMS","connectWithNoPrimary","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCert","ciphers","ecdhCurve","sslCRL","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","strategy","debug","family","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","maxStalenessSeconds","promiseLibrary","minSize","monitorCommands"];class ReplSet extends i{constructor(e,t){super();t=t||{};var r=this;t=d(t,h);for(var i=0;i<e.length;i++){if(!(e[i]instanceof n)){throw s.create({message:"all seed list instances must be of the Server type",driver:true})}}var m={force:false,bufferMaxEntries:typeof t.bufferMaxEntries==="number"?t.bufferMaxEntries:l};var y=t.store||new a(r,m);var g=e.map((function(e){return{host:e.host,port:e.port}}));var v=p({},{disconnectHandler:y,cursorFactory:o,reconnect:false,emitError:typeof t.emitError==="boolean"?t.emitError:true,size:typeof t.poolSize==="number"?t.poolSize:5,monitorCommands:typeof t.monitorCommands==="boolean"?t.monitorCommands:false});v=u(v,t);var b=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;v=u(v,b);var S=new c(g,v);S.on("reconnect",(function(){r.emit("reconnect");y.execute()}));this.s={coreTopology:S,sCapabilities:null,tag:t.tag,storeOptions:m,clonedOptions:v,store:y,options:t,sessionPool:null,sessions:new Set,promiseLibrary:t.promiseLibrary||Promise};if(v.debug){Object.defineProperty(this,"replset",{enumerable:true,get:function(){return S}})}}connect(e,t){var r=this;if("function"===typeof e)t=e,e={};if(e==null)e={};if(!("function"===typeof t))t=null;e=Object.assign({},this.s.clonedOptions,e);r.s.options=e;r.s.storeOptions.bufferMaxEntries=typeof e.bufferMaxEntries==="number"?e.bufferMaxEntries:-1;var errorHandler=function(e){return function(t){if(e!=="error"){r.emit(e,t)}}};var n=["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"];n.forEach((function(e){r.s.coreTopology.removeAllListeners(e)}));var relay=function(e){return function(t,n){r.emit(e,t,n)}};var replsetRelay=function(e){return function(t,n){r.emit(e,t,n.lastIsMaster(),n)}};var relayHa=function(e,t){r.emit("ha",e,t);if(e==="start"){r.emit("ha_connect",e,t)}else if(e==="end"){r.emit("ha_ismaster",e,t)}};r.s.coreTopology.on("joined",replsetRelay("joined"));r.s.coreTopology.on("left",relay("left"));r.s.coreTopology.on("ping",relay("ping"));r.s.coreTopology.on("ha",relayHa);r.s.coreTopology.on("serverDescriptionChanged",relay("serverDescriptionChanged"));r.s.coreTopology.on("serverHeartbeatStarted",relay("serverHeartbeatStarted"));r.s.coreTopology.on("serverHeartbeatSucceeded",relay("serverHeartbeatSucceeded"));r.s.coreTopology.on("serverHeartbeatFailed",relay("serverHeartbeatFailed"));r.s.coreTopology.on("serverOpening",relay("serverOpening"));r.s.coreTopology.on("serverClosed",relay("serverClosed"));r.s.coreTopology.on("topologyOpening",relay("topologyOpening"));r.s.coreTopology.on("topologyClosed",relay("topologyClosed"));r.s.coreTopology.on("topologyDescriptionChanged",relay("topologyDescriptionChanged"));r.s.coreTopology.on("commandStarted",relay("commandStarted"));r.s.coreTopology.on("commandSucceeded",relay("commandSucceeded"));r.s.coreTopology.on("commandFailed",relay("commandFailed"));r.s.coreTopology.on("fullsetup",(function(){r.emit("fullsetup",r,r)}));r.s.coreTopology.on("all",(function(){r.emit("all",null,r)}));var connectHandler=function(){r.s.coreTopology.once("timeout",errorHandler("timeout"));r.s.coreTopology.once("error",errorHandler("error"));r.s.coreTopology.once("close",errorHandler("close"));r.emit("open",null,r);try{t(null,r)}catch(e){process.nextTick((function(){throw e}))}};var connectErrorHandler=function(){return function(e){["timeout","error","close"].forEach((function(e){r.s.coreTopology.removeListener(e,connectErrorHandler)}));r.s.coreTopology.removeListener("connect",connectErrorHandler);r.s.coreTopology.destroy();try{t(e)}catch(e){if(!r.s.coreTopology.isConnected())process.nextTick((function(){throw e}))}}};r.s.coreTopology.once("timeout",connectErrorHandler("timeout"));r.s.coreTopology.once("error",connectErrorHandler("error"));r.s.coreTopology.once("close",connectErrorHandler("close"));r.s.coreTopology.once("connect",connectHandler);r.s.coreTopology.connect(e)}close(e,t){["timeout","error","close","joined","left"].forEach((e=>this.removeAllListeners(e)));super.close(e,t)}}Object.defineProperty(ReplSet.prototype,"haInterval",{enumerable:true,get:function(){return this.s.coreTopology.s.haInterval}});e.exports=ReplSet},8421:(e,t,r)=>{"use strict";const n=r(3994).Server;const o=r(7159);const s=r(8589).oF;const i=r(8589).yh;const a=r(3994).MongoError;const c=r(1371).MAX_JS_INT;const l=r(1371).translateOptions;const u=r(1371).filterOptions;const d=r(1371).mergeOptions;var p=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","family","loggerLevel","logger","reconnectTries","reconnectInterval","monitoring","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","compression","promiseLibrary","monitorCommands"];class Server extends s{constructor(e,t,r){super();var s=this;r=u(r,p);const h=r.promiseLibrary;var m={force:false,bufferMaxEntries:typeof r.bufferMaxEntries==="number"?r.bufferMaxEntries:c};var y=r.store||new i(s,m);if(e.indexOf("/")!==-1){if(t!=null&&typeof t==="object"){r=t;t=null}}else if(t==null){throw a.create({message:"port must be specified",driver:true})}var g=typeof r.auto_reconnect==="boolean"?r.auto_reconnect:true;g=typeof r.autoReconnect==="boolean"?r.autoReconnect:g;var v=d({},{host:e,port:t,disconnectHandler:y,cursorFactory:o,reconnect:g,emitError:typeof r.emitError==="boolean"?r.emitError:true,size:typeof r.poolSize==="number"?r.poolSize:5,monitorCommands:typeof r.monitorCommands==="boolean"?r.monitorCommands:false});v=l(v,r);var b=r.socketOptions&&Object.keys(r.socketOptions).length>0?r.socketOptions:r;v=l(v,b);this.s={coreTopology:new n(v),sCapabilities:null,clonedOptions:v,reconnect:v.reconnect,emitError:v.emitError,poolSize:v.size,storeOptions:m,store:y,host:e,port:t,options:r,sessionPool:null,sessions:new Set,promiseLibrary:h||Promise}}connect(e,t){var r=this;if("function"===typeof e)t=e,e={};if(e==null)e=this.s.clonedOptions;if(!("function"===typeof t))t=null;e=Object.assign({},this.s.clonedOptions,e);r.s.options=e;r.s.storeOptions.bufferMaxEntries=typeof e.bufferMaxEntries==="number"?e.bufferMaxEntries:-1;var connectErrorHandler=function(){return function(e){var o=["timeout","error","close"];o.forEach((function(e){r.s.coreTopology.removeListener(e,n[e])}));r.s.coreTopology.removeListener("connect",connectErrorHandler);try{t(e)}catch(e){process.nextTick((function(){throw e}))}}};var errorHandler=function(e){return function(t){if(e!=="error"){r.emit(e,t)}}};var reconnectHandler=function(){r.emit("reconnect",r);r.s.store.execute()};var reconnectFailedHandler=function(e){r.emit("reconnectFailed",e);r.s.store.flush(e)};var destroyHandler=function(){r.s.store.flush()};var relay=function(e){return function(t,n){r.emit(e,t,n)}};var connectHandler=function(){["timeout","error","close","destroy"].forEach((function(e){r.s.coreTopology.removeAllListeners(e)}));r.s.coreTopology.on("timeout",errorHandler("timeout"));r.s.coreTopology.once("error",errorHandler("error"));r.s.coreTopology.on("close",errorHandler("close"));r.s.coreTopology.on("destroy",destroyHandler);r.emit("open",null,r);try{t(null,r)}catch(e){process.nextTick((function(){throw e}))}};var n={timeout:connectErrorHandler("timeout"),error:connectErrorHandler("error"),close:connectErrorHandler("close")};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach((function(e){r.s.coreTopology.removeAllListeners(e)}));r.s.coreTopology.once("timeout",n.timeout);r.s.coreTopology.once("error",n.error);r.s.coreTopology.once("close",n.close);r.s.coreTopology.once("connect",connectHandler);r.s.coreTopology.on("reconnect",reconnectHandler);r.s.coreTopology.on("reconnectFailed",reconnectFailedHandler);r.s.coreTopology.on("serverDescriptionChanged",relay("serverDescriptionChanged"));r.s.coreTopology.on("serverHeartbeatStarted",relay("serverHeartbeatStarted"));r.s.coreTopology.on("serverHeartbeatSucceeded",relay("serverHeartbeatSucceeded"));r.s.coreTopology.on("serverHeartbeatFailed",relay("serverHeartbeatFailed"));r.s.coreTopology.on("serverOpening",relay("serverOpening"));r.s.coreTopology.on("serverClosed",relay("serverClosed"));r.s.coreTopology.on("topologyOpening",relay("topologyOpening"));r.s.coreTopology.on("topologyClosed",relay("topologyClosed"));r.s.coreTopology.on("topologyDescriptionChanged",relay("topologyDescriptionChanged"));r.s.coreTopology.on("commandStarted",relay("commandStarted"));r.s.coreTopology.on("commandSucceeded",relay("commandSucceeded"));r.s.coreTopology.on("commandFailed",relay("commandFailed"));r.s.coreTopology.on("attemptReconnect",relay("attemptReconnect"));r.s.coreTopology.on("monitoring",relay("monitoring"));r.s.coreTopology.connect(e)}}Object.defineProperty(Server.prototype,"poolSize",{enumerable:true,get:function(){return this.s.coreTopology.connections().length}});Object.defineProperty(Server.prototype,"autoReconnect",{enumerable:true,get:function(){return this.s.reconnect}});Object.defineProperty(Server.prototype,"host",{enumerable:true,get:function(){return this.s.host}});Object.defineProperty(Server.prototype,"port",{enumerable:true,get:function(){return this.s.port}});e.exports=Server},8589:(e,t,r)=>{"use strict";const n=r(8614),o=r(3994).MongoError,s=r(1669).format,i=r(3994).ReadPreference,a=r(3994).Sessions.ClientSession;var Store=function(e,t){var r=this;var n=[];t=t||{force:false,bufferMaxEntries:-1};this.s={storedOps:n,storeOptions:t,topology:e};Object.defineProperty(this,"length",{enumerable:true,get:function(){return r.s.storedOps.length}})};Store.prototype.add=function(e,t,r,n,i){if(this.s.storeOptions.force){return i(o.create({message:"db closed by application",driver:true}))}if(this.s.storeOptions.bufferMaxEntries===0){return i(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:true}))}if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries){while(this.s.storedOps.length>0){var a=this.s.storedOps.shift();a.c(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:true}))}return}this.s.storedOps.push({t:e,n:t,o:r,op:n,c:i})};Store.prototype.addObjectAndMethod=function(e,t,r,n,i){if(this.s.storeOptions.force){return i(o.create({message:"db closed by application",driver:true}))}if(this.s.storeOptions.bufferMaxEntries===0){return i(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:true}))}if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries){while(this.s.storedOps.length>0){var a=this.s.storedOps.shift();a.c(o.create({message:s("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:true}))}return}this.s.storedOps.push({t:e,m:r,o:t,p:n,c:i})};Store.prototype.flush=function(e){while(this.s.storedOps.length>0){this.s.storedOps.shift().c(e||o.create({message:s("no connection available for operation"),driver:true}))}};var c=["primary","primaryPreferred","nearest","secondaryPreferred"];var l=["secondary","secondaryPreferred"];Store.prototype.execute=function(e){e=e||{};var t=this.s.storedOps;this.s.storedOps=[];var r=typeof e.executePrimary==="boolean"?e.executePrimary:true;var n=typeof e.executeSecondary==="boolean"?e.executeSecondary:true;while(t.length>0){var o=t.shift();if(o.t==="cursor"){if(r&&n){o.o[o.m].apply(o.o,o.p)}else if(r&&o.o.options&&o.o.options.readPreference&&c.indexOf(o.o.options.readPreference.mode)!==-1){o.o[o.m].apply(o.o,o.p)}else if(!r&&n&&o.o.options&&o.o.options.readPreference&&l.indexOf(o.o.options.readPreference.mode)!==-1){o.o[o.m].apply(o.o,o.p)}}else if(o.t==="auth"){this.s.topology[o.t].apply(this.s.topology,o.o)}else{if(r&&n){this.s.topology[o.t](o.n,o.o,o.op,o.c)}else if(r&&o.op&&o.op.readPreference&&c.indexOf(o.op.readPreference.mode)!==-1){this.s.topology[o.t](o.n,o.o,o.op,o.c)}else if(!r&&n&&o.op&&o.op.readPreference&&l.indexOf(o.op.readPreference.mode)!==-1){this.s.topology[o.t](o.n,o.o,o.op,o.c)}}}};Store.prototype.all=function(){return this.s.storedOps};var ServerCapabilities=function(e){var setup_get_property=function(e,t,r){Object.defineProperty(e,t,{enumerable:true,get:function(){return r}})};var t=false;var r=false;var n=false;var o=false;var s=false;var i=false;var a=e.maxWriteBatchSize||1e3;var c=false;var l=false;if(e.minWireVersion>=0){n=true}if(e.maxWireVersion>=1){t=true;o=true}if(e.maxWireVersion>=2){r=true}if(e.maxWireVersion>=3){s=true;i=true}if(e.maxWireVersion>=5){c=true;l=true}if(e.minWireVersion==null){e.minWireVersion=0}if(e.maxWireVersion==null){e.maxWireVersion=0}setup_get_property(this,"hasAggregationCursor",t);setup_get_property(this,"hasWriteCommands",r);setup_get_property(this,"hasTextSearch",n);setup_get_property(this,"hasAuthCommands",o);setup_get_property(this,"hasListCollectionsCommand",s);setup_get_property(this,"hasListIndexesCommand",i);setup_get_property(this,"minWireVersion",e.minWireVersion);setup_get_property(this,"maxWireVersion",e.maxWireVersion);setup_get_property(this,"maxNumberOfDocsInBatch",a);setup_get_property(this,"commandsTakeWriteConcern",c);setup_get_property(this,"commandsTakeCollation",l)};class TopologyBase extends n{constructor(){super();this.setMaxListeners(Infinity)}hasSessionSupport(){return this.logicalSessionTimeoutMinutes!=null}startSession(e,t){const r=new a(this,this.s.sessionPool,e,t);r.once("ended",(()=>{this.s.sessions.delete(r)}));this.s.sessions.add(r);return r}endSessions(e,t){return this.s.coreTopology.endSessions(e,t)}get clientMetadata(){return this.s.coreTopology.s.options.metadata}capabilities(){if(this.s.sCapabilities)return this.s.sCapabilities;if(this.s.coreTopology.lastIsMaster()==null)return null;this.s.sCapabilities=new ServerCapabilities(this.s.coreTopology.lastIsMaster());return this.s.sCapabilities}command(e,t,r,n){this.s.coreTopology.command(e.toString(),t,i.translate(r),n)}insert(e,t,r,n){this.s.coreTopology.insert(e.toString(),t,r,n)}update(e,t,r,n){this.s.coreTopology.update(e.toString(),t,r,n)}remove(e,t,r,n){this.s.coreTopology.remove(e.toString(),t,r,n)}isConnected(e){e=e||{};e=i.translate(e);return this.s.coreTopology.isConnected(e)}isDestroyed(){return this.s.coreTopology.isDestroyed()}cursor(e,t,r){r=r||{};r=i.translate(r);r.disconnectHandler=this.s.store;r.topology=this;return this.s.coreTopology.cursor(e,t,r)}lastIsMaster(){return this.s.coreTopology.lastIsMaster()}selectServer(e,t,r){return this.s.coreTopology.selectServer(e,t,r)}unref(){return this.s.coreTopology.unref()}connections(){return this.s.coreTopology.connections()}close(e,t){this.s.sessions.forEach((e=>e.endSession()));if(this.s.sessionPool){this.s.sessionPool.endAllPooledSessions()}if(e===true){this.s.storeOptions.force=e;this.s.store.flush()}this.s.coreTopology.destroy({force:typeof e==="boolean"?e:false},t)}}Object.defineProperty(TopologyBase.prototype,"bson",{enumerable:true,get:function(){return this.s.coreTopology.s.bson}});Object.defineProperty(TopologyBase.prototype,"parserType",{enumerable:true,get:function(){return this.s.coreTopology.parserType}});Object.defineProperty(TopologyBase.prototype,"logicalSessionTimeoutMinutes",{enumerable:true,get:function(){return this.s.coreTopology.logicalSessionTimeoutMinutes}});Object.defineProperty(TopologyBase.prototype,"type",{enumerable:true,get:function(){return this.s.coreTopology.type}});t.yh=Store;t.ug=ServerCapabilities;t.oF=TopologyBase},8729:(e,t,r)=>{"use strict";const n=r(3994).ReadPreference;const o=r(8835);const s=r(1669).format;const i=r(3994).Logger;const a=r(881);const c=r(7289);const l=r(1191);const u=r(3111).MongoParseError;e.exports=function(e,t,r){if(typeof t==="function")r=t,t={};t=t||{};let n;try{n=o.parse(e,true)}catch(e){return r(new Error("URL malformed, cannot be parsed"))}if(n.protocol!=="mongodb:"&&n.protocol!=="mongodb+srv:"){return r(new Error("Invalid schema, expected `mongodb` or `mongodb+srv`"))}if(n.protocol==="mongodb:"){return parseHandler(e,t,r)}if(n.hostname.split(".").length<3){return r(new Error("URI does not have hostname, domain name and tld"))}n.domainLength=n.hostname.split(".").length;const s=e.substring("mongodb+srv://".length).split("/")[0];if(s.match(",")){return r(new Error("Invalid URI, cannot contain multiple hostnames"))}if(n.port){return r(new Error("Ports not accepted with `mongodb+srv` URIs"))}let i=`_mongodb._tcp.${n.host}`;a.resolveSrv(i,(function(e,o){if(e)return r(e);if(o.length===0){return r(new Error("No addresses found at host"))}for(let e=0;e<o.length;e++){if(!matchesParentDomain(o[e].name,n.hostname,n.domainLength)){return r(new Error("Server record does not share hostname with parent URI"))}}let s=n.auth?`mongodb://${n.auth}@`:`mongodb://`;let i=o.map((function(e,t){if(t===0)return`${s}${e.name}:${e.port}`;else return`${e.name}:${e.port}`}));let c=i.join(",")+"/";let d=[];if(n.path){let e=n.path.slice(1);if(e.indexOf("?")!==-1){e=e.slice(0,e.indexOf("?"))}c+=e}if(!t.ssl&&!n.search){d.push("ssl=true")}else if(!t.ssl&&n.search&&!n.search.match("ssl")){d.push("ssl=true")}if(n.search){d.push(n.search.replace("?",""))}a.resolveTxt(n.host,(function(e,n){if(e&&e.code!=="ENODATA"&&e.code!=="ENOTFOUND")return r(e);if(e&&e.code==="ENODATA")n=null;if(n){if(n.length>1){return r(new u("Multiple text records not allowed"))}n=n[0].join("");const e=l.parse(n);const t=Object.keys(e);if(t.some((e=>e!=="authSource"&&e!=="replicaSet"))){return r(new u("Text record must only set `authSource` or `replicaSet`"))}if(t.length>0){d.push(n)}}if(d.length){c+=`?${d.join("&")}`}parseHandler(c,t,r)}))}))};function matchesParentDomain(e,t){let r=/^.*?\./;let n=`.${e.replace(r,"")}`;let o=`.${t.replace(r,"")}`;if(n.endsWith(o))return true;else return false}function parseHandler(e,t,r){let n,o;try{n=parseConnectionString(e,t)}catch(e){o=e}return o?r(o,null):r(null,n)}function parseConnectionString(e,t){let r="";let a="";let l="";let u="admin";let d=o.parse(e,true);if((d.hostname==null||d.hostname==="")&&e.indexOf(".sock")===-1){throw new Error("No hostname or hostnames provided in connection string")}if(d.port==="0"){throw new Error("Invalid port (zero) with hostname")}if(!isNaN(parseInt(d.port,10))&&parseInt(d.port,10)>65535){throw new Error("Invalid port (larger than 65535) with hostname")}if(d.path&&d.path.length>0&&d.path[0]!=="/"&&e.indexOf(".sock")===-1){throw new Error("Missing delimiting slash between hosts and options")}if(d.query){for(let e in d.query){if(e.indexOf("::")!==-1){throw new Error("Double colon in host identifier")}if(d.query[e]===""){throw new Error("Query parameter "+e+" is an incomplete value pair")}}}if(d.auth){let t=d.auth.split(":");if(e.indexOf(d.auth)!==-1&&t.length>2){throw new Error("Username with password containing an unescaped colon")}if(e.indexOf(d.auth)!==-1&&d.auth.indexOf("@")!==-1){throw new Error("Username containing an unescaped at-sign")}}let p=e.split("?").shift();let h=p.split(",");let m=[];for(let e=0;e<h.length;e++){let t=h[e];if(t.indexOf("mongodb")!==-1){if(t.indexOf("@")!==-1){m.push(t.split("@").pop())}else{m.push(t.substr("mongodb://".length))}}else if(t.indexOf("/")!==-1){m.push(t.split("/").shift())}else if(t.indexOf("/")===-1){m.push(t.trim())}}for(let e=0;e<m.length;e++){let t=o.parse(s("mongodb://%s",m[e].trim()));if(t.path&&t.path.indexOf(".sock")!==-1)continue;if(t.path&&t.path.indexOf(":")!==-1){if(t.path.split("/").length>1&&t.path.indexOf("::")===-1){throw new Error("Slash in host identifier")}else{throw new Error("Double colon in host identifier")}}}if(e.indexOf("?")!==-1){l=e.substr(e.indexOf("?")+1);r=e.substring("mongodb://".length,e.indexOf("?"))}else{r=e.substring("mongodb://".length)}if(r.indexOf("@")!==-1){a=r.split("@")[0];r=r.split("@")[1]}if(r.split("/").length>2){throw new Error("Unsupported host '"+r.split("?")[0]+"', hosts must be URL encoded and contain at most one unencoded slash")}if(r.indexOf(".sock")!==-1){if(r.indexOf(".sock/")!==-1){u=r.split(".sock/")[1];if(u.indexOf("/")!==-1){if(u.split("/").length===2&&u.split("/")[1].length===0){throw new Error("Illegal trailing backslash after database name")}throw new Error("More than 1 database name in URL")}r=r.split("/",r.indexOf(".sock")+".sock".length)}}else if(r.indexOf("/")!==-1){if(r.split("/").length>2){if(r.split("/")[2].length===0){throw new Error("Illegal trailing backslash after database name")}throw new Error("More than 1 database name in URL")}u=r.split("/")[1];r=r.split("/")[0]}r=decodeURIComponent(r);let y={};let g=a||"";let v=g.split(":",2);let b=decodeURIComponent(v[0]);if(v[0]!==encodeURIComponent(b)){throw new Error("Username contains an illegal unescaped character")}v[0]=b;if(v[1]){let e=decodeURIComponent(v[1]);if(v[1]!==encodeURIComponent(e)){throw new Error("Password contains an illegal unescaped character")}v[1]=e}if(v.length===2)y.auth={user:v[0],password:v[1]};if(t&&t.auth!=null)y.auth=t.auth;let S;let w;let _;let E;let O={socketOptions:{}};let C={read_preference_tags:[]};let T={socketOptions:{}};let I={socketOptions:{}};y.server_options=O;y.db_options=C;y.rs_options=T;y.mongos_options=I;if(e.match(/\.sock/)){let t=e.substring(e.indexOf("mongodb://")+"mongodb://".length,e.lastIndexOf(".sock")+".sock".length);if(t.indexOf("@")!==-1)t=t.split("@")[1];t=decodeURIComponent(t);_=[{domain_socket:t}]}else{S=r;let e={};_=S.split(",").map((function(t){let r,n,o;if(o=/\[([^\]]+)\](?::(.+))?/.exec(t)){r=o[1];n=parseInt(o[2],10)||27017}else{let e=t.split(":",2);r=e[0]||"localhost";n=e[1]!=null?parseInt(e[1],10):27017;if(r.indexOf("?")!==-1)r=r.split(/\?/)[0]}if(e[r+"_"+n])return null;e[r+"_"+n]=1;return{host:r,port:n}})).filter((function(e){return e!=null}))}y.dbName=u||"admin";w=(l||"").split(/[&;]/);w.forEach((function(e){if(!e)return;var t=e.split("="),r=t[0],o=t[1];switch(r){case"slaveOk":case"slave_ok":O.slave_ok=o==="true";C.slaveOk=o==="true";break;case"maxPoolSize":case"poolSize":O.poolSize=parseInt(o,10);T.poolSize=parseInt(o,10);break;case"appname":y.appname=decodeURIComponent(o);break;case"autoReconnect":case"auto_reconnect":O.auto_reconnect=o==="true";break;case"ssl":if(o==="prefer"){O.ssl=o;T.ssl=o;I.ssl=o;break}O.ssl=o==="true";T.ssl=o==="true";I.ssl=o==="true";break;case"sslValidate":O.sslValidate=o==="true";T.sslValidate=o==="true";I.sslValidate=o==="true";break;case"replicaSet":case"rs_name":T.rs_name=o;break;case"reconnectWait":T.reconnectWait=parseInt(o,10);break;case"retries":T.retries=parseInt(o,10);break;case"readSecondary":case"read_secondary":T.read_secondary=o==="true";break;case"fsync":C.fsync=o==="true";break;case"journal":C.j=o==="true";break;case"safe":C.safe=o==="true";break;case"nativeParser":case"native_parser":C.native_parser=o==="true";break;case"readConcernLevel":C.readConcern=new c(o);break;case"connectTimeoutMS":O.socketOptions.connectTimeoutMS=parseInt(o,10);T.socketOptions.connectTimeoutMS=parseInt(o,10);I.socketOptions.connectTimeoutMS=parseInt(o,10);break;case"socketTimeoutMS":O.socketOptions.socketTimeoutMS=parseInt(o,10);T.socketOptions.socketTimeoutMS=parseInt(o,10);I.socketOptions.socketTimeoutMS=parseInt(o,10);break;case"w":C.w=parseInt(o,10);if(isNaN(C.w))C.w=o;break;case"authSource":C.authSource=o;break;case"gssapiServiceName":C.gssapiServiceName=o;break;case"authMechanism":if(o==="GSSAPI"){if(y.auth==null){let e=decodeURIComponent(g);if(e.indexOf("@")===-1)throw new Error("GSSAPI requires a provided principal");y.auth={user:e,password:null}}else{y.auth.user=decodeURIComponent(y.auth.user)}}else if(o==="MONGODB-X509"){y.auth={user:decodeURIComponent(g)}}if(o!=="GSSAPI"&&o!=="MONGODB-X509"&&o!=="MONGODB-CR"&&o!=="DEFAULT"&&o!=="SCRAM-SHA-1"&&o!=="SCRAM-SHA-256"&&o!=="PLAIN")throw new Error("Only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, or SCRAM-SHA-1 is supported by authMechanism");C.authMechanism=o;break;case"authMechanismProperties":{let e=o.split(",");let t={};e.forEach((function(e){let r=e.split(":");t[r[0]]=r[1]}));C.authMechanismProperties=t;if(typeof t.SERVICE_NAME==="string")C.gssapiServiceName=t.SERVICE_NAME;if(typeof t.SERVICE_REALM==="string")C.gssapiServiceRealm=t.SERVICE_REALM;if(typeof t.CANONICALIZE_HOST_NAME==="string")C.gssapiCanonicalizeHostName=t.CANONICALIZE_HOST_NAME==="true"?true:false}break;case"wtimeoutMS":C.wtimeout=parseInt(o,10);break;case"readPreference":if(!n.isValid(o))throw new Error("readPreference must be either primary/primaryPreferred/secondary/secondaryPreferred/nearest");C.readPreference=o;break;case"maxStalenessSeconds":C.maxStalenessSeconds=parseInt(o,10);break;case"readPreferenceTags":{o=decodeURIComponent(o);let e={};if(o==null||o===""){C.read_preference_tags.push(e);break}let t=o.split(/,/);for(let r=0;r<t.length;r++){let n=t[r].trim().split(/:/);e[n[0]]=n[1]}C.read_preference_tags.push(e)}break;case"compressors":{E=O.compression||{};let e=o.split(",");if(!e.every((function(e){return e==="snappy"||e==="zlib"}))){throw new Error("Compressors must be at least one of snappy or zlib")}E.compressors=e;O.compression=E}break;case"zlibCompressionLevel":{E=O.compression||{};let e=parseInt(o,10);if(e<-1||e>9){throw new Error("zlibCompressionLevel must be an integer between -1 and 9")}E.zlibCompressionLevel=e;O.compression=E}break;case"retryWrites":C.retryWrites=o==="true";break;case"minSize":C.minSize=parseInt(o,10);break;default:{let e=i("URL Parser");e.warn(`${r} is not supported as a connection string option`)}break}}));if(C.read_preference_tags.length===0){C.read_preference_tags=null}if((C.w===-1||C.w===0)&&(C.journal===true||C.fsync===true||C.safe===true))throw new Error("w set to -1 or 0 cannot be combined with safe/w/journal/fsync");if(!C.readPreference){C.readPreference="primary"}C=Object.assign(C,t);y.servers=_;return y}},1371:(e,t,r)=>{"use strict";const n=r(3111).MongoError;const o=r(2481);var shallowClone=function(e){var t={};for(var r in e)t[r]=e[r];return t};var getSingleProperty=function(e,t,r){Object.defineProperty(e,t,{enumerable:true,get:function(){return r}})};var s=t.formatSortValue=function(e){var t=(""+e).toLowerCase();switch(t){case"ascending":case"asc":case"1":return 1;case"descending":case"desc":case"-1":return-1;default:throw new Error("Illegal sort clause, must be of the form "+"[['field1', '(ascending|descending)'], "+"['field2', '(ascending|descending)']]")}};var i=t.formattedOrderClause=function(e){var t=new Map;if(e==null)return null;if(Array.isArray(e)){if(e.length===0){return null}for(var r=0;r<e.length;r++){if(e[r].constructor===String){t.set(`${e[r]}`,1)}else{t.set(`${e[r][0]}`,s(e[r][1]))}}}else if(e!=null&&typeof e==="object"){if(e instanceof Map){t=e}else{var n=Object.keys(e);for(var o of n){t.set(o,e[o])}}}else if(typeof e==="string"){t.set(`${e}`,1)}else{throw new Error("Illegal sort clause, must be of the form "+"[['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]")}return t};var a=function checkCollectionName(e){if("string"!==typeof e){throw new n("collection name must be a String")}if(!e||e.indexOf("..")!==-1){throw new n("collection names cannot be empty")}if(e.indexOf("$")!==-1&&e.match(/((^\$cmd)|(oplog\.\$main))/)==null){throw new n("collection names must not contain '$'")}if(e.match(/^\.|\.$/)!=null){throw new n("collection names must not start or end with '.'")}if(e.indexOf("\0")!==-1){throw new n("collection names cannot contain a null character")}};var handleCallback=function(e,t,r,n){try{if(e==null)return;if(e){return n?e(t,r,n):e(t,r)}}catch(t){process.nextTick((function(){throw t}));return false}return true};var toError=function(e){if(e instanceof Error)return e;var t=e.err||e.errmsg||e.errMessage||e;var r=n.create({message:t,driver:true});var o=typeof e==="object"?Object.keys(e):[];for(var s=0;s<o.length;s++){try{r[o[s]]=e[o[s]]}catch(e){}}return r};var c=function normalizeHintField(e){var t=null;if(typeof e==="string"){t=e}else if(Array.isArray(e)){t={};e.forEach((function(e){t[e]=1}))}else if(e!=null&&typeof e==="object"){t={};for(var r in e){t[r]=e[r]}}return t};var parseIndexOptions=function(e){var t={};var r=[];var n;if("string"===typeof e){r.push(e+"_"+1);t[e]=1}else if(Array.isArray(e)){e.forEach((function(e){if("string"===typeof e){r.push(e+"_"+1);t[e]=1}else if(Array.isArray(e)){r.push(e[0]+"_"+(e[1]||1));t[e[0]]=e[1]||1}else if(l(e)){n=Object.keys(e);n.forEach((function(n){r.push(n+"_"+e[n]);t[n]=e[n]}))}else{}}))}else if(l(e)){n=Object.keys(e);n.forEach((function(n){r.push(n+"_"+e[n]);t[n]=e[n]}))}return{name:r.join("_"),keys:n,fieldHash:t}};var l=t.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)};var debugOptions=function(e,t){var r={};e.forEach((function(e){r[e]=t[e]}));return r};var decorateCommand=function(e,t,r){for(var n in t){if(r.indexOf(n)===-1)e[n]=t[n]}return e};var mergeOptions=function(e,t){for(var r in t){e[r]=t[r]}return e};var translateOptions=function(e,t){var r={sslCA:"ca",sslCRL:"crl",sslValidate:"rejectUnauthorized",sslKey:"key",sslCert:"cert",sslPass:"passphrase",socketTimeoutMS:"socketTimeout",connectTimeoutMS:"connectionTimeout",replicaSet:"setName",rs_name:"setName",secondaryAcceptableLatencyMS:"acceptableLatency",connectWithNoPrimary:"secondaryOnlyConnectionAllowed",acceptableLatencyMS:"localThresholdMS"};for(var n in t){if(r[n]){e[r[n]]=t[n]}else{e[n]=t[n]}}return e};var filterOptions=function(e,t){var r={};for(var n in e){if(t.indexOf(n)!==-1)r[n]=e[n]}return r};const u=["w","j","wtimeout","fsync","writeConcern"];function conditionallyMergeWriteConcern(e,t){let r=false;for(const t of u){if(t in e){r=true;break}}if(!r){for(const r of u){if(t[r]){if(!("writeConcern"in e)){e.writeConcern={}}e.writeConcern[r]=t[r]}}}return e}const executeLegacyOperation=(e,t,r,o)=>{if(e==null){throw new TypeError("This method requires a valid topology instance")}if(!Array.isArray(r)){throw new TypeError("This method requires an array of arguments to apply")}o=o||{};const s=e.s.promiseLibrary;let i=r[r.length-1];let a,c,l;if(!o.skipSessions&&e.hasSessionSupport()){c=r[r.length-2];if(c==null||c.session==null){l=Symbol();a=e.startSession({owner:l});const t=r.length-2;r[t]=Object.assign({},r[t],{session:a})}else if(c.session&&c.session.hasEnded){throw new n("Use of expired sessions is not permitted")}}const makeExecuteCallback=(e,t)=>function executeCallback(r,n){if(a&&a.owner===l&&!o.returnsCursor){a.endSession((()=>{delete c.session;if(r)return t(r);e(n)}))}else{if(r)return t(r);e(n)}};if(typeof i==="function"){i=r.pop();const e=makeExecuteCallback((e=>i(null,e)),(e=>i(e,null)));r.push(e);try{return t.apply(null,r)}catch(t){e(t);throw t}}if(r[r.length-1]!=null){throw new TypeError("final argument to `executeLegacyOperation` must be a callback")}return new s((function(e,n){const o=makeExecuteCallback(e,n);r[r.length-1]=o;try{return t.apply(null,r)}catch(e){o(e)}}))};function applyRetryableWrites(e,t){if(t&&t.s.options.retryWrites){e.retryWrites=true}return e}function applyWriteConcern(e,t,r){r=r||{};const n=t.db;const s=t.collection;if(r.session&&r.session.inTransaction()){if(e.writeConcern){delete e.writeConcern}return e}const i=o.fromOptions(r);if(i){return Object.assign(e,{writeConcern:i})}if(s&&s.writeConcern){return Object.assign(e,{writeConcern:Object.assign({},s.writeConcern)})}if(n&&n.writeConcern){return Object.assign(e,{writeConcern:Object.assign({},n.writeConcern)})}return e}function isPromiseLike(e){return e&&typeof e.then==="function"}function decorateWithCollation(e,t,r){const o=t.s&&t.s.topology||t.topology;if(!o){throw new TypeError('parameter "target" is missing a topology')}const s=o.capabilities();if(r.collation&&typeof r.collation==="object"){if(s&&s.commandsTakeCollation){e.collation=r.collation}else{throw new n(`Current topology does not support collation`)}}}function decorateWithReadConcern(e,t,r){if(r&&r.session&&r.session.inTransaction()){return}let n=Object.assign({},e.readConcern||{});if(t.s.readConcern){Object.assign(n,t.s.readConcern)}if(Object.keys(n).length>0){Object.assign(e,{readConcern:n})}}function decorateWithExplain(e,t){if(e.explain){return e}return{explain:e,verbosity:t.verbosity}}const d=+process.version.split(".")[0].substring(1);const emitProcessWarning=e=>d<=6?process.emitWarning(e,"DeprecationWarning",m):process.emitWarning(e,{type:"DeprecationWarning",code:m});const emitConsoleWarning=e=>console.error(e);const p=process.emitWarning?emitProcessWarning:emitConsoleWarning;function defaultMsgHandler(e,t){return`${e} option [${t}] is deprecated and will be removed in a later version.`}function deprecateOptions(e,t){if(process.noDeprecation===true){return t}const r=e.msgHandler?e.msgHandler:defaultMsgHandler;const n=new Set;function deprecated(){const o=arguments[e.optionsIndex];if(!l(o)||Object.keys(o).length===0){return t.apply(this,arguments)}e.deprecatedOptions.forEach((t=>{if(Object.prototype.hasOwnProperty.call(o,t)&&!n.has(t)){n.add(t);const o=r(e.name,t);p(o);if(this&&this.getLogger){const e=this.getLogger();if(e){e.warn(o)}}}}));return t.apply(this,arguments)}Object.setPrototypeOf(deprecated,t);if(t.prototype){deprecated.prototype=t.prototype}return deprecated}const h={};try{r(1749);h.ASYNC_ITERATOR=true}catch(e){h.ASYNC_ITERATOR=false}class MongoDBNamespace{constructor(e,t){this.db=e;this.collection=t}toString(){return this.collection?`${this.db}.${this.collection}`:this.db}withCollection(e){return new MongoDBNamespace(this.db,e)}static fromString(e){if(!e){throw new Error(`Cannot parse namespace from "${e}"`)}const t=e.indexOf(".");return new MongoDBNamespace(e.substring(0,t),e.substring(t+1))}}function*makeCounter(e){let t=e||0;while(true){const e=t;t+=1;yield e}}function maybePromise(e,t,r){const n=e&&e.s&&e.s.promiseLibrary||Promise;let o;if(typeof t!=="function"){o=new n(((e,r)=>{t=(t,n)=>{if(t)return r(t);e(n)}}))}r((function(e,r){if(e!=null){try{t(e)}catch(e){return process.nextTick((()=>{throw e}))}return}t(e,r)}));return o}function now(){const e=process.hrtime();return Math.floor(e[0]*1e3+e[1]/1e6)}function calculateDurationInMs(e){if(typeof e!=="number"){throw TypeError("numeric value required to calculate duration")}const t=now()-e;return t<0?0:t}function makeInterruptableAsyncInterval(e,t){let r;let n;let o;let s=false;t=t||{};const i=t.interval||1e3;const a=t.minInterval||500;const c=typeof t.immediate==="boolean"?t.immediate:false;const l=typeof t.clock==="function"?t.clock:now;function wake(){const e=l();const t=e-o;const r=e-n;const s=i-r;o=e;if(t<a){return}if(s>a){reschedule(a)}if(s<0){executeAndReschedule()}}function stop(){s=true;if(r){clearTimeout(r);r=null}n=0;o=0}function reschedule(e){if(s)return;clearTimeout(r);r=setTimeout(executeAndReschedule,e||i)}function executeAndReschedule(){o=0;n=l();e((e=>{if(e)throw e;reschedule(i)}))}if(c){executeAndReschedule()}else{n=l();reschedule()}return{wake:wake,stop:stop}}function hasAtomicOperators(e){if(Array.isArray(e)){return e.reduce(((e,t)=>e||hasAtomicOperators(t)),null)}return Object.keys(typeof e.toBSON!=="function"?e:e.toBSON()).map((e=>e[0])).indexOf("$")>=0}const m="MONGODB DRIVER";function emitWarning(e){if(process.emitWarning){return d<=6?process.emitWarning(e,undefined,m):process.emitWarning(e,{code:m})}else{return console.error(`[${m}] Warning:`,e)}}const y=new Set;function emitWarningOnce(e){if(!y.has(e)){y.add(e);return emitWarning(e)}}e.exports={filterOptions:filterOptions,mergeOptions:mergeOptions,translateOptions:translateOptions,shallowClone:shallowClone,getSingleProperty:getSingleProperty,checkCollectionName:a,toError:toError,formattedOrderClause:i,parseIndexOptions:parseIndexOptions,normalizeHintField:c,handleCallback:handleCallback,decorateCommand:decorateCommand,isObject:l,debugOptions:debugOptions,MAX_JS_INT:Number.MAX_SAFE_INTEGER+1,conditionallyMergeWriteConcern:conditionallyMergeWriteConcern,executeLegacyOperation:executeLegacyOperation,applyRetryableWrites:applyRetryableWrites,applyWriteConcern:applyWriteConcern,isPromiseLike:isPromiseLike,decorateWithCollation:decorateWithCollation,decorateWithReadConcern:decorateWithReadConcern,decorateWithExplain:decorateWithExplain,deprecateOptions:deprecateOptions,SUPPORTS:h,MongoDBNamespace:MongoDBNamespace,emitDeprecationWarning:p,makeCounter:makeCounter,maybePromise:maybePromise,now:now,calculateDurationInMs:calculateDurationInMs,makeInterruptableAsyncInterval:makeInterruptableAsyncInterval,hasAtomicOperators:hasAtomicOperators,MONGODB_WARNING_CODE:m,emitWarning:emitWarning,emitWarningOnce:emitWarningOnce}},2481:(e,t,r)=>{"use strict";const n=new Set(["w","wtimeout","j","journal","fsync"]);let o;class WriteConcern{constructor(e,t,r,n){if(e!=null){this.w=e}if(t!=null){this.wtimeout=t}if(r!=null){this.j=r}if(n!=null){this.fsync=n}}static fromOptions(e){if(e==null||e.writeConcern==null&&e.w==null&&e.wtimeout==null&&e.j==null&&e.journal==null&&e.fsync==null){return}if(e.writeConcern){if(typeof e.writeConcern==="string"){return new WriteConcern(e.writeConcern)}if(!Object.keys(e.writeConcern).some((e=>n.has(e)))){return}return new WriteConcern(e.writeConcern.w,e.writeConcern.wtimeout,e.writeConcern.j||e.writeConcern.journal,e.writeConcern.fsync)}if(!o)o=r(1371);o.emitWarningOnce(`Top-level use of w, wtimeout, j, and fsync is deprecated. Use writeConcern instead.`);return new WriteConcern(e.w,e.wtimeout,e.j||e.journal,e.fsync)}}e.exports=WriteConcern},900:e=>{var t=1e3;var r=t*60;var n=r*60;var o=n*24;var s=o*7;var i=o*365.25;e.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0){return parse(e)}else if(r==="number"&&isFinite(e)){return t.long?fmtLong(e):fmtShort(e)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function parse(e){e=String(e);if(e.length>100){return}var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a){return}var c=parseFloat(a[1]);var l=(a[2]||"ms").toLowerCase();switch(l){case"years":case"year":case"yrs":case"yr":case"y":return c*i;case"weeks":case"week":case"w":return c*s;case"days":case"day":case"d":return c*o;case"hours":case"hour":case"hrs":case"hr":case"h":return c*n;case"minutes":case"minute":case"mins":case"min":case"m":return c*r;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return undefined}}function fmtShort(e){var s=Math.abs(e);if(s>=o){return Math.round(e/o)+"d"}if(s>=n){return Math.round(e/n)+"h"}if(s>=r){return Math.round(e/r)+"m"}if(s>=t){return Math.round(e/t)+"s"}return e+"ms"}function fmtLong(e){var s=Math.abs(e);if(s>=o){return plural(e,s,o,"day")}if(s>=n){return plural(e,s,n,"hour")}if(s>=r){return plural(e,s,r,"minute")}if(s>=t){return plural(e,s,t,"second")}return e+" ms"}function plural(e,t,r,n){var o=t>=r*1.5;return Math.round(e/r)+" "+n+(o?"s":"")}},1156:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.findSync=t.find=t.findAsync=void 0;const n=r(4351);const o=r(5622);const s=r(5747);const i=r(8237);const a=i("new-find-package-json:main");function findAsync(e,t,r){return n.__asyncGenerator(this,arguments,(function*findAsync_1(){a(`findSync: called with "${e}" and "${t}" and "${r}"`);t=!!t?t:"";const s=!!r?r:"package.json";const i=!!t||o.isAbsolute(t)?t:process.cwd();let c=o.resolve(i,e);let l=false;while(c){if(c===o.parse(c).root){l=true}const e=o.resolve(c,s);a(`findSync: testing path "${e}"`);const t=yield n.__await(statPathAsync(e));if(!!t&&t.isFile()){a(`findSync: path exists and is file "${e}"`);yield yield n.__await(e);a(`findSync: after yield`)}if(l){break}c=o.resolve(c,"..")}}))}t.findAsync=findAsync;t.find=findAsync;function*findSync(e,t,r){a(`findSync: called with "${e}" and "${t}" and "${r}"`);t=!!t?t:"";const n=!!r?r:"package.json";const s=!!t||o.isAbsolute(t)?t:process.cwd();let i=o.resolve(s,e);let c=false;while(i){if(i===o.parse(i).root){c=true}const e=o.resolve(i,n);a(`findSync: testing path "${e}"`);const t=statPathSync(e);if(!!t&&t.isFile()){a(`findSync: path exists and is file "${e}"`);yield e;a(`findSync: after yield`)}if(c){break}i=o.resolve(i,"..")}}t.findSync=findSync;function statPathSync(e){try{return s.statSync(e)}catch(e){if(e.code==="ENOENT"){return undefined}throw e}}function statPathAsync(e){return n.__awaiter(this,void 0,void 0,(function*(){return s.promises.stat(e).catch((e=>{if(e.code==="ENOENT"){return undefined}throw e}))}))}},1223:(e,t,r)=>{var n=r(2940);e.exports=n(once);e.exports.strict=n(onceStrict);once.proto=once((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return once(this)},configurable:true});Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return onceStrict(this)},configurable:true})}));function once(e){var f=function(){if(f.called)return f.value;f.called=true;return f.value=e.apply(this,arguments)};f.called=false;return f}function onceStrict(e){var f=function(){if(f.called)throw new Error(f.onceError);f.called=true;return f.value=e.apply(this,arguments)};var t=e.name||"Function wrapped with `once`";f.onceError=t+" shouldn't be called more than once";f.called=false;return f}},3182:(e,t,r)=>{"use strict";const n=r(2357);function findModuleNotFound(e,t){const r=e.message.split("\n")[0];return r&&(r.includes(`'${t}'`)||r.includes(` ${t} `)||r.includes(` ${t}. `)||r.includes(` ${t}, `))}function _optionalRequire(e,t,r,o){let s;if(typeof o==="object"){s=o;n(!(s.hasOwnProperty("notFound")&&s.hasOwnProperty("default")),"optionalRequire: options set with both `notFound` and `default`")}else{s={message:o}}try{return t?e.resolve(r):e(r)}catch(e){if(e.code!=="MODULE_NOT_FOUND"||!findModuleNotFound(e,r)){if(typeof s.fail==="function"){return s.fail(e)}throw e}if(s.message){const e=typeof s.message==="string"?`${s.message} - `:"";const n=t?"resolved":"found";optionalRequire.log(`${e}optional module not ${n}`,r)}if(typeof s.notFound==="function"){return s.notFound(e)}return s.default}}const tryRequire=(e,t,r)=>_optionalRequire(e,false,t,r);const tryResolve=(e,t,r)=>_optionalRequire(e,true,t,r);function optionalRequire(e){const x=(t,r)=>tryRequire(e,t,r);x.resolve=(t,r)=>tryResolve(e,t,r);return x}optionalRequire.try=tryRequire;optionalRequire.tryResolve=tryResolve;optionalRequire.resolve=tryResolve;optionalRequire.log=(e,t)=>console.log(`Just FYI: ${e}; Path "${t}"`);e.exports=optionalRequire},6978:(e,t,r)=>{"use strict";const n=r(5747);const{promisify:o}=r(1669);const s=o(n.access);e.exports=async e=>{try{await s(e);return true}catch(e){return false}};e.exports.sync=e=>{try{n.accessSync(e);return true}catch(e){return false}}},8714:e=>{"use strict";function posix(e){return e.charAt(0)==="/"}function win32(e){var t=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/;var r=t.exec(e);var n=r[1]||"";var o=Boolean(n&&n.charAt(1)!==":");return Boolean(r[2]||o)}e.exports=process.platform==="win32"?win32:posix;e.exports.posix=posix;e.exports.win32=win32},4833:e=>{e.exports=Pend;function Pend(){this.pending=0;this.max=Infinity;this.listeners=[];this.waiting=[];this.error=null}Pend.prototype.go=function(e){if(this.pending<this.max){pendGo(this,e)}else{this.waiting.push(e)}};Pend.prototype.wait=function(e){if(this.pending===0){e(this.error)}else{this.listeners.push(e)}};Pend.prototype.hold=function(){return pendHold(this)};function pendHold(e){e.pending+=1;var t=false;return onCb;function onCb(r){if(t)throw new Error("callback called twice");t=true;e.error=e.error||r;e.pending-=1;if(e.waiting.length>0&&e.pending<e.max){pendGo(e,e.waiting.shift())}else if(e.pending===0){var n=e.listeners;e.listeners=[];n.forEach(cbListener)}}function cbListener(t){t(e.error)}}function pendGo(e,t){t(pendHold(e))}},8098:(e,t,r)=>{"use strict";const n=r(5622);const o=r(1812);const pkgDir=async e=>{const t=await o("package.json",{cwd:e});return t&&n.dirname(t)};e.exports=pkgDir;e.exports.default=pkgDir;e.exports.sync=e=>{const t=o.sync("package.json",{cwd:e});return t&&n.dirname(t)}},1812:(e,t,r)=>{"use strict";const n=r(5622);const o=r(5937);const s=r(6978);const i=Symbol("findUp.stop");e.exports=async(e,t={})=>{let r=n.resolve(t.cwd||"");const{root:s}=n.parse(r);const a=[].concat(e);const runMatcher=async t=>{if(typeof e!=="function"){return o(a,t)}const r=await e(t.cwd);if(typeof r==="string"){return o([r],t)}return r};while(true){const e=await runMatcher({...t,cwd:r});if(e===i){return}if(e){return n.resolve(r,e)}if(r===s){return}r=n.dirname(r)}};e.exports.sync=(e,t={})=>{let r=n.resolve(t.cwd||"");const{root:s}=n.parse(r);const a=[].concat(e);const runMatcher=t=>{if(typeof e!=="function"){return o.sync(a,t)}const r=e(t.cwd);if(typeof r==="string"){return o.sync([r],t)}return r};while(true){const e=runMatcher({...t,cwd:r});if(e===i){return}if(e){return n.resolve(r,e)}if(r===s){return}r=n.dirname(r)}};e.exports.exists=s;e.exports.sync.exists=s.sync;e.exports.stop=i},5937:(e,t,r)=>{"use strict";const n=r(5622);const o=r(5747);const{promisify:s}=r(1669);const i=r(6249);const a=s(o.stat);const c=s(o.lstat);const l={directory:"isDirectory",file:"isFile"};function checkType({type:e}){if(e in l){return}throw new Error(`Invalid type specified: ${e}`)}const matchType=(e,t)=>e===undefined||t[l[e]]();e.exports=async(e,t)=>{t={cwd:process.cwd(),type:"file",allowSymlinks:true,...t};checkType(t);const r=t.allowSymlinks?a:c;return i(e,(async e=>{try{const o=await r(n.resolve(t.cwd,e));return matchType(t.type,o)}catch(e){return false}}),t)};e.exports.sync=(e,t)=>{t={cwd:process.cwd(),allowSymlinks:true,type:"file",...t};checkType(t);const r=t.allowSymlinks?o.statSync:o.lstatSync;for(const o of e){try{const e=r(n.resolve(t.cwd,o));if(matchType(t.type,e)){return o}}catch(e){}}}},4752:(e,t,r)=>{"use strict";const n=r(7471);const pLimit=e=>{if(!((Number.isInteger(e)||e===Infinity)&&e>0)){return Promise.reject(new TypeError("Expected `concurrency` to be a number from 1 and up"))}const t=[];let r=0;const next=()=>{r--;if(t.length>0){t.shift()()}};const run=(e,t,...o)=>{r++;const s=n(e,...o);t(s);s.then(next,next)};const enqueue=(n,o,...s)=>{if(r<e){run(n,o,...s)}else{t.push(run.bind(null,n,o,...s))}};const generator=(e,...t)=>new Promise((r=>enqueue(e,r,...t)));Object.defineProperties(generator,{activeCount:{get:()=>r},pendingCount:{get:()=>t.length},clearQueue:{value:()=>{t.length=0}}});return generator};e.exports=pLimit;e.exports.default=pLimit},6249:(e,t,r)=>{"use strict";const n=r(4752);class EndError extends Error{constructor(e){super();this.value=e}}const testElement=async(e,t)=>t(await e);const finder=async e=>{const t=await Promise.all(e);if(t[1]===true){throw new EndError(t[0])}return false};const pLocate=async(e,t,r)=>{r={concurrency:Infinity,preserveOrder:true,...r};const o=n(r.concurrency);const s=[...e].map((e=>[e,o(testElement,e,t)]));const i=n(r.preserveOrder?1:Infinity);try{await Promise.all(s.map((e=>i(finder,e))))}catch(e){if(e instanceof EndError){return e.value}throw e}};e.exports=pLocate;e.exports.default=pLocate},7471:e=>{"use strict";const pTry=(e,...t)=>new Promise((r=>{r(e(...t))}));e.exports=pTry;e.exports.default=pTry},7214:e=>{"use strict";const t={};function createErrorType(e,r,n){if(!n){n=Error}function getMessage(e,t,n){if(typeof r==="string"){return r}else{return r(e,t,n)}}class NodeError extends n{constructor(e,t,r){super(getMessage(e,t,r))}}NodeError.prototype.name=n.name;NodeError.prototype.code=e;t[e]=NodeError}function oneOf(e,t){if(Array.isArray(e)){const r=e.length;e=e.map((e=>String(e)));if(r>2){return`one of ${t} ${e.slice(0,r-1).join(", ")}, or `+e[r-1]}else if(r===2){return`one of ${t} ${e[0]} or ${e[1]}`}else{return`of ${t} ${e[0]}`}}else{return`of ${t} ${String(e)}`}}function startsWith(e,t,r){return e.substr(!r||r<0?0:+r,t.length)===t}function endsWith(e,t,r){if(r===undefined||r>e.length){r=e.length}return e.substring(r-t.length,r)===t}function includes(e,t,r){if(typeof r!=="number"){r=0}if(r+t.length>e.length){return false}else{return e.indexOf(t,r)!==-1}}createErrorType("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError);createErrorType("ERR_INVALID_ARG_TYPE",(function(e,t,r){let n;if(typeof t==="string"&&startsWith(t,"not ")){n="must not be";t=t.replace(/^not /,"")}else{n="must be"}let o;if(endsWith(e," argument")){o=`The ${e} ${n} ${oneOf(t,"type")}`}else{const r=includes(e,".")?"property":"argument";o=`The "${e}" ${r} ${n} ${oneOf(t,"type")}`}o+=`. Received type ${typeof r}`;return o}),TypeError);createErrorType("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");createErrorType("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"}));createErrorType("ERR_STREAM_PREMATURE_CLOSE","Premature close");createErrorType("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"}));createErrorType("ERR_MULTIPLE_CALLBACK","Callback called multiple times");createErrorType("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");createErrorType("ERR_STREAM_WRITE_AFTER_END","write after end");createErrorType("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);createErrorType("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError);createErrorType("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");e.exports.q=t},1359:(e,t,r)=>{"use strict";var n=Object.keys||function(e){var t=[];for(var r in e){t.push(r)}return t};e.exports=Duplex;var o=r(1433);var s=r(6993);r(4124)(Duplex,o);{var i=n(s.prototype);for(var a=0;a<i.length;a++){var c=i[a];if(!Duplex.prototype[c])Duplex.prototype[c]=s.prototype[c]}}function Duplex(e){if(!(this instanceof Duplex))return new Duplex(e);o.call(this,e);s.call(this,e);this.allowHalfOpen=true;if(e){if(e.readable===false)this.readable=false;if(e.writable===false)this.writable=false;if(e.allowHalfOpen===false){this.allowHalfOpen=false;this.once("end",onend)}}}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:false,get:function get(){return this._writableState.highWaterMark}});Object.defineProperty(Duplex.prototype,"writableBuffer",{enumerable:false,get:function get(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(Duplex.prototype,"writableLength",{enumerable:false,get:function get(){return this._writableState.length}});function onend(){if(this._writableState.ended)return;process.nextTick(onEndNT,this)}function onEndNT(e){e.end()}Object.defineProperty(Duplex.prototype,"destroyed",{enumerable:false,get:function get(){if(this._readableState===undefined||this._writableState===undefined){return false}return this._readableState.destroyed&&this._writableState.destroyed},set:function set(e){if(this._readableState===undefined||this._writableState===undefined){return}this._readableState.destroyed=e;this._writableState.destroyed=e}})},1542:(e,t,r)=>{"use strict";e.exports=PassThrough;var n=r(4415);r(4124)(PassThrough,n);function PassThrough(e){if(!(this instanceof PassThrough))return new PassThrough(e);n.call(this,e)}PassThrough.prototype._transform=function(e,t,r){r(null,e)}},1433:(e,t,r)=>{"use strict";e.exports=Readable;var n;Readable.ReadableState=ReadableState;var o=r(8614).EventEmitter;var s=function EElistenerCount(e,t){return e.listeners(t).length};var i=r(2387);var a=r(4293).Buffer;var c=global.Uint8Array||function(){};function _uint8ArrayToBuffer(e){return a.from(e)}function _isUint8Array(e){return a.isBuffer(e)||e instanceof c}var l=r(1669);var u;if(l&&l.debuglog){u=l.debuglog("stream")}else{u=function debug(){}}var d=r(2746);var p=r(7049);var h=r(9948),m=h.getHighWaterMark;var y=r(7214).q,g=y.ERR_INVALID_ARG_TYPE,v=y.ERR_STREAM_PUSH_AFTER_EOF,b=y.ERR_METHOD_NOT_IMPLEMENTED,S=y.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;var w;var _;var E;r(4124)(Readable,i);var O=p.errorOrDestroy;var C=["error","close","destroy","pause","resume"];function prependListener(e,t,r){if(typeof e.prependListener==="function")return e.prependListener(t,r);if(!e._events||!e._events[t])e.on(t,r);else if(Array.isArray(e._events[t]))e._events[t].unshift(r);else e._events[t]=[r,e._events[t]]}function ReadableState(e,t,o){n=n||r(1359);e=e||{};if(typeof o!=="boolean")o=t instanceof n;this.objectMode=!!e.objectMode;if(o)this.objectMode=this.objectMode||!!e.readableObjectMode;this.highWaterMark=m(this,e,"readableHighWaterMark",o);this.buffer=new d;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.paused=true;this.emitClose=e.emitClose!==false;this.autoDestroy=!!e.autoDestroy;this.destroyed=false;this.defaultEncoding=e.defaultEncoding||"utf8";this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(e.encoding){if(!w)w=r(4841).s;this.decoder=new w(e.encoding);this.encoding=e.encoding}}function Readable(e){n=n||r(1359);if(!(this instanceof Readable))return new Readable(e);var t=this instanceof n;this._readableState=new ReadableState(e,this,t);this.readable=true;if(e){if(typeof e.read==="function")this._read=e.read;if(typeof e.destroy==="function")this._destroy=e.destroy}i.call(this)}Object.defineProperty(Readable.prototype,"destroyed",{enumerable:false,get:function get(){if(this._readableState===undefined){return false}return this._readableState.destroyed},set:function set(e){if(!this._readableState){return}this._readableState.destroyed=e}});Readable.prototype.destroy=p.destroy;Readable.prototype._undestroy=p.undestroy;Readable.prototype._destroy=function(e,t){t(e)};Readable.prototype.push=function(e,t){var r=this._readableState;var n;if(!r.objectMode){if(typeof e==="string"){t=t||r.defaultEncoding;if(t!==r.encoding){e=a.from(e,t);t=""}n=true}}else{n=true}return readableAddChunk(this,e,t,false,n)};Readable.prototype.unshift=function(e){return readableAddChunk(this,e,null,true,false)};function readableAddChunk(e,t,r,n,o){u("readableAddChunk",t);var s=e._readableState;if(t===null){s.reading=false;onEofChunk(e,s)}else{var i;if(!o)i=chunkInvalid(s,t);if(i){O(e,i)}else if(s.objectMode||t&&t.length>0){if(typeof t!=="string"&&!s.objectMode&&Object.getPrototypeOf(t)!==a.prototype){t=_uint8ArrayToBuffer(t)}if(n){if(s.endEmitted)O(e,new S);else addChunk(e,s,t,true)}else if(s.ended){O(e,new v)}else if(s.destroyed){return false}else{s.reading=false;if(s.decoder&&!r){t=s.decoder.write(t);if(s.objectMode||t.length!==0)addChunk(e,s,t,false);else maybeReadMore(e,s)}else{addChunk(e,s,t,false)}}}else if(!n){s.reading=false;maybeReadMore(e,s)}}return!s.ended&&(s.length<s.highWaterMark||s.length===0)}function addChunk(e,t,r,n){if(t.flowing&&t.length===0&&!t.sync){t.awaitDrain=0;e.emit("data",r)}else{t.length+=t.objectMode?1:r.length;if(n)t.buffer.unshift(r);else t.buffer.push(r);if(t.needReadable)emitReadable(e)}maybeReadMore(e,t)}function chunkInvalid(e,t){var r;if(!_isUint8Array(t)&&typeof t!=="string"&&t!==undefined&&!e.objectMode){r=new g("chunk",["string","Buffer","Uint8Array"],t)}return r}Readable.prototype.isPaused=function(){return this._readableState.flowing===false};Readable.prototype.setEncoding=function(e){if(!w)w=r(4841).s;var t=new w(e);this._readableState.decoder=t;this._readableState.encoding=this._readableState.decoder.encoding;var n=this._readableState.buffer.head;var o="";while(n!==null){o+=t.write(n.data);n=n.next}this._readableState.buffer.clear();if(o!=="")this._readableState.buffer.push(o);this._readableState.length=o.length;return this};var T=1073741824;function computeNewHighWaterMark(e){if(e>=T){e=T}else{e--;e|=e>>>1;e|=e>>>2;e|=e>>>4;e|=e>>>8;e|=e>>>16;e++}return e}function howMuchToRead(e,t){if(e<=0||t.length===0&&t.ended)return 0;if(t.objectMode)return 1;if(e!==e){if(t.flowing&&t.length)return t.buffer.head.data.length;else return t.length}if(e>t.highWaterMark)t.highWaterMark=computeNewHighWaterMark(e);if(e<=t.length)return e;if(!t.ended){t.needReadable=true;return 0}return t.length}Readable.prototype.read=function(e){u("read",e);e=parseInt(e,10);var t=this._readableState;var r=e;if(e!==0)t.emittedReadable=false;if(e===0&&t.needReadable&&((t.highWaterMark!==0?t.length>=t.highWaterMark:t.length>0)||t.ended)){u("read: emitReadable",t.length,t.ended);if(t.length===0&&t.ended)endReadable(this);else emitReadable(this);return null}e=howMuchToRead(e,t);if(e===0&&t.ended){if(t.length===0)endReadable(this);return null}var n=t.needReadable;u("need readable",n);if(t.length===0||t.length-e<t.highWaterMark){n=true;u("length less than watermark",n)}if(t.ended||t.reading){n=false;u("reading or ended",n)}else if(n){u("do read");t.reading=true;t.sync=true;if(t.length===0)t.needReadable=true;this._read(t.highWaterMark);t.sync=false;if(!t.reading)e=howMuchToRead(r,t)}var o;if(e>0)o=fromList(e,t);else o=null;if(o===null){t.needReadable=t.length<=t.highWaterMark;e=0}else{t.length-=e;t.awaitDrain=0}if(t.length===0){if(!t.ended)t.needReadable=true;if(r!==e&&t.ended)endReadable(this)}if(o!==null)this.emit("data",o);return o};function onEofChunk(e,t){u("onEofChunk");if(t.ended)return;if(t.decoder){var r=t.decoder.end();if(r&&r.length){t.buffer.push(r);t.length+=t.objectMode?1:r.length}}t.ended=true;if(t.sync){emitReadable(e)}else{t.needReadable=false;if(!t.emittedReadable){t.emittedReadable=true;emitReadable_(e)}}}function emitReadable(e){var t=e._readableState;u("emitReadable",t.needReadable,t.emittedReadable);t.needReadable=false;if(!t.emittedReadable){u("emitReadable",t.flowing);t.emittedReadable=true;process.nextTick(emitReadable_,e)}}function emitReadable_(e){var t=e._readableState;u("emitReadable_",t.destroyed,t.length,t.ended);if(!t.destroyed&&(t.length||t.ended)){e.emit("readable");t.emittedReadable=false}t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark;flow(e)}function maybeReadMore(e,t){if(!t.readingMore){t.readingMore=true;process.nextTick(maybeReadMore_,e,t)}}function maybeReadMore_(e,t){while(!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&t.length===0)){var r=t.length;u("maybeReadMore read 0");e.read(0);if(r===t.length)break}t.readingMore=false}Readable.prototype._read=function(e){O(this,new b("_read()"))};Readable.prototype.pipe=function(e,t){var r=this;var n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e);break}n.pipesCount+=1;u("pipe count=%d opts=%j",n.pipesCount,t);var o=(!t||t.end!==false)&&e!==process.stdout&&e!==process.stderr;var i=o?onend:unpipe;if(n.endEmitted)process.nextTick(i);else r.once("end",i);e.on("unpipe",onunpipe);function onunpipe(e,t){u("onunpipe");if(e===r){if(t&&t.hasUnpiped===false){t.hasUnpiped=true;cleanup()}}}function onend(){u("onend");e.end()}var a=pipeOnDrain(r);e.on("drain",a);var c=false;function cleanup(){u("cleanup");e.removeListener("close",onclose);e.removeListener("finish",onfinish);e.removeListener("drain",a);e.removeListener("error",onerror);e.removeListener("unpipe",onunpipe);r.removeListener("end",onend);r.removeListener("end",unpipe);r.removeListener("data",ondata);c=true;if(n.awaitDrain&&(!e._writableState||e._writableState.needDrain))a()}r.on("data",ondata);function ondata(t){u("ondata");var o=e.write(t);u("dest.write",o);if(o===false){if((n.pipesCount===1&&n.pipes===e||n.pipesCount>1&&indexOf(n.pipes,e)!==-1)&&!c){u("false write response, pause",n.awaitDrain);n.awaitDrain++}r.pause()}}function onerror(t){u("onerror",t);unpipe();e.removeListener("error",onerror);if(s(e,"error")===0)O(e,t)}prependListener(e,"error",onerror);function onclose(){e.removeListener("finish",onfinish);unpipe()}e.once("close",onclose);function onfinish(){u("onfinish");e.removeListener("close",onclose);unpipe()}e.once("finish",onfinish);function unpipe(){u("unpipe");r.unpipe(e)}e.emit("pipe",r);if(!n.flowing){u("pipe resume");r.resume()}return e};function pipeOnDrain(e){return function pipeOnDrainFunctionResult(){var t=e._readableState;u("pipeOnDrain",t.awaitDrain);if(t.awaitDrain)t.awaitDrain--;if(t.awaitDrain===0&&s(e,"data")){t.flowing=true;flow(e)}}}Readable.prototype.unpipe=function(e){var t=this._readableState;var r={hasUnpiped:false};if(t.pipesCount===0)return this;if(t.pipesCount===1){if(e&&e!==t.pipes)return this;if(!e)e=t.pipes;t.pipes=null;t.pipesCount=0;t.flowing=false;if(e)e.emit("unpipe",this,r);return this}if(!e){var n=t.pipes;var o=t.pipesCount;t.pipes=null;t.pipesCount=0;t.flowing=false;for(var s=0;s<o;s++){n[s].emit("unpipe",this,{hasUnpiped:false})}return this}var i=indexOf(t.pipes,e);if(i===-1)return this;t.pipes.splice(i,1);t.pipesCount-=1;if(t.pipesCount===1)t.pipes=t.pipes[0];e.emit("unpipe",this,r);return this};Readable.prototype.on=function(e,t){var r=i.prototype.on.call(this,e,t);var n=this._readableState;if(e==="data"){n.readableListening=this.listenerCount("readable")>0;if(n.flowing!==false)this.resume()}else if(e==="readable"){if(!n.endEmitted&&!n.readableListening){n.readableListening=n.needReadable=true;n.flowing=false;n.emittedReadable=false;u("on readable",n.length,n.reading);if(n.length){emitReadable(this)}else if(!n.reading){process.nextTick(nReadingNextTick,this)}}}return r};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.removeListener=function(e,t){var r=i.prototype.removeListener.call(this,e,t);if(e==="readable"){process.nextTick(updateReadableListening,this)}return r};Readable.prototype.removeAllListeners=function(e){var t=i.prototype.removeAllListeners.apply(this,arguments);if(e==="readable"||e===undefined){process.nextTick(updateReadableListening,this)}return t};function updateReadableListening(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0;if(t.resumeScheduled&&!t.paused){t.flowing=true}else if(e.listenerCount("data")>0){e.resume()}}function nReadingNextTick(e){u("readable nexttick read 0");e.read(0)}Readable.prototype.resume=function(){var e=this._readableState;if(!e.flowing){u("resume");e.flowing=!e.readableListening;resume(this,e)}e.paused=false;return this};function resume(e,t){if(!t.resumeScheduled){t.resumeScheduled=true;process.nextTick(resume_,e,t)}}function resume_(e,t){u("resume",t.reading);if(!t.reading){e.read(0)}t.resumeScheduled=false;e.emit("resume");flow(e);if(t.flowing&&!t.reading)e.read(0)}Readable.prototype.pause=function(){u("call pause flowing=%j",this._readableState.flowing);if(this._readableState.flowing!==false){u("pause");this._readableState.flowing=false;this.emit("pause")}this._readableState.paused=true;return this};function flow(e){var t=e._readableState;u("flow",t.flowing);while(t.flowing&&e.read()!==null){}}Readable.prototype.wrap=function(e){var t=this;var r=this._readableState;var n=false;e.on("end",(function(){u("wrapped end");if(r.decoder&&!r.ended){var e=r.decoder.end();if(e&&e.length)t.push(e)}t.push(null)}));e.on("data",(function(o){u("wrapped data");if(r.decoder)o=r.decoder.write(o);if(r.objectMode&&(o===null||o===undefined))return;else if(!r.objectMode&&(!o||!o.length))return;var s=t.push(o);if(!s){n=true;e.pause()}}));for(var o in e){if(this[o]===undefined&&typeof e[o]==="function"){this[o]=function methodWrap(t){return function methodWrapReturnFunction(){return e[t].apply(e,arguments)}}(o)}}for(var s=0;s<C.length;s++){e.on(C[s],this.emit.bind(this,C[s]))}this._read=function(t){u("wrapped _read",t);if(n){n=false;e.resume()}};return this};if(typeof Symbol==="function"){Readable.prototype[Symbol.asyncIterator]=function(){if(_===undefined){_=r(3306)}return _(this)}}Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:false,get:function get(){return this._readableState.highWaterMark}});Object.defineProperty(Readable.prototype,"readableBuffer",{enumerable:false,get:function get(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(Readable.prototype,"readableFlowing",{enumerable:false,get:function get(){return this._readableState.flowing},set:function set(e){if(this._readableState){this._readableState.flowing=e}}});Readable._fromList=fromList;Object.defineProperty(Readable.prototype,"readableLength",{enumerable:false,get:function get(){return this._readableState.length}});function fromList(e,t){if(t.length===0)return null;var r;if(t.objectMode)r=t.buffer.shift();else if(!e||e>=t.length){if(t.decoder)r=t.buffer.join("");else if(t.buffer.length===1)r=t.buffer.first();else r=t.buffer.concat(t.length);t.buffer.clear()}else{r=t.buffer.consume(e,t.decoder)}return r}function endReadable(e){var t=e._readableState;u("endReadable",t.endEmitted);if(!t.endEmitted){t.ended=true;process.nextTick(endReadableNT,t,e)}}function endReadableNT(e,t){u("endReadableNT",e.endEmitted,e.length);if(!e.endEmitted&&e.length===0){e.endEmitted=true;t.readable=false;t.emit("end");if(e.autoDestroy){var r=t._writableState;if(!r||r.autoDestroy&&r.finished){t.destroy()}}}}if(typeof Symbol==="function"){Readable.from=function(e,t){if(E===undefined){E=r(9082)}return E(Readable,e,t)}}function indexOf(e,t){for(var r=0,n=e.length;r<n;r++){if(e[r]===t)return r}return-1}},4415:(e,t,r)=>{"use strict";e.exports=Transform;var n=r(7214).q,o=n.ERR_METHOD_NOT_IMPLEMENTED,s=n.ERR_MULTIPLE_CALLBACK,i=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=n.ERR_TRANSFORM_WITH_LENGTH_0;var c=r(1359);r(4124)(Transform,c);function afterTransform(e,t){var r=this._transformState;r.transforming=false;var n=r.writecb;if(n===null){return this.emit("error",new s)}r.writechunk=null;r.writecb=null;if(t!=null)this.push(t);n(e);var o=this._readableState;o.reading=false;if(o.needReadable||o.length<o.highWaterMark){this._read(o.highWaterMark)}}function Transform(e){if(!(this instanceof Transform))return new Transform(e);c.call(this,e);this._transformState={afterTransform:afterTransform.bind(this),needTransform:false,transforming:false,writecb:null,writechunk:null,writeencoding:null};this._readableState.needReadable=true;this._readableState.sync=false;if(e){if(typeof e.transform==="function")this._transform=e.transform;if(typeof e.flush==="function")this._flush=e.flush}this.on("prefinish",prefinish)}function prefinish(){var e=this;if(typeof this._flush==="function"&&!this._readableState.destroyed){this._flush((function(t,r){done(e,t,r)}))}else{done(this,null,null)}}Transform.prototype.push=function(e,t){this._transformState.needTransform=false;return c.prototype.push.call(this,e,t)};Transform.prototype._transform=function(e,t,r){r(new o("_transform()"))};Transform.prototype._write=function(e,t,r){var n=this._transformState;n.writecb=r;n.writechunk=e;n.writeencoding=t;if(!n.transforming){var o=this._readableState;if(n.needTransform||o.needReadable||o.length<o.highWaterMark)this._read(o.highWaterMark)}};Transform.prototype._read=function(e){var t=this._transformState;if(t.writechunk!==null&&!t.transforming){t.transforming=true;this._transform(t.writechunk,t.writeencoding,t.afterTransform)}else{t.needTransform=true}};Transform.prototype._destroy=function(e,t){c.prototype._destroy.call(this,e,(function(e){t(e)}))};function done(e,t,r){if(t)return e.emit("error",t);if(r!=null)e.push(r);if(e._writableState.length)throw new a;if(e._transformState.transforming)throw new i;return e.push(null)}},6993:(e,t,r)=>{"use strict";e.exports=Writable;function WriteReq(e,t,r){this.chunk=e;this.encoding=t;this.callback=r;this.next=null}function CorkedRequest(e){var t=this;this.next=null;this.entry=null;this.finish=function(){onCorkedFinish(t,e)}}var n;Writable.WritableState=WritableState;var o={deprecate:r(7127)};var s=r(2387);var i=r(4293).Buffer;var a=global.Uint8Array||function(){};function _uint8ArrayToBuffer(e){return i.from(e)}function _isUint8Array(e){return i.isBuffer(e)||e instanceof a}var c=r(7049);var l=r(9948),u=l.getHighWaterMark;var d=r(7214).q,p=d.ERR_INVALID_ARG_TYPE,h=d.ERR_METHOD_NOT_IMPLEMENTED,m=d.ERR_MULTIPLE_CALLBACK,y=d.ERR_STREAM_CANNOT_PIPE,g=d.ERR_STREAM_DESTROYED,v=d.ERR_STREAM_NULL_VALUES,b=d.ERR_STREAM_WRITE_AFTER_END,S=d.ERR_UNKNOWN_ENCODING;var w=c.errorOrDestroy;r(4124)(Writable,s);function nop(){}function WritableState(e,t,o){n=n||r(1359);e=e||{};if(typeof o!=="boolean")o=t instanceof n;this.objectMode=!!e.objectMode;if(o)this.objectMode=this.objectMode||!!e.writableObjectMode;this.highWaterMark=u(this,e,"writableHighWaterMark",o);this.finalCalled=false;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;this.destroyed=false;var s=e.decodeStrings===false;this.decodeStrings=!s;this.defaultEncoding=e.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(e){onwrite(t,e)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.emitClose=e.emitClose!==false;this.autoDestroy=!!e.autoDestroy;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function getBuffer(){var e=this.bufferedRequest;var t=[];while(e){t.push(e);e=e.next}return t};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:o.deprecate((function writableStateBufferGetter(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(e){}})();var _;if(typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"){_=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function value(e){if(_.call(this,e))return true;if(this!==Writable)return false;return e&&e._writableState instanceof WritableState}})}else{_=function realHasInstance(e){return e instanceof this}}function Writable(e){n=n||r(1359);var t=this instanceof n;if(!t&&!_.call(Writable,this))return new Writable(e);this._writableState=new WritableState(e,this,t);this.writable=true;if(e){if(typeof e.write==="function")this._write=e.write;if(typeof e.writev==="function")this._writev=e.writev;if(typeof e.destroy==="function")this._destroy=e.destroy;if(typeof e.final==="function")this._final=e.final}s.call(this)}Writable.prototype.pipe=function(){w(this,new y)};function writeAfterEnd(e,t){var r=new b;w(e,r);process.nextTick(t,r)}function validChunk(e,t,r,n){var o;if(r===null){o=new v}else if(typeof r!=="string"&&!t.objectMode){o=new p("chunk",["string","Buffer"],r)}if(o){w(e,o);process.nextTick(n,o);return false}return true}Writable.prototype.write=function(e,t,r){var n=this._writableState;var o=false;var s=!n.objectMode&&_isUint8Array(e);if(s&&!i.isBuffer(e)){e=_uint8ArrayToBuffer(e)}if(typeof t==="function"){r=t;t=null}if(s)t="buffer";else if(!t)t=n.defaultEncoding;if(typeof r!=="function")r=nop;if(n.ending)writeAfterEnd(this,r);else if(s||validChunk(this,n,e,r)){n.pendingcb++;o=writeOrBuffer(this,n,s,e,t,r)}return o};Writable.prototype.cork=function(){this._writableState.corked++};Writable.prototype.uncork=function(){var e=this._writableState;if(e.corked){e.corked--;if(!e.writing&&!e.corked&&!e.bufferProcessing&&e.bufferedRequest)clearBuffer(this,e)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(e){if(typeof e==="string")e=e.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new S(e);this._writableState.defaultEncoding=e;return this};Object.defineProperty(Writable.prototype,"writableBuffer",{enumerable:false,get:function get(){return this._writableState&&this._writableState.getBuffer()}});function decodeChunk(e,t,r){if(!e.objectMode&&e.decodeStrings!==false&&typeof t==="string"){t=i.from(t,r)}return t}Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:false,get:function get(){return this._writableState.highWaterMark}});function writeOrBuffer(e,t,r,n,o,s){if(!r){var i=decodeChunk(t,n,o);if(n!==i){r=true;o="buffer";n=i}}var a=t.objectMode?1:n.length;t.length+=a;var c=t.length<t.highWaterMark;if(!c)t.needDrain=true;if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:o,isBuf:r,callback:s,next:null};if(l){l.next=t.lastBufferedRequest}else{t.bufferedRequest=t.lastBufferedRequest}t.bufferedRequestCount+=1}else{doWrite(e,t,false,a,n,o,s)}return c}function doWrite(e,t,r,n,o,s,i){t.writelen=n;t.writecb=i;t.writing=true;t.sync=true;if(t.destroyed)t.onwrite(new g("write"));else if(r)e._writev(o,t.onwrite);else e._write(o,s,t.onwrite);t.sync=false}function onwriteError(e,t,r,n,o){--t.pendingcb;if(r){process.nextTick(o,n);process.nextTick(finishMaybe,e,t);e._writableState.errorEmitted=true;w(e,n)}else{o(n);e._writableState.errorEmitted=true;w(e,n);finishMaybe(e,t)}}function onwriteStateUpdate(e){e.writing=false;e.writecb=null;e.length-=e.writelen;e.writelen=0}function onwrite(e,t){var r=e._writableState;var n=r.sync;var o=r.writecb;if(typeof o!=="function")throw new m;onwriteStateUpdate(r);if(t)onwriteError(e,r,n,t,o);else{var s=needFinish(r)||e.destroyed;if(!s&&!r.corked&&!r.bufferProcessing&&r.bufferedRequest){clearBuffer(e,r)}if(n){process.nextTick(afterWrite,e,r,s,o)}else{afterWrite(e,r,s,o)}}}function afterWrite(e,t,r,n){if(!r)onwriteDrain(e,t);t.pendingcb--;n();finishMaybe(e,t)}function onwriteDrain(e,t){if(t.length===0&&t.needDrain){t.needDrain=false;e.emit("drain")}}function clearBuffer(e,t){t.bufferProcessing=true;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var n=t.bufferedRequestCount;var o=new Array(n);var s=t.corkedRequestsFree;s.entry=r;var i=0;var a=true;while(r){o[i]=r;if(!r.isBuf)a=false;r=r.next;i+=1}o.allBuffers=a;doWrite(e,t,true,t.length,o,"",s.finish);t.pendingcb++;t.lastBufferedRequest=null;if(s.next){t.corkedRequestsFree=s.next;s.next=null}else{t.corkedRequestsFree=new CorkedRequest(t)}t.bufferedRequestCount=0}else{while(r){var c=r.chunk;var l=r.encoding;var u=r.callback;var d=t.objectMode?1:c.length;doWrite(e,t,false,d,c,l,u);r=r.next;t.bufferedRequestCount--;if(t.writing){break}}if(r===null)t.lastBufferedRequest=null}t.bufferedRequest=r;t.bufferProcessing=false}Writable.prototype._write=function(e,t,r){r(new h("_write()"))};Writable.prototype._writev=null;Writable.prototype.end=function(e,t,r){var n=this._writableState;if(typeof e==="function"){r=e;e=null;t=null}else if(typeof t==="function"){r=t;t=null}if(e!==null&&e!==undefined)this.write(e,t);if(n.corked){n.corked=1;this.uncork()}if(!n.ending)endWritable(this,n,r);return this};Object.defineProperty(Writable.prototype,"writableLength",{enumerable:false,get:function get(){return this._writableState.length}});function needFinish(e){return e.ending&&e.length===0&&e.bufferedRequest===null&&!e.finished&&!e.writing}function callFinal(e,t){e._final((function(r){t.pendingcb--;if(r){w(e,r)}t.prefinished=true;e.emit("prefinish");finishMaybe(e,t)}))}function prefinish(e,t){if(!t.prefinished&&!t.finalCalled){if(typeof e._final==="function"&&!t.destroyed){t.pendingcb++;t.finalCalled=true;process.nextTick(callFinal,e,t)}else{t.prefinished=true;e.emit("prefinish")}}}function finishMaybe(e,t){var r=needFinish(t);if(r){prefinish(e,t);if(t.pendingcb===0){t.finished=true;e.emit("finish");if(t.autoDestroy){var n=e._readableState;if(!n||n.autoDestroy&&n.endEmitted){e.destroy()}}}}return r}function endWritable(e,t,r){t.ending=true;finishMaybe(e,t);if(r){if(t.finished)process.nextTick(r);else e.once("finish",r)}t.ended=true;e.writable=false}function onCorkedFinish(e,t,r){var n=e.entry;e.entry=null;while(n){var o=n.callback;t.pendingcb--;o(r);n=n.next}t.corkedRequestsFree.next=e}Object.defineProperty(Writable.prototype,"destroyed",{enumerable:false,get:function get(){if(this._writableState===undefined){return false}return this._writableState.destroyed},set:function set(e){if(!this._writableState){return}this._writableState.destroyed=e}});Writable.prototype.destroy=c.destroy;Writable.prototype._undestroy=c.undestroy;Writable.prototype._destroy=function(e,t){t(e)}},3306:(e,t,r)=>{"use strict";var n;function _defineProperty(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}var o=r(6080);var s=Symbol("lastResolve");var i=Symbol("lastReject");var a=Symbol("error");var c=Symbol("ended");var l=Symbol("lastPromise");var u=Symbol("handlePromise");var d=Symbol("stream");function createIterResult(e,t){return{value:e,done:t}}function readAndResolve(e){var t=e[s];if(t!==null){var r=e[d].read();if(r!==null){e[l]=null;e[s]=null;e[i]=null;t(createIterResult(r,false))}}}function onReadable(e){process.nextTick(readAndResolve,e)}function wrapForNext(e,t){return function(r,n){e.then((function(){if(t[c]){r(createIterResult(undefined,true));return}t[u](r,n)}),n)}}var p=Object.getPrototypeOf((function(){}));var h=Object.setPrototypeOf((n={get stream(){return this[d]},next:function next(){var e=this;var t=this[a];if(t!==null){return Promise.reject(t)}if(this[c]){return Promise.resolve(createIterResult(undefined,true))}if(this[d].destroyed){return new Promise((function(t,r){process.nextTick((function(){if(e[a]){r(e[a])}else{t(createIterResult(undefined,true))}}))}))}var r=this[l];var n;if(r){n=new Promise(wrapForNext(r,this))}else{var o=this[d].read();if(o!==null){return Promise.resolve(createIterResult(o,false))}n=new Promise(this[u])}this[l]=n;return n}},_defineProperty(n,Symbol.asyncIterator,(function(){return this})),_defineProperty(n,"return",(function _return(){var e=this;return new Promise((function(t,r){e[d].destroy(null,(function(e){if(e){r(e);return}t(createIterResult(undefined,true))}))}))})),n),p);var m=function createReadableStreamAsyncIterator(e){var t;var r=Object.create(h,(t={},_defineProperty(t,d,{value:e,writable:true}),_defineProperty(t,s,{value:null,writable:true}),_defineProperty(t,i,{value:null,writable:true}),_defineProperty(t,a,{value:null,writable:true}),_defineProperty(t,c,{value:e._readableState.endEmitted,writable:true}),_defineProperty(t,u,{value:function value(e,t){var n=r[d].read();if(n){r[l]=null;r[s]=null;r[i]=null;e(createIterResult(n,false))}else{r[s]=e;r[i]=t}},writable:true}),t));r[l]=null;o(e,(function(e){if(e&&e.code!=="ERR_STREAM_PREMATURE_CLOSE"){var t=r[i];if(t!==null){r[l]=null;r[s]=null;r[i]=null;t(e)}r[a]=e;return}var n=r[s];if(n!==null){r[l]=null;r[s]=null;r[i]=null;n(createIterResult(undefined,true))}r[c]=true}));e.on("readable",onReadable.bind(null,r));return r};e.exports=m},2746:(e,t,r)=>{"use strict";function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);if(t)n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};if(t%2){ownKeys(Object(r),true).forEach((function(t){_defineProperty(e,t,r[t])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(r))}else{ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}}return e}function _defineProperty(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function _classCallCheck(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){if(t)_defineProperties(e.prototype,t);if(r)_defineProperties(e,r);return e}var n=r(4293),o=n.Buffer;var s=r(1669),i=s.inspect;var a=i&&i.custom||"inspect";function copyBuffer(e,t,r){o.prototype.copy.call(e,t,r)}e.exports=function(){function BufferList(){_classCallCheck(this,BufferList);this.head=null;this.tail=null;this.length=0}_createClass(BufferList,[{key:"push",value:function push(e){var t={data:e,next:null};if(this.length>0)this.tail.next=t;else this.head=t;this.tail=t;++this.length}},{key:"unshift",value:function unshift(e){var t={data:e,next:this.head};if(this.length===0)this.tail=t;this.head=t;++this.length}},{key:"shift",value:function shift(){if(this.length===0)return;var e=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return e}},{key:"clear",value:function clear(){this.head=this.tail=null;this.length=0}},{key:"join",value:function join(e){if(this.length===0)return"";var t=this.head;var r=""+t.data;while(t=t.next){r+=e+t.data}return r}},{key:"concat",value:function concat(e){if(this.length===0)return o.alloc(0);var t=o.allocUnsafe(e>>>0);var r=this.head;var n=0;while(r){copyBuffer(r.data,t,n);n+=r.data.length;r=r.next}return t}},{key:"consume",value:function consume(e,t){var r;if(e<this.head.data.length){r=this.head.data.slice(0,e);this.head.data=this.head.data.slice(e)}else if(e===this.head.data.length){r=this.shift()}else{r=t?this._getString(e):this._getBuffer(e)}return r}},{key:"first",value:function first(){return this.head.data}},{key:"_getString",value:function _getString(e){var t=this.head;var r=1;var n=t.data;e-=n.length;while(t=t.next){var o=t.data;var s=e>o.length?o.length:e;if(s===o.length)n+=o;else n+=o.slice(0,e);e-=s;if(e===0){if(s===o.length){++r;if(t.next)this.head=t.next;else this.head=this.tail=null}else{this.head=t;t.data=o.slice(s)}break}++r}this.length-=r;return n}},{key:"_getBuffer",value:function _getBuffer(e){var t=o.allocUnsafe(e);var r=this.head;var n=1;r.data.copy(t);e-=r.data.length;while(r=r.next){var s=r.data;var i=e>s.length?s.length:e;s.copy(t,t.length-e,0,i);e-=i;if(e===0){if(i===s.length){++n;if(r.next)this.head=r.next;else this.head=this.tail=null}else{this.head=r;r.data=s.slice(i)}break}++n}this.length-=n;return t}},{key:a,value:function value(e,t){return i(this,_objectSpread({},t,{depth:0,customInspect:false}))}}]);return BufferList}()},7049:e=>{"use strict";function destroy(e,t){var r=this;var n=this._readableState&&this._readableState.destroyed;var o=this._writableState&&this._writableState.destroyed;if(n||o){if(t){t(e)}else if(e){if(!this._writableState){process.nextTick(emitErrorNT,this,e)}else if(!this._writableState.errorEmitted){this._writableState.errorEmitted=true;process.nextTick(emitErrorNT,this,e)}}return this}if(this._readableState){this._readableState.destroyed=true}if(this._writableState){this._writableState.destroyed=true}this._destroy(e||null,(function(e){if(!t&&e){if(!r._writableState){process.nextTick(emitErrorAndCloseNT,r,e)}else if(!r._writableState.errorEmitted){r._writableState.errorEmitted=true;process.nextTick(emitErrorAndCloseNT,r,e)}else{process.nextTick(emitCloseNT,r)}}else if(t){process.nextTick(emitCloseNT,r);t(e)}else{process.nextTick(emitCloseNT,r)}}));return this}function emitErrorAndCloseNT(e,t){emitErrorNT(e,t);emitCloseNT(e)}function emitCloseNT(e){if(e._writableState&&!e._writableState.emitClose)return;if(e._readableState&&!e._readableState.emitClose)return;e.emit("close")}function undestroy(){if(this._readableState){this._readableState.destroyed=false;this._readableState.reading=false;this._readableState.ended=false;this._readableState.endEmitted=false}if(this._writableState){this._writableState.destroyed=false;this._writableState.ended=false;this._writableState.ending=false;this._writableState.finalCalled=false;this._writableState.prefinished=false;this._writableState.finished=false;this._writableState.errorEmitted=false}}function emitErrorNT(e,t){e.emit("error",t)}function errorOrDestroy(e,t){var r=e._readableState;var n=e._writableState;if(r&&r.autoDestroy||n&&n.autoDestroy)e.destroy(t);else e.emit("error",t)}e.exports={destroy:destroy,undestroy:undestroy,errorOrDestroy:errorOrDestroy}},6080:(e,t,r)=>{"use strict";var n=r(7214).q.ERR_STREAM_PREMATURE_CLOSE;function once(e){var t=false;return function(){if(t)return;t=true;for(var r=arguments.length,n=new Array(r),o=0;o<r;o++){n[o]=arguments[o]}e.apply(this,n)}}function noop(){}function isRequest(e){return e.setHeader&&typeof e.abort==="function"}function eos(e,t,r){if(typeof t==="function")return eos(e,null,t);if(!t)t={};r=once(r||noop);var o=t.readable||t.readable!==false&&e.readable;var s=t.writable||t.writable!==false&&e.writable;var i=function onlegacyfinish(){if(!e.writable)c()};var a=e._writableState&&e._writableState.finished;var c=function onfinish(){s=false;a=true;if(!o)r.call(e)};var l=e._readableState&&e._readableState.endEmitted;var u=function onend(){o=false;l=true;if(!s)r.call(e)};var d=function onerror(t){r.call(e,t)};var p=function onclose(){var t;if(o&&!l){if(!e._readableState||!e._readableState.ended)t=new n;return r.call(e,t)}if(s&&!a){if(!e._writableState||!e._writableState.ended)t=new n;return r.call(e,t)}};var h=function onrequest(){e.req.on("finish",c)};if(isRequest(e)){e.on("complete",c);e.on("abort",p);if(e.req)h();else e.on("request",h)}else if(s&&!e._writableState){e.on("end",i);e.on("close",i)}e.on("end",u);e.on("finish",c);if(t.error!==false)e.on("error",d);e.on("close",p);return function(){e.removeListener("complete",c);e.removeListener("abort",p);e.removeListener("request",h);if(e.req)e.req.removeListener("finish",c);e.removeListener("end",i);e.removeListener("close",i);e.removeListener("finish",c);e.removeListener("end",u);e.removeListener("error",d);e.removeListener("close",p)}}e.exports=eos},9082:(e,t,r)=>{"use strict";function asyncGeneratorStep(e,t,r,n,o,s,i){try{var a=e[s](i);var c=a.value}catch(e){r(e);return}if(a.done){t(c)}else{Promise.resolve(c).then(n,o)}}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var s=e.apply(t,r);function _next(e){asyncGeneratorStep(s,n,o,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(s,n,o,_next,_throw,"throw",e)}_next(undefined)}))}}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);if(t)n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};if(t%2){ownKeys(Object(r),true).forEach((function(t){_defineProperty(e,t,r[t])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(r))}else{ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}}return e}function _defineProperty(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}var n=r(7214).q.ERR_INVALID_ARG_TYPE;function from(e,t,r){var o;if(t&&typeof t.next==="function"){o=t}else if(t&&t[Symbol.asyncIterator])o=t[Symbol.asyncIterator]();else if(t&&t[Symbol.iterator])o=t[Symbol.iterator]();else throw new n("iterable",["Iterable"],t);var s=new e(_objectSpread({objectMode:true},r));var i=false;s._read=function(){if(!i){i=true;next()}};function next(){return _next2.apply(this,arguments)}function _next2(){_next2=_asyncToGenerator((function*(){try{var e=yield o.next(),t=e.value,r=e.done;if(r){s.push(null)}else if(s.push(yield t)){next()}else{i=false}}catch(e){s.destroy(e)}}));return _next2.apply(this,arguments)}return s}e.exports=from},6989:(e,t,r)=>{"use strict";var n;function once(e){var t=false;return function(){if(t)return;t=true;e.apply(void 0,arguments)}}var o=r(7214).q,s=o.ERR_MISSING_ARGS,i=o.ERR_STREAM_DESTROYED;function noop(e){if(e)throw e}function isRequest(e){return e.setHeader&&typeof e.abort==="function"}function destroyer(e,t,o,s){s=once(s);var a=false;e.on("close",(function(){a=true}));if(n===undefined)n=r(6080);n(e,{readable:t,writable:o},(function(e){if(e)return s(e);a=true;s()}));var c=false;return function(t){if(a)return;if(c)return;c=true;if(isRequest(e))return e.abort();if(typeof e.destroy==="function")return e.destroy();s(t||new i("pipe"))}}function call(e){e()}function pipe(e,t){return e.pipe(t)}function popCallback(e){if(!e.length)return noop;if(typeof e[e.length-1]!=="function")return noop;return e.pop()}function pipeline(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++){t[r]=arguments[r]}var n=popCallback(t);if(Array.isArray(t[0]))t=t[0];if(t.length<2){throw new s("streams")}var o;var i=t.map((function(e,r){var s=r<t.length-1;var a=r>0;return destroyer(e,s,a,(function(e){if(!o)o=e;if(e)i.forEach(call);if(s)return;i.forEach(call);n(o)}))}));return t.reduce(pipe)}e.exports=pipeline},9948:(e,t,r)=>{"use strict";var n=r(7214).q.ERR_INVALID_OPT_VALUE;function highWaterMarkFrom(e,t,r){return e.highWaterMark!=null?e.highWaterMark:t?e[r]:null}function getHighWaterMark(e,t,r,o){var s=highWaterMarkFrom(t,o,r);if(s!=null){if(!(isFinite(s)&&Math.floor(s)===s)||s<0){var i=o?r:"highWaterMark";throw new n(i,s)}return Math.floor(s)}return e.objectMode?16:16*1024}e.exports={getHighWaterMark:getHighWaterMark}},2387:(e,t,r)=>{e.exports=r(2413)},1642:(e,t,r)=>{var n=r(2413);if(process.env.READABLE_STREAM==="disable"&&n){e.exports=n.Readable;Object.assign(e.exports,n);e.exports.Stream=n}else{t=e.exports=r(1433);t.Stream=n||t;t.Readable=t;t.Writable=r(6993);t.Duplex=r(1359);t.Transform=r(4415);t.PassThrough=r(1542);t.finished=r(6080);t.pipeline=r(6989)}},4959:(e,t,r)=>{const n=r(2357);const o=r(5622);const s=r(5747);let i=undefined;try{i=r(1957)}catch(e){}const a={nosort:true,silent:true};let c=0;const l=process.platform==="win32";const defaults=e=>{const t=["unlink","chmod","stat","lstat","rmdir","readdir"];t.forEach((t=>{e[t]=e[t]||s[t];t=t+"Sync";e[t]=e[t]||s[t]}));e.maxBusyTries=e.maxBusyTries||3;e.emfileWait=e.emfileWait||1e3;if(e.glob===false){e.disableGlob=true}if(e.disableGlob!==true&&i===undefined){throw Error("glob dependency not found, set `options.disableGlob = true` if intentional")}e.disableGlob=e.disableGlob||false;e.glob=e.glob||a};const rimraf=(e,t,r)=>{if(typeof t==="function"){r=t;t={}}n(e,"rimraf: missing path");n.equal(typeof e,"string","rimraf: path should be a string");n.equal(typeof r,"function","rimraf: callback function required");n(t,"rimraf: invalid options argument provided");n.equal(typeof t,"object","rimraf: options should be object");defaults(t);let o=0;let s=null;let a=0;const next=e=>{s=s||e;if(--a===0)r(s)};const afterGlob=(e,n)=>{if(e)return r(e);a=n.length;if(a===0)return r();n.forEach((e=>{const CB=r=>{if(r){if((r.code==="EBUSY"||r.code==="ENOTEMPTY"||r.code==="EPERM")&&o<t.maxBusyTries){o++;return setTimeout((()=>rimraf_(e,t,CB)),o*100)}if(r.code==="EMFILE"&&c<t.emfileWait){return setTimeout((()=>rimraf_(e,t,CB)),c++)}if(r.code==="ENOENT")r=null}c=0;next(r)};rimraf_(e,t,CB)}))};if(t.disableGlob||!i.hasMagic(e))return afterGlob(null,[e]);t.lstat(e,((r,n)=>{if(!r)return afterGlob(null,[e]);i(e,t.glob,afterGlob)}))};const rimraf_=(e,t,r)=>{n(e);n(t);n(typeof r==="function");t.lstat(e,((n,o)=>{if(n&&n.code==="ENOENT")return r(null);if(n&&n.code==="EPERM"&&l)fixWinEPERM(e,t,n,r);if(o&&o.isDirectory())return rmdir(e,t,n,r);t.unlink(e,(n=>{if(n){if(n.code==="ENOENT")return r(null);if(n.code==="EPERM")return l?fixWinEPERM(e,t,n,r):rmdir(e,t,n,r);if(n.code==="EISDIR")return rmdir(e,t,n,r)}return r(n)}))}))};const fixWinEPERM=(e,t,r,o)=>{n(e);n(t);n(typeof o==="function");t.chmod(e,438,(n=>{if(n)o(n.code==="ENOENT"?null:r);else t.stat(e,((n,s)=>{if(n)o(n.code==="ENOENT"?null:r);else if(s.isDirectory())rmdir(e,t,r,o);else t.unlink(e,o)}))}))};const fixWinEPERMSync=(e,t,r)=>{n(e);n(t);try{t.chmodSync(e,438)}catch(e){if(e.code==="ENOENT")return;else throw r}let o;try{o=t.statSync(e)}catch(e){if(e.code==="ENOENT")return;else throw r}if(o.isDirectory())rmdirSync(e,t,r);else t.unlinkSync(e)};const rmdir=(e,t,r,o)=>{n(e);n(t);n(typeof o==="function");t.rmdir(e,(n=>{if(n&&(n.code==="ENOTEMPTY"||n.code==="EEXIST"||n.code==="EPERM"))rmkids(e,t,o);else if(n&&n.code==="ENOTDIR")o(r);else o(n)}))};const rmkids=(e,t,r)=>{n(e);n(t);n(typeof r==="function");t.readdir(e,((n,s)=>{if(n)return r(n);let i=s.length;if(i===0)return t.rmdir(e,r);let a;s.forEach((n=>{rimraf(o.join(e,n),t,(n=>{if(a)return;if(n)return r(a=n);if(--i===0)t.rmdir(e,r)}))}))}))};const rimrafSync=(e,t)=>{t=t||{};defaults(t);n(e,"rimraf: missing path");n.equal(typeof e,"string","rimraf: path should be a string");n(t,"rimraf: missing options");n.equal(typeof t,"object","rimraf: options should be object");let r;if(t.disableGlob||!i.hasMagic(e)){r=[e]}else{try{t.lstatSync(e);r=[e]}catch(n){r=i.sync(e,t.glob)}}if(!r.length)return;for(let e=0;e<r.length;e++){const n=r[e];let o;try{o=t.lstatSync(n)}catch(e){if(e.code==="ENOENT")return;if(e.code==="EPERM"&&l)fixWinEPERMSync(n,t,e)}try{if(o&&o.isDirectory())rmdirSync(n,t,null);else t.unlinkSync(n)}catch(e){if(e.code==="ENOENT")return;if(e.code==="EPERM")return l?fixWinEPERMSync(n,t,e):rmdirSync(n,t,e);if(e.code!=="EISDIR")throw e;rmdirSync(n,t,e)}}};const rmdirSync=(e,t,r)=>{n(e);n(t);try{t.rmdirSync(e)}catch(n){if(n.code==="ENOENT")return;if(n.code==="ENOTDIR")throw r;if(n.code==="ENOTEMPTY"||n.code==="EEXIST"||n.code==="EPERM")rmkidsSync(e,t)}};const rmkidsSync=(e,t)=>{n(e);n(t);t.readdirSync(e).forEach((r=>rimrafSync(o.join(e,r),t)));const r=l?100:1;let s=0;do{let n=true;try{const o=t.rmdirSync(e,t);n=false;return o}finally{if(++s<r&&n)continue}}while(true)};e.exports=rimraf;rimraf.sync=rimrafSync},1867:(e,t,r)=>{var n=r(4293);var o=n.Buffer;function copyProps(e,t){for(var r in e){t[r]=e[r]}}if(o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow){e.exports=n}else{copyProps(n,t);t.Buffer=SafeBuffer}function SafeBuffer(e,t,r){return o(e,t,r)}copyProps(o,SafeBuffer);SafeBuffer.from=function(e,t,r){if(typeof e==="number"){throw new TypeError("Argument must not be a number")}return o(e,t,r)};SafeBuffer.alloc=function(e,t,r){if(typeof e!=="number"){throw new TypeError("Argument must be a number")}var n=o(e);if(t!==undefined){if(typeof r==="string"){n.fill(t,r)}else{n.fill(t)}}else{n.fill(0)}return n};SafeBuffer.allocUnsafe=function(e){if(typeof e!=="number"){throw new TypeError("Argument must be a number")}return o(e)};SafeBuffer.allocUnsafeSlow=function(e){if(typeof e!=="number"){throw new TypeError("Argument must be a number")}return n.SlowBuffer(e)}},9178:(e,t,r)=>{"use strict";const{unassigned_code_points:n,commonly_mapped_to_nothing:o,non_ASCII_space_characters:s,prohibited_characters:i,bidirectional_r_al:a,bidirectional_l:c}=r(8916);e.exports=saslprep;const l=s;const u=o;const getCodePoint=e=>e.codePointAt(0);const first=e=>e[0];const last=e=>e[e.length-1];function toCodePoints(e){const t=[];const r=e.length;for(let n=0;n<r;n+=1){const o=e.charCodeAt(n);if(o>=55296&&o<=56319&&r>n+1){const r=e.charCodeAt(n+1);if(r>=56320&&r<=57343){t.push((o-55296)*1024+r-56320+65536);n+=1;continue}}t.push(o)}return t}function saslprep(e,t={}){if(typeof e!=="string"){throw new TypeError("Expected string.")}if(e.length===0){return""}const r=toCodePoints(e).map((e=>l.get(e)?32:e)).filter((e=>!u.get(e)));const o=String.fromCodePoint.apply(null,r).normalize("NFKC");const s=toCodePoints(o);const d=s.some((e=>i.get(e)));if(d){throw new Error("Prohibited character, see https://tools.ietf.org/html/rfc4013#section-2.3")}if(t.allowUnassigned!==true){const e=s.some((e=>n.get(e)));if(e){throw new Error("Unassigned code point, see https://tools.ietf.org/html/rfc4013#section-2.5")}}const p=s.some((e=>a.get(e)));const h=s.some((e=>c.get(e)));if(p&&h){throw new Error("String must not contain RandALCat and LCat at the same time,"+" see https://tools.ietf.org/html/rfc3454#section-6")}const m=a.get(getCodePoint(first(o)));const y=a.get(getCodePoint(last(o)));if(p&&!(m&&y)){throw new Error("Bidirectional RandALCat character must be the first and the last"+" character of the string, see https://tools.ietf.org/html/rfc3454#section-6")}return o}},8916:(e,t,r)=>{"use strict";const n=r(5747);const o=r(5622);const s=r(1453);const i=n.readFileSync(r.ab+"code-points.mem");let a=0;function read(){const e=i.readUInt32BE(a);a+=4;const t=i.slice(a,a+e);a+=e;return s({buffer:t})}const c=read();const l=read();const u=read();const d=read();const p=read();const h=read();e.exports={unassigned_code_points:c,commonly_mapped_to_nothing:l,non_ASCII_space_characters:u,prohibited_characters:d,bidirectional_r_al:p,bidirectional_l:h}},1532:(e,t,r)=>{const n=Symbol("SemVer ANY");class Comparator{static get ANY(){return n}constructor(e,t){t=o(t);if(e instanceof Comparator){if(e.loose===!!t.loose){return e}else{e=e.value}}c("comparator",e,t);this.options=t;this.loose=!!t.loose;this.parse(e);if(this.semver===n){this.value=""}else{this.value=this.operator+this.semver.version}c("comp",this)}parse(e){const t=this.options.loose?s[i.COMPARATORLOOSE]:s[i.COMPARATOR];const r=e.match(t);if(!r){throw new TypeError(`Invalid comparator: ${e}`)}this.operator=r[1]!==undefined?r[1]:"";if(this.operator==="="){this.operator=""}if(!r[2]){this.semver=n}else{this.semver=new l(r[2],this.options.loose)}}toString(){return this.value}test(e){c("Comparator.test",e,this.options.loose);if(this.semver===n||e===n){return true}if(typeof e==="string"){try{e=new l(e,this.options)}catch(e){return false}}return a(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof Comparator)){throw new TypeError("a Comparator is required")}if(!t||typeof t!=="object"){t={loose:!!t,includePrerelease:false}}if(this.operator===""){if(this.value===""){return true}return new u(e.value,t).test(this.value)}else if(e.operator===""){if(e.value===""){return true}return new u(this.value,t).test(e.semver)}const r=(this.operator===">="||this.operator===">")&&(e.operator===">="||e.operator===">");const n=(this.operator==="<="||this.operator==="<")&&(e.operator==="<="||e.operator==="<");const o=this.semver.version===e.semver.version;const s=(this.operator===">="||this.operator==="<=")&&(e.operator===">="||e.operator==="<=");const i=a(this.semver,"<",e.semver,t)&&(this.operator===">="||this.operator===">")&&(e.operator==="<="||e.operator==="<");const c=a(this.semver,">",e.semver,t)&&(this.operator==="<="||this.operator==="<")&&(e.operator===">="||e.operator===">");return r||n||o&&s||i||c}}e.exports=Comparator;const o=r(785);const{re:s,t:i}=r(9523);const a=r(5098);const c=r(427);const l=r(8088);const u=r(9828)},9828:(e,t,r)=>{class Range{constructor(e,t){t=s(t);if(e instanceof Range){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease){return e}else{return new Range(e.raw,t)}}if(e instanceof i){this.raw=e.value;this.set=[[e]];this.format();return this}this.options=t;this.loose=!!t.loose;this.includePrerelease=!!t.includePrerelease;this.raw=e;this.set=e.split(/\s*\|\|\s*/).map((e=>this.parseRange(e.trim()))).filter((e=>e.length));if(!this.set.length){throw new TypeError(`Invalid SemVer Range: ${e}`)}if(this.set.length>1){const e=this.set[0];this.set=this.set.filter((e=>!isNullSet(e[0])));if(this.set.length===0)this.set=[e];else if(this.set.length>1){for(const e of this.set){if(e.length===1&&isAny(e[0])){this.set=[e];break}}}}this.format()}format(){this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim();return this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=Object.keys(this.options).join(",");const r=`parseRange:${t}:${e}`;const n=o.get(r);if(n)return n;const s=this.options.loose;const c=s?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];e=e.replace(c,hyphenReplace(this.options.includePrerelease));a("hyphen replace",e);e=e.replace(l[u.COMPARATORTRIM],d);a("comparator trim",e,l[u.COMPARATORTRIM]);e=e.replace(l[u.TILDETRIM],p);e=e.replace(l[u.CARETTRIM],h);e=e.split(/\s+/).join(" ");const m=s?l[u.COMPARATORLOOSE]:l[u.COMPARATOR];const y=e.split(" ").map((e=>parseComparator(e,this.options))).join(" ").split(/\s+/).map((e=>replaceGTE0(e,this.options))).filter(this.options.loose?e=>!!e.match(m):()=>true).map((e=>new i(e,this.options)));const g=y.length;const v=new Map;for(const e of y){if(isNullSet(e))return[e];v.set(e.value,e)}if(v.size>1&&v.has(""))v.delete("");const b=[...v.values()];o.set(r,b);return b}intersects(e,t){if(!(e instanceof Range)){throw new TypeError("a Range is required")}return this.set.some((r=>isSatisfiable(r,t)&&e.set.some((e=>isSatisfiable(e,t)&&r.every((r=>e.every((e=>r.intersects(e,t)))))))))}test(e){if(!e){return false}if(typeof e==="string"){try{e=new c(e,this.options)}catch(e){return false}}for(let t=0;t<this.set.length;t++){if(testSet(this.set[t],e,this.options)){return true}}return false}}e.exports=Range;const n=r(7129);const o=new n({max:1e3});const s=r(785);const i=r(1532);const a=r(427);const c=r(8088);const{re:l,t:u,comparatorTrimReplace:d,tildeTrimReplace:p,caretTrimReplace:h}=r(9523);const isNullSet=e=>e.value==="<0.0.0-0";const isAny=e=>e.value==="";const isSatisfiable=(e,t)=>{let r=true;const n=e.slice();let o=n.pop();while(r&&n.length){r=n.every((e=>o.intersects(e,t)));o=n.pop()}return r};const parseComparator=(e,t)=>{a("comp",e,t);e=replaceCarets(e,t);a("caret",e);e=replaceTildes(e,t);a("tildes",e);e=replaceXRanges(e,t);a("xrange",e);e=replaceStars(e,t);a("stars",e);return e};const isX=e=>!e||e.toLowerCase()==="x"||e==="*";const replaceTildes=(e,t)=>e.trim().split(/\s+/).map((e=>replaceTilde(e,t))).join(" ");const replaceTilde=(e,t)=>{const r=t.loose?l[u.TILDELOOSE]:l[u.TILDE];return e.replace(r,((t,r,n,o,s)=>{a("tilde",e,t,r,n,o,s);let i;if(isX(r)){i=""}else if(isX(n)){i=`>=${r}.0.0 <${+r+1}.0.0-0`}else if(isX(o)){i=`>=${r}.${n}.0 <${r}.${+n+1}.0-0`}else if(s){a("replaceTilde pr",s);i=`>=${r}.${n}.${o}-${s} <${r}.${+n+1}.0-0`}else{i=`>=${r}.${n}.${o} <${r}.${+n+1}.0-0`}a("tilde return",i);return i}))};const replaceCarets=(e,t)=>e.trim().split(/\s+/).map((e=>replaceCaret(e,t))).join(" ");const replaceCaret=(e,t)=>{a("caret",e,t);const r=t.loose?l[u.CARETLOOSE]:l[u.CARET];const n=t.includePrerelease?"-0":"";return e.replace(r,((t,r,o,s,i)=>{a("caret",e,t,r,o,s,i);let c;if(isX(r)){c=""}else if(isX(o)){c=`>=${r}.0.0${n} <${+r+1}.0.0-0`}else if(isX(s)){if(r==="0"){c=`>=${r}.${o}.0${n} <${r}.${+o+1}.0-0`}else{c=`>=${r}.${o}.0${n} <${+r+1}.0.0-0`}}else if(i){a("replaceCaret pr",i);if(r==="0"){if(o==="0"){c=`>=${r}.${o}.${s}-${i} <${r}.${o}.${+s+1}-0`}else{c=`>=${r}.${o}.${s}-${i} <${r}.${+o+1}.0-0`}}else{c=`>=${r}.${o}.${s}-${i} <${+r+1}.0.0-0`}}else{a("no pr");if(r==="0"){if(o==="0"){c=`>=${r}.${o}.${s}${n} <${r}.${o}.${+s+1}-0`}else{c=`>=${r}.${o}.${s}${n} <${r}.${+o+1}.0-0`}}else{c=`>=${r}.${o}.${s} <${+r+1}.0.0-0`}}a("caret return",c);return c}))};const replaceXRanges=(e,t)=>{a("replaceXRanges",e,t);return e.split(/\s+/).map((e=>replaceXRange(e,t))).join(" ")};const replaceXRange=(e,t)=>{e=e.trim();const r=t.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return e.replace(r,((r,n,o,s,i,c)=>{a("xRange",e,r,n,o,s,i,c);const l=isX(o);const u=l||isX(s);const d=u||isX(i);const p=d;if(n==="="&&p){n=""}c=t.includePrerelease?"-0":"";if(l){if(n===">"||n==="<"){r="<0.0.0-0"}else{r="*"}}else if(n&&p){if(u){s=0}i=0;if(n===">"){n=">=";if(u){o=+o+1;s=0;i=0}else{s=+s+1;i=0}}else if(n==="<="){n="<";if(u){o=+o+1}else{s=+s+1}}if(n==="<")c="-0";r=`${n+o}.${s}.${i}${c}`}else if(u){r=`>=${o}.0.0${c} <${+o+1}.0.0-0`}else if(d){r=`>=${o}.${s}.0${c} <${o}.${+s+1}.0-0`}a("xRange return",r);return r}))};const replaceStars=(e,t)=>{a("replaceStars",e,t);return e.trim().replace(l[u.STAR],"")};const replaceGTE0=(e,t)=>{a("replaceGTE0",e,t);return e.trim().replace(l[t.includePrerelease?u.GTE0PRE:u.GTE0],"")};const hyphenReplace=e=>(t,r,n,o,s,i,a,c,l,u,d,p,h)=>{if(isX(n)){r=""}else if(isX(o)){r=`>=${n}.0.0${e?"-0":""}`}else if(isX(s)){r=`>=${n}.${o}.0${e?"-0":""}`}else if(i){r=`>=${r}`}else{r=`>=${r}${e?"-0":""}`}if(isX(l)){c=""}else if(isX(u)){c=`<${+l+1}.0.0-0`}else if(isX(d)){c=`<${l}.${+u+1}.0-0`}else if(p){c=`<=${l}.${u}.${d}-${p}`}else if(e){c=`<${l}.${u}.${+d+1}-0`}else{c=`<=${c}`}return`${r} ${c}`.trim()};const testSet=(e,t,r)=>{for(let r=0;r<e.length;r++){if(!e[r].test(t)){return false}}if(t.prerelease.length&&!r.includePrerelease){for(let r=0;r<e.length;r++){a(e[r].semver);if(e[r].semver===i.ANY){continue}if(e[r].semver.prerelease.length>0){const n=e[r].semver;if(n.major===t.major&&n.minor===t.minor&&n.patch===t.patch){return true}}}return false}return true}},8088:(e,t,r)=>{const n=r(427);const{MAX_LENGTH:o,MAX_SAFE_INTEGER:s}=r(2293);const{re:i,t:a}=r(9523);const c=r(785);const{compareIdentifiers:l}=r(2463);class SemVer{constructor(e,t){t=c(t);if(e instanceof SemVer){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease){return e}else{e=e.version}}else if(typeof e!=="string"){throw new TypeError(`Invalid Version: ${e}`)}if(e.length>o){throw new TypeError(`version is longer than ${o} characters`)}n("SemVer",e,t);this.options=t;this.loose=!!t.loose;this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?i[a.LOOSE]:i[a.FULL]);if(!r){throw new TypeError(`Invalid Version: ${e}`)}this.raw=e;this.major=+r[1];this.minor=+r[2];this.patch=+r[3];if(this.major>s||this.major<0){throw new TypeError("Invalid major version")}if(this.minor>s||this.minor<0){throw new TypeError("Invalid minor version")}if(this.patch>s||this.patch<0){throw new TypeError("Invalid patch version")}if(!r[4]){this.prerelease=[]}else{this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<s){return t}}return e}))}this.build=r[5]?r[5].split("."):[];this.format()}format(){this.version=`${this.major}.${this.minor}.${this.patch}`;if(this.prerelease.length){this.version+=`-${this.prerelease.join(".")}`}return this.version}toString(){return this.version}compare(e){n("SemVer.compare",this.version,this.options,e);if(!(e instanceof SemVer)){if(typeof e==="string"&&e===this.version){return 0}e=new SemVer(e,this.options)}if(e.version===this.version){return 0}return this.compareMain(e)||this.comparePre(e)}compareMain(e){if(!(e instanceof SemVer)){e=new SemVer(e,this.options)}return l(this.major,e.major)||l(this.minor,e.minor)||l(this.patch,e.patch)}comparePre(e){if(!(e instanceof SemVer)){e=new SemVer(e,this.options)}if(this.prerelease.length&&!e.prerelease.length){return-1}else if(!this.prerelease.length&&e.prerelease.length){return 1}else if(!this.prerelease.length&&!e.prerelease.length){return 0}let t=0;do{const r=this.prerelease[t];const o=e.prerelease[t];n("prerelease compare",t,r,o);if(r===undefined&&o===undefined){return 0}else if(o===undefined){return 1}else if(r===undefined){return-1}else if(r===o){continue}else{return l(r,o)}}while(++t)}compareBuild(e){if(!(e instanceof SemVer)){e=new SemVer(e,this.options)}let t=0;do{const r=this.build[t];const o=e.build[t];n("prerelease compare",t,r,o);if(r===undefined&&o===undefined){return 0}else if(o===undefined){return 1}else if(r===undefined){return-1}else if(r===o){continue}else{return l(r,o)}}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0;this.patch=0;this.minor=0;this.major++;this.inc("pre",t);break;case"preminor":this.prerelease.length=0;this.patch=0;this.minor++;this.inc("pre",t);break;case"prepatch":this.prerelease.length=0;this.inc("patch",t);this.inc("pre",t);break;case"prerelease":if(this.prerelease.length===0){this.inc("patch",t)}this.inc("pre",t);break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0){this.major++}this.minor=0;this.patch=0;this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0){this.minor++}this.patch=0;this.prerelease=[];break;case"patch":if(this.prerelease.length===0){this.patch++}this.prerelease=[];break;case"pre":if(this.prerelease.length===0){this.prerelease=[0]}else{let e=this.prerelease.length;while(--e>=0){if(typeof this.prerelease[e]==="number"){this.prerelease[e]++;e=-2}}if(e===-1){this.prerelease.push(0)}}if(t){if(this.prerelease[0]===t){if(isNaN(this.prerelease[1])){this.prerelease=[t,0]}}else{this.prerelease=[t,0]}}break;default:throw new Error(`invalid increment argument: ${e}`)}this.format();this.raw=this.version;return this}}e.exports=SemVer},8848:(e,t,r)=>{const n=r(5925);const clean=(e,t)=>{const r=n(e.trim().replace(/^[=v]+/,""),t);return r?r.version:null};e.exports=clean},5098:(e,t,r)=>{const n=r(1898);const o=r(6017);const s=r(4123);const i=r(5522);const a=r(194);const c=r(7520);const cmp=(e,t,r,l)=>{switch(t){case"===":if(typeof e==="object")e=e.version;if(typeof r==="object")r=r.version;return e===r;case"!==":if(typeof e==="object")e=e.version;if(typeof r==="object")r=r.version;return e!==r;case"":case"=":case"==":return n(e,r,l);case"!=":return o(e,r,l);case">":return s(e,r,l);case">=":return i(e,r,l);case"<":return a(e,r,l);case"<=":return c(e,r,l);default:throw new TypeError(`Invalid operator: ${t}`)}};e.exports=cmp},3466:(e,t,r)=>{const n=r(8088);const o=r(5925);const{re:s,t:i}=r(9523);const coerce=(e,t)=>{if(e instanceof n){return e}if(typeof e==="number"){e=String(e)}if(typeof e!=="string"){return null}t=t||{};let r=null;if(!t.rtl){r=e.match(s[i.COERCE])}else{let t;while((t=s[i.COERCERTL].exec(e))&&(!r||r.index+r[0].length!==e.length)){if(!r||t.index+t[0].length!==r.index+r[0].length){r=t}s[i.COERCERTL].lastIndex=t.index+t[1].length+t[2].length}s[i.COERCERTL].lastIndex=-1}if(r===null)return null;return o(`${r[2]}.${r[3]||"0"}.${r[4]||"0"}`,t)};e.exports=coerce},2156:(e,t,r)=>{const n=r(8088);const compareBuild=(e,t,r)=>{const o=new n(e,r);const s=new n(t,r);return o.compare(s)||o.compareBuild(s)};e.exports=compareBuild},2804:(e,t,r)=>{const n=r(4309);const compareLoose=(e,t)=>n(e,t,true);e.exports=compareLoose},4309:(e,t,r)=>{const n=r(8088);const compare=(e,t,r)=>new n(e,r).compare(new n(t,r));e.exports=compare},4297:(e,t,r)=>{const n=r(5925);const o=r(1898);const diff=(e,t)=>{if(o(e,t)){return null}else{const r=n(e);const o=n(t);const s=r.prerelease.length||o.prerelease.length;const i=s?"pre":"";const a=s?"prerelease":"";for(const e in r){if(e==="major"||e==="minor"||e==="patch"){if(r[e]!==o[e]){return i+e}}}return a}};e.exports=diff},1898:(e,t,r)=>{const n=r(4309);const eq=(e,t,r)=>n(e,t,r)===0;e.exports=eq},4123:(e,t,r)=>{const n=r(4309);const gt=(e,t,r)=>n(e,t,r)>0;e.exports=gt},5522:(e,t,r)=>{const n=r(4309);const gte=(e,t,r)=>n(e,t,r)>=0;e.exports=gte},929:(e,t,r)=>{const n=r(8088);const inc=(e,t,r,o)=>{if(typeof r==="string"){o=r;r=undefined}try{return new n(e,r).inc(t,o).version}catch(e){return null}};e.exports=inc},194:(e,t,r)=>{const n=r(4309);const lt=(e,t,r)=>n(e,t,r)<0;e.exports=lt},7520:(e,t,r)=>{const n=r(4309);const lte=(e,t,r)=>n(e,t,r)<=0;e.exports=lte},6688:(e,t,r)=>{const n=r(8088);const major=(e,t)=>new n(e,t).major;e.exports=major},8447:(e,t,r)=>{const n=r(8088);const minor=(e,t)=>new n(e,t).minor;e.exports=minor},6017:(e,t,r)=>{const n=r(4309);const neq=(e,t,r)=>n(e,t,r)!==0;e.exports=neq},5925:(e,t,r)=>{const{MAX_LENGTH:n}=r(2293);const{re:o,t:s}=r(9523);const i=r(8088);const a=r(785);const parse=(e,t)=>{t=a(t);if(e instanceof i){return e}if(typeof e!=="string"){return null}if(e.length>n){return null}const r=t.loose?o[s.LOOSE]:o[s.FULL];if(!r.test(e)){return null}try{return new i(e,t)}catch(e){return null}};e.exports=parse},2866:(e,t,r)=>{const n=r(8088);const patch=(e,t)=>new n(e,t).patch;e.exports=patch},4016:(e,t,r)=>{const n=r(5925);const prerelease=(e,t)=>{const r=n(e,t);return r&&r.prerelease.length?r.prerelease:null};e.exports=prerelease},7499:(e,t,r)=>{const n=r(4309);const rcompare=(e,t,r)=>n(t,e,r);e.exports=rcompare},8701:(e,t,r)=>{const n=r(2156);const rsort=(e,t)=>e.sort(((e,r)=>n(r,e,t)));e.exports=rsort},6055:(e,t,r)=>{const n=r(9828);const satisfies=(e,t,r)=>{try{t=new n(t,r)}catch(e){return false}return t.test(e)};e.exports=satisfies},1426:(e,t,r)=>{const n=r(2156);const sort=(e,t)=>e.sort(((e,r)=>n(e,r,t)));e.exports=sort},9601:(e,t,r)=>{const n=r(5925);const valid=(e,t)=>{const r=n(e,t);return r?r.version:null};e.exports=valid},1383:(e,t,r)=>{const n=r(9523);e.exports={re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:r(2293).SEMVER_SPEC_VERSION,SemVer:r(8088),compareIdentifiers:r(2463).compareIdentifiers,rcompareIdentifiers:r(2463).rcompareIdentifiers,parse:r(5925),valid:r(9601),clean:r(8848),inc:r(929),diff:r(4297),major:r(6688),minor:r(8447),patch:r(2866),prerelease:r(4016),compare:r(4309),rcompare:r(7499),compareLoose:r(2804),compareBuild:r(2156),sort:r(1426),rsort:r(8701),gt:r(4123),lt:r(194),eq:r(1898),neq:r(6017),gte:r(5522),lte:r(7520),cmp:r(5098),coerce:r(3466),Comparator:r(1532),Range:r(9828),satisfies:r(6055),toComparators:r(2706),maxSatisfying:r(579),minSatisfying:r(832),minVersion:r(4179),validRange:r(2098),outside:r(420),gtr:r(9380),ltr:r(3323),intersects:r(7008),simplifyRange:r(5297),subset:r(7863)}},2293:e=>{const t="2.0.0";const r=256;const n=Number.MAX_SAFE_INTEGER||9007199254740991;const o=16;e.exports={SEMVER_SPEC_VERSION:t,MAX_LENGTH:r,MAX_SAFE_INTEGER:n,MAX_SAFE_COMPONENT_LENGTH:o}},427:e=>{const t=typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};e.exports=t},2463:e=>{const t=/^[0-9]+$/;const compareIdentifiers=(e,r)=>{const n=t.test(e);const o=t.test(r);if(n&&o){e=+e;r=+r}return e===r?0:n&&!o?-1:o&&!n?1:e<r?-1:1};const rcompareIdentifiers=(e,t)=>compareIdentifiers(t,e);e.exports={compareIdentifiers:compareIdentifiers,rcompareIdentifiers:rcompareIdentifiers}},785:e=>{const t=["includePrerelease","loose","rtl"];const parseOptions=e=>!e?{}:typeof e!=="object"?{loose:true}:t.filter((t=>e[t])).reduce(((e,t)=>{e[t]=true;return e}),{});e.exports=parseOptions},9523:(e,t,r)=>{const{MAX_SAFE_COMPONENT_LENGTH:n}=r(2293);const o=r(427);t=e.exports={};const s=t.re=[];const i=t.src=[];const a=t.t={};let c=0;const createToken=(e,t,r)=>{const n=c++;o(n,t);a[e]=n;i[n]=t;s[n]=new RegExp(t,r?"g":undefined)};createToken("NUMERICIDENTIFIER","0|[1-9]\\d*");createToken("NUMERICIDENTIFIERLOOSE","[0-9]+");createToken("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");createToken("MAINVERSION",`(${i[a.NUMERICIDENTIFIER]})\\.`+`(${i[a.NUMERICIDENTIFIER]})\\.`+`(${i[a.NUMERICIDENTIFIER]})`);createToken("MAINVERSIONLOOSE",`(${i[a.NUMERICIDENTIFIERLOOSE]})\\.`+`(${i[a.NUMERICIDENTIFIERLOOSE]})\\.`+`(${i[a.NUMERICIDENTIFIERLOOSE]})`);createToken("PRERELEASEIDENTIFIER",`(?:${i[a.NUMERICIDENTIFIER]}|${i[a.NONNUMERICIDENTIFIER]})`);createToken("PRERELEASEIDENTIFIERLOOSE",`(?:${i[a.NUMERICIDENTIFIERLOOSE]}|${i[a.NONNUMERICIDENTIFIER]})`);createToken("PRERELEASE",`(?:-(${i[a.PRERELEASEIDENTIFIER]}(?:\\.${i[a.PRERELEASEIDENTIFIER]})*))`);createToken("PRERELEASELOOSE",`(?:-?(${i[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[a.PRERELEASEIDENTIFIERLOOSE]})*))`);createToken("BUILDIDENTIFIER","[0-9A-Za-z-]+");createToken("BUILD",`(?:\\+(${i[a.BUILDIDENTIFIER]}(?:\\.${i[a.BUILDIDENTIFIER]})*))`);createToken("FULLPLAIN",`v?${i[a.MAINVERSION]}${i[a.PRERELEASE]}?${i[a.BUILD]}?`);createToken("FULL",`^${i[a.FULLPLAIN]}$`);createToken("LOOSEPLAIN",`[v=\\s]*${i[a.MAINVERSIONLOOSE]}${i[a.PRERELEASELOOSE]}?${i[a.BUILD]}?`);createToken("LOOSE",`^${i[a.LOOSEPLAIN]}$`);createToken("GTLT","((?:<|>)?=?)");createToken("XRANGEIDENTIFIERLOOSE",`${i[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);createToken("XRANGEIDENTIFIER",`${i[a.NUMERICIDENTIFIER]}|x|X|\\*`);createToken("XRANGEPLAIN",`[v=\\s]*(${i[a.XRANGEIDENTIFIER]})`+`(?:\\.(${i[a.XRANGEIDENTIFIER]})`+`(?:\\.(${i[a.XRANGEIDENTIFIER]})`+`(?:${i[a.PRERELEASE]})?${i[a.BUILD]}?`+`)?)?`);createToken("XRANGEPLAINLOOSE",`[v=\\s]*(${i[a.XRANGEIDENTIFIERLOOSE]})`+`(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})`+`(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})`+`(?:${i[a.PRERELEASELOOSE]})?${i[a.BUILD]}?`+`)?)?`);createToken("XRANGE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAIN]}$`);createToken("XRANGELOOSE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAINLOOSE]}$`);createToken("COERCE",`${"(^|[^\\d])"+"(\\d{1,"}${n}})`+`(?:\\.(\\d{1,${n}}))?`+`(?:\\.(\\d{1,${n}}))?`+`(?:$|[^\\d])`);createToken("COERCERTL",i[a.COERCE],true);createToken("LONETILDE","(?:~>?)");createToken("TILDETRIM",`(\\s*)${i[a.LONETILDE]}\\s+`,true);t.tildeTrimReplace="$1~";createToken("TILDE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAIN]}$`);createToken("TILDELOOSE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAINLOOSE]}$`);createToken("LONECARET","(?:\\^)");createToken("CARETTRIM",`(\\s*)${i[a.LONECARET]}\\s+`,true);t.caretTrimReplace="$1^";createToken("CARET",`^${i[a.LONECARET]}${i[a.XRANGEPLAIN]}$`);createToken("CARETLOOSE",`^${i[a.LONECARET]}${i[a.XRANGEPLAINLOOSE]}$`);createToken("COMPARATORLOOSE",`^${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]})$|^$`);createToken("COMPARATOR",`^${i[a.GTLT]}\\s*(${i[a.FULLPLAIN]})$|^$`);createToken("COMPARATORTRIM",`(\\s*)${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]}|${i[a.XRANGEPLAIN]})`,true);t.comparatorTrimReplace="$1$2$3";createToken("HYPHENRANGE",`^\\s*(${i[a.XRANGEPLAIN]})`+`\\s+-\\s+`+`(${i[a.XRANGEPLAIN]})`+`\\s*$`);createToken("HYPHENRANGELOOSE",`^\\s*(${i[a.XRANGEPLAINLOOSE]})`+`\\s+-\\s+`+`(${i[a.XRANGEPLAINLOOSE]})`+`\\s*$`);createToken("STAR","(<|>)?=?\\s*\\*");createToken("GTE0","^\\s*>=\\s*0.0.0\\s*$");createToken("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},9380:(e,t,r)=>{const n=r(420);const gtr=(e,t,r)=>n(e,t,">",r);e.exports=gtr},7008:(e,t,r)=>{const n=r(9828);const intersects=(e,t,r)=>{e=new n(e,r);t=new n(t,r);return e.intersects(t)};e.exports=intersects},3323:(e,t,r)=>{const n=r(420);const ltr=(e,t,r)=>n(e,t,"<",r);e.exports=ltr},579:(e,t,r)=>{const n=r(8088);const o=r(9828);const maxSatisfying=(e,t,r)=>{let s=null;let i=null;let a=null;try{a=new o(t,r)}catch(e){return null}e.forEach((e=>{if(a.test(e)){if(!s||i.compare(e)===-1){s=e;i=new n(s,r)}}}));return s};e.exports=maxSatisfying},832:(e,t,r)=>{const n=r(8088);const o=r(9828);const minSatisfying=(e,t,r)=>{let s=null;let i=null;let a=null;try{a=new o(t,r)}catch(e){return null}e.forEach((e=>{if(a.test(e)){if(!s||i.compare(e)===1){s=e;i=new n(s,r)}}}));return s};e.exports=minSatisfying},4179:(e,t,r)=>{const n=r(8088);const o=r(9828);const s=r(4123);const minVersion=(e,t)=>{e=new o(e,t);let r=new n("0.0.0");if(e.test(r)){return r}r=new n("0.0.0-0");if(e.test(r)){return r}r=null;for(let t=0;t<e.set.length;++t){const o=e.set[t];let i=null;o.forEach((e=>{const t=new n(e.semver.version);switch(e.operator){case">":if(t.prerelease.length===0){t.patch++}else{t.prerelease.push(0)}t.raw=t.format();case"":case">=":if(!i||s(t,i)){i=t}break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}}));if(i&&(!r||s(r,i)))r=i}if(r&&e.test(r)){return r}return null};e.exports=minVersion},420:(e,t,r)=>{const n=r(8088);const o=r(1532);const{ANY:s}=o;const i=r(9828);const a=r(6055);const c=r(4123);const l=r(194);const u=r(7520);const d=r(5522);const outside=(e,t,r,p)=>{e=new n(e,p);t=new i(t,p);let h,m,y,g,v;switch(r){case">":h=c;m=u;y=l;g=">";v=">=";break;case"<":h=l;m=d;y=c;g="<";v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(e,t,p)){return false}for(let r=0;r<t.set.length;++r){const n=t.set[r];let i=null;let a=null;n.forEach((e=>{if(e.semver===s){e=new o(">=0.0.0")}i=i||e;a=a||e;if(h(e.semver,i.semver,p)){i=e}else if(y(e.semver,a.semver,p)){a=e}}));if(i.operator===g||i.operator===v){return false}if((!a.operator||a.operator===g)&&m(e,a.semver)){return false}else if(a.operator===v&&y(e,a.semver)){return false}}return true};e.exports=outside},5297:(e,t,r)=>{const n=r(6055);const o=r(4309);e.exports=(e,t,r)=>{const s=[];let i=null;let a=null;const c=e.sort(((e,t)=>o(e,t,r)));for(const e of c){const o=n(e,t,r);if(o){a=e;if(!i)i=e}else{if(a){s.push([i,a])}a=null;i=null}}if(i)s.push([i,null]);const l=[];for(const[e,t]of s){if(e===t)l.push(e);else if(!t&&e===c[0])l.push("*");else if(!t)l.push(`>=${e}`);else if(e===c[0])l.push(`<=${t}`);else l.push(`${e} - ${t}`)}const u=l.join(" || ");const d=typeof t.raw==="string"?t.raw:String(t);return u.length<d.length?u:t}},7863:(e,t,r)=>{const n=r(9828);const o=r(1532);const{ANY:s}=o;const i=r(6055);const a=r(4309);const subset=(e,t,r={})=>{if(e===t)return true;e=new n(e,r);t=new n(t,r);let o=false;e:for(const n of e.set){for(const e of t.set){const t=simpleSubset(n,e,r);o=o||t!==null;if(t)continue e}if(o)return false}return true};const simpleSubset=(e,t,r)=>{if(e===t)return true;if(e.length===1&&e[0].semver===s){if(t.length===1&&t[0].semver===s)return true;else if(r.includePrerelease)e=[new o(">=0.0.0-0")];else e=[new o(">=0.0.0")]}if(t.length===1&&t[0].semver===s){if(r.includePrerelease)return true;else t=[new o(">=0.0.0")]}const n=new Set;let c,l;for(const t of e){if(t.operator===">"||t.operator===">=")c=higherGT(c,t,r);else if(t.operator==="<"||t.operator==="<=")l=lowerLT(l,t,r);else n.add(t.semver)}if(n.size>1)return null;let u;if(c&&l){u=a(c.semver,l.semver,r);if(u>0)return null;else if(u===0&&(c.operator!==">="||l.operator!=="<="))return null}for(const e of n){if(c&&!i(e,String(c),r))return null;if(l&&!i(e,String(l),r))return null;for(const n of t){if(!i(e,String(n),r))return false}return true}let d,p;let h,m;let y=l&&!r.includePrerelease&&l.semver.prerelease.length?l.semver:false;let g=c&&!r.includePrerelease&&c.semver.prerelease.length?c.semver:false;if(y&&y.prerelease.length===1&&l.operator==="<"&&y.prerelease[0]===0){y=false}for(const e of t){m=m||e.operator===">"||e.operator===">=";h=h||e.operator==="<"||e.operator==="<=";if(c){if(g){if(e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===g.major&&e.semver.minor===g.minor&&e.semver.patch===g.patch){g=false}}if(e.operator===">"||e.operator===">="){d=higherGT(c,e,r);if(d===e&&d!==c)return false}else if(c.operator===">="&&!i(c.semver,String(e),r))return false}if(l){if(y){if(e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===y.major&&e.semver.minor===y.minor&&e.semver.patch===y.patch){y=false}}if(e.operator==="<"||e.operator==="<="){p=lowerLT(l,e,r);if(p===e&&p!==l)return false}else if(l.operator==="<="&&!i(l.semver,String(e),r))return false}if(!e.operator&&(l||c)&&u!==0)return false}if(c&&h&&!l&&u!==0)return false;if(l&&m&&!c&&u!==0)return false;if(g||y)return false;return true};const higherGT=(e,t,r)=>{if(!e)return t;const n=a(e.semver,t.semver,r);return n>0?e:n<0?t:t.operator===">"&&e.operator===">="?t:e};const lowerLT=(e,t,r)=>{if(!e)return t;const n=a(e.semver,t.semver,r);return n<0?e:n>0?t:t.operator==="<"&&e.operator==="<="?t:e};e.exports=subset},2706:(e,t,r)=>{const n=r(9828);const toComparators=(e,t)=>new n(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));e.exports=toComparators},2098:(e,t,r)=>{const n=r(9828);const validRange=(e,t)=>{try{return new n(e,t).range||"*"}catch(e){return null}};e.exports=validRange},1453:(e,t,r)=>{var n=r(7147);e.exports=Bitfield;function Bitfield(e){if(!(this instanceof Bitfield))return new Bitfield(e);if(!e)e={};if(Buffer.isBuffer(e))e={buffer:e};this.pageOffset=e.pageOffset||0;this.pageSize=e.pageSize||1024;this.pages=e.pages||n(this.pageSize);this.byteLength=this.pages.length*this.pageSize;this.length=8*this.byteLength;if(!powerOfTwo(this.pageSize))throw new Error("The page size should be a power of two");this._trackUpdates=!!e.trackUpdates;this._pageMask=this.pageSize-1;if(e.buffer){for(var t=0;t<e.buffer.length;t+=this.pageSize){this.pages.set(t/this.pageSize,e.buffer.slice(t,t+this.pageSize))}this.byteLength=e.buffer.length;this.length=8*this.byteLength}}Bitfield.prototype.get=function(e){var t=e&7;var r=(e-t)/8;return!!(this.getByte(r)&128>>t)};Bitfield.prototype.getByte=function(e){var t=e&this._pageMask;var r=(e-t)/this.pageSize;var n=this.pages.get(r,true);return n?n.buffer[t+this.pageOffset]:0};Bitfield.prototype.set=function(e,t){var r=e&7;var n=(e-r)/8;var o=this.getByte(n);return this.setByte(n,t?o|128>>r:o&(255^128>>r))};Bitfield.prototype.toBuffer=function(){var e=alloc(this.pages.length*this.pageSize);for(var t=0;t<this.pages.length;t++){var r=this.pages.get(t,true);var n=t*this.pageSize;if(r)r.buffer.copy(e,n,this.pageOffset,this.pageOffset+this.pageSize)}return e};Bitfield.prototype.setByte=function(e,t){var r=e&this._pageMask;var n=(e-r)/this.pageSize;var o=this.pages.get(n,false);r+=this.pageOffset;if(o.buffer[r]===t)return false;o.buffer[r]=t;if(e>=this.byteLength){this.byteLength=e+1;this.length=this.byteLength*8}if(this._trackUpdates)this.pages.updated(o);return true};function alloc(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);t.fill(0);return t}function powerOfTwo(e){return!(e&e-1)}},4841:(e,t,r)=>{"use strict";var n=r(1867).Buffer;var o=n.isEncoding||function(e){e=""+e;switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function _normalizeEncoding(e){if(!e)return"utf8";var t;while(true){switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase();t=true}}}function normalizeEncoding(e){var t=_normalizeEncoding(e);if(typeof t!=="string"&&(n.isEncoding===o||!o(e)))throw new Error("Unknown encoding: "+e);return t||e}t.s=StringDecoder;function StringDecoder(e){this.encoding=normalizeEncoding(e);var t;switch(this.encoding){case"utf16le":this.text=utf16Text;this.end=utf16End;t=4;break;case"utf8":this.fillLast=utf8FillLast;t=4;break;case"base64":this.text=base64Text;this.end=base64End;t=3;break;default:this.write=simpleWrite;this.end=simpleEnd;return}this.lastNeed=0;this.lastTotal=0;this.lastChar=n.allocUnsafe(t)}StringDecoder.prototype.write=function(e){if(e.length===0)return"";var t;var r;if(this.lastNeed){t=this.fillLast(e);if(t===undefined)return"";r=this.lastNeed;this.lastNeed=0}else{r=0}if(r<e.length)return t?t+this.text(e,r):this.text(e,r);return t||""};StringDecoder.prototype.end=utf8End;StringDecoder.prototype.text=utf8Text;StringDecoder.prototype.fillLast=function(e){if(this.lastNeed<=e.length){e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length);this.lastNeed-=e.length};function utf8CheckByte(e){if(e<=127)return 0;else if(e>>5===6)return 2;else if(e>>4===14)return 3;else if(e>>3===30)return 4;return e>>6===2?-1:-2}function utf8CheckIncomplete(e,t,r){var n=t.length-1;if(n<r)return 0;var o=utf8CheckByte(t[n]);if(o>=0){if(o>0)e.lastNeed=o-1;return o}if(--n<r||o===-2)return 0;o=utf8CheckByte(t[n]);if(o>=0){if(o>0)e.lastNeed=o-2;return o}if(--n<r||o===-2)return 0;o=utf8CheckByte(t[n]);if(o>=0){if(o>0){if(o===2)o=0;else e.lastNeed=o-3}return o}return 0}function utf8CheckExtraBytes(e,t,r){if((t[0]&192)!==128){e.lastNeed=0;return""}if(e.lastNeed>1&&t.length>1){if((t[1]&192)!==128){e.lastNeed=1;return""}if(e.lastNeed>2&&t.length>2){if((t[2]&192)!==128){e.lastNeed=2;return""}}}}function utf8FillLast(e){var t=this.lastTotal-this.lastNeed;var r=utf8CheckExtraBytes(this,e,t);if(r!==undefined)return r;if(this.lastNeed<=e.length){e.copy(this.lastChar,t,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}e.copy(this.lastChar,t,0,e.length);this.lastNeed-=e.length}function utf8Text(e,t){var r=utf8CheckIncomplete(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);e.copy(this.lastChar,0,n);return e.toString("utf8",t,n)}function utf8End(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed)return t+"";return t}function utf16Text(e,t){if((e.length-t)%2===0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319){this.lastNeed=2;this.lastTotal=4;this.lastChar[0]=e[e.length-2];this.lastChar[1]=e[e.length-1];return r.slice(0,-1)}}return r}this.lastNeed=1;this.lastTotal=2;this.lastChar[0]=e[e.length-1];return e.toString("utf16le",t,e.length-1)}function utf16End(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function base64Text(e,t){var r=(e.length-t)%3;if(r===0)return e.toString("base64",t);this.lastNeed=3-r;this.lastTotal=3;if(r===1){this.lastChar[0]=e[e.length-1]}else{this.lastChar[0]=e[e.length-2];this.lastChar[1]=e[e.length-1]}return e.toString("base64",t,e.length-r)}function base64End(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed)return t+this.lastChar.toString("base64",0,3-this.lastNeed);return t}function simpleWrite(e){return e.toString(this.encoding)}function simpleEnd(e){return e&&e.length?this.write(e):""}},9318:(e,t,r)=>{"use strict";const n=r(2087);const o=r(3867);const s=r(1621);const{env:i}=process;let a;if(s("no-color")||s("no-colors")||s("color=false")||s("color=never")){a=0}else if(s("color")||s("colors")||s("color=true")||s("color=always")){a=1}if("FORCE_COLOR"in i){if(i.FORCE_COLOR==="true"){a=1}else if(i.FORCE_COLOR==="false"){a=0}else{a=i.FORCE_COLOR.length===0?1:Math.min(parseInt(i.FORCE_COLOR,10),3)}}function translateLevel(e){if(e===0){return false}return{level:e,hasBasic:true,has256:e>=2,has16m:e>=3}}function supportsColor(e,t){if(a===0){return 0}if(s("color=16m")||s("color=full")||s("color=truecolor")){return 3}if(s("color=256")){return 2}if(e&&!t&&a===undefined){return 0}const r=a||0;if(i.TERM==="dumb"){return r}if(process.platform==="win32"){const e=n.release().split(".");if(Number(e[0])>=10&&Number(e[2])>=10586){return Number(e[2])>=14931?3:2}return 1}if("CI"in i){if(["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some((e=>e in i))||i.CI_NAME==="codeship"){return 1}return r}if("TEAMCITY_VERSION"in i){return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(i.TEAMCITY_VERSION)?1:0}if(i.COLORTERM==="truecolor"){return 3}if("TERM_PROGRAM"in i){const e=parseInt((i.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(i.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}if(/-256(color)?$/i.test(i.TERM)){return 2}if(/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(i.TERM)){return 1}if("COLORTERM"in i){return 1}return r}function getSupportLevel(e){const t=supportsColor(e,e&&e.isTTY);return translateLevel(t)}e.exports={supportsColor:getSupportLevel,stdout:translateLevel(supportsColor(true,o.isatty(1))),stderr:translateLevel(supportsColor(true,o.isatty(2)))}},7882:(e,t,r)=>{var n=r(1669);var o=r(336);var s=r(8860);var i=r(1642).Writable;var a=r(1642).PassThrough;var noop=function(){};var overflow=function(e){e&=511;return e&&512-e};var emptyStream=function(e,t){var r=new Source(e,t);r.end();return r};var mixinPax=function(e,t){if(t.path)e.name=t.path;if(t.linkpath)e.linkname=t.linkpath;if(t.size)e.size=parseInt(t.size,10);e.pax=t;return e};var Source=function(e,t){this._parent=e;this.offset=t;a.call(this,{autoDestroy:false})};n.inherits(Source,a);Source.prototype.destroy=function(e){this._parent.destroy(e)};var Extract=function(e){if(!(this instanceof Extract))return new Extract(e);i.call(this,e);e=e||{};this._offset=0;this._buffer=o();this._missing=0;this._partial=false;this._onparse=noop;this._header=null;this._stream=null;this._overflow=null;this._cb=null;this._locked=false;this._destroyed=false;this._pax=null;this._paxGlobal=null;this._gnuLongPath=null;this._gnuLongLinkPath=null;var t=this;var r=t._buffer;var oncontinue=function(){t._continue()};var onunlock=function(e){t._locked=false;if(e)return t.destroy(e);if(!t._stream)oncontinue()};var onstreamend=function(){t._stream=null;var e=overflow(t._header.size);if(e)t._parse(e,ondrain);else t._parse(512,onheader);if(!t._locked)oncontinue()};var ondrain=function(){t._buffer.consume(overflow(t._header.size));t._parse(512,onheader);oncontinue()};var onpaxglobalheader=function(){var e=t._header.size;t._paxGlobal=s.decodePax(r.slice(0,e));r.consume(e);onstreamend()};var onpaxheader=function(){var e=t._header.size;t._pax=s.decodePax(r.slice(0,e));if(t._paxGlobal)t._pax=Object.assign({},t._paxGlobal,t._pax);r.consume(e);onstreamend()};var ongnulongpath=function(){var n=t._header.size;this._gnuLongPath=s.decodeLongPath(r.slice(0,n),e.filenameEncoding);r.consume(n);onstreamend()};var ongnulonglinkpath=function(){var n=t._header.size;this._gnuLongLinkPath=s.decodeLongPath(r.slice(0,n),e.filenameEncoding);r.consume(n);onstreamend()};var onheader=function(){var n=t._offset;var o;try{o=t._header=s.decode(r.slice(0,512),e.filenameEncoding,e.allowUnknownFormat)}catch(e){t.emit("error",e)}r.consume(512);if(!o){t._parse(512,onheader);oncontinue();return}if(o.type==="gnu-long-path"){t._parse(o.size,ongnulongpath);oncontinue();return}if(o.type==="gnu-long-link-path"){t._parse(o.size,ongnulonglinkpath);oncontinue();return}if(o.type==="pax-global-header"){t._parse(o.size,onpaxglobalheader);oncontinue();return}if(o.type==="pax-header"){t._parse(o.size,onpaxheader);oncontinue();return}if(t._gnuLongPath){o.name=t._gnuLongPath;t._gnuLongPath=null}if(t._gnuLongLinkPath){o.linkname=t._gnuLongLinkPath;t._gnuLongLinkPath=null}if(t._pax){t._header=o=mixinPax(o,t._pax);t._pax=null}t._locked=true;if(!o.size||o.type==="directory"){t._parse(512,onheader);t.emit("entry",o,emptyStream(t,n),onunlock);return}t._stream=new Source(t,n);t.emit("entry",o,t._stream,onunlock);t._parse(o.size,onstreamend);oncontinue()};this._onheader=onheader;this._parse(512,onheader)};n.inherits(Extract,i);Extract.prototype.destroy=function(e){if(this._destroyed)return;this._destroyed=true;if(e)this.emit("error",e);this.emit("close");if(this._stream)this._stream.emit("close")};Extract.prototype._parse=function(e,t){if(this._destroyed)return;this._offset+=e;this._missing=e;if(t===this._onheader)this._partial=false;this._onparse=t};Extract.prototype._continue=function(){if(this._destroyed)return;var e=this._cb;this._cb=noop;if(this._overflow)this._write(this._overflow,undefined,e);else e()};Extract.prototype._write=function(e,t,r){if(this._destroyed)return;var n=this._stream;var o=this._buffer;var s=this._missing;if(e.length)this._partial=true;if(e.length<s){this._missing-=e.length;this._overflow=null;if(n)return n.write(e,r);o.append(e);return r()}this._cb=r;this._missing=0;var i=null;if(e.length>s){i=e.slice(s);e=e.slice(0,s)}if(n)n.end(e);else o.append(e);this._overflow=i;this._onparse()};Extract.prototype._final=function(e){if(this._partial)return this.destroy(new Error("Unexpected end of data"));e()};e.exports=Extract},8860:(e,t)=>{var r=Buffer.alloc;var n="0000000000000000000";var o="7777777777777777777";var s="0".charCodeAt(0);var i=Buffer.from("ustar\0","binary");var a=Buffer.from("00","binary");var c=Buffer.from("ustar ","binary");var l=Buffer.from(" \0","binary");var u=parseInt("7777",8);var d=257;var p=263;var clamp=function(e,t,r){if(typeof e!=="number")return r;e=~~e;if(e>=t)return t;if(e>=0)return e;e+=t;if(e>=0)return e;return 0};var toType=function(e){switch(e){case 0:return"file";case 1:return"link";case 2:return"symlink";case 3:return"character-device";case 4:return"block-device";case 5:return"directory";case 6:return"fifo";case 7:return"contiguous-file";case 72:return"pax-header";case 55:return"pax-global-header";case 27:return"gnu-long-link-path";case 28:case 30:return"gnu-long-path"}return null};var toTypeflag=function(e){switch(e){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72}return 0};var indexOf=function(e,t,r,n){for(;r<n;r++){if(e[r]===t)return r}return n};var cksum=function(e){var t=8*32;for(var r=0;r<148;r++)t+=e[r];for(var n=156;n<512;n++)t+=e[n];return t};var encodeOct=function(e,t){e=e.toString(8);if(e.length>t)return o.slice(0,t)+" ";else return n.slice(0,t-e.length)+e+" "};function parse256(e){var t;if(e[0]===128)t=true;else if(e[0]===255)t=false;else return null;var r=[];for(var n=e.length-1;n>0;n--){var o=e[n];if(t)r.push(o);else r.push(255-o)}var s=0;var i=r.length;for(n=0;n<i;n++){s+=r[n]*Math.pow(256,n)}return t?s:-1*s}var decodeOct=function(e,t,r){e=e.slice(t,t+r);t=0;if(e[t]&128){return parse256(e)}else{while(t<e.length&&e[t]===32)t++;var n=clamp(indexOf(e,32,t,e.length),e.length,e.length);while(t<n&&e[t]===0)t++;if(n===t)return 0;return parseInt(e.slice(t,n).toString(),8)}};var decodeStr=function(e,t,r,n){return e.slice(t,indexOf(e,0,t,t+r)).toString(n)};var addLength=function(e){var t=Buffer.byteLength(e);var r=Math.floor(Math.log(t)/Math.log(10))+1;if(t+r>=Math.pow(10,r))r++;return t+r+e};t.decodeLongPath=function(e,t){return decodeStr(e,0,e.length,t)};t.encodePax=function(e){var t="";if(e.name)t+=addLength(" path="+e.name+"\n");if(e.linkname)t+=addLength(" linkpath="+e.linkname+"\n");var r=e.pax;if(r){for(var n in r){t+=addLength(" "+n+"="+r[n]+"\n")}}return Buffer.from(t)};t.decodePax=function(e){var t={};while(e.length){var r=0;while(r<e.length&&e[r]!==32)r++;var n=parseInt(e.slice(0,r).toString(),10);if(!n)return t;var o=e.slice(r+1,n-1).toString();var s=o.indexOf("=");if(s===-1)return t;t[o.slice(0,s)]=o.slice(s+1);e=e.slice(n)}return t};t.encode=function(e){var t=r(512);var n=e.name;var o="";if(e.typeflag===5&&n[n.length-1]!=="/")n+="/";if(Buffer.byteLength(n)!==n.length)return null;while(Buffer.byteLength(n)>100){var c=n.indexOf("/");if(c===-1)return null;o+=o?"/"+n.slice(0,c):n.slice(0,c);n=n.slice(c+1)}if(Buffer.byteLength(n)>100||Buffer.byteLength(o)>155)return null;if(e.linkname&&Buffer.byteLength(e.linkname)>100)return null;t.write(n);t.write(encodeOct(e.mode&u,6),100);t.write(encodeOct(e.uid,6),108);t.write(encodeOct(e.gid,6),116);t.write(encodeOct(e.size,11),124);t.write(encodeOct(e.mtime.getTime()/1e3|0,11),136);t[156]=s+toTypeflag(e.type);if(e.linkname)t.write(e.linkname,157);i.copy(t,d);a.copy(t,p);if(e.uname)t.write(e.uname,265);if(e.gname)t.write(e.gname,297);t.write(encodeOct(e.devmajor||0,6),329);t.write(encodeOct(e.devminor||0,6),337);if(o)t.write(o,345);t.write(encodeOct(cksum(t),6),148);return t};t.decode=function(e,t,r){var n=e[156]===0?0:e[156]-s;var o=decodeStr(e,0,100,t);var a=decodeOct(e,100,8);var u=decodeOct(e,108,8);var h=decodeOct(e,116,8);var m=decodeOct(e,124,12);var y=decodeOct(e,136,12);var g=toType(n);var v=e[157]===0?null:decodeStr(e,157,100,t);var b=decodeStr(e,265,32);var S=decodeStr(e,297,32);var w=decodeOct(e,329,8);var _=decodeOct(e,337,8);var E=cksum(e);if(E===8*32)return null;if(E!==decodeOct(e,148,8))throw new Error("Invalid tar header. Maybe the tar is corrupted or it needs to be gunzipped?");if(i.compare(e,d,d+6)===0){if(e[345])o=decodeStr(e,345,155,t)+"/"+o}else if(c.compare(e,d,d+6)===0&&l.compare(e,p,p+2)===0){}else{if(!r){throw new Error("Invalid tar header: unknown format.")}}if(n===0&&o&&o[o.length-1]==="/")n=5;return{name:o,mode:a,uid:u,gid:h,size:m,mtime:new Date(1e3*y),type:g,linkname:v,uname:b,gname:S,devmajor:w,devminor:_}}},2283:(e,t,r)=>{t.extract=r(7882);t.pack=r(4930)},4930:(e,t,r)=>{var n=r(3186);var o=r(1205);var s=r(4124);var i=Buffer.alloc;var a=r(1642).Readable;var c=r(1642).Writable;var l=r(4304).StringDecoder;var u=r(8860);var d=parseInt("755",8);var p=parseInt("644",8);var h=i(1024);var noop=function(){};var overflow=function(e,t){t&=511;if(t)e.push(h.slice(0,512-t))};function modeToType(e){switch(e&n.S_IFMT){case n.S_IFBLK:return"block-device";case n.S_IFCHR:return"character-device";case n.S_IFDIR:return"directory";case n.S_IFIFO:return"fifo";case n.S_IFLNK:return"symlink"}return"file"}var Sink=function(e){c.call(this);this.written=0;this._to=e;this._destroyed=false};s(Sink,c);Sink.prototype._write=function(e,t,r){this.written+=e.length;if(this._to.push(e))return r();this._to._drain=r};Sink.prototype.destroy=function(){if(this._destroyed)return;this._destroyed=true;this.emit("close")};var LinkSink=function(){c.call(this);this.linkname="";this._decoder=new l("utf-8");this._destroyed=false};s(LinkSink,c);LinkSink.prototype._write=function(e,t,r){this.linkname+=this._decoder.write(e);r()};LinkSink.prototype.destroy=function(){if(this._destroyed)return;this._destroyed=true;this.emit("close")};var Void=function(){c.call(this);this._destroyed=false};s(Void,c);Void.prototype._write=function(e,t,r){r(new Error("No body allowed for this entry"))};Void.prototype.destroy=function(){if(this._destroyed)return;this._destroyed=true;this.emit("close")};var Pack=function(e){if(!(this instanceof Pack))return new Pack(e);a.call(this,e);this._drain=noop;this._finalized=false;this._finalizing=false;this._destroyed=false;this._stream=null};s(Pack,a);Pack.prototype.entry=function(e,t,r){if(this._stream)throw new Error("already piping an entry");if(this._finalized||this._destroyed)return;if(typeof t==="function"){r=t;t=null}if(!r)r=noop;var n=this;if(!e.size||e.type==="symlink")e.size=0;if(!e.type)e.type=modeToType(e.mode);if(!e.mode)e.mode=e.type==="directory"?d:p;if(!e.uid)e.uid=0;if(!e.gid)e.gid=0;if(!e.mtime)e.mtime=new Date;if(typeof t==="string")t=Buffer.from(t);if(Buffer.isBuffer(t)){e.size=t.length;this._encode(e);var s=this.push(t);overflow(n,e.size);if(s)process.nextTick(r);else this._drain=r;return new Void}if(e.type==="symlink"&&!e.linkname){var i=new LinkSink;o(i,(function(t){if(t){n.destroy();return r(t)}e.linkname=i.linkname;n._encode(e);r()}));return i}this._encode(e);if(e.type!=="file"&&e.type!=="contiguous-file"){process.nextTick(r);return new Void}var a=new Sink(this);this._stream=a;o(a,(function(t){n._stream=null;if(t){n.destroy();return r(t)}if(a.written!==e.size){n.destroy();return r(new Error("size mismatch"))}overflow(n,e.size);if(n._finalizing)n.finalize();r()}));return a};Pack.prototype.finalize=function(){if(this._stream){this._finalizing=true;return}if(this._finalized)return;this._finalized=true;this.push(h);this.push(null)};Pack.prototype.destroy=function(e){if(this._destroyed)return;this._destroyed=true;if(e)this.emit("error",e);this.emit("close");if(this._stream&&this._stream.destroy)this._stream.destroy()};Pack.prototype._encode=function(e){if(!e.pax){var t=u.encode(e);if(t){this.push(t);return}}this._encodePax(e)};Pack.prototype._encodePax=function(e){var t=u.encodePax({name:e.name,linkname:e.linkname,pax:e.pax});var r={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.length,mtime:e.mtime,type:"pax-header",linkname:e.linkname&&"PaxHeader",uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};this.push(u.encode(r));this.push(t);overflow(this,t.length);r.size=e.size;r.type=e.type;this.push(u.encode(r))};Pack.prototype._read=function(e){var t=this._drain;this._drain=noop;t()};e.exports=Pack},8517:(e,t,r)=>{
/*!
 * Tmp
 *
 * Copyright (c) 2011-2017 KARASZI Istvan <github@spam.raszi.hu>
 *
 * MIT Licensed
 */
const n=r(5747);const o=r(2087);const s=r(5622);const i=r(6417);const a={fs:n.constants,os:o.constants};const c=r(4959);const l="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",u=/XXXXXX/,d=3,p=(a.O_CREAT||a.fs.O_CREAT)|(a.O_EXCL||a.fs.O_EXCL)|(a.O_RDWR||a.fs.O_RDWR),h=o.platform()==="win32",m=a.EBADF||a.os.errno.EBADF,y=a.ENOENT||a.os.errno.ENOENT,g=448,v=384,b="exit",S=[],w=n.rmdirSync.bind(n),_=c.sync;let E=false;function tmpName(e,t){const r=_parseArguments(e,t),o=r[0],s=r[1];try{_assertAndSanitizeOptions(o)}catch(e){return s(e)}let i=o.tries;(function _getUniqueName(){try{const e=_generateTmpName(o);n.stat(e,(function(t){if(!t){if(i-- >0)return _getUniqueName();return s(new Error("Could not get a unique tmp filename, max tries reached "+e))}s(null,e)}))}catch(e){s(e)}})()}function tmpNameSync(e){const t=_parseArguments(e),r=t[0];_assertAndSanitizeOptions(r);let o=r.tries;do{const e=_generateTmpName(r);try{n.statSync(e)}catch(t){return e}}while(o-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function file(e,t){const r=_parseArguments(e,t),o=r[0],s=r[1];tmpName(o,(function _tmpNameCreated(e,t){if(e)return s(e);n.open(t,p,o.mode||v,(function _fileCreated(e,r){if(e)return s(e);if(o.discardDescriptor){return n.close(r,(function _discardCallback(e){return s(e,t,undefined,_prepareTmpFileRemoveCallback(t,-1,o,false))}))}else{const e=o.discardDescriptor||o.detachDescriptor;s(null,t,r,_prepareTmpFileRemoveCallback(t,e?-1:r,o,false))}}))}))}function fileSync(e){const t=_parseArguments(e),r=t[0];const o=r.discardDescriptor||r.detachDescriptor;const s=tmpNameSync(r);var i=n.openSync(s,p,r.mode||v);if(r.discardDescriptor){n.closeSync(i);i=undefined}return{name:s,fd:i,removeCallback:_prepareTmpFileRemoveCallback(s,o?-1:i,r,true)}}function dir(e,t){const r=_parseArguments(e,t),o=r[0],s=r[1];tmpName(o,(function _tmpNameCreated(e,t){if(e)return s(e);n.mkdir(t,o.mode||g,(function _dirCreated(e){if(e)return s(e);s(null,t,_prepareTmpDirRemoveCallback(t,o,false))}))}))}function dirSync(e){const t=_parseArguments(e),r=t[0];const o=tmpNameSync(r);n.mkdirSync(o,r.mode||g);return{name:o,removeCallback:_prepareTmpDirRemoveCallback(o,r,true)}}function _removeFileAsync(e,t){const _handler=function(e){if(e&&!_isENOENT(e)){return t(e)}t()};if(0<=e[0])n.close(e[0],(function(){n.unlink(e[1],_handler)}));else n.unlink(e[1],_handler)}function _removeFileSync(e){let t=null;try{if(0<=e[0])n.closeSync(e[0])}catch(e){if(!_isEBADF(e)&&!_isENOENT(e))throw e}finally{try{n.unlinkSync(e[1])}catch(e){if(!_isENOENT(e))t=e}}if(t!==null){throw t}}function _prepareTmpFileRemoveCallback(e,t,r,n){const o=_prepareRemoveCallback(_removeFileSync,[t,e],n);const s=_prepareRemoveCallback(_removeFileAsync,[t,e],n,o);if(!r.keep)S.unshift(o);return n?o:s}function _prepareTmpDirRemoveCallback(e,t,r){const o=t.unsafeCleanup?c:n.rmdir.bind(n);const s=t.unsafeCleanup?_:w;const i=_prepareRemoveCallback(s,e,r);const a=_prepareRemoveCallback(o,e,r,i);if(!t.keep)S.unshift(i);return r?i:a}function _prepareRemoveCallback(e,t,r,n){let o=false;return function _cleanupCallback(s){if(!o){const i=n||_cleanupCallback;const a=S.indexOf(i);if(a>=0)S.splice(a,1);o=true;if(r||e===w||e===_){return e(t)}else{return e(t,s||function(){})}}}}function _garbageCollector(){if(!E)return;while(S.length){try{S[0]()}catch(e){}}}function _randomChars(e){let t=[],r=null;try{r=i.randomBytes(e)}catch(t){r=i.pseudoRandomBytes(e)}for(var n=0;n<e;n++){t.push(l[r[n]%l.length])}return t.join("")}function _isBlank(e){return e===null||_isUndefined(e)||!e.trim()}function _isUndefined(e){return typeof e==="undefined"}function _parseArguments(e,t){if(typeof e==="function"){return[{},e]}if(_isUndefined(e)){return[{},t]}const r={};for(const t of Object.getOwnPropertyNames(e)){r[t]=e[t]}return[r,t]}function _generateTmpName(e){const t=e.tmpdir;if(!_isUndefined(e.name))return s.join(t,e.dir,e.name);if(!_isUndefined(e.template))return s.join(t,e.dir,e.template).replace(u,_randomChars(6));const r=[e.prefix?e.prefix:"tmp","-",process.pid,"-",_randomChars(12),e.postfix?"-"+e.postfix:""].join("");return s.join(t,e.dir,r)}function _assertAndSanitizeOptions(e){e.tmpdir=_getTmpDir(e);const t=e.tmpdir;if(!_isUndefined(e.name))_assertIsRelative(e.name,"name",t);if(!_isUndefined(e.dir))_assertIsRelative(e.dir,"dir",t);if(!_isUndefined(e.template)){_assertIsRelative(e.template,"template",t);if(!e.template.match(u))throw new Error(`Invalid template, found "${e.template}".`)}if(!_isUndefined(e.tries)&&isNaN(e.tries)||e.tries<0)throw new Error(`Invalid tries, found "${e.tries}".`);e.tries=_isUndefined(e.name)?e.tries||d:1;e.keep=!!e.keep;e.detachDescriptor=!!e.detachDescriptor;e.discardDescriptor=!!e.discardDescriptor;e.unsafeCleanup=!!e.unsafeCleanup;e.dir=_isUndefined(e.dir)?"":s.relative(t,_resolvePath(e.dir,t));e.template=_isUndefined(e.template)?undefined:s.relative(t,_resolvePath(e.template,t));e.template=_isBlank(e.template)?undefined:s.relative(e.dir,e.template);e.name=_isUndefined(e.name)?undefined:_sanitizeName(e.name);e.prefix=_isUndefined(e.prefix)?"":e.prefix;e.postfix=_isUndefined(e.postfix)?"":e.postfix}function _resolvePath(e,t){const r=_sanitizeName(e);if(r.startsWith(t)){return s.resolve(r)}else{return s.resolve(s.join(t,r))}}function _sanitizeName(e){if(_isBlank(e)){return e}return e.replace(/["']/g,"")}function _assertIsRelative(e,t,r){if(t==="name"){if(s.isAbsolute(e))throw new Error(`${t} option must not contain an absolute path, found "${e}".`);let r=s.basename(e);if(r===".."||r==="."||r!==e)throw new Error(`${t} option must not contain a path, found "${e}".`)}else{if(s.isAbsolute(e)&&!e.startsWith(r)){throw new Error(`${t} option must be relative to "${r}", found "${e}".`)}let n=_resolvePath(e,r);if(!n.startsWith(r))throw new Error(`${t} option must be relative to "${r}", found "${n}".`)}}function _isEBADF(e){return _isExpectedError(e,-m,"EBADF")}function _isENOENT(e){return _isExpectedError(e,-y,"ENOENT")}function _isExpectedError(e,t,r){return h?e.code===r:e.code===r&&e.errno===t}function setGracefulCleanup(){E=true}function _getTmpDir(e){return s.resolve(_sanitizeName(e&&e.tmpdir||o.tmpdir()))}process.addListener(b,_garbageCollector);Object.defineProperty(e.exports,"tmpdir",{enumerable:true,configurable:false,get:function(){return _getTmpDir()}});e.exports.dir=dir;e.exports.dirSync=dirSync;e.exports.file=file;e.exports.fileSync=fileSync;e.exports.tmpName=tmpName;e.exports.tmpNameSync=tmpNameSync;e.exports.setGracefulCleanup=setGracefulCleanup},4351:e=>{
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t;var r;var n;var o;var s;var i;var a;var c;var l;var u;var d;var p;var h;var m;var y;var g;var v;var b;var S;var w;var _;var E;var O;var C;(function(t){var r=typeof global==="object"?global:typeof self==="object"?self:typeof this==="object"?this:{};if(typeof define==="function"&&define.amd){define("tslib",["exports"],(function(e){t(createExporter(r,createExporter(e)))}))}else if(true&&typeof e.exports==="object"){t(createExporter(r,createExporter(e.exports)))}else{t(createExporter(r))}function createExporter(e,t){if(e!==r){if(typeof Object.create==="function"){Object.defineProperty(e,"__esModule",{value:true})}else{e.__esModule=true}}return function(r,n){return e[r]=t?t(r,n):n}}})((function(e){var T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))e[r]=t[r]};t=function(e,t){if(typeof t!=="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");T(e,t);function __(){this.constructor=e}e.prototype=t===null?Object.create(t):(__.prototype=t.prototype,new __)};r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]}return e};n=function(e,t){var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0)r[n]=e[n];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++){if(t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o]))r[n[o]]=e[n[o]]}return r};o=function(e,t,r,n){var o=arguments.length,s=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,i;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)if(i=e[a])s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s;return o>3&&s&&Object.defineProperty(t,r,s),s};s=function(e,t){return function(r,n){t(r,n,e)}};i=function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};a=function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};c=function(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,i;return i={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function verb(e){return function(t){return step([e,t])}}function step(i){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(s=i[0]&2?o["return"]:i[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;if(o=0,s)i=[i[0]&2,s.value];switch(i[0]){case 0:case 1:s=i;break;case 4:r.label++;return{value:i[1],done:false};case 5:r.label++;o=i[1];i=[0];continue;case 7:i=r.ops.pop();r.trys.pop();continue;default:if(!(s=r.trys,s=s.length>0&&s[s.length-1])&&(i[0]===6||i[0]===2)){r=0;continue}if(i[0]===3&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(i[0]===6&&r.label<s[1]){r.label=s[1];s=i;break}if(s&&r.label<s[2]){r.label=s[2];r.ops.push(i);break}if(s[2])r.ops.pop();r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e];o=0}finally{n=s=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}};l=function(e,t){for(var r in e)if(r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r))C(t,e,r)};C=Object.create?function(e,t,r,n){if(n===undefined)n=r;Object.defineProperty(e,n,{enumerable:true,get:function(){return t[r]}})}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]};u=function(e){var t=typeof Symbol==="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length==="number")return{next:function(){if(e&&n>=e.length)e=void 0;return{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};d=function(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,s=[],i;try{while((t===void 0||t-- >0)&&!(o=n.next()).done)s.push(o.value)}catch(e){i={error:e}}finally{try{if(o&&!o.done&&(r=n["return"]))r.call(n)}finally{if(i)throw i.error}}return s};p=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e};h=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,o++)n[o]=s[i];return n};m=function(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,s;n<o;n++){if(s||!(n in t)){if(!s)s=Array.prototype.slice.call(t,0,n);s[n]=t[n]}}return e.concat(s||t)};y=function(e){return this instanceof y?(this.v=e,this):new y(e)};g=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,s=[];return o={},verb("next"),verb("throw"),verb("return"),o[Symbol.asyncIterator]=function(){return this},o;function verb(e){if(n[e])o[e]=function(t){return new Promise((function(r,n){s.push([e,t,r,n])>1||resume(e,t)}))}}function resume(e,t){try{step(n[e](t))}catch(e){settle(s[0][3],e)}}function step(e){e.value instanceof y?Promise.resolve(e.value.v).then(fulfill,reject):settle(s[0][2],e)}function fulfill(e){resume("next",e)}function reject(e){resume("throw",e)}function settle(e,t){if(e(t),s.shift(),s.length)resume(s[0][0],s[0][1])}};v=function(e){var t,r;return t={},verb("next"),verb("throw",(function(e){throw e})),verb("return"),t[Symbol.iterator]=function(){return this},t;function verb(n,o){t[n]=e[n]?function(t){return(r=!r)?{value:y(e[n](t)),done:n==="return"}:o?o(t):t}:o}};b=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof u==="function"?u(e):e[Symbol.iterator](),r={},verb("next"),verb("throw"),verb("return"),r[Symbol.asyncIterator]=function(){return this},r);function verb(t){r[t]=e[t]&&function(r){return new Promise((function(n,o){r=e[t](r),settle(n,o,r.done,r.value)}))}}function settle(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}};S=function(e,t){if(Object.defineProperty){Object.defineProperty(e,"raw",{value:t})}else{e.raw=t}return e};var I=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t};w=function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(r!=="default"&&Object.prototype.hasOwnProperty.call(e,r))C(t,e,r);I(t,e);return t};_=function(e){return e&&e.__esModule?e:{default:e}};E=function(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t==="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)};O=function(e,t,r,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t==="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,r):o?o.value=r:t.set(e,r),r};e("__extends",t);e("__assign",r);e("__rest",n);e("__decorate",o);e("__param",s);e("__metadata",i);e("__awaiter",a);e("__generator",c);e("__exportStar",l);e("__createBinding",C);e("__values",u);e("__read",d);e("__spread",p);e("__spreadArrays",h);e("__spreadArray",m);e("__await",y);e("__asyncGenerator",g);e("__asyncDelegator",v);e("__asyncValues",b);e("__makeTemplateObject",S);e("__importStar",w);e("__importDefault",_);e("__classPrivateFieldGet",E);e("__classPrivateFieldSet",O)}))},7127:(e,t,r)=>{e.exports=r(1669).deprecate},5840:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});Object.defineProperty(t,"v1",{enumerable:true,get:function(){return n.default}});Object.defineProperty(t,"v3",{enumerable:true,get:function(){return o.default}});Object.defineProperty(t,"v4",{enumerable:true,get:function(){return s.default}});Object.defineProperty(t,"v5",{enumerable:true,get:function(){return i.default}});Object.defineProperty(t,"NIL",{enumerable:true,get:function(){return a.default}});Object.defineProperty(t,"version",{enumerable:true,get:function(){return c.default}});Object.defineProperty(t,"validate",{enumerable:true,get:function(){return l.default}});Object.defineProperty(t,"stringify",{enumerable:true,get:function(){return u.default}});Object.defineProperty(t,"parse",{enumerable:true,get:function(){return d.default}});var n=_interopRequireDefault(r(8628));var o=_interopRequireDefault(r(6409));var s=_interopRequireDefault(r(5122));var i=_interopRequireDefault(r(9120));var a=_interopRequireDefault(r(5350));var c=_interopRequireDefault(r(1595));var l=_interopRequireDefault(r(6900));var u=_interopRequireDefault(r(8950));var d=_interopRequireDefault(r(4848));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}},4569:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=_interopRequireDefault(r(6417));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function md5(e){if(Array.isArray(e)){e=Buffer.from(e)}else if(typeof e==="string"){e=Buffer.from(e,"utf8")}return n.default.createHash("md5").update(e).digest()}var o=md5;t.default=o},5350:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var r="00000000-0000-0000-0000-000000000000";t.default=r},4848:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=_interopRequireDefault(r(6900));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function parse(e){if(!(0,n.default)(e)){throw TypeError("Invalid UUID")}let t;const r=new Uint8Array(16);r[0]=(t=parseInt(e.slice(0,8),16))>>>24;r[1]=t>>>16&255;r[2]=t>>>8&255;r[3]=t&255;r[4]=(t=parseInt(e.slice(9,13),16))>>>8;r[5]=t&255;r[6]=(t=parseInt(e.slice(14,18),16))>>>8;r[7]=t&255;r[8]=(t=parseInt(e.slice(19,23),16))>>>8;r[9]=t&255;r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255;r[11]=t/4294967296&255;r[12]=t>>>24&255;r[13]=t>>>16&255;r[14]=t>>>8&255;r[15]=t&255;return r}var o=parse;t.default=o},814:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;t.default=r},807:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=rng;var n=_interopRequireDefault(r(6417));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const o=new Uint8Array(256);let s=o.length;function rng(){if(s>o.length-16){n.default.randomFillSync(o);s=0}return o.slice(s,s+=16)}},5274:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=_interopRequireDefault(r(6417));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function sha1(e){if(Array.isArray(e)){e=Buffer.from(e)}else if(typeof e==="string"){e=Buffer.from(e,"utf8")}return n.default.createHash("sha1").update(e).digest()}var o=sha1;t.default=o},8950:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=_interopRequireDefault(r(6900));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const o=[];for(let e=0;e<256;++e){o.push((e+256).toString(16).substr(1))}function stringify(e,t=0){const r=(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase();if(!(0,n.default)(r)){throw TypeError("Stringified UUID is invalid")}return r}var s=stringify;t.default=s},8628:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=_interopRequireDefault(r(807));var o=_interopRequireDefault(r(8950));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}let s;let i;let a=0;let c=0;function v1(e,t,r){let l=t&&r||0;const u=t||new Array(16);e=e||{};let d=e.node||s;let p=e.clockseq!==undefined?e.clockseq:i;if(d==null||p==null){const t=e.random||(e.rng||n.default)();if(d==null){d=s=[t[0]|1,t[1],t[2],t[3],t[4],t[5]]}if(p==null){p=i=(t[6]<<8|t[7])&16383}}let h=e.msecs!==undefined?e.msecs:Date.now();let m=e.nsecs!==undefined?e.nsecs:c+1;const y=h-a+(m-c)/1e4;if(y<0&&e.clockseq===undefined){p=p+1&16383}if((y<0||h>a)&&e.nsecs===undefined){m=0}if(m>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}a=h;c=m;i=p;h+=122192928e5;const g=((h&268435455)*1e4+m)%4294967296;u[l++]=g>>>24&255;u[l++]=g>>>16&255;u[l++]=g>>>8&255;u[l++]=g&255;const v=h/4294967296*1e4&268435455;u[l++]=v>>>8&255;u[l++]=v&255;u[l++]=v>>>24&15|16;u[l++]=v>>>16&255;u[l++]=p>>>8|128;u[l++]=p&255;for(let e=0;e<6;++e){u[l+e]=d[e]}return t||(0,o.default)(u)}var l=v1;t.default=l},6409:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=_interopRequireDefault(r(5998));var o=_interopRequireDefault(r(4569));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const s=(0,n.default)("v3",48,o.default);var i=s;t.default=i},5998:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=_default;t.URL=t.DNS=void 0;var n=_interopRequireDefault(r(8950));var o=_interopRequireDefault(r(4848));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function stringToBytes(e){e=unescape(encodeURIComponent(e));const t=[];for(let r=0;r<e.length;++r){t.push(e.charCodeAt(r))}return t}const s="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=s;const i="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=i;function _default(e,t,r){function generateUUID(e,s,i,a){if(typeof e==="string"){e=stringToBytes(e)}if(typeof s==="string"){s=(0,o.default)(s)}if(s.length!==16){throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)")}let c=new Uint8Array(16+e.length);c.set(s);c.set(e,s.length);c=r(c);c[6]=c[6]&15|t;c[8]=c[8]&63|128;if(i){a=a||0;for(let e=0;e<16;++e){i[a+e]=c[e]}return i}return(0,n.default)(c)}try{generateUUID.name=e}catch(e){}generateUUID.DNS=s;generateUUID.URL=i;return generateUUID}},5122:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=_interopRequireDefault(r(807));var o=_interopRequireDefault(r(8950));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function v4(e,t,r){e=e||{};const s=e.random||(e.rng||n.default)();s[6]=s[6]&15|64;s[8]=s[8]&63|128;if(t){r=r||0;for(let e=0;e<16;++e){t[r+e]=s[e]}return t}return(0,o.default)(s)}var s=v4;t.default=s},9120:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=_interopRequireDefault(r(5998));var o=_interopRequireDefault(r(5274));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}const s=(0,n.default)("v5",80,o.default);var i=s;t.default=i},6900:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=_interopRequireDefault(r(814));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function validate(e){return typeof e==="string"&&n.default.test(e)}var o=validate;t.default=o},1595:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var n=_interopRequireDefault(r(6900));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function version(e){if(!(0,n.default)(e)){throw TypeError("Invalid UUID")}return parseInt(e.substr(14,1),16)}var o=version;t.default=o},2940:e=>{e.exports=wrappy;function wrappy(e,t){if(e&&t)return wrappy(e)(t);if(typeof e!=="function")throw new TypeError("need wrapper function");Object.keys(e).forEach((function(t){wrapper[t]=e[t]}));return wrapper;function wrapper(){var t=new Array(arguments.length);for(var r=0;r<t.length;r++){t[r]=arguments[r]}var n=e.apply(this,t);var o=t[t.length-1];if(typeof n==="function"&&n!==o){Object.keys(o).forEach((function(e){n[e]=o[e]}))}return n}}},4091:e=>{"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next){yield e.value}}}},665:(e,t,r)=>{"use strict";e.exports=Yallist;Yallist.Node=Node;Yallist.create=Yallist;function Yallist(e){var t=this;if(!(t instanceof Yallist)){t=new Yallist}t.tail=null;t.head=null;t.length=0;if(e&&typeof e.forEach==="function"){e.forEach((function(e){t.push(e)}))}else if(arguments.length>0){for(var r=0,n=arguments.length;r<n;r++){t.push(arguments[r])}}return t}Yallist.prototype.removeNode=function(e){if(e.list!==this){throw new Error("removing node which does not belong to this list")}var t=e.next;var r=e.prev;if(t){t.prev=r}if(r){r.next=t}if(e===this.head){this.head=t}if(e===this.tail){this.tail=r}e.list.length--;e.next=null;e.prev=null;e.list=null;return t};Yallist.prototype.unshiftNode=function(e){if(e===this.head){return}if(e.list){e.list.removeNode(e)}var t=this.head;e.list=this;e.next=t;if(t){t.prev=e}this.head=e;if(!this.tail){this.tail=e}this.length++};Yallist.prototype.pushNode=function(e){if(e===this.tail){return}if(e.list){e.list.removeNode(e)}var t=this.tail;e.list=this;e.prev=t;if(t){t.next=e}this.tail=e;if(!this.head){this.head=e}this.length++};Yallist.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++){push(this,arguments[e])}return this.length};Yallist.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++){unshift(this,arguments[e])}return this.length};Yallist.prototype.pop=function(){if(!this.tail){return undefined}var e=this.tail.value;this.tail=this.tail.prev;if(this.tail){this.tail.next=null}else{this.head=null}this.length--;return e};Yallist.prototype.shift=function(){if(!this.head){return undefined}var e=this.head.value;this.head=this.head.next;if(this.head){this.head.prev=null}else{this.tail=null}this.length--;return e};Yallist.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;r!==null;n++){e.call(t,r.value,n,this);r=r.next}};Yallist.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;r!==null;n--){e.call(t,r.value,n,this);r=r.prev}};Yallist.prototype.get=function(e){for(var t=0,r=this.head;r!==null&&t<e;t++){r=r.next}if(t===e&&r!==null){return r.value}};Yallist.prototype.getReverse=function(e){for(var t=0,r=this.tail;r!==null&&t<e;t++){r=r.prev}if(t===e&&r!==null){return r.value}};Yallist.prototype.map=function(e,t){t=t||this;var r=new Yallist;for(var n=this.head;n!==null;){r.push(e.call(t,n.value,this));n=n.next}return r};Yallist.prototype.mapReverse=function(e,t){t=t||this;var r=new Yallist;for(var n=this.tail;n!==null;){r.push(e.call(t,n.value,this));n=n.prev}return r};Yallist.prototype.reduce=function(e,t){var r;var n=this.head;if(arguments.length>1){r=t}else if(this.head){n=this.head.next;r=this.head.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var o=0;n!==null;o++){r=e(r,n.value,o);n=n.next}return r};Yallist.prototype.reduceReverse=function(e,t){var r;var n=this.tail;if(arguments.length>1){r=t}else if(this.tail){n=this.tail.prev;r=this.tail.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var o=this.length-1;n!==null;o--){r=e(r,n.value,o);n=n.prev}return r};Yallist.prototype.toArray=function(){var e=new Array(this.length);for(var t=0,r=this.head;r!==null;t++){e[t]=r.value;r=r.next}return e};Yallist.prototype.toArrayReverse=function(){var e=new Array(this.length);for(var t=0,r=this.tail;r!==null;t++){e[t]=r.value;r=r.prev}return e};Yallist.prototype.slice=function(e,t){t=t||this.length;if(t<0){t+=this.length}e=e||0;if(e<0){e+=this.length}var r=new Yallist;if(t<e||t<0){return r}if(e<0){e=0}if(t>this.length){t=this.length}for(var n=0,o=this.head;o!==null&&n<e;n++){o=o.next}for(;o!==null&&n<t;n++,o=o.next){r.push(o.value)}return r};Yallist.prototype.sliceReverse=function(e,t){t=t||this.length;if(t<0){t+=this.length}e=e||0;if(e<0){e+=this.length}var r=new Yallist;if(t<e||t<0){return r}if(e<0){e=0}if(t>this.length){t=this.length}for(var n=this.length,o=this.tail;o!==null&&n>t;n--){o=o.prev}for(;o!==null&&n>e;n--,o=o.prev){r.push(o.value)}return r};Yallist.prototype.splice=function(e,t,...r){if(e>this.length){e=this.length-1}if(e<0){e=this.length+e}for(var n=0,o=this.head;o!==null&&n<e;n++){o=o.next}var s=[];for(var n=0;o&&n<t;n++){s.push(o.value);o=this.removeNode(o)}if(o===null){o=this.tail}if(o!==this.head&&o!==this.tail){o=o.prev}for(var n=0;n<r.length;n++){o=insert(this,o,r[n])}return s};Yallist.prototype.reverse=function(){var e=this.head;var t=this.tail;for(var r=e;r!==null;r=r.prev){var n=r.prev;r.prev=r.next;r.next=n}this.head=t;this.tail=e;return this};function insert(e,t,r){var n=t===e.head?new Node(r,null,t,e):new Node(r,t,t.next,e);if(n.next===null){e.tail=n}if(n.prev===null){e.head=n}e.length++;return n}function push(e,t){e.tail=new Node(t,e.tail,null,e);if(!e.head){e.head=e.tail}e.length++}function unshift(e,t){e.head=new Node(t,null,e.head,e);if(!e.tail){e.tail=e.head}e.length++}function Node(e,t,r,n){if(!(this instanceof Node)){return new Node(e,t,r,n)}this.list=n;this.value=e;if(t){t.next=this;this.prev=t}else{this.prev=null}if(r){r.prev=this;this.next=r}else{this.next=null}}try{r(4091)(Yallist)}catch(e){}},8781:(e,t,r)=>{var n=r(5747);var o=r(8761);var s=r(5010);var i=r(4794);var a=r(1669);var c=r(8614).EventEmitter;var l=r(2413).Transform;var u=r(2413).PassThrough;var d=r(2413).Writable;t.open=open;t.fromFd=fromFd;t.fromBuffer=fromBuffer;t.fromRandomAccessReader=fromRandomAccessReader;t.dosDateTimeToDate=dosDateTimeToDate;t.validateFileName=validateFileName;t.ZipFile=ZipFile;t.Entry=Entry;t.RandomAccessReader=RandomAccessReader;function open(e,t,r){if(typeof t==="function"){r=t;t=null}if(t==null)t={};if(t.autoClose==null)t.autoClose=true;if(t.lazyEntries==null)t.lazyEntries=false;if(t.decodeStrings==null)t.decodeStrings=true;if(t.validateEntrySizes==null)t.validateEntrySizes=true;if(t.strictFileNames==null)t.strictFileNames=false;if(r==null)r=defaultCallback;n.open(e,"r",(function(e,o){if(e)return r(e);fromFd(o,t,(function(e,t){if(e)n.close(o,defaultCallback);r(e,t)}))}))}function fromFd(e,t,r){if(typeof t==="function"){r=t;t=null}if(t==null)t={};if(t.autoClose==null)t.autoClose=false;if(t.lazyEntries==null)t.lazyEntries=false;if(t.decodeStrings==null)t.decodeStrings=true;if(t.validateEntrySizes==null)t.validateEntrySizes=true;if(t.strictFileNames==null)t.strictFileNames=false;if(r==null)r=defaultCallback;n.fstat(e,(function(n,o){if(n)return r(n);var i=s.createFromFd(e,{autoClose:true});fromRandomAccessReader(i,o.size,t,r)}))}function fromBuffer(e,t,r){if(typeof t==="function"){r=t;t=null}if(t==null)t={};t.autoClose=false;if(t.lazyEntries==null)t.lazyEntries=false;if(t.decodeStrings==null)t.decodeStrings=true;if(t.validateEntrySizes==null)t.validateEntrySizes=true;if(t.strictFileNames==null)t.strictFileNames=false;var n=s.createFromBuffer(e,{maxChunkSize:65536});fromRandomAccessReader(n,e.length,t,r)}function fromRandomAccessReader(e,t,r,n){if(typeof r==="function"){n=r;r=null}if(r==null)r={};if(r.autoClose==null)r.autoClose=true;if(r.lazyEntries==null)r.lazyEntries=false;if(r.decodeStrings==null)r.decodeStrings=true;var o=!!r.decodeStrings;if(r.validateEntrySizes==null)r.validateEntrySizes=true;if(r.strictFileNames==null)r.strictFileNames=false;if(n==null)n=defaultCallback;if(typeof t!=="number")throw new Error("expected totalSize parameter to be a number");if(t>Number.MAX_SAFE_INTEGER){throw new Error("zip file too large. only file sizes up to 2^52 are supported due to JavaScript's Number type being an IEEE 754 double.")}e.ref();var s=22;var i=65535;var a=Math.min(s+i,t);var c=h(a);var l=t-c.length;readAndAssertNoEof(e,c,0,a,l,(function(i){if(i)return n(i);for(var u=a-s;u>=0;u-=1){if(c.readUInt32LE(u)!==101010256)continue;var d=c.slice(u);var p=d.readUInt16LE(4);if(p!==0){return n(new Error("multi-disk zip files are not supported: found disk number: "+p))}var m=d.readUInt16LE(10);var y=d.readUInt32LE(16);var g=d.readUInt16LE(20);var v=d.length-s;if(g!==v){return n(new Error("invalid comment length. expected: "+v+". found: "+g))}var b=o?decodeBuffer(d,22,d.length,false):d.slice(22);if(!(m===65535||y===4294967295)){return n(null,new ZipFile(e,y,t,m,b,r.autoClose,r.lazyEntries,o,r.validateEntrySizes,r.strictFileNames))}var S=h(20);var w=l+u-S.length;readAndAssertNoEof(e,S,0,S.length,w,(function(s){if(s)return n(s);if(S.readUInt32LE(0)!==117853008){return n(new Error("invalid zip64 end of central directory locator signature"))}var i=readUInt64LE(S,8);var a=h(56);readAndAssertNoEof(e,a,0,a.length,i,(function(s){if(s)return n(s);if(a.readUInt32LE(0)!==101075792){return n(new Error("invalid zip64 end of central directory record signature"))}m=readUInt64LE(a,32);y=readUInt64LE(a,48);return n(null,new ZipFile(e,y,t,m,b,r.autoClose,r.lazyEntries,o,r.validateEntrySizes,r.strictFileNames))}))}));return}n(new Error("end of central directory record signature not found"))}))}a.inherits(ZipFile,c);function ZipFile(e,t,r,n,o,s,i,a,l,u){var d=this;c.call(d);d.reader=e;d.reader.on("error",(function(e){emitError(d,e)}));d.reader.once("close",(function(){d.emit("close")}));d.readEntryCursor=t;d.fileSize=r;d.entryCount=n;d.comment=o;d.entriesRead=0;d.autoClose=!!s;d.lazyEntries=!!i;d.decodeStrings=!!a;d.validateEntrySizes=!!l;d.strictFileNames=!!u;d.isOpen=true;d.emittedError=false;if(!d.lazyEntries)d._readEntry()}ZipFile.prototype.close=function(){if(!this.isOpen)return;this.isOpen=false;this.reader.unref()};function emitErrorAndAutoClose(e,t){if(e.autoClose)e.close();emitError(e,t)}function emitError(e,t){if(e.emittedError)return;e.emittedError=true;e.emit("error",t)}ZipFile.prototype.readEntry=function(){if(!this.lazyEntries)throw new Error("readEntry() called without lazyEntries:true");this._readEntry()};ZipFile.prototype._readEntry=function(){var e=this;if(e.entryCount===e.entriesRead){setImmediate((function(){if(e.autoClose)e.close();if(e.emittedError)return;e.emit("end")}));return}if(e.emittedError)return;var t=h(46);readAndAssertNoEof(e.reader,t,0,t.length,e.readEntryCursor,(function(r){if(r)return emitErrorAndAutoClose(e,r);if(e.emittedError)return;var n=new Entry;var o=t.readUInt32LE(0);if(o!==33639248)return emitErrorAndAutoClose(e,new Error("invalid central directory file header signature: 0x"+o.toString(16)));n.versionMadeBy=t.readUInt16LE(4);n.versionNeededToExtract=t.readUInt16LE(6);n.generalPurposeBitFlag=t.readUInt16LE(8);n.compressionMethod=t.readUInt16LE(10);n.lastModFileTime=t.readUInt16LE(12);n.lastModFileDate=t.readUInt16LE(14);n.crc32=t.readUInt32LE(16);n.compressedSize=t.readUInt32LE(20);n.uncompressedSize=t.readUInt32LE(24);n.fileNameLength=t.readUInt16LE(28);n.extraFieldLength=t.readUInt16LE(30);n.fileCommentLength=t.readUInt16LE(32);n.internalFileAttributes=t.readUInt16LE(36);n.externalFileAttributes=t.readUInt32LE(38);n.relativeOffsetOfLocalHeader=t.readUInt32LE(42);if(n.generalPurposeBitFlag&64)return emitErrorAndAutoClose(e,new Error("strong encryption is not supported"));e.readEntryCursor+=46;t=h(n.fileNameLength+n.extraFieldLength+n.fileCommentLength);readAndAssertNoEof(e.reader,t,0,t.length,e.readEntryCursor,(function(r){if(r)return emitErrorAndAutoClose(e,r);if(e.emittedError)return;var o=(n.generalPurposeBitFlag&2048)!==0;n.fileName=e.decodeStrings?decodeBuffer(t,0,n.fileNameLength,o):t.slice(0,n.fileNameLength);var s=n.fileNameLength+n.extraFieldLength;var a=t.slice(n.fileNameLength,s);n.extraFields=[];var c=0;while(c<a.length-3){var l=a.readUInt16LE(c+0);var u=a.readUInt16LE(c+2);var d=c+4;var p=d+u;if(p>a.length)return emitErrorAndAutoClose(e,new Error("extra field length exceeds extra field buffer size"));var m=h(u);a.copy(m,0,d,p);n.extraFields.push({id:l,data:m});c=p}n.fileComment=e.decodeStrings?decodeBuffer(t,s,s+n.fileCommentLength,o):t.slice(s,s+n.fileCommentLength);n.comment=n.fileComment;e.readEntryCursor+=t.length;e.entriesRead+=1;if(n.uncompressedSize===4294967295||n.compressedSize===4294967295||n.relativeOffsetOfLocalHeader===4294967295){var y=null;for(var c=0;c<n.extraFields.length;c++){var g=n.extraFields[c];if(g.id===1){y=g.data;break}}if(y==null){return emitErrorAndAutoClose(e,new Error("expected zip64 extended information extra field"))}var v=0;if(n.uncompressedSize===4294967295){if(v+8>y.length){return emitErrorAndAutoClose(e,new Error("zip64 extended information extra field does not include uncompressed size"))}n.uncompressedSize=readUInt64LE(y,v);v+=8}if(n.compressedSize===4294967295){if(v+8>y.length){return emitErrorAndAutoClose(e,new Error("zip64 extended information extra field does not include compressed size"))}n.compressedSize=readUInt64LE(y,v);v+=8}if(n.relativeOffsetOfLocalHeader===4294967295){if(v+8>y.length){return emitErrorAndAutoClose(e,new Error("zip64 extended information extra field does not include relative header offset"))}n.relativeOffsetOfLocalHeader=readUInt64LE(y,v);v+=8}}if(e.decodeStrings){for(var c=0;c<n.extraFields.length;c++){var g=n.extraFields[c];if(g.id===28789){if(g.data.length<6){continue}if(g.data.readUInt8(0)!==1){continue}var b=g.data.readUInt32LE(1);if(i.unsigned(t.slice(0,n.fileNameLength))!==b){continue}n.fileName=decodeBuffer(g.data,5,g.data.length,true);break}}}if(e.validateEntrySizes&&n.compressionMethod===0){var S=n.uncompressedSize;if(n.isEncrypted()){S+=12}if(n.compressedSize!==S){var w="compressed/uncompressed size mismatch for stored file: "+n.compressedSize+" != "+n.uncompressedSize;return emitErrorAndAutoClose(e,new Error(w))}}if(e.decodeStrings){if(!e.strictFileNames){n.fileName=n.fileName.replace(/\\/g,"/")}var _=validateFileName(n.fileName,e.validateFileNameOptions);if(_!=null)return emitErrorAndAutoClose(e,new Error(_))}e.emit("entry",n);if(!e.lazyEntries)e._readEntry()}))}))};ZipFile.prototype.openReadStream=function(e,t,r){var n=this;var s=0;var i=e.compressedSize;if(r==null){r=t;t={}}else{if(t.decrypt!=null){if(!e.isEncrypted()){throw new Error("options.decrypt can only be specified for encrypted entries")}if(t.decrypt!==false)throw new Error("invalid options.decrypt value: "+t.decrypt);if(e.isCompressed()){if(t.decompress!==false)throw new Error("entry is encrypted and compressed, and options.decompress !== false")}}if(t.decompress!=null){if(!e.isCompressed()){throw new Error("options.decompress can only be specified for compressed entries")}if(!(t.decompress===false||t.decompress===true)){throw new Error("invalid options.decompress value: "+t.decompress)}}if(t.start!=null||t.end!=null){if(e.isCompressed()&&t.decompress!==false){throw new Error("start/end range not allowed for compressed entry without options.decompress === false")}if(e.isEncrypted()&&t.decrypt!==false){throw new Error("start/end range not allowed for encrypted entry without options.decrypt === false")}}if(t.start!=null){s=t.start;if(s<0)throw new Error("options.start < 0");if(s>e.compressedSize)throw new Error("options.start > entry.compressedSize")}if(t.end!=null){i=t.end;if(i<0)throw new Error("options.end < 0");if(i>e.compressedSize)throw new Error("options.end > entry.compressedSize");if(i<s)throw new Error("options.end < options.start")}}if(!n.isOpen)return r(new Error("closed"));if(e.isEncrypted()){if(t.decrypt!==false)return r(new Error("entry is encrypted, and options.decrypt !== false"))}n.reader.ref();var a=h(30);readAndAssertNoEof(n.reader,a,0,a.length,e.relativeOffsetOfLocalHeader,(function(c){try{if(c)return r(c);var l=a.readUInt32LE(0);if(l!==67324752){return r(new Error("invalid local file header signature: 0x"+l.toString(16)))}var u=a.readUInt16LE(26);var d=a.readUInt16LE(28);var p=e.relativeOffsetOfLocalHeader+a.length+u+d;var h;if(e.compressionMethod===0){h=false}else if(e.compressionMethod===8){h=t.decompress!=null?t.decompress:true}else{return r(new Error("unsupported compression method: "+e.compressionMethod))}var m=p;var y=m+e.compressedSize;if(e.compressedSize!==0){if(y>n.fileSize){return r(new Error("file data overflows file bounds: "+m+" + "+e.compressedSize+" > "+n.fileSize))}}var g=n.reader.createReadStream({start:m+s,end:m+i});var v=g;if(h){var b=false;var S=o.createInflateRaw();g.on("error",(function(e){setImmediate((function(){if(!b)S.emit("error",e)}))}));g.pipe(S);if(n.validateEntrySizes){v=new AssertByteCountStream(e.uncompressedSize);S.on("error",(function(e){setImmediate((function(){if(!b)v.emit("error",e)}))}));S.pipe(v)}else{v=S}v.destroy=function(){b=true;if(S!==v)S.unpipe(v);g.unpipe(S);g.destroy()}}r(null,v)}finally{n.reader.unref()}}))};function Entry(){}Entry.prototype.getLastModDate=function(){return dosDateTimeToDate(this.lastModFileDate,this.lastModFileTime)};Entry.prototype.isEncrypted=function(){return(this.generalPurposeBitFlag&1)!==0};Entry.prototype.isCompressed=function(){return this.compressionMethod===8};function dosDateTimeToDate(e,t){var r=e&31;var n=(e>>5&15)-1;var o=(e>>9&127)+1980;var s=0;var i=(t&31)*2;var a=t>>5&63;var c=t>>11&31;return new Date(o,n,r,c,a,i,s)}function validateFileName(e){if(e.indexOf("\\")!==-1){return"invalid characters in fileName: "+e}if(/^[a-zA-Z]:/.test(e)||/^\//.test(e)){return"absolute path: "+e}if(e.split("/").indexOf("..")!==-1){return"invalid relative path: "+e}return null}function readAndAssertNoEof(e,t,r,n,o,s){if(n===0){return setImmediate((function(){s(null,h(0))}))}e.read(t,r,n,o,(function(e,t){if(e)return s(e);if(t<n){return s(new Error("unexpected EOF"))}s()}))}a.inherits(AssertByteCountStream,l);function AssertByteCountStream(e){l.call(this);this.actualByteCount=0;this.expectedByteCount=e}AssertByteCountStream.prototype._transform=function(e,t,r){this.actualByteCount+=e.length;if(this.actualByteCount>this.expectedByteCount){var n="too many bytes in the stream. expected "+this.expectedByteCount+". got at least "+this.actualByteCount;return r(new Error(n))}r(null,e)};AssertByteCountStream.prototype._flush=function(e){if(this.actualByteCount<this.expectedByteCount){var t="not enough bytes in the stream. expected "+this.expectedByteCount+". got only "+this.actualByteCount;return e(new Error(t))}e()};a.inherits(RandomAccessReader,c);function RandomAccessReader(){c.call(this);this.refCount=0}RandomAccessReader.prototype.ref=function(){this.refCount+=1};RandomAccessReader.prototype.unref=function(){var e=this;e.refCount-=1;if(e.refCount>0)return;if(e.refCount<0)throw new Error("invalid unref");e.close(onCloseDone);function onCloseDone(t){if(t)return e.emit("error",t);e.emit("close")}};RandomAccessReader.prototype.createReadStream=function(e){var t=e.start;var r=e.end;if(t===r){var n=new u;setImmediate((function(){n.end()}));return n}var o=this._readStreamForRange(t,r);var s=false;var i=new RefUnrefFilter(this);o.on("error",(function(e){setImmediate((function(){if(!s)i.emit("error",e)}))}));i.destroy=function(){o.unpipe(i);i.unref();o.destroy()};var a=new AssertByteCountStream(r-t);i.on("error",(function(e){setImmediate((function(){if(!s)a.emit("error",e)}))}));a.destroy=function(){s=true;i.unpipe(a);i.destroy()};return o.pipe(i).pipe(a)};RandomAccessReader.prototype._readStreamForRange=function(e,t){throw new Error("not implemented")};RandomAccessReader.prototype.read=function(e,t,r,n,o){var s=this.createReadStream({start:n,end:n+r});var i=new d;var a=0;i._write=function(r,n,o){r.copy(e,t+a,0,r.length);a+=r.length;o()};i.on("finish",o);s.on("error",(function(e){o(e)}));s.pipe(i)};RandomAccessReader.prototype.close=function(e){setImmediate(e)};a.inherits(RefUnrefFilter,u);function RefUnrefFilter(e){u.call(this);this.context=e;this.context.ref();this.unreffedYet=false}RefUnrefFilter.prototype._flush=function(e){this.unref();e()};RefUnrefFilter.prototype.unref=function(e){if(this.unreffedYet)return;this.unreffedYet=true;this.context.unref()};var p="\0 !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";function decodeBuffer(e,t,r,n){if(n){return e.toString("utf8",t,r)}else{var o="";for(var s=t;s<r;s++){o+=p[e[s]]}return o}}function readUInt64LE(e,t){var r=e.readUInt32LE(t);var n=e.readUInt32LE(t+4);return n*4294967296+r}var h;if(typeof Buffer.allocUnsafe==="function"){h=function(e){return Buffer.allocUnsafe(e)}}else{h=function(e){return new Buffer(e)}}function defaultCallback(e){if(e)throw e}},5711:(e,t,r)=>{"use strict";r.r(t);var n=r(2186);var o=r(1257);var s=r(3129);var i=r(5517);var a=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var c=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,i;return i={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function verb(e){return function(t){return step([e,t])}}function step(i){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(s=i[0]&2?o["return"]:i[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;if(o=0,s)i=[i[0]&2,s.value];switch(i[0]){case 0:case 1:s=i;break;case 4:r.label++;return{value:i[1],done:false};case 5:r.label++;o=i[1];i=[0];continue;case 7:i=r.ops.pop();r.trys.pop();continue;default:if(!(s=r.trys,s=s.length>0&&s[s.length-1])&&(i[0]===6||i[0]===2)){r=0;continue}if(i[0]===3&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(i[0]===6&&r.label<s[1]){r.label=s[1];s=i;break}if(s&&r.label<s[2]){r.label=s[2];r.ops.push(i);break}if(s[2])r.ops.pop();r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e];o=0}finally{n=s=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}};var l=function(){function MemoryServerFactory(){}MemoryServerFactory.generateMemoryServer=function(e,t,r,n){return a(this,void 0,void 0,(function(){var s,i,a,l;return c(this,(function(c){switch(c.label){case 0:s={};i={checkMD5:true};if(e){s.dbName=e}if(t){s.port=t}if(r){s.storageEngine=r}if(n){i.version=n}a={instance:s,binary:i};return[4,o.MongoMemoryServer.create(a)];case 1:l=c.sent();return[2,l]}}))}))};MemoryServerFactory.verifyMemoryServer=function(e){return a(this,void 0,void 0,(function(){var t,r,n;return c(this,(function(o){switch(o.label){case 0:o.trys.push([0,2,3,6]);r=e.getUri();t=new i.MongoClient(r,{useUnifiedTopology:true,useNewUrlParser:true});return[4,t.connect()];case 1:o.sent();return[2,r];case 2:n=o.sent();console.error(n);throw n;case 3:if(!(t===null||t===void 0?void 0:t.isConnected()))return[3,5];return[4,t.close()];case 4:o.sent();o.label=5;case 5:return[7];case 6:return[2]}}))}))};return MemoryServerFactory}();var u=undefined&&undefined.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};var d=undefined&&undefined.__generator||function(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,i;return i={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(i[Symbol.iterator]=function(){return this}),i;function verb(e){return function(t){return step([e,t])}}function step(i){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,o&&(s=i[0]&2?o["return"]:i[0]?o["throw"]||((s=o["return"])&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;if(o=0,s)i=[i[0]&2,s.value];switch(i[0]){case 0:case 1:s=i;break;case 4:r.label++;return{value:i[1],done:false};case 5:r.label++;o=i[1];i=[0];continue;case 7:i=r.ops.pop();r.trys.pop();continue;default:if(!(s=r.trys,s=s.length>0&&s[s.length-1])&&(i[0]===6||i[0]===2)){r=0;continue}if(i[0]===3&&(!s||i[1]>s[0]&&i[1]<s[3])){r.label=i[1];break}if(i[0]===6&&r.label<s[1]){r.label=s[1];s=i;break}if(s&&r.label<s[2]){r.label=s[2];r.ops.push(i);break}if(s[2])r.ops.pop();r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e];o=0}finally{n=s=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:true}}};function runCommand(e,t){return u(this,void 0,void 0,(function(){var r,o;return d(this,(function(i){console.info('Executing the target script: "'+e+'"');r=n.getInput("db-connection-env-var");o=n.getInput("mongoms-debug");process.env[r]=t;if(o){process.env["MONGOMS_DEBUG"]="1"}try{return[2,(0,s.execSync)(e,{env:process.env,cwd:process.env.githubRepository}).toString()]}catch(e){console.error(e);throw e}return[2]}))}))}function run(){return u(this,void 0,void 0,(function(){var e,t,r,s,i,a,c,u,p;return d(this,(function(d){switch(d.label){case 0:d.trys.push([0,4,5,8]);t=n.getInput("instance-dbName");r=Number.parseInt(n.getInput("instance-port"));s=n.getInput("instance-storageEngine");i=n.getInput("binary-version");return[4,l.generateMemoryServer(t,r,s,i)];case 1:e=d.sent();return[4,l.verifyMemoryServer(e)];case 2:a=d.sent();c=n.getInput("run-command");return[4,runCommand(c,a)];case 3:u=d.sent();console.info(u);return[3,8];case 4:p=d.sent();n.setFailed(p.message);return[3,8];case 5:if(!((e===null||e===void 0?void 0:e.state)===o.MongoMemoryServerStates.running))return[3,7];return[4,e.stop()];case 6:d.sent();d.label=7;case 7:return[7];case 8:return[2]}}))}))}run()},3847:module=>{module.exports=eval("require")("aws4")},5764:module=>{module.exports=eval("require")("mongodb-client-encryption")},306:e=>{"use strict";e.exports={i8:"1.0.0"}},2357:e=>{"use strict";e.exports=require("assert")},4293:e=>{"use strict";e.exports=require("buffer")},3129:e=>{"use strict";e.exports=require("child_process")},7619:e=>{"use strict";e.exports=require("constants")},6417:e=>{"use strict";e.exports=require("crypto")},881:e=>{"use strict";e.exports=require("dns")},8614:e=>{"use strict";e.exports=require("events")},5747:e=>{"use strict";e.exports=require("fs")},8605:e=>{"use strict";e.exports=require("http")},7211:e=>{"use strict";e.exports=require("https")},1631:e=>{"use strict";e.exports=require("net")},2087:e=>{"use strict";e.exports=require("os")},5622:e=>{"use strict";e.exports=require("path")},1191:e=>{"use strict";e.exports=require("querystring")},1058:e=>{"use strict";e.exports=require("readline")},2413:e=>{"use strict";e.exports=require("stream")},4304:e=>{"use strict";e.exports=require("string_decoder")},8818:e=>{"use strict";e.exports=require("tls")},3867:e=>{"use strict";e.exports=require("tty")},8835:e=>{"use strict";e.exports=require("url")},1669:e=>{"use strict";e.exports=require("util")},8761:e=>{"use strict";e.exports=require("zlib")}};var __webpack_module_cache__={};function __nccwpck_require__(e){var t=__webpack_module_cache__[e];if(t!==undefined){return t.exports}var r=__webpack_module_cache__[e]={exports:{}};var n=true;try{__webpack_modules__[e].call(r.exports,r,r.exports,__nccwpck_require__);n=false}finally{if(n)delete __webpack_module_cache__[e]}return r.exports}(()=>{__nccwpck_require__.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var __webpack_exports__=__nccwpck_require__(1667);module.exports=__webpack_exports__})();